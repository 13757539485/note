{"config":{"lang":["ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#_1","title":"\u73af\u5883\u8981\u6c42","text":"<p>\u5b89\u88c5python</p>"},{"location":"#mkdocs","title":"mkdocs\u5b98\u7f51","text":"<p>https://www.mkdocs.org/user-guide/configuration/#build-directories</p>"},{"location":"#mkdocs_1","title":"\u5b89\u88c5mkdocs","text":"<p>window\uff1a <pre><code>pip install mkdocs\n</code></pre> linux\uff1a <pre><code>sudo pip install mkdocs\n</code></pre></p>"},{"location":"#_2","title":"\u521b\u5efa\u9879\u76ee","text":"<pre><code>mkdocs new xxx\n</code></pre>"},{"location":"#_3","title":"\u67e5\u770b\u9884\u89c8","text":"<p><pre><code>cd xxx\nmkdocs serve\n</code></pre> \u5728http://127.0.0.1:8000\u8fdb\u884c\u67e5\u770b</p>"},{"location":"#_4","title":"\u751f\u6210\u7f51\u9875","text":"<pre><code>mkdocs build\n</code></pre>"},{"location":"#_5","title":"\u53d1\u5e03","text":"<ol> <li>github\u914d\u7f6e</li> </ol> <p>\u914d\u7f6egit\u57fa\u672c\u4fe1\u606f <pre><code>git config --global user.name \"yuli\" // \u968f\u610f\u586b\u5199\ngit config --global user.email \"1875287386@qq.com\" // \u548cgithub\u7ed1\u5b9a\u90ae\u7bb1\u4e00\u81f4\ngit config --global credential.helper store\n</code></pre> \u751f\u6210ssh\uff0c\u6267\u884c\u5e76\u4e00\u8def\u56de\u8f66 <pre><code>ssh-keygen -t rsa -C '1875287386@qq.com'\n</code></pre> \u5c06id_rsa.pub\u5185\u5bb9\u7c98\u8d34\u5230\u7f51\u7ad9\u4e2d https://github.com/settings/keys</p> <ol> <li>github\u521b\u5efa\u9879\u76ee\u540d\u4e3anote\uff0c\u4ed3\u5e93\u5fc5\u987b\u662fpublic\uff0c\u8fdb\u5165\u5230mkdocs\u521b\u5efa\u7684\u9879\u76ee\u6587\u4ef6\u5939\u4e2d\uff0c\u6839\u636egithub\u4e0a\u63d0\u793a\u547d\u4ee4\u6267\u884c <pre><code>git init\ngit add .\ngit commit -m \"\u521d\u59cb\u5316mkdocs\u9879\u76ee\"\ngit remote add origin git@github.com:13757539485/note.git\ngit branch -M main // \u7528\u6765\u5b58\u653e\u6e90\u7801\u4f7f\u7528\ngit push -u origin main\n</code></pre></li> <li>\u6267\u884c\u4e00\u4e0b\u547d\u4ee4\uff0c\u5de5\u5177\u5c31\u4f1a\u81ea\u52a8\u5c06\u76f8\u5e94\u5185\u5bb9\u63a8\u9001\u5230\u9879\u76ee\u7684 gh-pages \u5206\u652f\u4e0a <pre><code>mkdocs gh-deploy // \u4f1a\u81ea\u52a8\u521b\u5efa\u5206\u652f\u540d\u4e3agh-deploy\u5e76\u5b58\u653e\u7f51\u9875\u6e90\u7801\n</code></pre></li> <li> <p>\u5728github\u9879\u76ee\u4e2d\u6309\u7167\u56fe\u4e2d\u914d\u7f6e\u5373\u53ef </p> </li> <li> <p>\u6d4f\u89c8https://username.github.io/project-name</p> </li> </ol> <p>https://13757539485.github.io/note</p> <ol> <li>\u5982\u679c\u7f51\u9875\u6ca1\u5237\u65b0\uff0c\u53ef\u4ee5\u624b\u52a8\u91cd\u65b0\u89e6\u53d1\u6784\u5efa\u53d1\u5e03</li> </ol> <p>https://github.com/13757539485/note/actions</p> <p>\u627e\u5230\u5931\u8d25\u7684job\u6216\u8005\u6700\u65b0\u7684</p> <p></p> <p>\u6253\u5f00\u540e\u91cd\u65b0\u89e6\u53d1</p> <p></p>"},{"location":"#yaml","title":"yaml\u76f8\u5173\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"#material","title":"\u5b89\u88c5material\u4e3b\u9898","text":"<p><pre><code>pip install mkdocs-material\n</code></pre> linux\u9700\u8981\u4f7f\u7528sudo</p>"},{"location":"#_6","title":"\u914d\u7f6e\u4e3b\u9898","text":"<pre><code>theme: \n  name: material\n  language: zh\n  palette:\n    primary: 'Light Blue'\n    accent: 'Light Blue'\n  features:\n    - navigation.tabs\n  font:\n    text: Microsoft YaHei\n    code: Courier New\n</code></pre>"},{"location":"#_7","title":"\u5176\u4ed6\u914d\u7f6e(\u53ef\u5ffd\u7565)","text":"<p><pre><code>markdown_extensions:\n  - admonition\n  - codehilite:\n      guess_lang: false\n      linenums: false\n  - toc:\n      permalink: true\n  - footnotes\n  - meta\n  - def_list\n  - pymdownx.arithmatex\n  - pymdownx.betterem:\n      smart_enable: all\n  - pymdownx.caret\n  - pymdownx.critic\n  - pymdownx.details\n  - pymdownx.emoji:\n      emoji_generator: !!python/name:pymdownx.emoji.to_png\n      #emoji_generator: !!python/name:pymdownx.emoji.to_svg\n      #emoji_generator: !!python/name:pymdownx.emoji.to_png_sprite\n      #emoji_generator: !!python/name:pymdownx.emoji.to_svg_sprite\n      #emoji_generator: !!python/name:pymdownx.emoji.to_awesome\n      #emoji_generator: !!python/name:pymdownx.emoji.to_alt\n  - pymdownx.inlinehilite\n  - pymdownx.magiclink\n  - pymdownx.mark\n  - pymdownx.smartsymbols\n  - pymdownx.superfences\n  - pymdownx.tasklist\n  - pymdownx.tilde\n\nextra:\n  search:\n    language: 'en,zh,jp'\n\nplugins:\n  - search\n</code></pre> \u4e3b\u9875\u9ed8\u8ba4\u4e3aindex.md</p> <p>\u66f4\u591a\u5b66\u4e60\uff1a</p> <p>https://zhuanlan.zhihu.com/p/613038183 https://squidfunk.github.io/mkdocs-material/setup/changing-the-colors/</p>"},{"location":"ai/","title":"AI","text":"<p>\u6587\u5fc3\u4e00\u8a00</p> <p>\u901a\u4e49\u5343\u95ee</p> <p>OpenAI</p> <p>elijahjom7o@outlook.com gH1HSlvjgH1HSlvj</p>"},{"location":"excel/","title":"Excel","text":""},{"location":"excel/#_1","title":"\u5e38\u7528\u7b26\u53f7","text":"\u7b26\u53f7 \u4f5c\u7528 ~ \u8f6c\u4e49\u5b57\u7b26 ? \u901a\u914d\u7b26 * \u8868\u793a\u4e00\u4e2a\u6216\u4e00\u4e32\u5b57\u7b26 &lt;&gt; \u4e0d\u7b49\u4e8e $ \u8868\u793a\u7edd\u5bf9\u5f15\u7528\uff0c\u5982$A1\u5219A\u56fa\u5b9a1\u662f\u53ef\u53d8"},{"location":"excel/#_2","title":"\u51fd\u6570","text":""},{"location":"excel/#if","title":"if\u51fd\u6570","text":"<ul> <li> <p>\u57fa\u672c\u4f7f\u7528 <pre><code>IF(\u6d4b\u8bd5\u6761\u4ef6, \"\u771f\",\"\u5047\")\n</code></pre> \u5982\uff1a=IF(B2=-1,\"\u4e0d\u663e\u793a\",B2))         \u5982\u679cB2\u7b49\u4e8e-1\uff0c\u5219\u5355\u5143\u683c\u663e\u793a\u5185\u5bb9\u4e3a\u201c\u4e0d\u663e\u793a\u201d\uff0c\u5426\u5219\u663e\u793aB2\u5177\u4f53\u5185\u5bb9</p> </li> <li> <p>\u5d4c\u5957\u4f7f\u7528</p> </li> </ul> <p>\u5982\uff1a=IF(B2=-1,\"\u4e0d\u663e\u793a\",IF(B2&gt;5,\"\u4e0d\u5408\u9002\",B2)) \u5982\u679cB2\u7b49\u4e8e-1\uff0c\u5219\u5355\u5143\u683c\u663e\u793a\u5185\u5bb9\u4e3a\u201c\u4e0d\u663e\u793a\u201d\uff0c\u5426\u5219\u518d\u5224\u65adB2\u662f\u5426\u5927\u4e8e5\uff0c\u5927\u4e8e\u5219\u663e\u793aB2\u5177\u4f53\u5185\u5bb9\uff0c\u5426\u5219\u5355\u5143\u683c\u663e\u793a\u5185\u5bb9\u4e3a\u201c\u4e0d\u5408\u9002\u201d</p> <ul> <li>\u591a\u4e2a\u6761\u4ef6\u540c\u65f6\u4f7f\u7528</li> </ul> <p>\u5982\uff1a=IF(B2=-1,\"-\",IF(AND(I3=\"\u5bf9\",L3=\"\u5bf9\"),\"\u4e2d\",\"\u4e0d\u4e2d\"))</p> <p>\u5982\u679cB2\u4e0d\u4e3a-1\uff0c\u5224\u65adI3\u548cL3\u662f\u5426\u540c\u65f6\u4e3a\u201c\u5bf9\u201d\uff0c\u663e\u793a\u4e0d\u540c\u7684\u7ed3\u679c \u7c7b\u4f3c\u7684=IF(B2=-1,\"-\",IF(OR(I3=\"\u5bf9\",L3=\"\u5bf9\"),\"\u4e2d\",\"\u4e0d\u4e2d\"))</p> <p>\u8fd9\u91ccI3\u548cL3\u53ea\u8981\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u5373\u4e3a\u771f AND\u53ef\u4ee5\u4f7f\u7528*\u4ee3\u66ff\uff0c=IF(B2=-1,\"-\",IF((I3=\"\u5bf9\")*(L3=\"\u5bf9\"),\"\u4e2d\",\"\u4e0d\u4e2d\"))</p> <p>OR\u53ef\u4ee5\u4f7f\u7528+\u4ee3\u66ff\uff0c=IF(B2=-1,\"-\",IF((I3=\"\u5bf9\")+(L3=\"\u5bf9\"),\"\u4e2d\",\"\u4e0d\u4e2d\"))</p>"},{"location":"excel/#countif","title":"COUNTIF\u51fd\u6570","text":"<ul> <li> <p>\u57fa\u672c\u4f7f\u7528 <pre><code>COUNTIF(\u7edf\u8ba1\u8303\u56f4, \u6761\u4ef6)\n</code></pre> \u5982\uff1a=COUNTIF(B3:D3,H3) \u7edf\u8ba1B3\u5230D3\u533a\u57df\u91cc\u548cH3\u5185\u5bb9\u76f8\u540c\u7684\u6570\u91cf\uff0c\u663e\u793a\u5230\u5355\u5143\u683c\u4e2d</p> </li> <li> <p>\u548cIF\u5d4c\u5957\u4f7f\u7528</p> </li> </ul> <p>\u5982\uff1a=IF(B2=-1,\"\u65e0\u6548\",IF(COUNTIF(B3:D3,H3),\"\u9519\",\"\u5bf9\")) B2\u4e0d\u662f\u65e0\u6548\u65f6\uff0c\u7edf\u8ba1B3\u5230D3\u5b58\u5728\u591a\u5c11\u4e2aH3\u503c\uff0c\u5982\u679c\u4e3a0\u5219\u663e\u793a\u5bf9\uff0c\u5426\u5219\u663e\u793a\u9519</p> <ul> <li>\u5176\u4ed6\u4f7f\u7528</li> </ul> <p>=COUNTIF(E2:E12,\"&gt;=90\")\u00a0\uff0c\"&gt;=90\" \u4e5f\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a\"&gt;=\"&amp;90</p> <p>=COUNTIF(B2:B12,\"\u7c89\u7ea2*\")</p> <p>=COUNTIF(F2:F12,\"&gt;\"&amp;AVERAGE(F2:F12))</p> <ul> <li>\u6570\u7ec4\u7ec4\u5408\u591a\u91cd\u6761\u4ef6</li> </ul> <p>\u5982\u7edf\u8ba1&gt;=350\u4ee5\u53ca&lt;=750\u7684\u8ba1\u6570\u548c =SUM(COUNTIF(F2:F12,{\"&gt;=350\",\"&gt;750\"})*{1,-1})</p> <p>\u5982\u679c\u6761\u4ef6\u586b\u5199&lt;=750\u4f1a\u628a&lt;350\u7684\u4e5f\u7edf\u8ba1\u8fdb\u6765 \u5982\u679c\u4e0d\u548c(*)\u4e0a{1,-1}\uff0c\u9ed8\u8ba4\u7ed3\u679c\u662f\u5c06\u4e24\u4e2a\u6761\u4ef6\u7ed3\u679c\u76f8\u52a0\uff0c\u7406\u60f3\u7ed3\u679c\u662f\u76f8\u51cf\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u540e\u9762\u7684\u7ed3\u679c\u53d8\u6210\u8d1f\u6570 \u6216\u8005\u76f4\u63a5\u6539\u6210=COUNTIF(F2:F12,\"&gt;350\"\uff09- COUNTIF(F2:F12,\"&gt;750\"\uff09</p>"},{"location":"excel/#mod","title":"MOD\u51fd\u6570","text":"<p><pre><code>MOD(\u6570\u503c,\u9664\u6570)\n</code></pre> \u5982\uff1a=MOD(1000,10)        \u7ed3\u679c\u662f0\uff0c\u9664\u6570\u662f10\u5219\u4fdd\u7559\u4e2a\u4f4d\uff0c\u76f8\u5f53\u4e8e\u9664\u4f59\u64cd\u4f5c</p>"},{"location":"excel/#rows","title":"ROWS\u51fd\u6570","text":"<p><pre><code>ROWS(\u6570\u7ec4)\n</code></pre> \u5982\uff1a=ROWS(I3:I13) \u7ed3\u679c\u662f11\uff0c\u8fd4\u56de\u7684\u662f\u533a\u57df\u7684\u603b\u884c\u6570</p>"},{"location":"excel/#choose","title":"CHOOSE\u51fd\u6570","text":""},{"location":"excel/#vlookup","title":"VLOOKUP\u51fd\u6570","text":""},{"location":"excel/#match","title":"MATCH\u51fd\u6570","text":""},{"location":"excel/#lookup","title":"LOOKUP\u51fd\u6570","text":"<pre><code>\u4e09\u4e2a\u53c2\u6570(keys1, keys2, values)\nkeys1:\u8868\u793a\u8981\u67e5\u627e\u7684key\uff0c\u53ef\u4ee5\u662f\u591a\u4e2a\nkeys2:\u8868\u793a\u5b9a\u4e49\u597d\u7684\u96c6\u5408\u4e2d\u7684key\nvalues:\u8868\u793a\u96c6\u5408\u4e2d\u7684key\u5bf9\u5e94\u7684value\n</code></pre>"},{"location":"excel/#searchfind","title":"SEARCH\u548cFIND\u51fd\u6570","text":"<p>\u4e24\u4e2a\u53c2\u6570(\u8981\u67e5\u627e\u7684\u5b57\u7b26\u4e32\uff0c\u88ab\u67e5\u627e\u7684\u5b57\u7b26\u4e32\uff0c\u5f00\u59cb\u4f4d\u7f6e) \u5176\u4e2d\u5f00\u59cb\u4f4d\u7f6e\u53ef\u4ee5\u4e0d\u586b\uff0c\u9ed8\u8ba4\u4ece\u7b2c\u4e00\u4e2a\u4f4d\u7f6e\u5f00\u59cb *search\u4e0d\u533a\u5206\u5927\u5c0f\u5199\uff0cfind\u533a\u5206\u5927\u5c0f\u5199\uff0c\u90fd\u8fd4\u56de\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u4f4d\u7f6e</p>"},{"location":"excel/#iferror","title":"IFERROR\u51fd\u6570","text":"<p>\u4e24\u4e2a\u53c2\u6570(\u503c\uff0c\u9519\u8bef\u503c) \u53ef\u4ee5\u914d\u5408search\u51fd\u6570\uff0csearch\u51fd\u6570\u5982\u679c\u627e\u4e0d\u5230\u4f1a\u8fd4\u56de\u9519\u8bef\u503c(#VALUE!)\uff0cIFERROR\u51fd\u6570\u53ef\u4ee5\u5c06\u9519\u8bef\u503c\u91cd\u65b0\u8bbe\u7f6e\u6210\u81ea\u5df1\u60f3\u8981\u7684\u503c IFERROR(\u9519\u8bef\u503c\uff0c\u81ea\u884c\u6307\u5b9a\u503c)</p>"},{"location":"excel/#_3","title":"\u6848\u4f8b","text":"<ul> <li>\u7edf\u8ba1\u6700\u5927\u8fde\u7eed\u51fa\u73b0\"A\"\u7684\u6b21\u6570 <pre><code>MAX(FREQUENCY(IF($V2:$V1441=\"A\",ROW(V2:V1441)),IF($V2:$V1441=\"B\",ROW(V2:V1441))))\n</code></pre></li> <li> <p>\u7edf\u8ba1\u8fde\u7eed\u51fa\u73b0(1,2,3,...,N)\u6b21\u7684\u6b21\u6570 <pre><code>SUM(N(FREQUENCY(IF($O1:$O1419=\"A\",ROW(O1:O1419)),IF($O1:$O1419=\"B\",ROW(O1:O1419)))=COLUMN(A1)))\n</code></pre> COLUMN(A1)\u7528\u6765\u786e\u5b9aN\u7684\u503c\uff0cA1\u5373\u51fa\u73b0\u8fde\u7eed1\u6b21\u7684A\u7684\u6b21\u6570 \u4ee5\u4e0a\u90fd\u9700\u8981shift+ctrl+\u56de\u8f66</p> </li> <li> <p>\u81ea\u52a8\u52a00\u516c\u5f0f\uff1a <pre><code>IF(B2&lt;10,\"0000\"&amp;B2,IF(B2&lt;100,\"000\"&amp;B2,\nIF(B2&lt;1000,\"00\"&amp;B2,IF(B2&lt;10000,\"0\"&amp;B2,B2))))\n</code></pre></p> </li> <li>\u5982\u56fe\u6548\u679c</li> </ul> <p> <pre><code>\u5904\u7406\u7b2c\u4e00\u4e2a\u7a7a\u7684\u4f4d\u7f6e(A1)\uff1a=IF(A1=\"\u7a7a\",1,0)\n\u540e\u9762\u7684\u76f4\u63a5=IF(A2=\"\u7a7a\",B1+1,IF(A2=0,0,\"--\"))\n</code></pre> * \u628a\u5185\u5bb915894\u5206\u5272 <pre><code>=MID($A1,COLUMN(B1)-1,1)\n</code></pre> MID(\u5206\u5272\u7684\u5185\u5bb9\uff0c\u5f00\u59cb\u4f4d\u7f6e\uff0c\u5206\u5272\u4e2a\u6570) \u5982\u679c\u5185\u5bb9\u5b58\u5728\u7279\u70b9\u7b26\u53f7\u598245122-4578\uff0c\u53ef\u4ee5\u4f7f\u7528\u5de5\u5177\u5206\u5272 \u9009\u62e9\u9700\u8981\u5206\u5272\u7684\u533a\u57df\uff0c\u6570\u636e--\u5206\u5217--\u5206\u5272\u7b26\u53f7(\u6216\u8005\u56fa\u5b9a\u5bbd\u5ea6)--\u9009\u62e9\u7b26\u53f7(\u6807\u8bb0\u5206\u5272\u7ebf)--\u5b8c\u6210</p>"},{"location":"git_github/","title":"git\u90e8\u7f72","text":""},{"location":"git_github/#git","title":"git\u5b89\u88c5","text":"<p>window:</p> <p>https://gitforwindows.org/</p> <p>linux/mac: <pre><code>sudo apt install git\nbrew install git\n</code></pre></p>"},{"location":"git_github/#_1","title":"\u914d\u7f6e\u7528\u6237\u4fe1\u606f","text":"<pre><code>git config --global user.name \"xxx\"\ngit config --global user.email \"xxx\"\n</code></pre>"},{"location":"git_github/#_2","title":"\u521b\u5efa\u4ee3\u7801\u4ed3\u5e93","text":"<pre><code>git init\n</code></pre>"},{"location":"git_github/#_3","title":"\u63d0\u4ea4\u4ee3\u7801","text":"<pre><code>git add xxx\ngit commit -m \"xxx\"\n</code></pre>"},{"location":"git_github/#_4","title":"\u5206\u652f\u5904\u7406","text":"<p><pre><code>git branch\u67e5\u770b\u672c\u5730\u6240\u6709\u5206\u652f\ngit branch -a\u67e5\u770b\u8fdc\u7a0b\u6240\u6709\u5206\u652f\ngit branch -D xxx \u5220\u9664\u67d0\u4e2a\u5206\u652f\ngit checkout xxx\u5207\u6362\u5230\u67d0\u4e2a\u5206\u652f\ngit branch xxx\u65b0\u5efaxxx\u672c\u5730\u5206\u652f\n</code></pre> \u5408\u5e76\u4fee\u6539\u5230\u4e3b\u5206\u652f\uff1a <pre><code>git checkout \u4e3b\u5206\u652f\ngit merge \u672c\u5730\u5206\u652f\n</code></pre> \u89e3\u51b3\u51b2\u7a81</p>"},{"location":"git_github/#github","title":"\u63d0\u4ea4\u4ee3\u7801\u5230github","text":"<p>1)github\u4e0a\u65b0\u5efa\u9879\u76ee(New repository)</p> <p> 2)\u672c\u5730\u751f\u6210SSH</p> <p>\u9002\u5f53\u4f4d\u7f6e\u4e0b\u6267\u884c\uff1a <pre><code>git init\n</code></pre> \u7136\u540e\u6267\u884c\uff1a <pre><code>ssh-keygen -t rsa -C \"\u90ae\u7bb1\"\n</code></pre> \u5bc6\u7801\u53ef\u4e0d\u586b\u76f4\u63a5\u56de\u8f66</p> <p>\u751f\u6210\u5b8c\u6bd5\u540e\u5230\u751f\u6210\u76ee\u5f55(C:\\Users\\window.ssh)\u590d\u5236id_rsa.pub\u91cc\u7684\u5185\u5bb9\u5230github\u4e0a</p> <p>\u4f4d\u7f6e\uff1aSettings--SSH and GPG keys</p> <p> \u6dfb\u52a0\u65b0\u7684key(New SSH key)</p> <p>3)\u6dfb\u52a0\u8fdc\u7a0b\u5730\u5740</p> <p></p> <p>git remote add origin git@github.com:13757539485/AndroidForAll.git</p> <p>4)\u63d0\u4ea4\u672c\u5730\u4ee3\u7801</p> <p>Android Studio\u65b0\u5efa\u9879\u76ee <pre><code>git branch -a\n\n\u590d\u5236\u8fdc\u7a0b\u5206\u652f remotes/origin/master\n\ngit reset --mixed remotes/origin/master\n\ngit add .\n\ngit commit -m \"project init\"\n\ngit push  (remotes/origin/master master)\n</code></pre> 5)\u521b\u5efa\u8fdc\u7a0b\u5206\u652f <pre><code>git checkout -b xxx\n\ngit push origin xxx:xxx\n</code></pre> 6)\u5220\u9664\u8fdc\u7a0b\u5206\u652f <pre><code>git push origin --delete xxx\n</code></pre></p>"},{"location":"git_github/#_5","title":"\u5176\u4ed6\u547d\u4ee4","text":"<pre><code>git fetch\n\ngit diff --cached\n\ngit format-patch\u6253\u8865\u4e01\n\ngit tag\n\ngit config --global commit.template  [\u6a21\u677f\u6587\u4ef6\u540d]\n\ngit config --global core.editor  [\u7f16\u8f91\u5668\u540d\u5b57] \u5982C:/windows/notepad.exe\n</code></pre>"},{"location":"git_github/#_6","title":"\u67e5\u770b\u914d\u7f6e\u4fe1\u606f","text":"<p>\u67e5\u770b\u7cfb\u7edfconfig <pre><code>git config --system --list\uff08\u4e00\u822c\u6ca1\u6709\uff09\n</code></pre> \u67e5\u770b\u5f53\u524d\u7528\u6237\uff08global\uff09\u914d\u7f6e\uff0c\u76f8\u5f53\u4e8e\u5168\u5c40 <pre><code>git config --global --list\n</code></pre> \u67e5\u770b\u5f53\u524d\u4ed3\u5e93\u914d\u7f6e\u4fe1\u606f\uff0c\u76f8\u5f53\u4e8e\u4f5c\u7528\u4e8e\u8fd9\u4e2a\u4ed3\u5e93 <pre><code>git config --local --list\n</code></pre></p>"},{"location":"git_github/#_7","title":"\u914d\u7f6e\u522b\u540d","text":"<p>\u5982\u8bbe\u7f6estatus\u7b80\u5199st <pre><code>git config --global alias.st status\ngit config --global alias.ch checkout\ngit config --global alias.co commit\ngit config --global alias.br branch\ngit config --global alias.sh stash\n\ngit config --global alias.lg \"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit\"\n\ngit config --global alias.last 'log -1'\n</code></pre> \u6216\u8005\u76f4\u63a5\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u6dfb\u52a0\uff0c~/.gitconfig</p> <p>[user]</p> <p>email = 1875287386@qq.com</p> <p>name = yuli [core]</p> <p>editor = vi [commit]</p> <p>template = /home/yuli/CommitTemplate [color]</p> <p>ui = auto [alias]</p> <p>last = log -1</p> <p>lg = log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset' --abbrev-commit</p> <p>ch = checkout</p> <p>co = commit</p> <p>br = branch</p> <p>st = status</p> <p>Window\u4e0agit diff\u51fa\u73b0^M\u95ee\u9898 <pre><code>git config --global core.autocrlf true\n</code></pre> git tag\u4f7f\u7528 <pre><code>git tag -l\u67e5\u770b\u6240\u6709tag\n</code></pre> \u521b\u5efatag\uff1a <pre><code>git tag tagName \u6216\u8005\n\ngit tag -a tagName -m \"\u5907\u6ce8\u4fe1\u606f\"\n</code></pre> \u63d0\u4ea4tag\uff1a <pre><code>git push origin tagName\n</code></pre> \u5220\u9664tag <pre><code>git tag -d tagName\n</code></pre> \u7279\u5b9acommit\u6dfb\u52a0tag <pre><code>git tag tagName  commit_id\n</code></pre> \u6307\u5b9atag\u4e0a\u4fee\u6539\u4ee3\u7801\uff1a <pre><code>git checkout -b branch_name tagName\n</code></pre> \u4fee\u6539\u540e\u63d0\u4ea4 <pre><code>git push --set-upstream origin branch_name\n</code></pre></p>"},{"location":"git_github/#repo","title":"\u6e05\u7406repo\u7f13\u5b58","text":"<pre><code>repo forall -c \"git gc\"\nrm -rf .repo/objects/*\nrm -rf .repo/logs/*\nrm -rf .repo/cache/*\nrepo sync --no-repo-verify -c\n</code></pre>"},{"location":"git_github/#aosp","title":"aosp\u67e5\u770b\u5206\u652f","text":"<pre><code>git --git-dir=.repo/manifests/.git/ branch -av\n</code></pre>"},{"location":"git_github/#aosp_1","title":"aosp\u6e05\u7406\u4fee\u6539","text":"<pre><code>repo forall -c 'git stash' # \u5148\u6682\u5b58\u6240\u6709\u66f4\u6539\uff08\u5982\u679c\u6709\uff09\nrepo forall -c 'git checkout .'\nrepo forall -c 'git clean -fdx' # \u6e05\u7406\u672a\u8ddf\u8e2a\u6587\u4ef6\u548c\u76ee\u5f55\nrepo forall -c 'git reset --hard HEAD' # \u786c\u91cd\u7f6e\u6240\u6709\u6a21\u5757\u5230HEAD\nrepo forall -c 'git stash drop' # \u5220\u9664\u6682\u5b58\u533a\u7684\u6539\u52a8\uff08\u5982\u679c\u524d\u9762\u6267\u884c\u4e86stash\n</code></pre>"},{"location":"markdown/","title":"Markdown","text":""},{"location":"markdown/#_1","title":"\u4ee3\u7801\u5feb","text":"<p>```java/kotlin/xml\u7b49</p> <p>//\u4ee3\u7801</p> <p>```</p>"},{"location":"markdown/#_2","title":"\u6587\u5b57\u989c\u8272","text":"<p>&lt;font color=\"#dd0000\"&gt;\u6587\u5b57\u989c\u8272&lt;/font&gt;</p>"},{"location":"markdown/#_3","title":"\u6807\u9898","text":"<p># \u4e00\u7ea7</p> <p>## \u4e8c\u7ea7</p>"},{"location":"markdown/#_4","title":"\u5b57\u4f53","text":"<p>*\u659c\u4f53*</p> <p>_\u659c\u4f53_</p> <p>**\u52a0\u7c97**</p> <p>***\u503e\u659c\u52a0\u7c97***</p> <p>~~\u4e0b\u5212\u7ebf~~</p>"},{"location":"markdown/#_5","title":"\u56fe\u7247/\u8fde\u63a5/\u8df3\u8f6c","text":"<p>![\u56fe\u7247](/\u77ed\u89c6\u9891\u5c01\u9762/083.jpg)</p> <p>[\u94fe\u63a5](\u7f51\u5740) </p> <p>\u7eaf\u82f1\u6587\u6807\u9898\u8df3\u8f6c\uff1a [\u6587\u5b57](\u6587\u4ef6\u8def\u5f84/#title)</p> <p>\u542b\u4e2d\u6587\u6807\u9898\u8df3\u8f6c\uff1a</p> <p>\u5148\u5728\u8981\u8df3\u8f6c\u7684\u6807\u9898\u6dfb\u52a0a\u6807\u7b7e\uff0c\u5982\"##### &lt;a id=\"title\"&gt;\u6807\u9898&lt;/a&gt;\"</p> <p>\u7136\u540e\u8c03\u7528\uff1a [\u6587\u5b57](\u6587\u4ef6\u8def\u5f84/#title)</p>"},{"location":"python/","title":"\u5b89\u88c5","text":"<p>\u8fdb\u5165\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5\u5373\u53ef</p>"},{"location":"python/#_2","title":"\u73af\u5883\u53d8\u91cf","text":""},{"location":"python/#windows","title":"windows","text":"<ol> <li>\u65b0\u5efapython_home\uff0c\u6dfb\u52a0\u5b89\u88c5\u8def\u5f84\uff0c\u5982\u56fe</li> </ol> <ol> <li>path\u4e2d\u6dfb\u52a0\u53d8\u91cf\uff0c\u5982\u56fe</li> </ol> <ol> <li>\u67e5\u770bpython\u7248\u672c\uff0c\u68c0\u6d4b\u73af\u5883\u662f\u5426\u6b63\u5e38</li> </ol> <pre><code>python -V\n</code></pre> <ol> <li>\u67e5\u770bpip\u7248\u672c</li> </ol> <pre><code>pip -V\n</code></pre>"},{"location":"python/#linux","title":"linux","text":"<p>python\u4e00\u822c\u9ed8\u8ba4\u81ea\u5e26\uff0c\u751f\u6210\u4e00\u4e0b\u8f6f\u94fe\u63a5\u5373\u53ef <pre><code>sudo ln -s /usr/bin/python3.10 /usr/bin/python\n</code></pre> - \u5176\u4e2d/usr/bin/python3.10\u53ef\u901a\u8fc7which python3\u6309Tab\u952e\u67e5\u770b</p> <p>\u5b89\u88c5pip <pre><code>sudo apt install pip\n</code></pre></p>"},{"location":"android/android_build_apk/","title":"Apk\u76f8\u5173","text":""},{"location":"android/android_build_apk/#_1","title":"\u591a\u6e20\u9053\u6253\u5305","text":""},{"location":"android/android_build_apk/#_2","title":"\u4ec0\u4e48\u662f\u591a\u6e20\u9053\u5305\uff1f","text":"<p>\u6e20\u9053\u5305\u5c31\u662f\u8981\u5728\u5b89\u88c5\u5305\u4e2d\u6dfb\u52a0\u6e20\u9053\u4fe1\u606f\uff0c\u4e5f\u5c31\u662fchannel\uff0c\u5bf9\u5e94\u4e0d\u540c\u7684\u6e20\u9053\uff0c\u4f8b\u5982\uff1a\u5c0f\u7c73\u5e02\u573a\u3001ov\u5e02\u573a\u3001\u5e94\u7528\u5b9d\u5e02\u573a\u7b49</p>"},{"location":"android/android_build_apk/#_3","title":"\u4e3a\u4ec0\u4e48\u8981\u63d0\u4f9b\u591a\u6e20\u9053\u5305\uff1f","text":"<p>\u5728\u5b89\u88c5\u5305\u4e2d\u6dfb\u52a0\u4e0d\u540c\u7684\u6807\u8bc6\uff0c\u5e94\u7528\u5728\u8bf7\u6c42\u7f51\u7edc\u7684\u65f6\u5019\u643a\u5e26\u6e20\u9053\u4fe1\u606f\uff0c\u65b9\u4fbf\u540e\u53f0\u505a\u8fd0\u8425\u7edf\u8ba1</p>"},{"location":"android/android_build_apk/#360","title":"360\u6253\u5305","text":""},{"location":"android/android_build_apk/#1","title":"1.\u539f\u7406","text":"<p>apk\u6587\u4ef6\u672c\u8d28\u5c31\u662fzip\u6587\u4ef6,\u5229\u7528zip\u6587\u4ef6\u201c\u53ef\u4ee5\u6dfb\u52a0comment\uff08\u6458\u8981\uff09\u201d\u7684\u6570\u636e\u7ed3\u6784\u7279\u70b9\uff0c\u5728\u6587\u4ef6\u7684\u672b\u5c3e\u5199\u5165\u4efb\u610f\u6570\u636e\uff0c\u800c\u4e0d\u7528\u91cd\u65b0\u89e3\u538bzip\u6587\u4ef6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u6e20\u9053\u4fe1\u606f\u5199\u5165\u6458\u8981\u533a</p>"},{"location":"android/android_build_apk/#2","title":"2.\u65b9\u6cd5","text":"<p>https://jiagu.360.cn/#/global/download</p>"},{"location":"android/android_build_apk/#3","title":"3.\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9: 1\u30015M\u7684apk\uff0c1\u79d2\u79cd\u80fd\u6253300\u4e2a 2\u3001\u5728\u4e0b\u8f7dapk\u7684\u540c\u65f6\uff0c\u670d\u52a1\u7aef\u53ef\u4ee5\u5199\u5165\u4e00\u4e9b\u4fe1\u606f\uff0c\u4f8b\u5982\u9080\u8bf7\u7801\uff0c\u5206\u4eab\u4fe1\u606f\u7b49 \u7f3a\u70b9: \u6e20\u9053\u4fe1\u606f\u4e5f\u662f\u5f88\u5bb9\u6613\u4fee\u6539\uff0c\u867d\u7136\u53ef\u4ee5\u52a0\u5bc6\uff0c\u53ea\u662f\u63d0\u9ad8\u4e86\u4fee\u6539\u7684\u95e8\u69db</p>"},{"location":"android/android_build_apk/#_4","title":"\u53cb\u76df\u6253\u5305","text":""},{"location":"android/android_build_apk/#1_1","title":"1.\u539f\u7406","text":"<p>\u4e00\u822c\u6765\u8bb2\uff0c\u8fd9\u4e2a\u6e20\u9053\u7684\u6807\u8bc6\u4f1a\u653e\u5728AndroidManifest.xml\u7684Application\u7684\u4e00\u4e2aMetadata\u4e2d\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u5728java\u4e2d\u901a\u8fc7API\u83b7\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u4e86\u3002</p>"},{"location":"android/android_build_apk/#2_1","title":"2.\u65b9\u6cd5","text":"<p>\u7b2c\u4e00\u79cd\uff1a\u53cb\u76df\u5c31\u63d0\u4f9b\u4e86\u591a\u6e20\u9053\u6253\u5305\u7684\u65b9\u5f0f\uff0c\u53ef\u7528\u4e8e\u6e20\u9053\u7edf\u8ba1\u7b49\u3002 \u73b0\u5728Android\u7684\u6784\u5efa\u5de5\u5177\u6362\u6210\u4e86gradle\uff0c\u901a\u8fc7gradle\uff0c\u7b80\u5355\u914d\u7f6e\u540e\u5c31\u53ef\u4ee5\u5b9e\u73b0\u81ea\u52a8\u6253\u6240\u6709\u6e20\u9053\u5305\u3002 1.\u6309\u7167umeng\u7684\u8981\u6c42\uff0cmanifest\u6587\u4ef6\u4e2d\u9700\u8981\u6709 <pre><code>&lt;meta-data\nandroid:name=\"UMENG_CHANNEL\"\nandroid:value=\"${UMENG_CHANNEL_VALUE}\" /&gt;\n</code></pre> \u8fd9\u6bb5\u914d\u7f6e\uff0cvalue\u90a3\u91cc\u5c31\u662fwandoujia\uff0c360\u4e4b\u7c7b\u7684\u6e20\u9053\u540d\u79f0\uff0c\u4f46\u662f\u6211\u4eec\u5728\u8fd9\u91cc\u4e0d\u4f1a\u53bb\u5199\u6e20\u9053\u540d\uff0c\u5199\u7684\u662f\u4e00\u4e2a\u5360\u4f4d\u7b26\uff0c\u540e\u9762gradle\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u52a8\u6001\u7684\u66ff\u6362\u6389\u5b83\u3002 2\uff0c\u5728module\uff08\u4e00\u822c\u4e5f\u5c31\u662fapp\uff09\u7684build.gradle\u7684android{}\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a <pre><code>productFlavors{\nwandoujia{}\nxiaomi{}\n}\nproductFlavors.all { flavor -&gt;\nflavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]\n}\n</code></pre></p> <p>\u91cd\u547d\u540dapk <pre><code>applicationVariants.all { variant -&gt;    //\u6279\u91cf\u4fee\u6539Apk\u540d\u5b57\nvariant.outputs.all { output -&gt;\nif (!variant.buildType.isDebuggable()) {\ndef sourceFile = \".apk\"\ndef replaceFile = \"-${variant.versionName}_${releaseTime()}.apk\"\noutputFileName = output.outputFile.name.replace(sourceFile, replaceFile)\n}\n}\n}\ndef releaseTime() {\nreturn new Date().format(\"yyyy-MM-dd\", TimeZone.getTimeZone(\"UTC\"))\n}\n</code></pre></p> <p>4.\u83b7\u53d6\u6e20\u9053 \u5728\u4ee3\u7801\u4e2d\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bfb\u53d6mate-data\u4fe1\u606f\u6765\u83b7\u53d6\u6e20\u9053\uff0c\u7136\u540e\u6dfb\u52a0\u5230\u8bf7\u6c42\u53c2\u6570\u4e2d\uff0c\u83b7\u53d6\u65b9\u6cd5\u5982\u4e0b\uff1a <pre><code>private String getChannel() {\ntry {\nPackageManager pm = getPackageManager();\nApplicationInfo appInfo = pm.getApplicationInfo(getPackageName(), PackageManager.GET_META_DATA);\nreturn appInfo.metaData.getString(\"UMENG_CHANNEL\");\n} catch (PackageManager.NameNotFoundException ignored) {\n}\nreturn \"\";\n}\n</code></pre> 5.\u6267\u884c\u7b7e\u540d\u6253\u5305\uff1a \u8fd9\u65f6\u5019\u4f60\u53bbapp/build/outputs/apk\u4e2d\u5c31\u80fd\u770b\u5230\u81ea\u52a8\u6253\u597d\u7684\u6e20\u9053\u5305\u4e86</p>"},{"location":"android/android_build_apk/#3_1","title":"3.\u4f18\u7f3a\u70b9","text":"<p>\u6253\u5305\u65b9\u5f0f\u6548\u7387\u6bd4\u8f83\u4f4e\u4e0b</p>"},{"location":"android/android_compose/","title":"Compose","text":""},{"location":"android/android_compose/#_1","title":"\u51fd\u6570\u4fee\u9970\u7b26","text":"<p>\u51fd\u6570\u4fee\u9970\u7b26\u4ecb\u7ecd</p>"},{"location":"android/android_compose/#_2","title":"\u7ec4\u4ef6","text":"<p>\u521b\u5efa\u7ec4\u4ef6\u6a21\u677f </p> <pre><code>#if (${PACKAGE_NAME} &amp;&amp; ${PACKAGE_NAME} != \"\")package ${PACKAGE_NAME}#end\n\n#parse(\"File Header.java\")\n\nimport androidx.compose.runtime.Composable\nimport androidx.compose.ui.tooling.preview.Preview\n\n#if (${Function_Name} == \"\" )\n@Composable\nfun ${NAME}() {\n}@Preview\n@Composable\nfun ${NAME}Preview() {${NAME}()\n}\n#end#if (${Function_Name} != \"\" )\n@Composable\nfun ${Function_Name}() {\n}@Preview\n@Composable\nfun ${Function_Name}Preview() {${Function_Name}()\n}\n#end\n</code></pre> <p>\u7ec4\u4ef6\u5bf9\u6bd4</p> Android Compose Button Button TextView Text EditText TextField ImageView Image LinearLayout(h) Row LinearLayout(v) Column FrameLayout Box RecyclerView(v) LazyColumn RecyclerView(h) LazyRow Snackbar Snackbar"},{"location":"android/android_compose/#modifier","title":"Modifier\u4fee\u9970\u7b26","text":""},{"location":"android/android_compose/#slots-api","title":"Slots API","text":"<p>CompositionLocalProvider Scaffold</p>"},{"location":"android/android_compose/#_3","title":"\u4f18\u5316","text":"<p>Laziness\u4f18\u5316</p>"},{"location":"android/android_dev_mode/","title":"\u5f00\u53d1\u6a21\u5f0f","text":""},{"location":"android/android_dev_mode/#mvc","title":"MVC","text":"<p>\u5728\u5b89\u5353\u5f00\u53d1\u4e2d\uff0cMVC\uff08Model-View-Controller\uff09\u662f\u4e00\u79cd\u8f6f\u4ef6\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u7ec4\u7ec7\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u7ed3\u6784\u548c\u903b\u8f91\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5b89\u5353\u4e2d\u7684MVC\u6a21\u5f0f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4ee5\u4e0b\u5bf9\u5e94\u5173\u7cfb\uff1a</p> <ol> <li> <p>Model\uff08\u6a21\u578b\uff09\uff1a\u6a21\u578b\u662f\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u6570\u636e\u548c\u4e1a\u52a1\u903b\u8f91\u3002\u5728\u5b89\u5353\u4e2d\uff0c\u6a21\u578b\u901a\u5e38\u662f\u6307\u6570\u636e\u7684\u6765\u6e90\u548c\u5904\u7406\uff0c\u4f8b\u5982\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\u3001\u5bf9\u6570\u636e\u8fdb\u884c\u64cd\u4f5c\u548c\u66f4\u65b0\u7b49\u3002</p> </li> <li> <p>View\uff08\u89c6\u56fe\uff09\uff1a\u89c6\u56fe\u8d1f\u8d23\u663e\u793a\u6a21\u578b\u4e2d\u7684\u6570\u636e\u548c\u7528\u6237\u754c\u9762\u3002\u5728\u5b89\u5353\u4e2d\uff0c\u89c6\u56fe\u901a\u5e38\u662f\u6307UI\u5143\u7d20\uff0c\u5982\u6309\u94ae\u3001\u6587\u672c\u6846\u3001\u56fe\u8868\u7b49\uff0c\u4ee5\u53ca\u5e03\u5c40\u6587\u4ef6\uff08XML\u6587\u4ef6\uff09\u3002</p> </li> <li> <p>Controller\uff08\u63a7\u5236\u5668\uff09\uff1a\u63a7\u5236\u5668\u8d1f\u8d23\u5904\u7406\u7528\u6237\u8f93\u5165\u3001\u66f4\u65b0\u6a21\u578b\u6570\u636e\u548c\u7ba1\u7406\u89c6\u56fe\u7684\u884c\u4e3a\u3002\u5728\u5b89\u5353\u4e2d\uff0c\u63a7\u5236\u5668\u901a\u5e38\u662f\u6307\u6d3b\u52a8\uff08Activity\uff09\u6216\u7247\u6bb5\uff08Fragment\uff09\uff0c\u5b83\u4eec\u63a5\u6536\u7528\u6237\u8f93\u5165\u3001\u8c03\u7528\u6a21\u578b\u7684\u65b9\u6cd5\u6765\u66f4\u65b0\u6570\u636e\uff0c\u5e76\u5728\u9700\u8981\u65f6\u66f4\u65b0\u89c6\u56fe\u3002</p> </li> </ol>"},{"location":"android/android_dev_mode/#_1","title":"\u4f18\u70b9","text":"<ol> <li>\u5206\u79bb\u5173\u6ce8\u70b9\uff1aMVC\u5c06\u5e94\u7528\u7a0b\u5e8f\u7684\u903b\u8f91\u5206\u4e3a\u6a21\u578b\u3001\u89c6\u56fe\u548c\u63a7\u5236\u5668\uff0c\u4f7f\u5f97\u4ee3\u7801\u66f4\u5177\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002</li> <li>\u53ef\u91cd\u7528\u6027\uff1aMVC\u4e2d\u7684\u6a21\u578b\u548c\u89c6\u56fe\u662f\u72ec\u7acb\u7684\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e2d\u91cd\u7528\u3002</li> <li>\u677e\u8026\u5408\uff1a\u6a21\u578b\u3001\u89c6\u56fe\u548c\u63a7\u5236\u5668\u4e4b\u95f4\u7684\u8026\u5408\u5ea6\u8f83\u4f4e\uff0c\u4f7f\u5f97\u5bf9\u4e8e\u5176\u4e2d\u4e00\u4e2a\u90e8\u5206\u7684\u4fee\u6539\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u90e8\u5206\u3002</li> <li>\u5bb9\u6613\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff1aMVC\u4e2d\u7684\u63a7\u5236\u5668\u548c\u6a21\u578b\u90fd\u53ef\u4ee5\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u4ee5\u4fdd\u8bc1\u4ee3\u7801\u7684\u8d28\u91cf\u3002</li> </ol>"},{"location":"android/android_dev_mode/#_2","title":"\u7f3a\u70b9","text":"<ol> <li>\u89c6\u56fe\u548c\u63a7\u5236\u5668\u4e4b\u95f4\u7684\u8026\u5408\uff1a\u63a7\u5236\u5668\u5bf9\u89c6\u56fe\u7684\u76f4\u63a5\u5f15\u7528\u53ef\u80fd\u5bfc\u81f4\u5b83\u4eec\u4e4b\u95f4\u7684\u5f3a\u8026\u5408\uff0c\u9020\u6210\u4ee3\u7801\u7684\u590d\u6742\u6027\u589e\u52a0\u3002</li> <li>\u903b\u8f91\u5206\u6563\uff1aMVC\u4e2d\u7684\u63a7\u5236\u5668\u8d1f\u8d23\u5904\u7406\u7528\u6237\u8f93\u5165\u548c\u63a7\u5236\u6a21\u578b\u548c\u89c6\u56fe\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u5bfc\u81f4\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u5206\u6563\u5728\u5404\u4e2a\u63a7\u5236\u5668\u4e4b\u95f4\u3002</li> <li>\u968f\u7740\u754c\u9762\u53ca\u5176\u903b\u8f91\u7684\u590d\u6742\u5ea6\u4e0d\u65ad\u63d0\u5347\uff0cActivity\u7c7b\u7684\u804c\u8d23\u4e0d\u65ad\u589e\u52a0\uff0c\u4ee5\u81f4\u53d8\u5f97\u5e9e\u5927\u81c3\u80bf</li> </ol>"},{"location":"android/android_dev_mode/#mvp","title":"MVP","text":"<p>\u5728\u5b89\u5353\u5f00\u53d1\u4e2d\uff0cMVP\uff08Model-View-Presenter\uff09\u662f\u4e00\u79cd\u57fa\u4e8eMVC\u6a21\u5f0f\u7684\u53d8\u79cd\u6a21\u5f0f\uff0c\u5b83\u7528\u4e8e\u7ec4\u7ec7\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u7ed3\u6784\u548c\u903b\u8f91\u3002\u5728\u5b89\u5353\u4e2d\uff0cMVP\u6a21\u5f0f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4ee5\u4e0b\u5bf9\u5e94\u5173\u7cfb\uff1a</p> <ol> <li> <p>Model\uff08\u6a21\u578b\uff09\uff1a\u4e0emvc\u76f8\u540c</p> </li> <li> <p>View\uff08\u89c6\u56fe\uff09\uff1a\u4e0emvc\u76f8\u540c</p> </li> <li> <p>Presenter\uff08\u5c55\u793a\u8005\uff09\uff1a\u5c55\u793a\u8005\u662f\u8fde\u63a5\u6a21\u578b\u548c\u89c6\u56fe\u7684\u4e2d\u95f4\u5c42\u3002\u5b83\u8d1f\u8d23\u5904\u7406\u7528\u6237\u8f93\u5165\u3001\u8c03\u7528\u6a21\u578b\u7684\u65b9\u6cd5\u6765\u66f4\u65b0\u6570\u636e\uff0c\u5e76\u5728\u9700\u8981\u65f6\u66f4\u65b0\u89c6\u56fe\u3002\u5c55\u793a\u8005\u8fd8\u8d1f\u8d23\u63a7\u5236\u89c6\u56fe\u7684\u884c\u4e3a\u548c\u903b\u8f91\uff0c\u4f8b\u5982\u5904\u7406\u70b9\u51fb\u4e8b\u4ef6\u3001\u663e\u793a\u6570\u636e\u7b49\u3002</p> </li> </ol>"},{"location":"android/android_dev_mode/#_3","title":"\u4f18\u70b9","text":"<ol> <li>\u66f4\u597d\u7684\u6d4b\u8bd5\u6027\uff1aMVP\u4e2d\u7684\u89c6\u56fe\u548c\u6a21\u578b\u4e4b\u95f4\u901a\u8fc7Presenter\u8fdb\u884c\u4ea4\u4e92\uff0c\u4f7f\u5f97\u89c6\u56fe\u548c\u6a21\u578b\u53ef\u4ee5\u8fdb\u884c\u72ec\u7acb\u7684\u5355\u5143\u6d4b\u8bd5\u3002</li> <li>\u89e3\u8026\uff1aMVP\u5c06\u89c6\u56fe\u548c\u6a21\u578b\u5b8c\u5168\u89e3\u8026\uff0c\u4f7f\u5f97\u5b83\u4eec\u53ef\u4ee5\u72ec\u7acb\u5730\u8fdb\u884c\u5f00\u53d1\u548c\u4fee\u6539\u3002</li> <li>\u53ef\u7ef4\u62a4\u6027\uff1aMVP\u67b6\u6784\u4f7f\u5f97\u4ee3\u7801\u66f4\u6613\u4e8e\u7406\u89e3\u548c\u7ef4\u62a4\u3002</li> <li>\u7075\u6d3b\u6027\uff1aPresenter\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u7684\u9700\u6c42\u8fdb\u884c\u5b9a\u5236\uff0c\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u66f4\u52a0\u7075\u6d3b\u3002</li> </ol>"},{"location":"android/android_dev_mode/#_4","title":"\u7f3a\u70b9","text":"<ol> <li>\u590d\u6742\u6027\u589e\u52a0\uff1aMVP\u67b6\u6784\u4e2d\u589e\u52a0\u4e86Presenter\u7684\u89d2\u8272\uff0c\u4f7f\u5f97\u6574\u4f53\u67b6\u6784\u53d8\u5f97\u66f4\u52a0\u590d\u6742\u3002</li> <li>\u5b66\u4e60\u66f2\u7ebf\uff1a\u5bf9\u4e8e\u6ca1\u6709\u4f7f\u7528\u8fc7MVP\u7684\u5f00\u53d1\u4eba\u5458\u6765\u8bf4\uff0c\u5b66\u4e60\u548c\u7406\u89e3MVP\u67b6\u6784\u53ef\u80fd\u9700\u8981\u4e00\u5b9a\u7684\u65f6\u95f4\u548c\u7ecf\u9a8c</li> <li>\u63a5\u53e3\u7206\u70b8\u5f0f\u589e\u52a0</li> </ol>"},{"location":"android/android_dev_mode/#mvp_1","title":"mvp\u642d\u5efa","text":"<p>View\u5c42\u63a5\u53e3 <pre><code>interface ILoginView {\nfun loginSuccess(data: LoginBean?)\n\nfun loginFail(msg: String?)\n}\n</code></pre> View\u5c42\u5b9e\u73b0\uff1a\u7531\u56fe\u53ef\u77e5v\u5c42\u9700\u8981p\u5c42\u5bf9\u8c61 <pre><code>class LoginActivity : AppCompatActivity, ILoginView {\nprivate lateinit var p: ILoginPresenter\noverride fun init() {\np = LoginPresenterImpl(this, this)\nxx.setOnClickListener {\np.login(\"xxx\", \"xxx\")\n}\n}\noverride fun loginSuccess(data: LoginBean?) {\n}\n\noverride fun loginFail(msg: String?) {\n}\n}\n</code></pre> p\u5c42\u63a5\u53e3 <pre><code>interface ILoginPresenter {\nfun login(name: String, pwd: String)\n}\n</code></pre> p\u5c42\u5b9e\u73b0\uff1a\u7531\u56fe\u53ef\u77e5p\u5c42\u9700\u8981model\u548cview\u5bf9\u8c61\uff0c\u4e00\u822c\u6570\u636e\u6821\u9a8c\u53ef\u4ee5\u5728\u6b64\u6267\u884c <pre><code>class LoginPresenterImpl(private val context: Context, private val loginView: ILoginView) :\nILoginPresenter, ILoginModel.ILoginCallBack {\nprivate val model = LoginModelImpl()\noverride fun login(name: String, pwd: String) {\n//\u6570\u636e\u6821\u9a8c\u5904\u7406\nmodel.login(context, name, pwd, this)\n}\noverride fun onSuccess(data: LoginBean?) {\n//\u6570\u636e\u6821\u9a8c\u5904\u7406\nloginView.loginSuccess(data)\n}\noverride fun onFail(msg: String?) {\nloginView.loginFail(msg)\n}\n}\n</code></pre> model\u5c42\u63a5\u53e3\uff1a\u9700\u8981\u56de\u8c03\u7ed9p\u5c42\u6570\u636e <pre><code>interface ILoginModel {\nfun login(context: Context, name: String, pwd: String, callBack: ILoginCallBack)\n\ninterface ILoginCallBack {\nfun onSuccess(data: LoginBean?)\n\nfun onFail(msg: String?)\n}\n}\n</code></pre> model\u5c42\u5b9e\u73b0 <pre><code>class LoginModelImpl : ILoginModel {\noverride fun login(\ncontext: Context,\nname: String,\npwd: String,\ncallBack: ILoginModel.ILoginCallBack\n) {\n//\u7f51\u7edc\u8bf7\u6c42\n}\n</code></pre> google\u65b9\u6848\u5b9e\u73b0 \u589e\u52a0\u4e00\u4e2a\u5951\u7ea6\u7c7b\uff0c\u5c06\u63a5\u53e3\u7c7b\u5168\u90e8\u79fb\u5230\u7c7b\u4e2d <pre><code>interface LoginContract {\ninterface IModel {\n//\u7701\u7565\n}\n\ninterface IView{\n//\u7701\u7565\n}\n\ninterface IPresenter {\n//\u7701\u7565\n}\n}\n</code></pre></p>"},{"location":"android/android_github/","title":"\u5f00\u6e90\u6846\u67b6","text":""},{"location":"android/android_github/#eventbus","title":"EventBus","text":"<p>\u4f7f\u7528\u6ce8\u89e3\u3001\u53cd\u5c04\u30013.x\u540e\u6dfb\u52a0apt\u4ee3\u66ff\u53cd\u5c04</p>"},{"location":"android/android_github/#mmkv","title":"mmkv","text":"<p>github: https://github.com/Tencent/MMKV/</p> <p>\u5199\u5165\u5feb\uff0c\u5c0f\u6570\u636e\u5feb\uff0c\u652f\u6301\u591a\u8fdb\u7a0b\uff0c\u4e0d\u4f1a\u81ea\u52a8\u5907\u4efd\u6570\u636e\uff0c\u521d\u59cb\u5316\u52a0\u8f7d\u6587\u4ef6\u6216\u5927\u5b57\u7b26\u65f6\u53ef\u80fd\u4f1a\u5361\u987f</p> <p>\u8bde\u751f\u76ee\u7684\uff1a\u89e3\u51b3\u9ad8\u9891\u4e3b\u7ebf\u7a0b\u5199\u6570\u636e</p>"},{"location":"android/android_github/#datastore","title":"datastore","text":"<p>\u8bde\u751f\u76ee\u7684\uff1a\u4ee3\u66ffSharedPreferences</p> <p>\u652f\u6301\u591a\u8fdb\u7a0b\uff0c\u4f1a\u81ea\u52a8\u5907\u4efd\uff0c\u5927\u6570\u636e\u5b58\u50a8\u6bd4mmkv\u5feb</p>"},{"location":"android/android_github/#okhttp","title":"OKhttp","text":"<p>\u51c6\u5907\u77e5\u8bc6\uff1ajava\u57fa\u7840\u3001\u7f51\u7edc\u7f16\u7a0b\u3001HTTP\u534f\u8bae\u3001\u8bbe\u8ba1\u6a21\u5f0f</p> <p>\u4fdd\u6301\u957f\u8fde\u63a5\uff1a\u52a0\u5feb\u8bf7\u6c42\u6548\u7387\uff0c\u91cd\u590d\u4f7f\u7528socket\uff0c\u9700\u8981\u670d\u52a1\u5668\u652f\u6301</p> <p>key: Connection value: keep-alive</p> <p>\u5982\u679c\u54cd\u5e94\u8fd4\u56de\u4e5f\u6709\u662fkeep-alive\u8bf4\u660e\u652f\u6301\uff0c\u5982\u679c\u662fclose\u5219\u4e0d\u652f\u6301</p> <p>http1.1\u5f00\u59cb\u652f\u6301\uff0c\u4f46\u53ea\u80fd\u4e32\u884c(\u4fdd\u8bc1\u6709\u5e8f)\uff0c\u5373\u4e0a\u4e00\u4e2a\u8bf7\u6c42\u5b8c\u6210\u540e\u624d\u80fd\u4e0b\u4e00\u4e2a\u8bf7\u6c42</p> <p>http2.0\u652f\u6301\u5e76\u884c(\u591a\u4e86\u987a\u5e8f\u6807\u8bc6\u4fdd\u8bc1\u6709\u5e8f)</p> <p>OkHttp\u7f13\u5b58\u9ed8\u8ba4\u5173\u95ed\u9700\u8981\u8c03\u7528.cache(path)</p>"},{"location":"android/android_github/#_1","title":"\u5206\u53d1\u6d41\u7a0b","text":"<p><pre><code>override fun enqueue(responseCallback: Callback) {\ncheck(executed.compareAndSet(false, true)) { \"Already Executed\" }\n\ncallStart()\nclient.dispatcher.enqueue(AsyncCall(responseCallback))\n}\n</code></pre> check\u5148\u4f7f\u7528CAS\u673a\u5236\u4fdd\u8bc1\u53ea\u80fd\u6267\u884c\u4e00\u6b21\u5f02\u6b65\u8bf7\u6c42\uff0c\u7136\u540edispatcher\u5206\u53d1\u5668 <pre><code>internal fun enqueue(call: AsyncCall) {\nsynchronized(this) {\n// \u6dfb\u52a0\u5230\u51c6\u5907\u961f\u5217\u4e2d\nreadyAsyncCalls.add(call)\nif (!call.call.forWebSocket) {\nval existingCall = findExistingCallWithHost(call.host)\nif (existingCall != null) call.reuseCallsPerHostFrom(existingCall)\n}\n}\npromoteAndExecute()\n}\nprivate fun promoteAndExecute(): Boolean {\n//...\nsynchronized(this) {\nval i = readyAsyncCalls.iterator()\nwhile (i.hasNext()) {\nval asyncCall = i.next()\n// \u6700\u5927\u5f02\u6b65\u8bf7\u6c4264\u4e2a\nif (runningAsyncCalls.size &gt;= this.maxRequests) break // Max capacity.\n// \u540c\u4e00\u4e2ahost\u4e0d\u80fd\u5927\u4e8e5\uff0c\u6bd4\u5982\u8bf7\u6c42\u767e\u5ea6\u4e0d\u80fd\u540c\u65f6\u67656\u6b21\uff0c\u7b2c6\u6b21\u7b49\u5f85\nif (asyncCall.callsPerHost.get() &gt;= this.maxRequestsPerHost) continue // Host max capacity.\n\ni.remove()\nasyncCall.callsPerHost.incrementAndGet()\n// \u6dfb\u52a0\u5230\u9700\u8981\u6267\u884c\u7684\u8bf7\u6c42\u961f\u5217\u4e2d\nexecutableCalls.add(asyncCall)\n// \u6dfb\u52a0\u5230\u6267\u884c\u961f\u5217\u4e2d\nrunningAsyncCalls.add(asyncCall)\n}\nisRunning = runningCallsCount() &gt; 0\n}\n\nfor (i in 0 until executableCalls.size) {\nval asyncCall = executableCalls[i]\nasyncCall.executeOn(executorService)// \u904d\u5386\u6267\u884c\u5f02\u6b65\u8bf7\u6c42\n}\n\nreturn isRunning\n}\n\nfun executeOn(executorService: ExecutorService) {\n//...\ntry {\nexecutorService.execute(this) //\u6267\u884crun\u65b9\u6cd5\n} //...\n}\nexecutorService\uff1a\u76f8\u5f53\u4e8eExecutor.newCachedThreadPool\n\n// SynchronousQueue: \u4e0d\u7528\u7b49\u5f85\u524d\u9762\u8bf7\u6c42\uff0c\u5e76\u884c\u6267\u884c\nThreadPoolExecutor(0, Int.MAX_VALUE, 60, TimeUnit.SECONDS,\nSynchronousQueue(), threadFactory(\"$okHttpName Dispatcher\", false))\n\noverride fun run() {\n//...\nfinally {\n// \u4f1a\u91cd\u5199\u6267\u884cpromoteAndExecute\u65b9\u6cd5\u89e6\u53d1\u4e0b\u4e00\u4e2a\u8bf7\u6c42(\u5982\u679c\u8fd8\u6709\u4e0b\u4e00\u4e2a\u8bf7\u6c42)\nclient.dispatcher.finished(this)\n}\n}\n</code></pre> \u540c\u6b65\u8bf7\u6c42execute\u533a\u522b\u5c31\u662f\u76f4\u63a5\u6dfb\u52a0\u5230runningAsyncCalls\u4e2d\u6267\u884c\u8bf7\u6c42</p>"},{"location":"android/android_github/#_2","title":"\u62e6\u622a\u5668","text":"<ol> <li>\u91cd\u8bd5\u91cd\u5b9a\u5411\u62e6\u622a\u5668\uff1a\u5224\u65ad\u662f\u5426\u53d6\u6d88\uff0c\u83b7\u5f97\u7ed3\u679c\u540e\u6839\u636e\u54cd\u5e94\u7801\u5224\u65ad\u662f\u5426\u91cd\u5b9a\u5411\uff0c\u6ee1\u8db3\u6761\u4ef6\u4f1a\u91cd\u542f\u6240\u6709\u62e6\u622a\u5668</li> <li>\u6865\u63a5\u62e6\u622a\u5668\uff1a\u81ea\u52a8\u6dfb\u52a0host\u7b49http\u534f\u8bae\u5fc5\u5907\u7684\u8bf7\u6c42\u5934\uff0ccookie\u76f8\u5173</li> <li>\u7f13\u5b58\u62e6\u622a\u5668\uff1a\u7f13\u5b58\u76f8\u5173</li> <li>\u8fde\u63a5\u62e6\u622a\u5668\uff1a\u8d1f\u8d23\u627e\u5230\u6216\u8005\u521b\u5efa\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u4e0d\u4f1a\u989d\u5916\u5904\u7406\u6570\u636e</li> <li>\u8bf7\u6c42\u670d\u52a1\u5668\u62e6\u622a\u5668\uff1a\u771f\u6b63\u4e0e\u670d\u52a1\u5668\u901a\u4fe1</li> </ol> <p>\u81ea\u5b9a\u4e49\u62e6\u622a\u5668</p> <p>Interceptor\u548cNetworkInterceptor\uff1a\u524d\u8005\u6dfb\u52a0\u5230\u6700\u5f00\u59cb\uff0c\u540e\u8005\u6dfb\u52a0\u5230\u6700\u540e\uff0c\u6240\u4ee5\u8bf7\u6c42\u6709\u524d\u8005\u5148\u83b7\u5f97\uff0c\u54cd\u5e94\u7531\u540e\u8005\u5148\u83b7\u53d6\uff0c\u56e0\u4e3a\u5148\u8bf7\u6c42\u540e\u54cd\u5e94</p> <p>HttpLoggingInterceptor\u6dfb\u52a0\u5230\u4e0a\u9762\u4e24\u4e2a\u6548\u679c\u4e0d\u540c\uff0c\u540e\u8005\u7531\u4e8e\u653e\u6700\u540e\u80fd\u62ff\u5230\u6240\u6709\u8bf7\u6c42\u5185\u5bb9</p> <p>\u5206\u53d1\u5668\u5de5\u4f5c\u6d41\u7a0b</p> <p>\u540c\u6b65\uff1a\u4e3b\u8981\u8bb0\u5f55\u5230\u961f\u5217\u4e2d\u76f4\u63a5\u8bf7\u6c42\uff1b\u5f02\u6b65\uff1a\u9700\u8981\u5148\u653e\u5230\u51c6\u5907\u961f\u5217\u6ee1\u8db364\u548c5\u6761\u4ef6\u540e\u518d\u8bf7\u6c42</p> <p>\u62e6\u622a\u5668\u5206\u53d1\u6d41\u7a0b</p> <p>\u8d23\u4efb\u94fe\u6a21\u5f0f</p> <p>\u8bf7\u6c42\u6d41\u7a0b\uff1a\u521b\u5efaclient-&gt;realCall-&gt;\u540c\u6b65\u3001\u5f02\u6b65(AsynCall)-&gt;\u5206\u53d1\u5668-&gt;\u62e6\u622a\u5668\u8bf7\u6c42</p> <p>getResponseWithInterceptorChain\uff1a\u6240\u6709\u62e6\u622a\u5668\u6240\u5728</p>"},{"location":"android/android_github/#_3","title":"\u91cd\u5b9a\u5411\u62e6\u622a\u5668","text":"<p>\u6700\u591a20\u6b21\uff0c.retryOnConnectionFailure(false)\u5173\u95ed\u91cd\u8bd5\u9ed8\u8ba4\u5f00\u542f</p> <p>\u67d0\u4e9b\u5f02\u5e38\u4e0d\u91cd\u8bd5\uff1a\u534f\u8bae\u5f02\u5e38(204)\u3001io\u4e2d\u65ad\u5f02\u5e38(Socket\u91cd\u8bd5\u9664\u5916)\u3001\u8bc1\u4e66\u5f02\u5e38\u3001\u8bc1\u4e66\u9a8c\u8bc1\u5f02\u5e38</p> <p>\u57fa\u4e8eSocket\u7f51\u7edc\u8bf7\u6c42\uff0cHttpURLConnection\u4e5f\u662f\u57fa\u4e8eSocket\u5c01\u88c5</p>"},{"location":"android/android_github/#retrofit","title":"Retrofit","text":"<p>\u5b98\u65b9\u7f51\u5740\uff1ahttps://github.com/square/retrofit</p> <p>\u672c\u8eab\u4e0d\u652f\u6301\u7f51\u7edc\u8bf7\u6c42\uff0c\u9762\u5411\u5207\u9762\u7f16\u7a0b\uff0caop\u601d\u60f3</p>"},{"location":"android/android_github/#8","title":"\u5e94\u75288\u79cd\u8bbe\u8ba1\u6a21\u5f0f","text":"<p>\u6784\u5efa\u8005\u6a21\u5f0f(Builder)\uff1a\u4f7f\u7528\u89c4\u5219\u662f\u53c2\u6570\u8d85\u8fc75\u4e14\u53ef\u9009\u65f6\uff0cRetrofit\u7684\u521b\u5efa\u65f6\u4f7f\u7528\u5230</p> <p>\u5916\u89c2\u6a21\u5f0f\uff1a\u5bb9\u6613\u4f7f\u7528\uff0c\u7b26\u5408\u8fea\u7c73\u7279\u6cd5\u5219\uff0ccreate\u5373\u53ef\u521b\u5efa\u5b9e\u4f8b\uff1b\u4e09\u65b9sdk\u5e38\u7528</p> <p>\u88c5\u9970\u8005\u6a21\u5f0f\uff1a\u7ec4\u5408\u7684\u5f62\u5f0f\u62d3\u5c55\u529f\u80fd\uff0c\u5982io\u4e2d\u7684BufferedoutputStream(FileOutputStream(File))\u53ef\u4ee5\u5355\u72ec\u4e5f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\uff0c\u6839\u636e\u9700\u6c42\u589e\u51cf\u5341\u5206\u7075\u6d3b\uff1bretrofit\u5728ExecutorCallbackCall\u62d3\u5c55OkHttpCall\u529f\u80fd\uff0c\u6dfb\u52a0\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u529f\u80fd(MainThreadExecutor\u91c7\u7528Handler)</p> <p>\u4ee3\u7406\u6a21\u5f0fvs\u88c5\u9970\u8005\u6a21\u5f0f\u533a\u522b\uff1a\u4ee3\u7406\u540e\u5bf9\u8c61\u53d8\u4e86\uff0c\u88c5\u9970\u540e\u53ea\u662f\u589e\u5f3a\u529f\u80fd</p> <p>\u9002\u914d\u5668\u6a21\u5f0f\uff1aOkHttpCall\u8f6c\u6210ExecutorCallbackCall</p> <p>\u7b56\u7565\u6a21\u5f0f\uff1aCallAdapter\u6839\u636e\u4e0d\u540c\u8fd4\u56de\u7c7b\u578b\u91c7\u53d6\u4e0d\u540c\u7b97\u6cd5</p> <p></p>"},{"location":"android/android_github/#_4","title":"\u539f\u7406","text":"<p>\u6838\u5fc3\u77e5\u8bc6\uff1a\u52a8\u6001\u4ee3\u7406\u3001\u6ce8\u89e3\u3001\u53cd\u5c04</p> <p>Retrofit\u7684\u521b\u5efa <pre><code>Retrofit.Builder()\n.baseUrl(BASE_URL)\n.client(createDefaultOkhttp())\n.addConverterFactory(GsonConverterFactory.create())\n.build()\n</code></pre> \u5b9e\u4f8b\u751f\u6210\uff0c\u662f\u52a8\u6001\u751f\u6210\u4e86\u5b9e\u73b0\u7c7b <pre><code>retrofit.create(ChatGptApi::class.java)\n</code></pre> create\u7684\u6e90\u7801\u4f7f\u7528\u4e86\u52a8\u6001\u4ee3\u7406 <pre><code>public &lt;T&gt; T create(final Class&lt;T&gt; service) {\nvalidateServiceInterface(service);\nreturn (T)\nProxy.newProxyInstance(\nservice.getClassLoader(),\nnew Class&lt;?&gt;[] {service},\nnew InvocationHandler() {\nprivate final Platform platform = Platform.get();\nprivate final Object[] emptyArgs = new Object[0];\n\n@Override\npublic @Nullable Object invoke(Object proxy, Method method, @Nullable Object[] args)\nthrows Throwable {\nif (method.getDeclaringClass() == Object.class) {\nreturn method.invoke(this, args);\n}\nargs = args != null ? args : emptyArgs;\nreturn platform.isDefaultMethod(method)\n? platform.invokeDefaultMethod(method, service, proxy, args)\n: loadServiceMethod(method).invoke(args);\n}\n});\n}\n</code></pre> \u63a5\u7740\u4f7f\u7528\u6ce8\u89e3\u548c\u53cd\u5c04\u77e5\u8bc6 <pre><code>ServiceMethod&lt;?&gt; loadServiceMethod(Method method) {\nServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);\nif (result != null) return result;\n\nsynchronized (serviceMethodCache) {\nresult = serviceMethodCache.get(method);\nif (result == null) {\nresult = ServiceMethod.parseAnnotations(this, method);\nserviceMethodCache.put(method, result);\n}\n}\nreturn result;\n}\n</code></pre> \u4e3b\u8981\u662f\u901a\u8fc7\u52a8\u6001\u4ee3\u7406(\u542b\u53cd\u5c04\u673a\u5236)\uff0c\u7136\u540e\u89e3\u6790\u6ce8\u89e3\u5c01\u88c5\u8bf7\u6c42\u6240\u9700\u7684\u4fe1\u606f\u5e76\u521b\u5efa\u9ed8\u8ba4\u7684okhttp\u8bf7\u6c42\u4f53\u8fdb\u884c\u8bf7\u6c42</p>"},{"location":"android/android_github/#glide","title":"Glide","text":"<p>\u5b98\u65b9\u7f51\u5740\uff1ahttps://github.com/bumptech/glide</p> <p>Glide.with().load().into()</p> <p>with\uff1a\u7a7a\u767dFragment\u7ba1\u7406\u751f\u547d\u5468\u671f(ui\u7ebf\u7a0b\u624d\u4f1a\u521b\u5efa\u3001\u5982\u679c\u662fapplication\u4e5f\u4e0d\u521b\u5efa)\uff0c\u540c\u6b65\u5230RequestManager\u65b9\u4fbf\u7ba1\u7406\u7c7b\u4f3cImageViewTarget\u7b49\u7c7b</p> <p>load\uff1a\u6784\u5efa\u51faRequestBuilder\u5bf9\u8c61</p> <p>into\uff1a\u8fd0\u884c\u961f\u5217 \u7b49\u5f85\u961f\u5217 \u6d3b\u52a8\u7f13\u5b58 \u5185\u5b58\u7f13\u5b58 \u7f51\u7edc\u6a21\u578b</p> <p>\u6e90\u7801\u5206\u6790\uff1a</p> <p>https://blog.csdn.net/u013347784/article/details/125728996</p> <p>\u9ed8\u8ba4\u662f\u7f51\u7edc\u8bf7\u6c42\u662f\u4f7f\u7528HttpURLConnection</p> <p>\u6d3b\u52a8\u7f13\u5b58\u3001\u5185\u5b58\u7f13\u5b58\u3001\u78c1\u76d8\u7f13\u5b58</p>"},{"location":"android/android_github/#coil","title":"Coil","text":"<p>\u5b98\u65b9\u7f51\u5740\uff1ahttps://github.com/coil-kt/coil</p> <p>\u9ed8\u8ba4\u7f51\u7edc\u8bf7\u6c42\u662f\u4f7f\u7528OkHttp</p> <p>\u6d3b\u52a8\u7f13\u5b58\u3001\u5185\u5b58\u7f13\u5b58\u3001\u78c1\u76d8\u7f13\u5b58</p>"},{"location":"android/android_github/#recyclerview","title":"RecyclerView\u76f8\u5173\u5e93","text":"<p>1.\u5b9e\u73b0\u4eff\u7f8e\u56e2\u53cc\u6392\u7ffb\u9875\u6548\u679c\uff1a https://github.com/GcsSloop/pager-layoutmanager</p> <p></p> <p>2.\u5b9e\u73b0\u4eff\u5fae\u4fe1\u4e5d\u5bab\u683c\u6548\u679c\uff1ahttps://github.com/MartinMu2016/NineGridLayoutManager</p> <p>3.\u5b9e\u73b0\u5438\u9876\u6548\u679c\uff1ahttps://github.com/donkingliang/ConsecutiveScroller</p> <p>4.\u5feb\u901f\u4f7f\u7528BaseRecyclerViewAdapterHelper\uff1ahttps://github.com/CymChad/BaseRecyclerViewAdapterHelper <pre><code>implementation\uff08\"io.github.cymchad:BaseRecyclerViewAdapterHelper4:4.1.2\")\n</code></pre> \u57fa\u672c\u4f7f\u7528(\u5b98\u65b9\u6848\u4f8b) <pre><code>class TestAdapter : BaseQuickAdapter&lt;Status, TestAdapter.VH&gt;() {\n\n// \u81ea\u5b9a\u4e49ViewHolder\u7c7b\nclass VH(\nparent: ViewGroup,\nval binding: LayoutAnimationBinding = LayoutAnimationBinding.inflate(\nLayoutInflater.from(parent.context), parent, false\n),\n) : RecyclerView.ViewHolder(binding.root)\n\noverride fun onCreateViewHolder(context: Context, parent: ViewGroup, viewType: Int): VH {\n// \u8fd4\u56de\u4e00\u4e2a ViewHolder\nreturn VH(parent)\n}\n\noverride fun onBindViewHolder(holder: VH, position: Int, item: Status?) {\n// \u8bbe\u7f6eitem\u6570\u636e\n}\n}\n</code></pre> \u6ce8\uff1a\u6dfb\u52a0\u6570\u636e\u96c6\u5408\u5185\u90e8\u662f\u76f4\u63a5\u8d4b\u503c\u7684\u5f62\u5f0f\uff0c\u56e0\u6b64\u662f\u5f15\u7528\uff0c\u5982\u679c\u9700\u8981\u4fdd\u8bc1\u521d\u59cb\u6570\u636e\uff0c\u53efnew\u4e00\u4e2a\u96c6\u5408 <pre><code>rvAdapter.submitList(mutableListOf&lt;Media&gt;().also { it.addAll(imgUrls) })\n</code></pre></p>"},{"location":"android/android_github/#_5","title":"\u4e0b\u62c9\u5237\u65b0\u5e93","text":"<p>https://github.com/scwang90/SmartRefreshLayout</p>"},{"location":"android/android_github/#xxpermissions","title":"XXPermissions","text":"<p>https://github.com/getActivity/XXPermissions</p>"},{"location":"android/android_hotfix/","title":"\u63d2\u4ef6\u5316","text":""},{"location":"android/android_hotfix/#_1","title":"\u63d2\u4ef6\u5316\u5fc5\u5907\u77e5\u8bc6\u70b9","text":"<ol> <li>Binder</li> <li>AIDL</li> <li>AMS</li> <li>\u56db\u5927\u7ec4\u4ef6\u7684\u5de5\u4f5c\u539f\u7406</li> <li>PMS</li> <li>App\u5b89\u88c5\u8fc7\u7a0b</li> <li>ClassLoader\u4ee5\u53ca\u53cc\u4eb2\u59d4\u6258</li> <li>\u53cd\u5c04</li> </ol>"},{"location":"android/android_hotfix/#classloader","title":"ClassLoader\u4ee5\u53ca\u53cc\u4eb2\u59d4\u6258","text":"<p>Android4.4\u542b\u4ee5\u4e0b\uff1a</p> <ul> <li>DexClassLoader\uff1a\u52a0\u8f7djar\u3001apk\u3001dex\uff0c\u53ef\u4ee5\u4ece\u6307\u5b9a\u76ee\u5f55\u4e2d\u52a0\u8f7d</li> <li>PathClassLoader\uff1a\u53ea\u80fd\u52a0\u8f7d\u5df2\u5b89\u88c5\u5230\u7cfb\u7edf\u4e2d\u7684apk\u6587\u4ef6\uff0c\u5373/data/app\u76ee\u5f55</li> </ul> <p>Android5.0-Android8.0\uff1a</p> <ul> <li>DexClassLoader\uff1a\u4e0d\u53d8</li> <li>PathClassLoader\uff1a\u548cDexClassLoader\u57fa\u672c\u76f8\u540c\uff0c\u9664\u4e86\u65e0\u6cd5\u8fdb\u884cdex2oat\u64cd\u4f5c</li> </ul> <p>Android8.0\u4ee5\u4e0a\uff1a\u5b8c\u5168\u4e00\u81f4</p> <p>\u53cc\u4eb2\u59d4\u6258\u673a\u5236\uff1a\u7c7b\u52a0\u8f7d\u65f6\u4f18\u5148\u8bf7\u6c42\u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u627e\u4e0d\u5230\u6307\u5b9a\u7c7b\u65f6\u624d\u7531\u5b50\u7c7b\u52a0\u8f7d\u5668\u5c1d\u8bd5\u52a0\u8f7d</p> <p>\u52a0\u8f7d\u6b65\u9aa4\uff1a\u7f13\u5b58\u52a0\u8f7d--\u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d--\u81ea\u5df1\u52a0\u8f7d <pre><code>protected Class&lt;?&gt; loadClass(String name, boolean resolve)\nthrows ClassNotFoundException\n{\n// \u7f13\u5b58\u52a0\u8f7d\nClass&lt;?&gt; c = findLoadedClass(name);\nif (c == null) {\ntry {\nif (parent != null) {\nc = parent.loadClass(name, false); // \u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\n} else {\nc = findBootstrapClassOrNull(name);\n}\n} catch (ClassNotFoundException e) {\n}\n\nif (c == null) {\n// \u81ea\u5df1\u5c1d\u8bd5\u52a0\u8f7d\nc = findClass(name);\n}\n}\nreturn c;\n}\n</code></pre> \u53cc\u4eb2\u59d4\u6258\u673a\u5236\u7684\u4f5c\u7528 1. \u9632\u6b62\u91cd\u590d\u52a0\u8f7d 2. \u5b89\u5168\uff0c\u4fdd\u8bc1\u7cfb\u7edf\u7c7b\u4e0d\u80fd\u88ab\u7be1\u6539</p> <p>\u6253\u7834\u53cc\u4eb2\u59d4\u6258\u673a\u5236\uff1a\u81ea\u5b9a\u4e49\u7c7b\u52a0\u8f7d\u5668</p> <p>\u521b\u5efa\u7c7b\u7ee7\u627f\u4e8eClassLoader\uff0c\u91cd\u5199loadClass\u65b9\u6cd5\uff0c\u5b9e\u73b0findClass\u65b9\u6cd5</p> <p>Android\u5e94\u7528\u573a\u666f\uff1a\u63d2\u4ef6\u5316\u5f00\u53d1\u3001\u70ed\u66f4\u65b0</p> <p>\u7c7b\u52a0\u8f7d\u53ef\u4ee5\u901a\u8fc7Class.forName(\"\")</p>"},{"location":"android/android_interview/","title":"\u9762\u8bd5\u9898","text":""},{"location":"android/android_interview/#java","title":"Java\u65b9\u9762","text":""},{"location":"android/android_interview/#java_1","title":"Java\u57fa\u7840\u90e8\u5206","text":"<p>\u62bd\u8c61\u7c7b\u4e0e\u63a5\u53e3\u7684\u533a\u522b\uff1f</p> <p>\u5206\u522b\u8bb2\u8bb2 final\uff0cstatic\uff0csynchronized</p> <p>\u8bf7\u7b80\u8ff0\u4e00\u4e0bString\u3001StringBuffer\u548cStringBuilder</p> <p>\u201cequals\u201d\u4e0e\u201c==\u201d\u3001\u201chashCode\u201d\u7684\u533a\u522b\u548c\u4f7f\u7528\u573a\u666f\uff1f</p> <p>Java \u4e2d\u6df1\u62f7\u8d1d\u4e0e\u6d45\u62f7\u8d1d\u7684\u533a\u522b\uff1f</p> <p>\u8c08\u8c08Error\u548cException\u7684\u533a\u522b\uff1f</p> <p>\u4ec0\u4e48\u662f\u53cd\u5c04\u673a\u5236\uff1f\u53cd\u5c04\u673a\u5236\u7684\u5e94\u7528\u573a\u666f\u6709\u54ea\u4e9b\uff1f</p> <p>\u8c08\u8c08\u5982\u4f55\u91cd\u5199equals()\u65b9\u6cd5\uff1f\u4e3a\u4ec0\u4e48\u8fd8\u8981\u91cd\u5199hashCode()\uff1f</p> <p>\u8c08\u8c08\u4f60\u5bf9Java\u6cdb\u578b\u4e2d\u7c7b\u578b\u64e6\u9664\u7684\u7406\u89e3\uff0c\u5e76\u8bf4\u8bf4\u5176\u5c40\u9650\u6027\uff1f -String\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210\u4e0d\u53ef\u53d8\u7684\uff1f</p> <p>\u8bf4\u8bf4\u4f60\u5bf9Java\u6ce8\u89e3\u7684\u7406\u89e3\uff1f</p>"},{"location":"android/android_interview/#java_2","title":"Java\u96c6\u5408","text":"<p>\u8c08\u8c08List,Set,Map\u7684\u533a\u522b\uff1f</p> <p>\u8c08\u8c08ArrayList\u548cLinkedList\u7684\u533a\u522b\uff1f</p> <p>\u8bf7\u8bf4\u4e00\u4e0bHashMap\u4e0eHashTable\u7684\u533a\u522b</p> <p>\u8c08\u4e00\u8c08ArrayList\u7684\u6269\u5bb9\u673a\u5236\uff1f</p> <p>HashMap \u7684\u5b9e\u73b0\u539f\u7406\uff1f</p> <p>\u8bf7\u7b80\u8ff0 LinkedHashMap \u7684\u5de5\u4f5c\u539f\u7406\u548c\u4f7f\u7528\u65b9\u5f0f\uff1f</p> <p>\u8c08\u8c08\u5bf9\u4e8eConcurrentHashMap\u7684\u7406\u89e3?</p>"},{"location":"android/android_interview/#java_3","title":"Java\u591a\u7ebf\u7a0b","text":"<p>Java \u4e2d\u4f7f\u7528\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6709\u54ea\u4e9b\uff1f</p> <p>\u8bf4\u4e00\u4e0b\u7ebf\u7a0b\u7684\u51e0\u79cd\u72b6\u6001\uff1f</p> <p>\u5982\u4f55\u5b9e\u73b0\u591a\u7ebf\u7a0b\u4e2d\u7684\u540c\u6b65\uff1f</p> <p>\u8c08\u8c08\u7ebf\u7a0b\u6b7b\u9501\uff0c\u5982\u4f55\u6709\u6548\u7684\u907f\u514d\u7ebf\u7a0b\u6b7b\u9501\uff1f</p> <p>\u8c08\u8c08\u7ebf\u7a0b\u963b\u585e\u7684\u539f\u56e0\uff1f</p> <p>\u8bf7\u8c08\u8c08 Thread \u4e2d run() \u4e0e start() \u7684\u533a\u522b\uff1f</p> <p>synchronized\u548cvolatile\u5173\u952e\u5b57\u7684\u533a\u522b\uff1f</p> <p>\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1f</p> <p>\u8c08\u8c08ThreadLocal\u7528\u6cd5\u548c\u539f\u7406\uff1f</p> <p>java\u7ebf\u7a0b\u4e2dnotify \u548c notifyAll\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>\u4ec0\u4e48\u662f\u7ebf\u7a0b\u6c60\uff1f\u5982\u4f55\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff1f</p> <p>\u8c08\u4e00\u8c08java\u7ebf\u7a0b\u5e38\u89c1\u7684\u51e0\u79cd\u9501\uff1f</p> <p>\u8c08\u4e00\u8c08\u7ebf\u7a0bsleep()\u548cwait()\u7684\u533a\u522b\uff1f</p>"},{"location":"android/android_interview/#java_4","title":"Java\u865a\u62df\u673a","text":"<p>\u8c08\u4e00\u8c08JAVA\u5783\u573e\u56de\u6536\u673a\u5236\uff1f</p> <p>\u56de\u7b54\u4e00\u4e0b\u4ec0\u4e48\u662f\u5f3a\u3001\u8f6f\u3001\u5f31\u3001\u865a\u5f15\u7528\u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\uff1f</p> <p>\u7b80\u8ff0JVM\u4e2d\u7c7b\u7684\u52a0\u8f7d\u673a\u5236\u4e0e\u52a0\u8f7d\u8fc7\u7a0b\uff1f</p> <p>JVM\u3001Dalvik\u3001ART\u4e09\u8005\u7684\u539f\u7406\u548c\u533a\u522b\uff1f</p> <p>\u8bf7\u8c08\u8c08Java\u7684\u5185\u5b58\u56de\u6536\u673a\u5236\uff1f</p> <p>JMM\u662f\u4ec0\u4e48\uff1f\u5b83\u5b58\u5728\u54ea\u4e9b\u95ee\u9898\uff1f\u8be5\u5982\u4f55\u89e3\u51b3\uff1f</p>"},{"location":"android/android_interview/#android","title":"Android\u65b9\u9762","text":""},{"location":"android/android_interview/#_1","title":"\u56db\u5927\u7ec4\u4ef6","text":"<p>Activity \u4e0e Fragment \u4e4b\u95f4\u5e38\u89c1\u7684\u51e0\u79cd\u901a\u4fe1\u65b9\u5f0f\uff1f</p> <p>LaunchMode \u7684\u5e94\u7528\u573a\u666f\uff1f</p> <p>\u5bf9\u4e8e Context\uff0c\u4f60\u4e86\u89e3\u591a\u5c11?</p> <p>IntentFilter\u662f\u4ec0\u4e48\uff1f\u6709\u54ea\u4e9b\u4f7f\u7528\u573a\u666f\uff1f</p> <p>\u8c08\u4e00\u8c08startService\u548cbindService\u7684\u533a\u522b\uff0c\u751f\u547d\u5468\u671f\u4ee5\u53ca\u4f7f\u7528\u573a\u666f\uff1f</p> <p>Service\u5982\u4f55\u8fdb\u884c\u4fdd\u6d3b\uff1f</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0bContentProvider\u662f\u5982\u4f55\u5b9e\u73b0\u6570\u636e\u5171\u4eab\u7684\uff1f</p> <p>\u8bf4\u4e0b\u5207\u6362\u6a2a\u7ad6\u5c4f\u65f6Activity\u7684\u751f\u547d\u5468\u671f?</p> <p>Intent\u4f20\u8f93\u6570\u636e\u7684\u5927\u5c0f\u6709\u9650\u5236\u5417\uff1f\u5982\u4f55\u89e3\u51b3\uff1f</p>"},{"location":"android/android_interview/#android_1","title":"Android \u5f02\u6b65\u4efb\u52a1\u548c\u6d88\u606f\u673a\u5236","text":"<p>HandlerThread \u7684\u4f7f\u7528\u573a\u666f\u548c\u7528\u6cd5\uff1f</p> <p>IntentService \u7684\u5e94\u7528\u573a\u666f\u548c\u4f7f\u7528\u59ff\u52bf\uff1f</p> <p>AsyncTask\u7684\u4f18\u70b9\u548c\u7f3a\u70b9\uff1f</p> <p>\u8c08\u8c08\u4f60\u5bf9 Activity.runOnUiThread \u7684\u7406\u89e3\uff1f</p> <p>\u5b50\u7ebf\u7a0b\u80fd\u5426\u66f4\u65b0UI\uff1f\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u8c08\u8c08 Handler \u673a\u5236\u548c\u539f\u7406\uff1f</p> <p>\u4e3a\u4ec0\u4e48\u5728\u5b50\u7ebf\u7a0b\u4e2d\u521b\u5efaHandler\u4f1a\u629b\u5f02\u5e38\uff1f</p> <p>Handler\u4e2d\u6709Loop\u6b7b\u5faa\u73af\uff0c\u4e3a\u4ec0\u4e48\u6ca1\u6709\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u539f\u7406\u662f\u4ec0\u4e48?</p>"},{"location":"android/android_interview/#_2","title":"\u6570\u636e\u7ed3\u6784","text":"<p>\u4ec0\u4e48\u662f\u5192\u6ce1\u6392\u5e8f\uff1f\u5982\u4f55\u4f18\u5316\uff1f</p> <p>\u8bf7\u7528 Java \u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u5355\u94fe\u8868\uff1f</p> <p>\u5982\u4f55\u53cd\u8f6c\u4e00\u4e2a\u5355\u94fe\u8868\uff1f</p> <p>\u8c08\u8c08\u4f60\u5bf9\u65f6\u95f4\u590d\u6742\u5ea6\u548c\u7a7a\u95f4\u590d\u6742\u5ea6\u7684\u7406\u89e3\uff1f</p> <p>\u8c08\u4e00\u8c08\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u94fe\u8868\u6210\u73af\uff1f</p> <p>\u4ec0\u4e48\u662f\u7ea2\u9ed1\u6811\uff1f\u4e3a\u4ec0\u4e48\u8981\u7528\u7ea2\u9ed1\u6811\uff1f</p> <p>\u4ec0\u4e48\u662f\u5feb\u901f\u6392\u5e8f\uff1f\u5982\u4f55\u4f18\u5316\uff1f</p> <p>\u8bf4\u8bf4\u5faa\u73af\u961f\u5217\uff1f</p> <p>\u5982\u4f55\u5224\u65ad\u5355\u94fe\u8868\u4ea4\u53c9</p>"},{"location":"android/android_interview/#binder","title":"Binder","text":"<p>Binder\u6709\u4ec0\u4e48\u4f18\u52bf</p> <p>Binder\u662f\u5982\u4f55\u505a\u5230\u4e00\u6b21\u62f7\u8d1d\u7684</p> <p>MMAP\u7684\u5185\u5b58\u6620\u5c04\u539f\u7406\u4e86\u89e3\u5417</p> <p>Binder\u673a\u5236\u662f\u5982\u4f55\u8de8\u8fdb\u7a0b\u7684</p> <p>\u8bf4\u8bf4\u56db\u5927\u7ec4\u4ef6\u7684\u901a\u4fe1\u673a\u5236</p> <p>\u4e3a\u4ec0\u4e48Intent\u4e0d\u80fd\u4f20\u9012\u5927\u6570\u636e</p>"},{"location":"android/android_interview/#handler","title":"Handler","text":"<p>HandlerThread\u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u5b83\u4f1a\u5b58\u5728\uff1f</p> <p>\u7b80\u8ff0\u4e0b Handler \u673a\u5236\u7684\u603b\u4f53\u539f\u7406\uff1f</p> <p>Looper \u5b58\u5728\u54ea\uff1f\u5982\u4f55\u53ef\u4ee5\u4fdd\u8bc1\u7ebf\u7a0b\u72ec\u6709\uff1f</p> <p>\u5982\u4f55\u7406\u89e3 ThreadLocal \u7684\u4f5c\u7528\uff1f</p> <p>\u4e3b\u7ebf\u7a0b Main Looper \u548c\u4e00\u822c Looper \u7684\u5f02\u540c\uff1f</p> <p>Handler \u6216\u8005\u8bf4 Looper \u5982\u4f55\u5207\u6362\u7ebf\u7a0b\uff1f</p> <p>Looper \u7684 loop() \u6b7b\u5faa\u73af\u4e3a\u4ec0\u4e48\u4e0d\u5361\u6b7b\uff1f</p> <p>Looper \u7684\u7b49\u5f85\u662f\u5982\u4f55\u80fd\u591f\u51c6\u786e\u5524\u9192\u7684\uff1f</p> <p>Message \u5982\u4f55\u83b7\u53d6\uff1f\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bbe\u8ba1\uff1f</p>"},{"location":"android/android_interview/#ams","title":"AMS","text":"<p>ActivityManagerService\u662f\u4ec0\u4e48\uff1f\u4ec0\u4e48\u65f6\u5019\u521d\u59cb\u5316\u7684\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f</p> <p>ActivityThread\u662f\u4ec0\u4e48?ApplicationThread\u662f\u4ec0\u4e48?\u4ed6\u4eec\u7684\u533a\u522b</p> <p>Instrumentation\u662f\u4ec0\u4e48\uff1f\u548cActivityThread\u662f\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <p>ActivityManagerService\u548czygote\u8fdb\u7a0b\u901a\u4fe1\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002</p> <p>\u624b\u5199\u5b9e\u73b0\u7b80\u5316\u7248AMS</p>"},{"location":"android/android_interview/#_3","title":"\u7b97\u6cd5\u65b9\u9762","text":"<p>\u5982\u4f55\u8fd0\u2f64\u2f06\u5206\u67e5\u627e\u7b97\u6cd5</p> <p>\u5982\u4f55\u2fbc\u6548\u89e3\u51b3\u63a5\u2fac\u2f54\u95ee\u9898</p> <p>\u2f06\u5206\u67e5\u627e\u2fbc\u6548\u5224\u5b9a\u2f26\u5e8f\u5217</p> <p>\u5982\u4f55\u53bb\u9664\u6709\u5e8f\u6570\u7ec4\u7684\u91cd\u590d\u5143\u7d20</p> <p>\u5982\u4f55\u5bfb\u627e\u6700\u2ed3\u56de\u2f42\u2f26\u4e32</p> <p>\u5982\u4f55\u2fbc\u6548\u8fdb\u2f8f\u6a21\u5e42\u8fd0\u7b97</p> <p>\u5982\u4f55\u8fd0\u7528\u8d2a\u5fc3\u601d\u60f3\u5e7f\u57df\u73a9\u8df3\u8dc3\u6e38\u620f</p> <p>\u5982\u4f55\u2fbc\u6548\u5224\u65ad\u56de\u2f42\u94fe\u8868</p> <p>\u5982\u4f55\u5728\u65e0\u7ebf\u5e8f\u5217\u4e2d\u968f\u673a\u62bd\u53d6\u5143\u7d20</p> <p>\u5982\u4f55\u5224\u5b9a\u62ec\u53f7\u5408\u6cd5\u6027</p> <p>\u5982\u4f55\u5bfb\u627e\u7f3a\u5931\u548c\u91cd\u590d\u7684\u5143\u7d20</p> <p>\u8bf7\u8bf4\u4e00\u8bf4HashMap\uff0cSparseArrary\u539f\u7406\uff0cSparseArrary\u76f8\u6bd4HashMap\u7684\u4f18\u70b9\u3001ConcurrentHashMap\u5982\u4f55\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\uff1f</p> <p>\u8bf7\u8bf4\u4e00\u8bf4HashMap\u539f\u7406\uff0c\u5b58\u53d6\u8fc7\u7a0b\uff0c\u4e3a\u4ec0\u4e48\u7528\u7ea2\u9ed1\u6811\uff0c\u7ea2\u9ed1\u6811\u4e0e\u5b8c\u5168\u4e8c\u53c9\u6811\u5bf9\u6bd4\uff0cHashTab\u3001concurrentHashMap\uff0cconcurrent\u5305\u91cc\u6709\u5565?</p> <p>\u8bf7\u8bf4\u4e00\u8bf4hashmap put()\u5e95\u5c42\u539f\u7406,\u53d1\u751f\u51b2\u7a81\u65f6\uff0c\u5982\u4f55\u53bb\u6dfb\u52a0(\u987a\u7740\u94fe\u8868\u53bb\u904d\u5386\uff0c\u6328\u4e2a\u6bd4\u8f83key\u503c\u662f\u5426\u4e00\u81f4\uff0c\u5982\u679c\u4e00\u81f4\uff0c\u5c31\u8986\u76d6\u66ff\u6362\uff0c\u4e0d\u4e00\u81f4\u904d\u5386\u7ed3\u675f\u540e\uff0c\u63d2\u5165\u8be5\u4f4d\u7f6e) \uff1f</p>"},{"location":"android/android_interview/#kotlin","title":"Kotlin\u65b9\u9762","text":"<p>\u8bf7\u7b80\u8ff0\u4e00\u4e0b\u4ec0\u4e48\u662f Kotlin\uff1f\u5b83\u6709\u54ea\u4e9b\u7279\u6027\uff1f</p> <p>Kotlin\u4e2d\u5b9e\u73b0\u5355\u4f8b\u7684\u51e0\u79cd\u5e38\u89c1\u65b9\u5f0f\uff1f</p> <p>\u5728Kotlin\u4e2d\uff0c\u4ec0\u4e48\u662f\u5185\u8054\u51fd\u6570\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f</p> <p>\u8bf7\u8c08\u8c08Kotlin\u4e2d\u7684Coroutines\uff0c\u5b83\u4e0e\u7ebf\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f\u6709\u54ea\u4e9b\u4f18\u70b9\uff1f</p> <p>\u8bf4\u8bf4Kotlin\u4e2d\u7684Any\u4e0eJava\u4e2d\u7684Object \u6709\u4f55\u5f02\u540c\uff1f</p> <p>Kotlin\u4e2d\u7684\u6570\u636e\u7c7b\u578b\u6709\u9690\u5f0f\u8f6c\u6362\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f</p> <p>Kotlin\u4e2d\u96c6\u5408\u904d\u5386\u6709\u54ea\u51e0\u79cd\u65b9\u5f0f</p> <p>Kotlin\u5185\u7f6e\u6807\u51c6\u51fd\u6570let\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f</p> <p>Kotlin\u8bed\u8a00\u7684run\u9ad8\u9636\u51fd\u6570\u7684\u539f\u7406\u662f\u4ec0\u4e48\uff1f</p>"},{"location":"android/android_interview/#_4","title":"\u97f3\u89c6\u9891\u65b9\u9762","text":"<p>\u600e\u4e48\u505a\u5230\u76f4\u64ad\u79d2\u5f00\u4f18\u5316\uff1f</p> <p>\u6570\u5b57\u56fe\u50cf\u6ee4\u6ce2\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1f</p> <p>\u56fe\u50cf\u53ef\u4ee5\u63d0\u53d6\u7684\u7279\u5f81\u6709\u54ea\u4e9b\uff1f</p> <p>FFMPEG:\u56fe\u7247\u5982\u4f55\u5408\u6210\u89c6\u9891</p> <p>\u5e38\u89c1\u7684\u97f3\u89c6\u9891\u683c\u5f0f\u6709\u54ea\u4e9b\uff1f</p> <p>\u8bf7\u53d9\u8ff0MPEG\u89c6\u9891\u57fa\u672c\u7801\u6d41\u7ed3\u6784\uff1f</p> <p>\u8bf4\u4e00\u8bf4ffffmpeg\u7684\u6570\u636e\u7ed3\u6784\uff1f</p> <p>\u5982\u4f55\u964d\u4f4e\u5ef6\u8fdf\uff1f\u5982\u4f55\u4fdd\u8bc1\u6d41\u7545\u6027\uff1f\u5982\u4f55\u89e3\u51b3\u5361\u987f\uff1f\u89e3\u51b3\u7f51\u7edc\u6296\u52a8\uff1f</p> <p>\u5e73\u65f6\u8bf4\u7684\u8f6f\u89e3\u548c\u786c\u89e3\uff0c\u5177\u4f53\u662f\u4ec0\u4e48\uff1f</p>"},{"location":"android/android_interview/#flutter","title":"Flutter\u65b9\u9762","text":"<p>Dart \u8bed\u8a00\u7684\u7279\u6027\uff1f</p> <p>Dart \u591a\u4efb\u52a1\u5982\u4f55\u5e76\u884c\u7684\uff1f</p> <p>dart\u662f\u503c\u4f20\u9012\u8fd8\u662f\u5f15\u7528\u4f20\u9012\uff1f</p> <p>Flutter \u7279\u6027\u6709\u54ea\u4e9b\uff1f</p> <p>Widget \u548c element \u548c RenderObject \u4e4b\u95f4\u7684\u5173\u7cfb\uff1f</p> <p>\u4f7f\u7528mixins\u7684\u6761\u4ef6\u662f\u4ec0\u4e48\uff1f</p> <p>Stream \u4e24\u79cd\u8ba2\u9605\u6a21\u5f0f\uff1f</p> <p>Flutter\u4e2d\u7684Widget\u3001State\u3001Context \u7684\u6838\u5fc3\u6982\u5ff5\uff1f\u662f\u4e3a\u4e86\u89e3\u51b3\u4ec0\u4e48\u95ee\u9898\uff1f</p> <p>\u8bf4\u4e00\u4e0bHot Reload\uff0cHot Restart\uff0c\u70ed\u66f4\u65b0\u4e09\u8005\u7684\u533a\u522b\u548c\u539f\u7406</p> <p>Flutter \u5982\u4f55\u4e0e Android iOS \u901a\u4fe1\uff1f</p> <p>\u8bf4\u4e00\u4e0b\u4ec0\u4e48\u662f\u72b6\u6001\u7ba1\u7406\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981\u5b83\uff1f</p>"},{"location":"android/android_ndk/","title":"Android ndk","text":""},{"location":"android/android_ndk/#_1","title":"\u914d\u7f6e\u5de5\u7a0b","text":"<p>as\u4e2d\u5b89\u88c5\u5de5\u5177\uff0c\u5305\u62ecndk\u548ccmake</p> <p></p> <p>gradle\u914d\u7f6e</p> <p>\u4ee3\u7801\u63d0\u793a\u529f\u80fd\u5f00\u542f\uff0c\u9488\u5bf9\u5934\u6587\u4ef6\u5f15\u5165\u540e\u6ca1\u6709\u4ee3\u7801\u63d0\u793a</p> <p></p>"},{"location":"android/android_ndk/#_2","title":"\u57fa\u7840\u77e5\u8bc6","text":"<p>\u4e0a\u5c42\u8c03\u7528c++\u65b9\u6cd5\u65b9\u5f0f</p> <p>java\uff1anative\u5173\u952e\u5b57</p> <p>kotlin\uff1aexternal\u5173\u952e\u5b57</p> <p>cmake\u6587\u4ef6\u4e2d</p> <p><pre><code>add_library(${CMAKE_PROJECT_NAME} SHARED\njetpack.cpp)\n\ntarget_link_libraries(${CMAKE_PROJECT_NAME}\nandroid\nlog)\n</code></pre> add_library\uff1a\u53c2\u6570\u5206\u522b\u662f\u540d\u5b57\uff0c\u7f16\u8bd1\u7c7b\u578b(SHARED\u8868\u793a\u7f16\u8bd1\u6210so)\uff0c\u7f16\u8bd1\u6e90\u6587\u4ef6</p> <p>target_link_libraries\uff1a\u5f15\u7528\u5176\u4ed6\u5e93</p>"},{"location":"android/android_root/","title":"Root\u9762\u5177","text":""},{"location":"android/android_root/#kernelsu","title":"KernelSU","text":"<p>\u9879\u76ee\u5b98\u7f51\uff1ahttps://github.com/tiann/KernelSU</p> <p>\u4e0b\u8f7d\u6700\u65b0\u7684Magisk\u5b89\u88c5\u5305</p> <p>https://github.com/topjohnwu/Magisk/releases</p> <p>\u5c06 Magisk-(version).apk \u91cd\u547d\u540d\u4e3a Magisk-.zip </p> <p>\u89e3\u538b\u83b7\u53d6Magisk-*/lib/arm64-v8a/libmagiskboot.so\u6587\u4ef6</p> <p>\u4f7f\u7528 adb push \u5230\u624b\u673a\uff1a <pre><code>adb push libmagiskboot.so /data/local/tmp/magiskboot\n</code></pre> \u63d0\u53d6boot.img\uff0c\u5237\u673a\u5305\u6216\u8005\u76f4\u63a5\u63d0\u53d6\u7cfb\u7edfboot</p> <p>\u4e0b\u8f7dAnyKernel3(https://github.com/tiann/KernelSU/releases/tag/v0.9.0) \u4e2d\u7684 Image</p> <p>\u6839\u636e\u624b\u673a\u8bbe\u7f6e\u5185\u6838\u7248\u672c</p> <p></p> <p>\u4e0b\u8f7d\u5bf9\u5e94AnyKernel3-android13-5.10.149_2023-01.zip </p> <p>\u63a8\u9001\u5230\u624b\u673a <pre><code>adb push boot.img /data/local/tmp/\nadb push Image /data/local/tmp/\n</code></pre> \u6253\u5305\u5185\u6838 <pre><code>adb shell\ncd /data/local/tmp/\nchmod +x magiskboot\n./magiskboot unpack boot.img\n//\u6267\u884c\u540e\u5f97\u5230kernel\u6587\u4ef6\nmv -f Image kernel\n./magiskboot repack boot.img\n//\u5f97\u5230new-boot.img\u6587\u4ef6\n</code></pre> \u5237\u5185\u6838\u5230\u624b\u673a <pre><code>fastboot flash boot new-boot.img\n</code></pre> \u5b89\u88c5 KernelSU_xxx-release.apk (https://github.com/tiann/KernelSU/releases/tag/v0.9.0)</p>"},{"location":"android/android_root/#lsposed","title":"LSPosed","text":"<p>LSPosed\u6846\u67b6: https://github.com/LSPosed/LSPosed</p> <p>Magisk\u9762\u5177root\u5b89\u88c5: LSPosed-v1.9.2-7024-riru-release.zip</p> <p>KernelSu\u5b89\u88c5: LSPosed-v1.9.2-7024-zygisk-release.zip </p> <p>\u62e8\u53f7\u952e\u8f93\u5165\u4ee3\u7801 ##5776733## \u53ef\u542f\u52a8\u5e94\u7528</p>"},{"location":"android/android_root/#riru","title":"Riru","text":"<p>https://github.com/RikkaApps/Riru</p>"},{"location":"android/android_root/#zygisk-next","title":"Zygisk-Next","text":"<p>https://github.com/tsailin-bit/ZygiskNext/</p>"},{"location":"android/android_root/#zygisk-on-kernelsu","title":"Zygisk-on-KernelSU","text":"<p>https://github.com/magiskmodule/Zygisk-on-KernelSU</p> <p>\u548cZygisk-Next\u4e92\u65a5</p>"},{"location":"android/android_studio/","title":"AS\u76f8\u5173","text":""},{"location":"android/android_studio/#composekotlin","title":"Compose\u4e0ekotlin\u7248\u672c\u517c\u5bb9","text":"<p>https://developer.android.com/jetpack/androidx/releases/compose-kotlin?hl=zh-cn</p>"},{"location":"android/android_studio/#_1","title":"\u6ce8\u89e3\u5904\u7406\u5668","text":"<p>auto-service: https://github.com/google/auto</p> <p>\u6dfb\u52a0kapt <pre><code>plugins {\n    id 'com.android.library'\n    id 'org.jetbrains.kotlin.android'\n    id 'kotlin-kapt'\n}\nannotationProcessor 'com.google.auto.service:auto-service:1.1.1'\nkapt 'com.google.auto.service:auto-service:1.1.1'\n</code></pre></p>"},{"location":"android/android_studio/#gradle","title":"gradle\u5e38\u89c1\u95ee\u9898","text":""},{"location":"android/android_studio/#gradle80","title":"\u8001\u7248\u672c\u5347\u7ea7gradle8.0","text":"<p>1.\u5148\u4fee\u6539gradle/gradle-wrapper.properties\u62108.0 <pre><code>distributionBase=GRADLE_USER_HOME\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-8.0-bin.zip\ndistributionPath=wrapper/dists\nzipStorePath=wrapper/dists\nzipStoreBase=GRADLE_USER_HOME\n</code></pre></p> <p>2.\u4fee\u6539settings.gradle\u548c\u6839build.gradle\u6587\u4ef6</p> <p>build.gradle\u53c2\u8003\u6a21\u677f <pre><code>buildscript {\n    ext {\n        compose_version = '1.4.2'\n    }\n}\nplugins {\n    id 'com.android.application' version '8.0.0' apply false\n    id 'com.android.library' version '8.0.0' apply false\n    id 'org.jetbrains.kotlin.android' version '1.8.10' apply false\n    id 'org.jetbrains.kotlin.jvm' version '1.8.10' apply false\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre> settings.gradle\u53c2\u8003\u6a21\u677f <pre><code>pluginManagement {\nrepositories {\ngradlePluginPortal()\ngoogle()\nmavenCentral()\nmaven { url 'https://jitpack.io' }\n}\n}\ndependencyResolutionManagement {\nrepositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\nrepositories {\ngoogle()\nmavenCentral()\nmaven { url 'https://jitpack.io' }//\u4e09\u65b9\u5e93\u5e38\u7528\n}\n}\nrootProject.name = \"KotlinApp\"//\u9879\u76ee\u6587\u4ef6\u5939\u540d\u5b57\ninclude ':app'\ninclude ':other'//\u5176\u4ed6module\n</code></pre> \u5176\u4ed6\u62a5\u9519\u4fee\u6539</p> <p>1.Build was configured to prefer settings repositories over project repositories but repository 'flatDir' was added by build file 'xxx\\build.gradle' <pre><code>repositories {\n    flatDir {\n        dirs 'libs', 'providedLibs'\n    }\n}\n</code></pre> \u89e3\u51b3\u65b9\u5f0f</p> <p>\u5c06flatDir\u90e8\u5206\u4ee3\u7801\u79fb\u52a8\u5230settings.gradle</p> <p>2.Namespace not specified. Please specify a namespace in the module's build.gradle file like so</p> <p>\u5c06\u6bcf\u4e2abuild.gradle\u4e2d\u6dfb\u52a0\u5305\u540d\uff0c\u53ef\u4eceAndroidManifest\u4e2d\u67e5\u770b <pre><code>android {\n    namespace 'com.xxx.xxx'\n}\n</code></pre></p> <p>3.Build Type 'debug' contains custom BuildConfig fields, but the feature is disabled.</p> <p>build.gradle\u4e2d\u4f7f\u7528\u4e86\u81ea\u5b9a\u4e49\u914d\u7f6e(BuildConfig)\u5c5e\u6027buildConfigField\uff0c8.0\u9ed8\u8ba4\u5173\u95ed\u9700\u8981\u624b\u52a8\u5f00\u542f <pre><code>android {\n    buildFeatures {\n        buildConfig = true\n    }\n}\n</code></pre> 4.\u65e0\u6cd5\u65b0\u5efaAIDL\u6587\u4ef6 Requires setting the buildFeatures.aidl to true in the build file <pre><code>buildFeatures {\n    aidl = true\n}\n</code></pre></p>"},{"location":"android/android_studio/#ndk","title":"ndk\u914d\u7f6e","text":"<p><pre><code>android {\n    //...\n    defaultConfig {\n        //...\n        //\u914d\u7f6e\u81ea\u5df1c++\u4ee3\u7801\u7f16\u8bd1\u7684CPU\u67b6\u6784\n        externalNativeBuild {\n            cmake {\n                cppFlags ''\n                abiFilters 'armeabi-v7a'\n            }\n        }\n        //\u914d\u7f6e\u6253\u5305\u54ea\u4e9bCPU\u67b6\u6784\n        ndk {\n            abiFilters 'armeabi-v7a'\n        }\n    }\n    //...\n    //\u914d\u7f6ecpp\u4ee3\u7801\u8def\u5f84\n    externalNativeBuild {\n        cmake {\n            path file('src/main/cpp/CMakeLists.txt')\n            version '3.22.1'\n        }\n    }\n}\n</code></pre> as\u63d2\u4ef6\uff1aCMake simple highlighter</p>"},{"location":"android/android_studio/#gradle_1","title":"gradle\u4e0b\u8f7d\u6e90","text":"<p>https://mirrors.huaweicloud.com/repository/maven/</p> <p>http://mirrors.cloud.tencent.com/gradle/</p> <p>\u66ff\u6362\uff1a .gradle/wrapper/dists/</p>"},{"location":"android/android_studio/#_2","title":"\u5e38\u89c1\u5f02\u5e38","text":"<ol> <li> <p>\u63d0\u793a\u6b64\u5e94\u7528\u4e13\u4e3a\u65e7\u7248android\u6253\u9020...\uff0c\u5e95\u90e8\u663e\u793a\u5168\u5c4f</p> <p>\u5c06minSdkVersion\u4fee\u6539\u621024\u6216\u4ee5\u4e0a</p> </li> <li> <p>java\u8f6ckt\u540e\u542f\u52a8Activity\u5931\u8d25</p> <p>app\u9879\u76ee\u7684gradle\u4e2d\u52a0kotlin\u63d2\u4ef6 <pre><code>plugins {\n    //...\n    id 'org.jetbrains.kotlin.android'\n}\n</code></pre> \u6839\u76ee\u5f55\u7684gradle\u5bf9\u5e94 <pre><code>plugins {\n    //...\n    id 'org.jetbrains.kotlin.android' version '1.8.10' apply false\n}\n</code></pre></p> </li> </ol>"},{"location":"android/android_ui/","title":"View\u57fa\u7840","text":""},{"location":"android/android_ui/#ui","title":"UI\u66f4\u65b0\u76f8\u5173","text":"<p>onCreate\u3001onResume\u4e2d\u53ef\u4ee5\u4f7f\u7528\u5b50\u7ebf\u7a0b\u66f4\u65b0ui <pre><code>&lt;androidx.appcompat.widget.AppCompatTextView\nandroid:id=\"@+id/tvShow\"\nandroid:layout_width=\"match_parent\"\nandroid:text=\"xml\u7684\u6587\u5b57\"\nandroid:textSize=\"@dimen/sp_25\"\nandroid:gravity=\"center\"\nandroid:layout_height=\"wrap_content\" /&gt;\n</code></pre> <pre><code>class ThreadCreateUIActivity : AppCompatActivity() {\nprivate var textView: AppCompatTextView? = null\n\noverride fun onCreate(savedInstanceState: Bundle?) {\nsuper.onCreate(savedInstanceState)\nsetContentView(R.layout.activity_thread_create_uiactivity)\ntextView = findViewById(R.id.tvShow)\nThread {\ntextView?.text = \"onCreate\u5b50\u7ebf\u7a0b\u4e2d\u4fee\u6539\"\n}.start()\nbtnTest?.setOnClickListener {\nthread {\ntextView?.text = \"click\u5b50\u7ebf\u7a0b\u4e2d\u4fee\u6539\"\n}\n}\n}\n\noverride fun onResume() {\nsuper.onResume()\nThread {\ntextView?.text = \"onResume\u5b50\u7ebf\u7a0b\u4e2d\u4fee\u6539\"\n}.start()\n}\n}\n</code></pre> \u5982\u679ctextView\u7684layout_width\u662fwrap_content\uff0cclick\u5237\u65b0ui\u4f1a\u62a5\u9519</p> <p>\u5b50\u7ebf\u7a0b\u4e2d\u521b\u5efa\u7684View\u53ef\u4ee5\u66f4\u65b0 <pre><code>//\u914d\u7f6e\u60ac\u6d6e\u7a97\u6743\u9650\n&lt;uses-permission android:name=\"android.permission.SYSTEM_ALERT_WINDOW\" /&gt;\n&lt;uses-permission android:name=\"android.permission.SYSTEM_OVERLAY_WINDOW\" /&gt;\n//\u5224\u65ad\u6743\u9650\uff0c\u8df3\u8f6c\u8bbe\u7f6e\u4e2d\u6253\u5f00\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {\nif (!Settings.canDrawOverlays(this)) {\nstartActivity(\nIntent(\nSettings.ACTION_MANAGE_OVERLAY_PERMISSION,\nUri.parse(\"package:$packageName\")\n)\n)\n}\n}\n\nprivate val handlerThread = HandlerThread(\"thread\")\n//\u70b9\u51fb\u65f6\u8c03\u7528\nprivate fun addFloatView() {\nhandlerThread.start()\nval handler = Handler(handlerThread.looper){\nval manager = getSystemService(WINDOW_SERVICE) as WindowManager\nval layoutParams = WindowManager.LayoutParams()\nlayoutParams.type = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY\nlayoutParams.flags = WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE\nlayoutParams.format = PixelFormat.RGBA_8888\nlayoutParams.gravity = Gravity.TOP or Gravity.LEFT\nlayoutParams.width = WindowManager.LayoutParams.WRAP_CONTENT\nlayoutParams.height = WindowManager.LayoutParams.WRAP_CONTENT\nlayoutParams.x = 50\nlayoutParams.y = 50\nmanager.addView(it.obj as View, layoutParams)\nfalse\n}\nThread {\nTextView(this).apply {\ntext = \"\u6d4b\u8bd5\u6587\u5b57\"\ntextSize = 25.0f\nsetTextColor(Color.GRAY)\nval ll = LinearLayout(this@ThreadCreateUIActivity)\nll.addView(this, LinearLayout.LayoutParams.WRAP_CONTENT, LinearLayout.LayoutParams.WRAP_CONTENT)\nsetOnClickListener {\nrunOnUiThread {\nToast.makeText(this@ThreadCreateUIActivity, \"\u88ab\u70b9\u51fb\", Toast.LENGTH_LONG).show()\n}\n}\nhandler.sendMessage(Message.obtain().let {\nit.obj = ll\nit\n})\n}\n}.start()\n}\n</code></pre> \u62a5\u5b50\u7ebf\u7a0b\u4e2d\u4e0d\u80fd\u66f4\u65b0ui\u7684\u5f02\u5e38\u662f\u5728ViewRootImpl\u4e2d <pre><code>ViewRootImpl.java\npublic void requestLayout() {\nif (!mHandlingLayoutInLayoutRequest) {\ncheckThread();\nmLayoutRequested = true;\nscheduleTraversals();\n}\n}\nvoid checkThread() {\nif (mThread != Thread.currentThread()) {\nthrow new CalledFromWrongThreadException(\n\"Only the original thread that created a view hierarchy can touch its views.\");\n}\n}\n</code></pre> \u6839\u636e\u666e\u901ahandleLaunchActivity\u53ef\u77e5ViewRootImpl\u521b\u5efa\u662f\u5728onResume\u540e\uff0c\u6240\u4ee5\u5728onCreate\u4e2d\u4e0d\u4f1a\u68c0\u67e5\u7ebf\u7a0b\u662f\u5426\u662fUI\u7ebf\u7a0b</p>"},{"location":"android/android_ui/#decorviewwindowviewviewrootimpl","title":"DecorView\u3001Window\u3001View\u3001ViewRootImpl","text":""},{"location":"android/android_ui/#window","title":"Window","text":"<p>Android\u4e2d\u7ba1\u7406View\u7684\u5de5\u5177\uff0c\u88c5\u8f7dView\u7684\u5b9e\u4f53\uff0cactivity\u548cdialog\u4f9d\u8d56\u4e8ewindow\uff0cwindow\u7684\u552f\u4e00\u5b9e\u73b0\u7c7b\u662fPhoneWindow\uff0c\u5728Activity\u7684attach\u65b9\u6cd5\u4e2d\u521b\u5efa\uff0cattach\u65b9\u6cd5\u5728handleResumeActivity\u8c03\u7528</p>"},{"location":"android/android_ui/#decorview","title":"DecorView","text":"<p><pre><code>AppCompatActivity\u4e2d\npublic void setContentView(View view) {\ninitViewTreeOwners();\ngetDelegate().setContentView(view);\n}\nAppCompatDelegateImpl.java\npublic void setContentView(View v) {\nensureSubDecor();\nViewGroup contentParent = mSubDecor.findViewById(android.R.id.content);\ncontentParent.removeAllViews();\ncontentParent.addView(v);\n//...\n}\n\nprivate void ensureSubDecor() {\nif (!mSubDecorInstalled) {\nmSubDecor = createSubDecor();\n}\n//...\n}\n</code></pre> v\u662f\u6dfb\u52a0\u5230contentParent\u4e2d\uff0ccontentParent\u662f\u901a\u8fc7mSubDecor\u83b7\u53d6\u7684\uff0c\u800cmSubDecor\u901a\u8fc7createSubDecor\u521b\u5efa <pre><code>private ViewGroup createSubDecor() {\n//...\nensureWindow();\nmWindow.getDecorView();\n//...\nViewGroup subDecor = null;\nsubDecor = (ViewGroup) LayoutInflater.from(themedContext)\n.inflate(R.layout.abc_screen_toolbar, null);\n\nmDecorContentParent = (DecorContentParent) subDecor\n.findViewById(R.id.decor_content_parent);\nmDecorContentParent.setWindowCallback(getWindowCallback());\n//...\nmWindow.setContentView(subDecor);\n//...\nreturn subDecor;\n}\n</code></pre> subDecor\u6700\u7ec8\u6dfb\u52a0\u5230mWindow\uff0c\u8c03\u7528PhoneWindow\u7684setContentView <pre><code>public void setContentView(View view, ViewGroup.LayoutParams params) {\nif (mContentParent == null) {\ninstallDecor();\n} else if (!hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\nmContentParent.removeAllViews();\n}\nif (hasFeature(FEATURE_CONTENT_TRANSITIONS)) {\nview.setLayoutParams(params);\nfinal Scene newScene = new Scene(mContentParent, view);\ntransitionTo(newScene);\n} else {\nmContentParent.addView(view, params);\n}\n//...\n}\n</code></pre> \u6b64\u5904installDecor\u4e0d\u4f1a\u8c03\u7528\uff0c\u800c\u662f\u5728mWindow.getDecorView()\u4e2d\u4f1a\u8c03\u7528mContentParent\u5c31\u4e0d\u4f1a\u4e3anull <pre><code>private void installDecor() {\nif (mDecor == null) {\nmDecor = generateDecor(-1);\n//...\n} else {\nmDecor.setWindow(this);\n}\nif (mContentParent == null) {\nmContentParent = generateLayout(mDecor);\n//...\n}\n}\n\nprotected DecorView generateDecor(int featureId) {\n//...\nreturn new DecorView(context, featureId, this, getAttributes());\n}\nprotected ViewGroup generateLayout(DecorView decor) {\n//...\n//\u52a0\u8f7d\u5e03\u5c40\u6587\u4ef6\u5230mDecor\nmDecor.onResourcesLoaded(mLayoutInflater, layoutResource);\nViewGroup contentParent = (ViewGroup)findViewById(ID_ANDROID_CONTENT);\n//...\nreturn contentParent;\n}\npublic &lt;T extends View&gt; T findViewById(@IdRes int id) {\nreturn getDecorView().findViewById(id);\n}\n</code></pre> \u603b\u7ed3\uff1asetContentView\u7684View\u6700\u7ec8\u5b58\u653e\u5230mContentParent\u4e2d\uff0cmContentParent\u662f\u901a\u8fc7DecorView\u901a\u8fc7id(com.android.internal.R.id.content)\u83b7\u5f97</p>"},{"location":"android/android_ui/#viewrootimpl","title":"ViewRootImpl","text":"<p>\u6865\u63a5View\u548cWms\uff0c\u5185\u90e8\u5c5e\u6027mView\u5c31\u662fDecorView\uff0c\u7ed1\u5b9a\u8fc7\u7a0b\u770bhandleResumeActivity\u8fc7\u7a0b\u4e2dWindowManagerGlobal\u8c03\u7528addView\u65b9\u6cd5</p> <p>performTraversals\u65b9\u6cd5\u4e2d\u91cd\u8981\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236\u6b65\u9aa4(View\u7684\u7ed8\u5236\u6d41\u7a0b) <pre><code>performMeasure(childWidthMeasureSpec, childHeightMeasureSpec);\nperformLayout(lp, mWidth, mHeight);\nperformDraw()\n</code></pre></p> <p>View\u7684invalidate()\u4f1a\u8c03\u7528onDraw\uff0c\u5927\u81f4\u6d41\u7a0b\u662finvalidate\u4f1a\u9010\u5c42\u627eparent\u4e00\u76f4\u5230DecorView\u5373ViewRootImpl\u4e2d\u7684mView\u4e2d\uff0c\u7136\u540e\u7531ViewRootImpl\u5206\u53d1\u7ed9\u6240\u6709View\uff0c\u4e0d\u4f1a\u8c03\u7528ViewRootImpl\u7684invalidate\uff0c\u800c\u662f\u9012\u5f52\u8c03\u7528\u7236View\u7684invalidateChildInParent\uff0c\u7136\u540e\u89e6\u53d1ViewRootImpl\u7684performTraversals\uff0c\u7531\u4e8emLayoutRequested\u4e3afalse\uff0conMeasure\u548conLayout\u4e0d\u88ab\u8c03\u7528\uff0c\u53ea\u8c03\u7528onDraw\uff0c\u4e5f\u4f1a\u8c03\u7528computeScroll\u65b9\u6cd5</p>"},{"location":"android/android_ui/#invalidatepostinvalidate","title":"invalidate\u548cpostInvalidate","text":"<p>postInvalidate\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8c03\u7528\u5237\u65b0\uff0c\u901a\u8fc7Handler\u5207\u6362\u7ebf\u7a0b\u6700\u7ec8\u8c03\u7528invalidate</p>"},{"location":"android/android_ui/#requesstlayout","title":"requesstLayout","text":"<p>\u4f1a\u8c03\u7528onMeasure\u548cnLayout\u65b9\u6cd5\uff0c\u4e0d\u4e00\u5b9a\u89e6\u53d1onDraw</p>"},{"location":"android/android_ui/#view","title":"View\u7684\u6ed1\u52a8","text":"<ol> <li>scrollTo\u548cscrollBy</li> <li>\u5e73\u79fb\u52a8\u753b</li> <li>layoutParams\u4e2dmargin\u503c\u4fee\u6539</li> <li>\u8c03\u7528layout\u4fee\u6539\u503c</li> <li>Scroller+invalidate+\u91cd\u5199computeScroll</li> </ol>"},{"location":"android/android_ui/#_1","title":"\u4e8b\u4ef6\u5206\u53d1\u673a\u5236","text":"<ol> <li>dispatcchTouchEvent\uff1a\u4e8b\u4ef6\u5206\u53d1\u903b\u8f91\uff0c\u8fd4\u56de\u503csuper\u548c\u76f4\u63a5true\u3001false\u6548\u679c\u662f\u4e0d\u540c\u7684</li> <li>onInterceptTouchEvent\uff1a\u4e8b\u4ef6\u62e6\u622a\uff0cviewgroup\u4e13\u5c5e</li> <li>onTouchEvent\uff1a\u5904\u7406\u4e8b\u4ef6</li> </ol> <p>FrameLayout\u5305\u542bView1\u548cview2</p> <p>down\u4e8b\u4ef6\uff1a</p> <p>f(dis)-&gt;f(intercept=true)-&gt;f(onTouch)</p> <p>f(dis)-&gt;f(intercept=false)-&gt;v2(dis)-&gt;v2(onTouch)-&gt;v1(dis)-&gt;v1(onTouch)-&gt;f(onTouch)</p> <p>f(dis=true)-&gt;f(dis)</p> <p>f(dis=false)</p>"},{"location":"android/android_ui/#_2","title":"\u4e8b\u4ef6\u51b2\u7a81","text":"<ol> <li>\u5185\u90e8\u62e6\u622a\u6cd5</li> </ol> <p>\u6839\u636e\u6761\u4ef6\u5728\u5b50view\u4e2d\u7684dispatcchTouchEvent\u8bf7\u6c42\u7236\u5bb9\u5668\u4e0d\u62e6\u622a\u4e8b\u4ef6 <pre><code>parent.requestDisallowInterceptTouchEvent(true)\n</code></pre></p> <ol> <li>\u5916\u90e8\u62e6\u622a\u6cd5 \u76f4\u63a5\u5728\u7236\u5bb9\u5668\u7684onInterceptTouchEvent\u6839\u636e\u6761\u4ef6\u62e6\u622a\u4e8b\u4ef6</li> </ol>"},{"location":"android/android_ui/#ontouchontoucheventonclick","title":"onTouch\u3001onTouchEvent\u3001onClick","text":"<p>onTouch\u662f\u901a\u8fc7setOnTouchListener\u56de\u8c03\uff0c\u8fd4\u56deboolean</p> <p>V2\u4e0a\u8bbe\u7f6esetOnTouchListener\uff0c\u5219\u8c03\u7528\u5982\u4e0b</p> <p>v2(dis)-&gt;onTouch(false)-&gt;v2(onTouchEvent)</p> <p>v2(dis)-&gt;onTouch(true)</p> <p>V2\u4e0a\u8bbe\u7f6esetOnClickListener\uff0c\u5219\u8c03\u7528\u5982\u4e0b</p> <p>v2(dis)-&gt;v2(onTouchEvent = false)</p> <p>v2(dis)-&gt;v2(onTouchEvent = true)</p> <p>v2(dis)-&gt;v2(onTouchEvent = super.onTouchEvent)-&gt;onClick</p> <p>\u603b\u7ed3\uff1a 1. \u8bbe\u7f6esetOnTouchListener\u540eonClick\u80af\u5b9a\u4e0d\u4f1a\u8c03\u7528 2. onTouchEvent\u8c03\u7528\u7531onTouch\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\uff0cfalse\u8c03\u7528 3. onClick\u8c03\u7528\u7531onTouchEvent\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\uff0c\u8c03\u7528super.onTouchEvent\u4e14\u662f\u5728UP\u4e8b\u4ef6\u540e</p> <p>\u8bbe\u8ba1\u6a21\u5f0f\uff1a\u8d23\u4efb\u94fe\u6a21\u5f0f</p>"},{"location":"android/design_mode/","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"android/design_mode/#_1","title":"\u8bbe\u8ba1\u6a21\u5f0f\u516d\u5927\u539f\u5219","text":""},{"location":"android/design_mode/#1","title":"1.\u5355\u4e00\u804c\u8d23\u539f\u5219","text":"<p>\u4e00\u4e2a\u7c7b\u5e94\u8be5\u53ea\u8d1f\u8d23\u4e00\u9879\u804c\u8d23</p>"},{"location":"android/design_mode/#2","title":"2.\u63a5\u53e3\u9694\u79bb\u539f\u5219","text":"<p>\u5efa\u7acb\u5355\u4e00\u63a5\u53e3\uff0c\u4e0d\u8981\u5efa\u7acb\u81c3\u80bf\u5e9e\u5927\u7684\u63a5\u53e3\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u63a5\u53e3\u5c3d\u91cf\u7ec6\u5316\uff0c\u540c\u65f6\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u5c3d\u91cf\u5c11</p>"},{"location":"android/design_mode/#3","title":"3.\u91cc\u6c0f\u66ff\u6362\u539f\u5219","text":"<p>\u5b50\u7c7b\u53ef\u4ee5\u6269\u5c55\u7236\u7c7b\u7684\u529f\u80fd\uff0c\u4f46\u662f\u4e0d\u80fd\u6539\u53d8\u7236\u7c7b\u539f\u6709\u7684\u529f\u80fd(\u4e0d\u80fd\u8986\u76d6\u7236\u7c7b\u7684\u975e\u62bd\u8c61\u65b9\u6cd5)</p>"},{"location":"android/design_mode/#4","title":"4.\u4f9d\u8d56\u5012\u7f6e\u539f\u5219","text":"<p>\u6a21\u5757\u95f4\u4f9d\u8d56\u901a\u8fc7\u62bd\u8c61\u53d1\u751f\uff0c\u5b9e\u73b0\u7c7b\u4e4b\u95f4\u4e0d\u53d1\u751f\u76f4\u63a5\u4f9d\u8d56\u5173\u7cfb\uff0c\u5982\u7c7b\u4e2d\u7684\u6210\u5458\u5c5e\u6027\u5e94\u8be5\u62bd\u8c61\u5316(\u63a5\u53e3)</p>"},{"location":"android/design_mode/#5","title":"5.\u8fea\u7c73\u7279\u6cd5\u5219","text":"<p>\u6838\u5fc3\u662f\u5c3d\u91cf\u964d\u4f4e\u7c7b\u4e4b\u95f4\u7684\u8026\u5408</p>"},{"location":"android/design_mode/#6","title":"6.\u5f00\u95ed\u539f\u5219","text":"<p>\u5f3a\u8c03\u5bf9\u4fee\u6539\u5173\u95ed\uff0c\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u9075\u5faa\u8be5\u539f\u5219\u80fd\u591f\u4f7f\u4ee3\u7801\u66f4\u52a0\u7075\u6d3b\u3001\u6613\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55</p>"},{"location":"android/design_mode/#23","title":"23\u79cd\u8bbe\u8ba1\u6a21\u5f0f","text":"<ol> <li> <p>\u521b\u5efa\u578b\u6a21\u5f0f\uff0c\u5171\u4e94\u79cd\uff1a\u2f2f\u2f1a\u2f45\u6cd5\u6a21\u5f0f\u3001\u62bd\u8c61\u2f2f\u2f1a\u6a21\u5f0f\u3001\u5355\u4f8b\u6a21\u5f0f\u3001\u5efa\u9020\u8005\u6a21\u5f0f\u3001\u539f\u578b\u6a21\u5f0f</p> </li> <li> <p>\u7ed3\u6784\u578b\u6a21\u5f0f\uff0c\u5171\u4e03\u79cd\uff1a\u9002\u914d\u5668\u6a21\u5f0f\u3001\u88c5\u9970\u5668\u6a21\u5f0f\u3001\u4ee3\u7406\u6a21\u5f0f\u3001\u5916\u89c2\u6a21\u5f0f\u3001\u6865\u63a5\u6a21\u5f0f\u3001\u7ec4\u5408\u6a21\u5f0f\u3001\u4eab\u5143\u6a21\u5f0f</p> </li> <li> <p>\u2f8f\u4e3a\u578b\u6a21\u5f0f\uff0c\u5171\u2f17\u2f00\u79cd\uff1a\u7b56\u7565\u6a21\u5f0f\u3001\u6a21\u677f\u2f45\u6cd5\u6a21\u5f0f\u3001\u89c2\u5bdf\u8005\u6a21\u5f0f\u3001\u8fed\u4ee3\u2f26\u6a21\u5f0f\u3001\u8d23\u4efb\u94fe\u6a21\u5f0f\u3001\u547d\u4ee4\u6a21\u5f0f\u3001\u5907\u5fd8\u5f55\u6a21\u5f0f\u3001\u72b6\u6001\u6a21\u5f0f\u3001\u8bbf\u95ee\u8005\u6a21\u5f0f\u3001\u4e2d\u4ecb\u8005\u6a21\u5f0f\u3001\u89e3\u91ca\u5668\u6a21\u5f0f</p> </li> </ol>"},{"location":"android/design_mode/#_2","title":"\u5355\u4f8b\u6a21\u5f0f","text":"<p>\u5355\u4f8b\u6a21\u5f0f</p>"},{"location":"android/design_mode/#_3","title":"\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f","text":"<p>AsyncTask(onPreExecute\u3001doInBackground\u3001onPostExecute)\u3001Activity(\u751f\u547d\u5468\u671f)</p>"},{"location":"android/design_mode/#_4","title":"\u89c2\u5bdf\u8005\u6a21\u5f0f","text":"<p>\u89c2\u5bdf\u8005\u6a21\u5f0f</p>"},{"location":"android/design_mode/#_5","title":"\u4eab\u5143\u6a21\u5f0f","text":"<p>\u4eab\u5143\u6a21\u5f0f</p>"},{"location":"android/design_mode/#_6","title":"\u7b56\u7565\u6a21\u5f0f","text":"<p>\u7b56\u7565\u6a21\u5f0f</p>"},{"location":"android/design_mode/#_7","title":"\u8d23\u4efb\u94fe\u6a21\u5f0f <p>Android\u4e8b\u4ef6\u5206\u53d1\u673a\u5236</p> <p>\u4f18\u70b9 1. \u964d\u4f4e\u5bf9\u8c61\u95f4\u8026\u5408\u5ea6 2. \u589e\u5f3a\u7cfb\u7edf\u53ef\u6269\u5c55\u6027\uff0c\u6ee1\u8db3\u5f00\u95ed\u539f\u5219 3. \u589e\u5f3a\u5bf9\u8c61\u6307\u6d3e\u8d23\u4efb\u7684\u7075\u6d3b\u6027 4. \u7b80\u5316\u5bf9\u8c61\u4e4b\u95f4\u7684\u8fde\u63a5\uff0c\u907f\u514dif else\u8bed\u53e5 5. \u8d23\u4efb\u5206\u62c5\uff0c\u6bcf\u4e2a\u7c7b\u53ea\u9700\u8981\u5904\u7406\u81ea\u5df1\u7684\u5de5\u4f5c\uff0c\u7b26\u5408\u5355\u4e00\u804c\u8d23\u539f\u5219</p> <p>\u7f3a\u70b9 1. \u4e0d\u80fd\u4fdd\u8bc1\u4e8b\u4ef6\u4e00\u5b9a\u88ab\u5904\u7406 2. \u8d23\u4efb\u94fe\u592a\u957f\u65f6\uff0c\u7cfb\u7edf\u6027\u80fd\u53d7\u5f71\u54cd 3. \u8d23\u4efb\u94fe\u5efa\u7acb\u9700\u8981\u5408\u7406\u5904\u7406\u624d\u80fd\u4fdd\u8bc1\uff0c\u590d\u6742\u6027\u589e\u52a0</p>","text":""},{"location":"android/resource/","title":"Resource","text":"<p>\u8c37\u6b4c\u6587\u5b57\u5e93\uff1ahttps://www.googlefonts.cn/</p> <p>Android\u7248\u672c\uff1ahttps://developer.android.google.cn/about/versions?hl=zh-cn</p> <p>\u84dd\u7259\u3001\u7f51\u7edc\u3001USB\u7b49\uff1ahttps://developer.android.google.cn/develop/connectivity/overview?hl=zh-cn</p> <p>Android\u5f00\u53d1\uff1ahttps://developer.android.google.cn/guide?hl=zh-cn</p>"},{"location":"android/component/com_base/","title":"as\u914d\u7f6e","text":""},{"location":"android/component/com_base/#_1","title":"\u610f\u4e49","text":"<p>\u4e0d\u4e92\u76f8\u4f9d\u8d56\uff0c\u53ef\u4ee5\u4e92\u76f8\u4ea4\u4e92\uff0c\u4efb\u610f\u7ec4\u5408\uff0c\u9ad8\u5ea6\u89e3\u8026\uff0c\u81ea\u7531\u62c6\u5378\uff0c\u81ea\u7531\u7ec4\u88c5\uff0c\u91cd\u590d\u5229\u7528\uff0c\u5206\u5c42\u72ec\u7acb\u5316</p>"},{"location":"android/component/com_base/#_2","title":"\u5de5\u7a0b\u914d\u7f6e","text":"<p>app\u58f3\u5de5\u7a0b\u548c\u591a\u4e2a\u72ec\u7acb\u6a21\u5757</p> <p>\u5229\u7528gradle\u5207\u6362application\u548clibrary\u8fbe\u5230\u6a21\u5757\u53ef\u72ec\u7acb\u8fd0\u884c</p> <p>\u6839\u76ee\u5f55\u6dfb\u52a0config.gradle <pre><code>ext {\n    isRelease = false//\u5f00\u5173\u63a7\u5236\uff0c\u8c03\u8bd5\u65f6\u8ba9\u6a21\u5757\u5355\u72ec\u8fd0\u884c\n    appId = [\n            app    : \"com.android.kotlinapp\",\n            module1: \"com.module.xx\",\n            module2: \"com.module.xxx\",\n    ]\n}\n</code></pre> \u6839build.gradle\u5f15\u7528 <pre><code>apply from: \"config.gradle\"\n</code></pre> \u6a21\u5757gradle\u4fee\u6539 <pre><code>def config = rootProject.ext\nif (config.isRelease) {\n    apply plugin: 'com.android.library'\n} else {\n    apply plugin: 'com.android.application'\n}\nandroid {\n    defaultConfig {\n        if (!config.isRelease) {//\u8c03\u8bd5\u65f6\u9700\u8981id\n            applicationId config.appId.module1\n        }\n        ...\n    }\n    ...\n}\n</code></pre> app\u58f3gradle\u4fee\u6539 <pre><code>if (config.isRelease) {\n    implementation project(path: ':module1')\n    implementation project(path: ':module2')\n    implementation project(path: ':module3')\n}\n</code></pre></p>"},{"location":"android/component/com_base/#apt","title":"APT\u6280\u672f","text":"<p>\u65b0\u5efa\u4e24\u4e2ajava/kotlin\u6a21\u5757\uff0cannotations\u548ccompiler </p> <p>\u5176\u4e2dannotations\u4e3b\u8981\u662f\u58f0\u660e\u6ce8\u89e3\uff0ccompiler\u7528\u4e8eAPT\u5b9e\u73b0</p> <p>\u6ce8\u89e3\u90e8\u5206\u6bd4\u8f83\u7b80\u5355 <pre><code>@Target( AnnotationTarget.CLASS)\n@Retention(AnnotationRetention.BINARY)\nannotation class ARouter(\nval path: String = \"\",\nval group: String = \"\"\n)\n</code></pre> APT\u7528\u4e8e\u4ee5\u4ee3\u7801\u7684\u65b9\u5f0f\u751f\u6210\u4ee3\u7801\uff0c\u9996\u5148gradle\u6dfb\u52a0\u4f9d\u8d56 <pre><code>plugins {\n    id 'kotlin-kapt'\n}\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n\n    // \u80cc\u540e\u7684\u670d\u52a1 \u80fd\u591f\u76d1\u542c \u4f60\u662f\u5426\u5728\u7f16\u8bd1\u4e2d.....\n    // https://github.com/google/auto/tree/master/service\n    compileOnly 'com.google.auto.service:auto-service:1.0.1'\n    kapt 'com.google.auto.service:auto-service:1.0.1'\n\n    // \u5e2e\u52a9\u6211\u4eec\u901a\u8fc7\u7c7b\u8c03\u7528\u7684\u5f62\u5f0f\u6765\u751f\u6210Java\u4ee3\u7801\n    // https://github.com/square/javapoet\n    // https://github.com/square/kotlinpoet\n    //implementation 'com.squareup:javapoet:1.13.0'\n    implementation 'com.squareup:kotlinpoet:1.12.0'\n\n    // \u4f9d\u8d56\u6ce8\u89e3\n    implementation project(\":annotations\")\n}\n</code></pre> \u540c\u6b65\u540e\u81ea\u5b9a\u4e49\u7c7b\u76d1\u542c\u7f16\u8bd1\u65f6 <pre><code>@AutoService(Processor::class)// \u542f\u7528\u670d\u52a1\n@SupportedSourceVersion(SourceVersion.RELEASE_11) // \u73af\u5883\u7684\u7248\u672c\n@SupportedOptions(\"moduleName\") // \u63a5\u6536 \u5b89\u5353\u5de5\u7a0b\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\n@SupportedAnnotationTypes(\"com.hfc.annotations.ARouter\")// \u6ce8\u89e3\u5b8c\u6574\u8def\u5f84\nclass ARouterProcessor : AbstractProcessor() {\n// \u64cd\u4f5cElement\u7684\u5de5\u5177\u7c7b\uff08\u7c7b\uff0c\u51fd\u6570\uff0c\u5c5e\u6027\uff0c\u5176\u5b9e\u90fd\u662fElement\uff09\nprivate lateinit var mElements: Elements\n\n// Message\u7528\u6765\u6253\u5370 \u65e5\u5fd7\u76f8\u5173\u4fe1\u606f\nprivate lateinit var mMessager: Messager\n\n// \u6587\u4ef6\u751f\u6210\u5668\uff0c \u7c7b\u8d44\u6e90\u7b49\uff0c\u5c31\u662f\u6700\u7ec8\u8981\u751f\u6210\u7684\u6587\u4ef6\u662f\u9700\u8981Filer\u6765\u5b8c\u6210\u7684\nprivate lateinit var mFiler: Filer\n\n// type(\u7c7b\u4fe1\u606f)\u7684\u5de5\u5177\u7c7b\uff0c\u5305\u542b\u7528\u4e8e\u64cd\u4f5cTypeMirror\u7684\u5de5\u5177\u65b9\u6cd5\nprivate lateinit var mTypeTool: Types\n\noverride fun init(processingEnv: ProcessingEnvironment) {\nsuper.init(processingEnv)\nmElements = processingEnv.elementUtils\nmMessager = processingEnv.messager\nmFiler = processingEnv.filer\n\nval name = processingEnv.options?.get(\"moduleName\")\nmMessager.printMessage(Diagnostic.Kind.NOTE, \"===============init $name\")\n}\n\noverride fun process(\nannotations: MutableSet&lt;out TypeElement&gt;,\nroundEnv: RoundEnvironment\n): Boolean {\nmMessager.printMessage(Diagnostic.Kind.NOTE, \"------------------process\")\nif (annotations.isEmpty()) {\nreturn false // \u7531\u4e8e\u56de\u8c03\u75283\u6b21\u6b64\u65b9\u6cd5\uff0c\u5176\u4e2d\u6b63\u786e\u7684\u4e00\u6b21annotations\u6709\u503c\n}\nreturn false\n}\n}\n</code></pre> \u6ce8\uff1a Diagnostic.Kind.ERROR\u7528\u4e8e\u629b\u5f02\u5e38\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u68c0\u67e5\u5f02\u5e38\u65f6\u4f7f\u7528</p> <p>SupportedOptions\u63a5\u6536\u7684\u53c2\u6570\u662f\u901a\u8fc7gradle\u4f20\u9012\uff0c\u6a21\u5757\u4e2d\u53ef\u4ee5\u8fd9\u6837\u5b9a\u4e49 <pre><code>kapt {\n    arguments {\n        arg(\"moduleName\", project.getName())\n    }\n}\n</code></pre> javapoet/kotlinpoet\u90fd\u662f\u4ee5oop\u601d\u60f3\u65b9\u5f0f\u751f\u6210\u4ee3\u7801\uff0c\u8fd8\u6709\u4e00\u79cd\u4f20\u7edf\u65b9\u5f0f\u76f4\u63a5\u4e00\u884c\u884c\u5199\u5b57\u7b26\u4e32\u65b9\u5f0f\u53ef\u770bEventBus\u5b9e\u73b0</p>"},{"location":"android/component/com_base/#auto-service","title":"auto-service","text":"<p>build.gradle\u4e2d\u6dfb\u52a0\u6ce8\u89e3\u89e3\u91ca\u5668\u548cauto-service</p> <p>\u89c1as\u914d\u7f6e</p>"},{"location":"android/component/com_base/#auto-service_1","title":"\u4f7f\u7528Auto-Service","text":"<p><pre><code>object ServiceLoader {\nfun &lt;T&gt; load(service: Class&lt;T&gt;): T? {\nreturn try {\nServiceLoader.load(service).iterator().next()\n} catch (e: Exception) {\nnull\n}\n}\n}\n</code></pre> \u4e3b\u8981\u7528\u6765\u52a0\u8f7d\u63a5\u53e3\u65b9\u6cd5 <pre><code>interface XXX{\nfun xx()\n}\n\n@AutoService(XXX::class)\nclass XXXImpl: XXX {\n}\n\nServiceLoader.load(XXX::class.java)\n</code></pre> \u4f7f\u7528\u6848\u4f8bWebView\u5c01\u88c5</p>"},{"location":"android/compose/compose_annotation/","title":"Compose annotation","text":""},{"location":"android/compose/compose_annotation/#composable","title":"@Composable","text":"<p>\u53ef\u7ec4\u5408\u51fd\u6570\uff0cJetpack Compose \u662f\u56f4\u7ed5\u53ef\u7ec4\u5408\u51fd\u6570\u6784\u5efa\u7684 <pre><code>@Composable\nfun MessageCard(name: String) {\nText(text = \"Hello $name!\")\n}\n</code></pre></p>"},{"location":"android/compose/compose_annotation/#preview","title":"@Preview","text":"<p>\u5f00\u542f\u9884\u89c8\u529f\u80fd <pre><code>@Preview(\nshowBackground = true,\nshowSystemUi = true,\ndevice = Devices.NEXUS_5\n)\n@Composable\nfun MessageCard(name: String) {\nText(text = \"Hello $name!\")\n}\n</code></pre> \u63a5\u53e3</p> \u53c2\u6570\u540d \u53c2\u6570\u7c7b\u578b \u5fc5\u586b \u53c2\u6570\u63cf\u8ff0 name String \u5426 \u8bbe\u7f6e\u9884\u89c8\u522b\u540d group String \u5426 \u8bbe\u7f6e\u9884\u89c8\u7ec4\u540d apiLevel Int \u5426 \u8bbe\u7f6eapi\u7b49\u7ea7\uff0c\u6839\u636eas\u63d0\u793a\u8303\u56f4\u586b\u5199 widthDp Int \u5426 \u8bbe\u7f6e\u9884\u89c8\u754c\u9762\u5bbd\u5ea6\uff0c\u5355\u4f4ddp heightDp Int \u5426 \u8bbe\u7f6e\u9884\u89c8\u754c\u9762\u9ad8\u5ea6\uff0c\u5355\u4f4ddp locale String \u5426 \u8bbe\u7f6e\u9884\u89c8\u8bed\u8a00\uff0c\u5982\u4e2d\u6587\uff0c\u82f1\u6587\u7b49 fontScale Float \u5426 \u8bbe\u7f6e\u9884\u89c8\u6587\u5b57\u7f29\u653e showSystemUi Boolean \u5426 \u8bbe\u7f6e\u9884\u89c8\u72b6\u6001\u680f\u5e95\u90e8\u680f\u663e\u793a showBackground Boolean \u5426 \u8bbe\u7f6e\u9884\u89c8\u754c\u9762\u80cc\u666f\u663e\u793a backgroundColor String \u5426 \u8bbe\u7f6e\u9884\u89c8\u754c\u9762\u80cc\u666f\u989c\u8272 uiMode UiMode \u5426 \u8bbe\u7f6e\u9884\u89c8\u663e\u793a\u6a21\u5f0f\uff0c\u5982\u591c\u95f4\u6a21\u5f0f device Device \u5426 \u8bbe\u7f6e\u9884\u89c8\u8bbe\u5907 wallpaper Wallpaper \u5426 \u8bbe\u7f6e\u9884\u89c8\u58c1\u7eb8"},{"location":"android/compose/compose_annotation/#uimode","title":"UiMode","text":"\u540d\u79f0 \u63cf\u8ff0 UI_MODE_TYPE_UNDEFINED \u672a\u5b9a\u4e49 UI_MODE_TYPE_NORMAL \u6b63\u5e38\u6a21\u5f0f UI_MODE_TYPE_DESK \u5de5\u4f5c\u6a21\u5f0f UI_MODE_TYPE_CAR \u6c7d\u8f66\u6a21\u5f0f UI_MODE_TYPE_TELEVISION \u7535\u89c6\u8bbe\u5907 UI_MODE_TYPE_APPLIANCE \u4fbf\u643a\u8bbe\u5907 UI_MODE_TYPE_WATCH \u624b\u8868\u8bbe\u5907 UI_MODE_TYPE_VR_HEADSET VR\u8bbe\u5907 UI_MODE_NIGHT_MASK \u591c\u95f4\u6a21\u5f0f UI_MODE_NIGHT_UNDEFINED \u591c\u95f4\u672a\u5b9a\u4e49 UI_MODE_NIGHT_NO \u767d\u5929\u6a21\u5f0f UI_MODE_NIGHT_YES \u9ed1\u591c\u6a21\u5f0f <p>group\u4e00\u822c\u548cdevices\u7ec4\u5408\u4f7f\u7528\uff0c\u5982\u6a2a\u5c4f\u548c\u7ad6\u5c4f </p>"},{"location":"android/compose/compose_laziness/","title":"Compose laziness","text":"<p>\u6848\u4f8b</p> <p><pre><code>fun MainSample() {\nlog(\"1\")\nvar state by remember {\nmutableStateOf(\"init\")\n}\nLaunchedEffect(key1 = Unit){\ndelay(1000L)\nstate = \"modify\"\n}\nGreeting(content = state)\nlog(\"4\")\n}\n\n@Composable\nfun Greeting(content: String) {\nlog(\"2 $content\")\nText(text = content)\nlog(\"3 $content\")\n}\n\nfun log(msg: String){\nLog.d(\"TAG\", \"log: $msg\")\n}\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\nlog: 1\nlog: 2 init\nlog: 3 init\nlog: 4\n1s\u540e\nlog: 1\nlog: 2 modify\nlog: 3 modify\nlog: 4\n</code></pre> \u4f18\u5316\u540e</p> <p><pre><code>fun MainSample() {\n...\nGreeting { state }\n...\n}\n\n@Composable\nfun Greeting(lambda: () -&gt; String) {\nlog(\"2 ${lambda()}\")\nText(text = lambda())\nlog(\"3 ${lambda()}\")\n}\n\n\u8fd0\u884c\u7ed3\u679c\uff1a\n\nlog: 1\nlog: 2 init\nlog: 3 init\nlog: 4\n1s\u540e\nlog: 2 modify\nlog: 3 modify\n</code></pre> \u539f\u56e0\u662flambda\u8868\u8fbe\u5f0f\u662f\u5728\u8c03\u7528\u7684\u65f6\u5019\u624d\u6267\u884c\uff0c\u4f18\u5316\u540e\u7684\u4f5c\u7528\u57df\u53d8\u6210\u4e86Greeting\u51fd\u6570\u4e2d\uff0c\u56e0\u4e3a\u4e0d\u4f1a\u89e6\u53d1MainSample\u7684\u51fd\u6570\u4f5c\u7528\u57df</p>"},{"location":"android/compose/compose_text/","title":"Compose text","text":""},{"location":"android/compose/compose_text/#_1","title":"\u6587\u5b57\u5185\u5bb9","text":"<pre><code>Text(text = \"app_name\")\nText(text = stringResource(id = R.string.app_name))\n</code></pre>"},{"location":"android/compose/compose_text/#_2","title":"\u6587\u5b57\u989c\u8272","text":"<pre><code>color = Color.Blue\ncolor = Color(0XFFFFFF00)\ncolor = Color(1F, 1F, 0F, 1f)\ncolor = Color(255, 255, 0, 0xFF)\ncolor = colorResource(id = R.color.black)\n</code></pre>"},{"location":"android/compose/compose_text/#_3","title":"\u6587\u5b57\u5927\u5c0f","text":"<pre><code>fontSize = 16.sp\nfontSize = TextUnit(22f, TextUnitType.Sp)\n</code></pre>"},{"location":"android/compose/compose_text/#_4","title":"\u6587\u5b57\u7c97\u7ec6","text":"<pre><code>fontWeight = FontWeight.Bold\n</code></pre>"},{"location":"android/compose/compose_text/#_5","title":"\u6587\u5b57\u6837\u5f0f","text":"<pre><code>fontStyle = FontStyle.Normal\nfontStyle = FontStyle.Italic\n</code></pre>"},{"location":"android/compose/compose_text/#_6","title":"\u5b57\u4f53","text":"<pre><code>fontFamily = FontFamily.SansSerif\n</code></pre>"},{"location":"android/compose/compose_text/#_7","title":"\u6587\u5b57\u95f4\u8ddd","text":"<pre><code>letterSpacing = 10.sp\n</code></pre>"},{"location":"android/compose/compose_text/#_8","title":"\u6587\u5b57\u88c5\u9970","text":"<pre><code>textDecoration = TextDecoration.Underline//\u4e0b\u5212\u7ebf\ntextDecoration = TextDecoration.combine(listOf(\nTextDecoration.LineThrough,//\u5220\u9664\u7ebf\nTextDecoration.Underline//\u4e0b\u5212\u7ebf\n))//\u540c\u65f6\u5b58\u5728\n</code></pre>"},{"location":"android/compose/compose_text/#_9","title":"\u6587\u5b57\u4f4d\u7f6e","text":"<pre><code>textAlign = TextAlign.Center\n</code></pre>"},{"location":"android/compose/compose_text/#_10","title":"\u884c\u9ad8","text":"<pre><code>lineHeight = 15.sp\n</code></pre>"},{"location":"android/compose/compose_text/#_11","title":"\u6587\u5b57\u884c\u6570\u4ee5\u53ca\u88c1\u526a","text":"<pre><code>overflow = TextOverflow.Clip\nmaxLines = 1\n</code></pre>"},{"location":"android/compose/compose_text/#_12","title":"\u6587\u5b57\u6837\u5f0f\u53ef\u8bbe\u7f6e\u5f88\u591a\u5c5e\u6027\uff0c\u5305\u62ec\u4ee5\u4e0a\u4ee5\u53ca\u989d\u5916\u7684\u7f29\u8fdb\u7b49","text":"<pre><code>style = TextStyle()\n</code></pre>"},{"location":"android/compose/compose_text/#_13","title":"\u6587\u5b57\u53ef\u9009\u62e9","text":"<pre><code>SelectionContainer {\nText()\n}\n</code></pre>"},{"location":"android/compose/compose_text/#_14","title":"\u53ef\u70b9\u51fb\u6587\u672c(\u5bcc\u6587\u672c)","text":"<p>\u6848\u4f8b\uff1a\u7528\u6237\u534f\u8bae\u548c\u9690\u79c1\u653f\u7b56\u70b9\u51fb\u8d85\u94fe\u63a5 <pre><code>val annoStr = buildAnnotatedString {\nappend(\"\u70b9\u51fb\u767b\u5f55\u4ee3\u7801\u540c\u610f\")\npushStringAnnotation(\"protocol\", \"https://www.baidu.com\")\nwithStyle(\nSpanStyle(\ncolor = Color.Blue,\ntextDecoration = TextDecoration.Underline\n)\n) {\nappend(\"\u7528\u6237\u534f\u8bae\")\n}\npop()\nappend(\"\u548c\")\npushStringAnnotation(\"private\", \"https://developer.android.google.cn/jetpack/compose\")\nwithStyle(\nSpanStyle(\ncolor = Color.Blue,\ntextDecoration = TextDecoration.Underline\n)\n) {\nappend(\"\u9690\u79c1\u653f\u7b56\")\n}\npop()\n}\nvar showStr by remember {\nmutableStateOf(\"\")\n}\nColumn {\nClickableText(text = annoStr, onClick = { position -&gt;\nshowStr = annoStr.getStringAnnotations(\"protocol\", position, position)\n.firstOrNull()?.item ?: annoStr.getStringAnnotations(\"private\", position, position)\n.firstOrNull()?.item ?: \"\"\n})\nText(text = showStr)\n}\n</code></pre></p>"},{"location":"android/design/design_enyuan/","title":"Design enyuan","text":""},{"location":"android/design/design_enyuan/#_1","title":"\u7b80\u4ecb","text":"<p>\u4eab\u5143\u6a21\u5f0f\u662f\u5bf9\u8c61\u6c60\u7684\u4e00\u79cd\u5b9e\u73b0\uff0c\u4eab\u5143\u6a21\u5f0f\u7528\u6765\u5c3d\u53ef\u80fd\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\u91cf\uff0c\u5b83\u9002\u5408\u7528\u4e8e\u53ef\u80fd\u5b58\u5728\u5927\u91cf\u91cd\u590d\u5bf9\u8c61\u7684\u573a\u666f\uff0c\u6765\u7f13\u5b58\u53ef\u5171\u4eab\u7684\u5bf9\u8c61\uff0c\u8fbe\u5230\u5bf9\u8c61\u5171\u4eab\u3001\u907f\u514d\u521b\u5efa\u8fc7\u591a\u5bf9\u8c61\u7684\u6548\u679c\uff0c\u8fd9\u6837\u4e00\u6765\u5c31\u53ef\u4ee5\u63d0\u5347\u6027\u80fd\u3001\u907f\u514d\u5185\u5b58\u79fb\u9664\u7b49\u3002</p>"},{"location":"android/design/design_enyuan/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u7cfb\u7edf\u4e2d\u5b58\u5728\u5927\u91cf\u7684\u76f8\u4f3c\u5bf9\u8c61\u3002</li> <li>\u7ec6\u7c92\u5ea6\u7684\u5bf9\u8c61\u90fd\u5177\u5907\u8f83\u63a5\u8fd1\u7684\u5916\u90e8\u72b6\u6001\uff0c\u800c\u4e14\u5185\u90e8\u72b6\u6001\u4e0e\u73af\u5883\u65e0\u5173\uff0c\u4e5f\u5c31\u662f\u8bf4\u5bf9\u8c61\u6ca1\u6709\u7279\u5b9a\u8eab\u4efd\u3002</li> <li>\u9700\u8981\u7f13\u51b2\u6c60\u7684\u573a\u666f\u3002</li> </ol>"},{"location":"android/design/design_enyuan/#android","title":"Android\u4e2d\u7684\u5e94\u7528","text":""},{"location":"android/design/design_enyuan/#handler","title":"Handler\u4e2d","text":"<p><pre><code>// Handler\npublic final Message obtainMessage(){\nreturn Message.obtain(this);\n}\n// Message\npublic static Message obtain(Handler h) {\nMessage m = obtain();\nm.target = h;\nreturn m;\n}\npublic static Message obtain() {\nsynchronized (sPoolSync) {\nif (sPool != null) { // \u4ece\u7f13\u5b58\u4e2d\u53d6Message\nMessage m = sPool;\nsPool = m.next;\nm.next = null;\nm.flags = 0; // clear in-use flag\nsPoolSize--;\nreturn m;\n}\n}\nreturn new Message();\n}\n// Looper\u4e2dloopOnce\u65b9\u6cd5\u6700\u540e\u4f1a\u56de\u6536message\nmsg.recycleUnchecked(); void recycleUnchecked() {\nflags = FLAG_IN_USE;\nwhat = 0;\narg1 = 0;\narg2 = 0;\nobj = null;\nreplyTo = null;\nsendingUid = UID_NONE;\nworkSourceUid = UID_NONE;\nwhen = 0;\ntarget = null;\ncallback = null;\ndata = null;\n\nsynchronized (sPoolSync) { // \u5c06Message\u5185\u5bb9\u6e05\u7a7a\u540e\u5b58\u653e\u5230\u7f13\u5b58\u4e2d\u4ee5\u4fbf\u4e8e\u590d\u7528\nif (sPoolSize &lt; MAX_POOL_SIZE) { // \u4e0a\u965050\u4e2a\nnext = sPool;\nsPool = this;\nsPoolSize++;\n}\n}\n}\n</code></pre> \u8bbe\u8ba1\u4f18\u52bf\uff1a</p> <ol> <li>\u5c4f\u5e55\u5237\u65b0\u4e5f\u9700\u8981Handler\u5904\u7406\u6d88\u606f(60hz,120hz\u7b49\u6bcf16ms\u62168ms\u6d88\u606f\u5904\u7406\u4e00\u6b21\u6bd4\u8f83\u9891\u7e41)\uff0c\u5982\u679c\u4e0d\u8fdb\u884c\u7f13\u5b58\u590d\u7528\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5185\u5b58\u6296\u52a8</li> <li>\u6709\u5229\u4e8e\u5c11\u5185\u5b58\u788e\u7247\uff0c\u5982\u679c\u76f4\u63a5new\u7684\u65b9\u5f0f\u4f1a\u4ea7\u751f\u5185\u5b58\u788e\u7247\uff0c\u5f53\u521b\u5efa\u6bd4\u8f83\u5927\u53c8\u9700\u8981\u8fde\u7eed\u5185\u5b58\u65f6\u53ef\u80fd\u5bfc\u81f4oom(\u5982\u521b\u5efabitmap)</li> </ol>"},{"location":"android/design/design_enyuan/#recyclerview","title":"RecyclerView\u4e2d","text":""},{"location":"android/design/design_observer/","title":"Design observer","text":""},{"location":"android/design/design_observer/#_1","title":"\u89c2\u5bdf\u8005\u6a21\u5f0f","text":""},{"location":"android/design/design_observer/#_2","title":"\u7b80\u4ecb","text":"<p>\u5b9a\u4e49\u5bf9\u8c61\u95f4\u4e00\u79cd\u4e00\u5bf9\u591a\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u5f53\u5bf9\u8c61\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u6240\u6709\u4f9d\u8d56\u4e8e\u5b83\u7684\u5bf9\u8c61\u90fd\u4f1a\u5f97\u5230\u901a\u77e5\u5e76\u88ab\u81ea\u52a8\u66f4\u65b0</p>"},{"location":"android/design/design_observer/#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u5173\u8054\u884c\u4e3a\u573a\u666f\uff0c\u884c\u4e3a\u53ef\u4ee5\u62c6\u5206\u4e0d\u662f\u7ec4\u5408\u5173\u7cfb</li> <li>\u4e8b\u4ef6\u591a\u7ea7\u89e6\u53d1\u573a\u666f</li> <li>\u8de8\u7cfb\u7edf\u7684\u6d88\u606f\u4ea4\u6362\u573a\u666f\uff0c\u5982\u6d88\u606f\u961f\u5217\u4e8b\u4ef6\u603b\u7ebf\u7684\u5904\u7406\u673a\u5236</li> </ol>"},{"location":"android/design/design_observer/#_4","title":"\u6848\u4f8b","text":"<pre><code>//\u88ab\u89c2\u5bdf\u8005\ninterface Observable {\nfun addObserver(observer: Observer)\nfun removeObserver(observer: Observer)\nfun notifyObservers()\nfun pushMsg(msg: String)\n}\nclass ObservableImpl : Observable {\nprivate val mObservers: ArrayList&lt;Observer&gt; = ArrayList()\nprivate var mMsg: String = \"\"\noverride fun addObserver(observer: Observer) {\nmObservers += observer\n}\noverride fun removeObserver(observer: Observer) {\nmObservers -= observer\n}\noverride fun notifyObservers() {\nmObservers.forEach {\nit.update(mMsg)\n}\n}\noverride fun pushMsg(msg: String) {\nmMsg = msg\nnotifyObservers()\n}\n}\n//\u89c2\u5bdf\u8005\ninterface Observer {\nfun update(msg: Any)\n}\nclass ObserverImpl(var name: String) : Observer {\noverride fun update(msg: Any) {\nprintln(\"${name}\u63a5\u6536\u5230\u901a\u77e5\uff1a$msg\")\n}\n}\nfun main() {\nval wechat = ObservableImpl()\nval user1 = ObserverImpl(\"\u7528\u62371\")\nval user2 = ObserverImpl(\"\u7528\u62372\")\nval user3 = ObserverImpl(\"\u7528\u62373\")\nwechat.addObserver(user1)\nwechat.addObserver(user2)\nwechat.addObserver(user3)\nwechat.pushMsg(\"\u5fae\u4fe1\u5347\u7ea78.5\u7248\u672c\")\nwechat.removeObserver(user2)\nwechat.pushMsg(\"\u5fae\u4fe1\u5347\u7ea78.6\u7248\u672c\")\n}\n</code></pre>"},{"location":"android/design/design_observer/#android","title":"Android\u4e2d\u7684\u5e94\u7528","text":"<ol> <li>View\u8bbe\u7f6e\u4e8b\u4ef6</li> <li>ListView\u3001RecyclerView\u4e2d\u7684Adapter\u6570\u636e\u5237\u65b0\u76d1\u542c</li> <li>Rxjava</li> </ol>"},{"location":"android/design/design_observer/#_5","title":"\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f","text":""},{"location":"android/design/design_observer/#_6","title":"\u7b80\u4ecb","text":"<p>\u5176\u5b9e\u5c31\u662f\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u884d\u751f\uff0c\u533a\u522b\u5982\u4e0b</p> <p></p>"},{"location":"android/design/design_observer/#_7","title":"\u6848\u4f8b","text":"<pre><code>//\u53d1\u5e03\u8005\nclass Publisher(var type: Any, var msg: Any) {\n\n}\n//\u8ba2\u9605\u8005\nclass Subscriber(var type: Any) {\nfun onEvent(msg: Any) {\nprintln(\"\u63a5\u6536\u6d88\u606f: $msg\")\n}\n}\n//\u8c03\u5ea6\u4e2d\u5fc3\nclass EventBus {\nprivate val mSubscribers: ArrayList&lt;Subscriber&gt; = ArrayList()\nfun register(subscriber: Subscriber) {\nmSubscribers += subscriber\n}\nfun unregister(subscriber: Subscriber) {\nmSubscribers -= subscriber\n}\nfun push(publisher: Publisher) {\nmSubscribers.forEach {\nif (it.type == publisher.type) {\nit.onEvent(publisher.msg)\n}\n}\n}\n}\nfun main() {\nval eventBus = EventBus()\neventBus.register(Subscriber(1))\neventBus.register(Subscriber(true))\nval subscriber = Subscriber(\"name\")\neventBus.register(subscriber)\neventBus.push(Publisher(1, \"\u5fae\u4fe1\u66f4\u65b0\u4e861.0\"))\neventBus.push(Publisher(true, \"\u5fae\u4fe1\u66f4\u65b0\u4e862.0\"))\neventBus.unregister(subscriber)\neventBus.push(Publisher(\"name\", \"\u5fae\u4fe1\u66f4\u65b0\u4e863.0\"))\n}\n</code></pre>"},{"location":"android/design/design_observer/#android_1","title":"Android\u4e2d\u7684\u5e94\u7528","text":"<ol> <li>BoradcastReceiver\u8c03\u5ea6\u4e2d\u5fc3\uff1aAMS</li> <li>EventBus\u8c03\u5ea6\u4e2d\u5fc3\uff1aEventBus\u5355\u4f8b</li> </ol>"},{"location":"android/design/design_single/","title":"Design single","text":""},{"location":"android/design/design_single/#_1","title":"\u61d2\u6c49\u5f0f(\u53cc\u91cd\u6821\u9a8c)","text":"<pre><code>public class Singleton {\nprivate static Singleton INSTANCE;\nprivate Singleton() {\n}\npublic static Singleton getInstance() {\nif (INSTANCE == null) {\nsynchronized (Singleton.class) {\nif (INSTANCE == null) {\nINSTANCE = new Singleton();\n}\n}\n}\nreturn INSTANCE;\n}\n}\n</code></pre>"},{"location":"android/design/design_single/#_2","title":"\u9759\u6001\u5185\u90e8\u7c7b\u5355\u4f8b","text":"<pre><code>class Singleton {\nprivate Singleton() {\n\n}\n\npublic static Singleton getInstance() {\nreturn Holder.singleton;\n}\nprivate static class Holder{\nprivate static Singleton singleton = new Singleton();\n}\n}\n</code></pre>"},{"location":"android/design/design_single/#kotlin","title":"kotlin\u7684\u5355\u4f8b","text":"<p>object\u5173\u952e\u5b57\u5355\u4f8b</p>"},{"location":"android/design/design_single/#_3","title":"\u61d2\u6c49\u5f0f(\u53cc\u91cd\u6821\u9a8c)","text":"<pre><code>class Singleton private constructor() {\ncompanion object {\nval instance by lazy(mode = LazyThreadSafetyMode.SYNCHRONIZED) {\nSingleton()\n}\n}\n}\n</code></pre>"},{"location":"android/design/design_single/#_4","title":"\u9759\u6001\u5185\u90e8\u7c7b\u5355\u4f8b","text":"<pre><code>class Singleton private constructor() {\ncompanion object {\nval instance = Holder.instance\n}\n\nprivate object Holder {\nval instance = Singleton()\n}\n}\n</code></pre>"},{"location":"android/design/design_strategy/","title":"Design strategy","text":""},{"location":"android/design/design_strategy/#_1","title":"\u7b80\u4ecb","text":"<p>\u5c06\u7b97\u6cd5\u6216\u8005\u7b56\u7565\u62bd\u8c61\u51fa\u6765\u63d0\u4f9b\u7edf\u4e00\u63a5\u53e3\uff0c\u5141\u8bb8\u5916\u90e8\u52a8\u6001\u66ff\u6362\u7b97\u6cd5\u6216\u7b56\u7565</p>"},{"location":"android/design/design_strategy/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u9488\u5bf9\u540c\u4e00\u7c7b\u95ee\u9898\u7684\u591a\u79cd\u5904\u7406\u65b9\u5f0f\uff0c\u4ec5\u5177\u4f53\u884c\u4e3a\u4e0d\u540c\u65f6</li> <li>\u9700\u8981\u5b89\u5168\u5c01\u88c5\u591a\u79cd\u540c\u4e00\u7c7b\u64cd\u4f5c\u65f6</li> <li>\u51fa\u73b0\u540c\u4e00\u62bd\u8c61\u7c7b\u6709\u591a\u4e2a\u5b50\u7c7b\uff0c\u4e14\u9700\u8981\u4f7f\u7528if else\u6216when\u6765\u9009\u62e9\u5177\u4f53\u5b50\u7c7b\u65f6 if else\u6216when(switch)\u4e0d\u9075\u5faa\u5f00\u95ed\u539f\u5219</li> </ol>"},{"location":"android/design/design_strategy/#_3","title":"\u6848\u4f8b","text":"<p><pre><code>class PriceCalculator {// \u8ba1\u7b97\u7c7b\nprivate fun busPrice(){}\nprivate fun subWayPrice(){}\nfun calPrice(traffic: Traffic) {\nif (traffic == Traffic.BUS) {busPrice()}\nelse if (traffic == Traffic.SUBWAY){subWayPrice()}\n}\n}\nenum class Traffic{// \u51fa\u884c\u7c7b\u578b\nBUS,SUBWAY\n}\n\nfun main() {\nPriceCalculator().calPrice(Traffic.BUS)\nPriceCalculator().calPrice(Traffic.SUBWAY)\n}\n</code></pre> \u95ee\u9898\u548c\u7f3a\u9677</p> <ol> <li>PriceCalculator\u7c7b\u8fdd\u53cd\u5355\u4e00\u804c\u8d23\uff0c\u9700\u8981\u8ba1\u7b97\u4e0d\u540c\u7c7b\u578b\u7684\u51fa\u884c\u4ef7\u683c</li> <li>\u8fdd\u53cd\u5f00\u95ed\u539f\u5219\u51fa\u73b0if else\u81c3\u80bf\uff0c\u62d3\u5c55\u5dee\uff0c\u6dfb\u52a0\u4e00\u79cd\u51fa\u73b0\u7c7b\u578b\u9700\u8981\u6dfb\u52a0else\u5206\u652f\u4ee5\u53ca\u4ef7\u683c\u8ba1\u7b97\u65b9\u5f0f</li> </ol> <p>\u7b56\u7565\u6a21\u5f0f\u89e3\u51b3 </p> <p>\u62bd\u8c61\u7edf\u4e00\u63a5\u53e3\u548c\u5177\u4f53\u5b9e\u73b0 <pre><code>interface CalculateStrategy {\nfun calPrice()\n}\nclass BusStrategy : CalculateStrategy {\noverride fun calPrice() {}\n}\n\nclass SubWayStrategy : CalculateStrategy {\noverride fun calPrice() {}\n}\n</code></pre> \u8c03\u7528 <pre><code>class PriceCalculator(var strategy: CalculateStrategy) {\nfun calPrice() {\nstrategy.calPrice()\n}\n}\nfun main() {\nPriceCalculator(BusStrategy()).calPrice()\nPriceCalculator(SubWayStrategy()).calPrice()\n}\n</code></pre></p>"},{"location":"android/design/design_strategy/#android","title":"Android\u6e90\u7801\u4e2d\u7684\u7b56\u7565\u6a21\u5f0f","text":"<p>\u52a8\u753b\u63d2\u503c\u5668</p>"},{"location":"android/design/design_strategy/#_4","title":"\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9\uff1a</p> <ol> <li>\u7ed3\u6784\u6e05\u6670\uff0c\u4f7f\u7528\u7b80\u5355\u76f4\u89c2</li> <li>\u8026\u5408\u5ea6\u8f83\u4f4e\uff0c\u6269\u5c55\u65b9\u4fbf</li> <li> <p>\u64cd\u4f5c\u5c01\u88c5\u6bd4\u8f83\u5f7b\u5e95\uff0c\u6570\u636e\u66f4\u5b89\u5168 \u7f3a\u70b9\uff1a</p> </li> <li> <p>\u968f\u7740\u7b56\u7565\u589e\u52a0\uff0c\u5b50\u7c7b\u53d8\u5f97\u7e41\u591a</p> </li> </ol>"},{"location":"android/fws/fw_aosp_error/","title":"Fw aosp error","text":""},{"location":"android/fws/fw_aosp_error/#android","title":"Android\u6e90\u7801\u4e0b\u8f7d\u5e38\u89c1\u95ee\u9898","text":""},{"location":"android/fws/fw_aosp_error/#_1","title":"\u4f7f\u7528\u955c\u50cf\u4e0b\u8f7d\u62a5\u9519","text":"<p>\u62a5\u9519\uff1a Repo command failed: RepoUnhandledExceptionError     GitCommandError: 'reset --keep v2.44^0' on repo failed stderr: error: Entry 'project.py' not uptodate. Cannot merge. fatal: \u4e0d\u80fd\u91cd\u7f6e\u7d22\u5f15\u6587\u4ef6\u81f3\u7248\u672c 'v2.44^0'\u3002</p> <p>\u89e3\u51b3\uff1a <pre><code>cd .repo/repo/\ngit pull\n</code></pre></p> <p>\u62a5\u9519\uff1a error.GitError: manifests rev-list ('^1013d985f70641b2cc05943f57fab5824d9e2ff3', 'HEAD', '--'): fatal: bad revision 'HEAD'</p> <p>\u89e3\u51b3\uff1a <pre><code>cd .repo/manifests\ngit reset --hard 1013d985f70641b2cc05943f57fab5824d9e2ff3\ngit pull\n</code></pre> \u62a5\u9519\uff1agit config --global --add safe.directory /xxx/xxx</p> <p>\u89e3\u51b3\uff1a <pre><code>git config --global --add safe.directory \"*\"\n</code></pre> \u6587\u4ef6\u6743\u9650\u88ab\u4fee\u6539</p> <p>\u89e3\u51b3\uff1a <pre><code>repo forall -c git config --add core.filemode false\n</code></pre></p>"},{"location":"android/fws/fw_aosp_error/#adbfastboot","title":"adb\u548cfastboot\u62a5\u9519","text":"<p>no permissions (missing udev rules? user is in the plugdev group)</p> <p>\u89e3\u51b3\uff1a <pre><code>lsusb\n</code></pre> \u8f93\u51fa\uff1aBus 001 Device 009: ID 18d1:4ee7 Google Inc. Nexus/Pixel Device (charging + debug) <pre><code>cd /etc/udev/rules.d/\nsudo vi 51-android.rules\n\u6dfb\u52a0\u5185\u5bb9\uff1a\nSUBSYSTEM==\"usb\", ATTRS{idVendor}==\"18d1\", ATTRS{idProduct}==\"4ee7\",MODE=\"0666\"\n</code></pre> \u8bbe\u7f6e\u6743\u9650 <pre><code>sudo chmod a+x 51-android.rules\n</code></pre> fastboot\u76f8\u540c\u89e3\u51b3</p> <p>Bus 001 Device 014: ID 18d1:4ee0 Google Inc. Nexus/Pixel Device (fastboot) SUBSYSTEM==\"usb\", ATTRS{idVendor}\"18d1\", ATTRS{idProduct}\"4ee0\",MODE=\"0666\"</p>"},{"location":"android/fws/fws_ams/","title":"AMS/ATMS","text":"<p>\u5728\u542f\u52a8SystemServer\u65f6\u4f1a\u542f\u52a8AMS\u548cATMS\u670d\u52a1 <pre><code>startBootstrapServices(t);\n</code></pre> \u901a\u8fc7\u8f85\u52a9\u7c7bSystemServiceManager\u6765\u542f\u52a8 <pre><code>ActivityTaskManagerService atm = mSystemServiceManager.startService(\nActivityTaskManagerService.Lifecycle.class).getService();\nmActivityManagerService = ActivityManagerService.Lifecycle.startService(\nmSystemServiceManager, atm);\nmActivityManagerService.setSystemServiceManager(mSystemServiceManager);\nmActivityManagerService.setInstaller(installer);\nmWindowManagerGlobalLock = atm.getGlobalLock();\n</code></pre> \u5176\u4e2dams\u548catms\u542f\u52a8\u65b9\u5f0f\u662f\u76f8\u540c\u7684\uff0cams\u4fdd\u5b58\u4e86atms\u4e3a\u6210\u5458\u53d8\u91cf</p> <p><pre><code>frameworks/base/services/core/java/com/android/server/SystemServiceManager.java\n\nConstructor&lt;T&gt; constructor = serviceClass.getConstructor(Context.class);\nservice = constructor.newInstance(mContext);\nstartService(service);\n</code></pre> \u901a\u8fc7\u53cd\u5c04\u7684\u65b9\u5f0f\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u521b\u5efaLifecycle\u5b9e\u4f8b <pre><code>mServices.add(service);\nservice.onStart();\n</code></pre> \u5c06\u521b\u5efa\u7684\u5b9e\u4f8b\u5bf9\u8c61\u4fdd\u5b58\u5230ArrayList\u4e2d\uff0cLifecycle\u7ee7\u627f\u4e8eSystemService\uff0c\u6784\u9020\u65b9\u6cd5\u4e2d\u521b\u5efaActivityTaskManagerService\u5b9e\u4f8b\uff0c\u63a5\u7740\u901a\u8fc7getService\u83b7\u5f97\u5b9e\u4f8b\u5bf9\u8c61 <pre><code>frameworks/base/services/core/java/com/android/server/wm/ActivityTaskManagerService.java\n\npublic static final class Lifecycle extends SystemService {\nprivate final ActivityTaskManagerService mService;\n\npublic Lifecycle(Context context) {\nsuper(context);\nmService = new ActivityTaskManagerService(context);\n}\n\n@Override\npublic void onStart() {\npublishBinderService(Context.ACTIVITY_TASK_SERVICE, mService);\nmService.start();\n}\n\npublic ActivityTaskManagerService getService() {\nreturn mService;\n}\n}\n</code></pre> new ActivityTaskManagerService\u65f6\u4f1a\u521b\u5efamInternal\u7684\u5b9e\u4f8b <pre><code>mInternal = new LocalService();\n</code></pre> onStart\u65b9\u6cd5\u4e3b\u8981\u7528\u4e8e\u4fdd\u5b58Binder\u5bf9\u8c61\u5230ServicesManager\u4e2d\uff0cmService.start()\u4e3b\u8981\u662f\u628amInternal\u4fdd\u5b58\u8d77\u6765\u4f7f\u7528ArrayMap\u6570\u636e\u7ed3\u6784 <pre><code>LocalServices.addService(ActivityTaskManagerInternal.class, mInternal);\n</code></pre>"},{"location":"android/fws/fws_android_start/","title":"Android\u542f\u52a8\u6d41\u7a0b","text":""},{"location":"android/fws/fws_android_start/#android","title":"Android\u542f\u52a8\u6d41\u7a0b","text":""},{"location":"android/fws/fws_android_start/#bootloader","title":"BootLoader\u5f15\u5bfc\u9636\u6bb5","text":"<p>\u521d\u59cb\u5316\u57fa\u672c\u7684\u786c\u4ef6\u8bbe\u5907(CPU\u3001\u5185\u5b58\u3001Flash\u7b49)\u5e76\u5efa\u7acb\u5185\u5b58\u6620\u5c04\uff0c\u7ec4\u5408\u952e\u8fdb\u5165Fastboot\u6a21\u5f0f\u548cRecovery\u6a21\u5f0f</p>"},{"location":"android/fws/fws_android_start/#linux","title":"\u88c5\u8f7d\u548c\u542f\u52a8Linux\u5185\u6838\u9636\u6bb5","text":"<p>\u7531BootLoader\u88c5\u8f7dboot.img(\u5305\u542blinux\u5185\u6838\u548c\u6839\u6587\u4ef6\u7cfb\u7edf)\u8fdb\u5185\u5b58\u4e2d\uff0clinux\u5185\u6838\u6267\u884c\u6574\u4e2a\u7cfb\u7edf\u7684\u521d\u59cb\u5316\uff0c\u88c5\u8f7d\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u542f\u52a8init\u8fdb\u7a0b\uff0c\u88c5\u8f7d\u5b8c\u6bd5\u540eBootLoader\u5728\u5185\u5b58\u4e2d\u6e05\u9664</p>"},{"location":"android/fws/fws_android_start/#init","title":"\u542f\u52a8init\u8fdb\u7a0b","text":"<p>\u662f\u7cfb\u7edf\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u542f\u52a8\u8fc7\u7a0b\u4e2d\u4f1a\u89e3\u6790init.rc(system/core/rootdir/init.rc)\u811a\u672c\u6587\u4ef6\uff0c\u6839\u636e\u5185\u5bb9</p> <ul> <li>\u88c5\u8f7dAndroid\u6587\u4ef6\u7cfb\u7edf</li> <li>\u521b\u5efa\u7cfb\u7edf\u76ee\u5f55</li> <li>\u521d\u59cb\u5316\u5c5e\u6027\u7cfb\u7edf</li> <li>\u542f\u52a8Android\u7684\u91cd\u8981\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5982USB\u3001adb\u3001vold\u3001rild\u7b49\u5b88\u62a4\u8fdb\u7a0b</li> <li>init\u4f5c\u4e3a\u5b88\u62a4\u8fdb\u7a0b\uff0c\u7528\u4e8e\u6267\u884c\u5c5e\u6027\u4fee\u6539\u8bf7\u6c42\uff0c\u91cd\u542f\u5d29\u6e83\u8fdb\u7a0b\u7b49\u64cd\u4f5c</li> </ul>"},{"location":"android/fws/fws_android_start/#servicemanager","title":"ServiceManager\u542f\u52a8","text":"<p>\u7531init\u8fdb\u7a0b\u542f\u52a8\uff0c\u7ba1\u7406Binder\u670d\u52a1(Binder\u670d\u52a1\u7684\u6ce8\u518c\u548c\u67e5\u627e)\uff0c\u4f5c\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u5b58\u5728\u4e0e\u540e\u53f0\uff0c\u5f53SystemServer\u542f\u52a8AMS\u3001WMS\u3001PMS\u7b49\u670d\u52a1\u65f6\uff0c\u90fd\u662f\u901a\u8fc7Binder\u6ce8\u518c\u5230ServiceManager\u4e2d\uff0c\u7edf\u4e00\u4fdd\u5b58\u7ba1\u7406</p>"},{"location":"android/fws/fws_android_start/#zygote","title":"\u542f\u52a8Zygote\u8fdb\u7a0b","text":"<p>\u7531init\u8fdb\u7a0b\u542f\u52a8\uff0c\u8d1f\u8d23fork\u51fa\u5e94\u7528\u8fdb\u7a0b\uff0c\u521d\u59cb\u5316\u65f6\u4f1a\u521b\u5efaAndroid\u865a\u62df\u673a\u548c\u9884\u88c5\u8f7d\u7cfb\u7edf\u7684\u8d44\u6e90\u6587\u4ef6\u548cjava\u7c7b\uff0c\u6240\u6709fork\u51fa\u7684\u7528\u6237\u8fdb\u7a0b\u90fd\u5171\u4eab\uff0c\u521d\u59cb\u5316\u7ed3\u675f\u540e\u8f6c\u6210\u5b88\u62a4\u8fdb\u7a0b\uff0c\u54cd\u5e94\u542f\u52a8\u5e94\u7528\u8bf7\u6c42</p> <ul> <li>\u521b\u5efaDVM/ART\u865a\u62df\u673a</li> <li>\u6ce8\u518cAndroid SDK\u6240\u9700\u7684JNI\u65b9\u6cd5</li> <li>\u6267\u884cZygoteInit\u7684main\u51fd\u6570</li> </ul> <p>init.zygote64.rc <pre><code>service zygote /system/bin/app_process64 -Xzygote /system/bin --zygote --start-system-server\n    class main\n</code></pre> \u6267\u884c\u4ee3\u7801\uff1a frameworks/base/cmds/app_process/app_main.cpp <pre><code>runtime.start(\"com.android.internal.os.ZygoteInit\", args, zygote);\n</code></pre> \u6267\u884cframeworks/base/core/jni/AndroidRuntime.cpp\u4e2d\u7684start\u51fd\u6570 <pre><code>// \u542f\u52a8\u865a\u62df\u673a\nif (startVm(&amp;mJavaVM, &amp;env, zygote, primary_zygote) != 0) {\nreturn;\n}\nonVmCreated(env);\n// \u6ce8\u518cjni\nif (startReg(env) &lt; 0) {\nALOGE(\"Unable to register all android natives\\n\");\nreturn;\n}\nchar* slashClassName = toSlashClassName(className != NULL ? className : \"\");\njclass startClass = env-&gt;FindClass(slashClassName);\nif (startClass == NULL) {\nALOGE(\"JavaVM unable to locate class '%s'\\n\", slashClassName);\n/* keep going */\n} else {\n// \u627e\u5230main\u65b9\u6cd5\njmethodID startMeth = env-&gt;GetStaticMethodID(startClass, \"main\",\n\"([Ljava/lang/String;)V\");\nif (startMeth == NULL) {\nALOGE(\"JavaVM unable to find main() in '%s'\\n\", className);\n/* keep going */\n} else {\n// \u542f\u52a8java\u5c42\u65b9\u6cd5\nenv-&gt;CallStaticVoidMethod(startClass, startMeth, strArray);\n}\n}\n</code></pre></p> <p>\u6267\u884c\u4ee3\u7801\uff1aframeworks/base/core/java/com/android/internal/os/ZygoteInit.java\u4e2d\u7684main\u65b9\u6cd5</p>"},{"location":"android/fws/fws_android_start/#systemserver","title":"\u542f\u52a8SystemServer","text":"<p>\u7531zygote\u8fdb\u7a0bfork\u51fa\u7684\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8d1f\u8d23Android\u4e2d\u5927\u90e8\u5206Binder\u670d\u52a1\uff0c\u5148\u542f\u52a8SensorManager\uff0c\u518d\u542f\u52a8AMS\u3001PMS\u3001WMS\u7b49\u6240\u6709java\u670d\u52a1</p>"},{"location":"android/fws/fws_android_start/#mediaserver","title":"\u542f\u52a8MediaServer","text":"<p>\u7531init\u8fdb\u7a0b\u542f\u52a8\uff0c\u5305\u542b\u5a92\u4f53\u76f8\u5173\u7684Binder\u670d\u52a1\uff0c\u5305\u542bCameraService\u3001AudioFligerService\u3001MediaPlayerService\u3001AutioPolicyService</p>"},{"location":"android/fws/fws_android_start/#launcher","title":"\u542f\u52a8Launcher","text":"<p>SystemServer\u52a0\u8f7d\u5b8c\u6240\u6709java\u670d\u52a1\u540e\uff0c\u8c03\u7528AMS\u7684SystemReady\u65b9\u6cd5\uff0cIntent(android.intent.category.HOME)</p>"},{"location":"android/fws/fws_android_start/#fork","title":"fork\u673a\u5236","text":"<ol> <li>\u4e24\u4e2a\u8fdb\u7a0b\u4ee3\u7801\u4e00\u81f4\uff0c\u4ee3\u7801\u6267\u884c\u5230\u7684\u4f4d\u7f6e\u4e5f\u4e00\u81f4</li> <li>\u8fdb\u7a0bPID\u4e0d\u4e00\u6837</li> <li>\u7236\u8fdb\u7a0b\u8fd4\u56de\u7684\u662f\u5b50\u8fdb\u7a0b\u7684PID\u65b9\u4fbf\u8ddf\u8e2a\u5b50\u8fdb\u7a0b\u72b6\u6001\uff0c\u5b50\u8fdb\u7a0b\u8fd4\u56de\u7684\u662f0</li> </ol>"},{"location":"android/fws/fws_android_start/#system_serverzygote-init","title":"system_server\u4e3a\u4ec0\u4e48\u8981\u5728Zygote\u4e2d\u542f\u52a8\uff0c\u800c\u4e0d\u662f\u7531 init \u76f4\u63a5\u542f\u52a8","text":"<p>system_server\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Zygote\u4e2d\u7684JNI \u51fd\u6570.\u5171\u4eab\u5e93\u3001\u5e38\u7528\u7684\u7c7b\u3001\u4ee5\u53ca\u4e3b\u9898\u8d44\u6e90</p>"},{"location":"android/fws/fws_android_start/#zygotesystem_server","title":"\u4e3a\u4ec0\u4e48\u8981\u4e13\u95e8\u4f7f\u7528Zygote\u8fdb\u7a0b\u53bb\u5b75\u5316\u5e94\u7528\u8fdb\u7a0b\uff0c\u800c\u4e0d\u662f\u8ba9system_server\u53bb\u5b75\u5316","text":"<ol> <li>system_server\u76f8\u6bd4 Zygote \u591a\u8fd0\u884c\u4e86 AMS\u3001WMS \u7b49\u670d\u52a1\uff0c\u8fd9\u4e9b\u5bf9\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6765\u8bf4\u662f\u4e0d\u9700\u8981\u7684</li> <li>\u8fdb\u7a0b\u7684fork()\u5bf9\u591a\u7ebf\u7a0b\u4e0d\u53cb\u597d\uff0c\u4ec5\u4f1a\u5c06\u53d1\u8d77\u8c03\u7528\u7684\u7ebf\u7a0b\u62f7\u8d1d\u5230\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6b7b\u9501\uff0c\u800csystem_server\u4e2d\u80af\u5b9a\u662f\u6709\u5f88\u591a\u7ebf\u7a0b\u7684</li> </ol> <p>\u6b7b\u9501\u7684\u539f\u56e0\uff1afork\u51fa\u7684\u5b50\u8fdb\u7a0b\u5e76\u6ca1\u6709\u7236\u8fdb\u7a0b\u7684\u6240\u6709\u7ebf\u7a0b\uff0c\u9501\u662f\u53ef\u4ee5\u88ab\u590d\u5236\u7684\uff0c\u9501\u9700\u8981\u6240\u6709\u8005(\u7ebf\u7a0b)\u624d\u80fd\u89e3\u9501</p>"},{"location":"android/fws/fws_android_start/#zygote-binder-ipc","title":"Zygote \u4e3a\u4ec0\u4e48\u4e0d\u91c7\u7528 Binder \u673a\u5236\u8fdb\u884c IPC \u901a\u4fe1","text":"<p>Binder\u662f\u591a\u7ebf\u7a0b\u7684\uff0cSocket\u662f\u5355\u7ebf\u7a0b\u7684</p> <p>unix\u7a0b\u5e8f\u8bbe\u8ba1\u51c6\u5219\uff1a\u591a\u7ebf\u7a0b\u4e2d\u4e0d\u5141\u8bb8\u4f7f\u7528fork</p>"},{"location":"android/fws/fws_android_start/#_1","title":"\u4e00\u952e\u9000\u51fa\u5e94\u7528","text":"<pre><code>val manager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager\nmanager.appTasks.forEach {\nit.finishAndRemoveTask()\n}\n// vm\u5c42\u6b21\uff0c\u8fdb\u7a0b\u9000\u51fa\nandroid.os.Process.killProcess(android.os.Process.myPid())\nexitProcess(0)\n</code></pre>"},{"location":"android/fws/fws_anim/","title":"\u7cfb\u7edf\u52a8\u753b","text":""},{"location":"android/fws/fws_anim/#_1","title":"\u6dfb\u52a0\u7cfb\u7edf\u5706\u89d2\u52a8\u753b","text":"<p>\u4e00\u822c\u7cfb\u7edf\u52a8\u753bapply\u7684\u5730\u65b9(\u8f6c\u573a\u52a8\u753b\u9664\u5916)\uff1a</p> <p>frameworks/base/services/core/java/com/android/server/wm/WindowAnimationSpec.java <pre><code>@Override\npublic void apply(Transaction t, SurfaceControl leash, long currentPlayTime) {\n//...\nif (mAnimation.hasRoundedCorners()) {\nt.setCornerRadius(leash, tmp.transformation.getRadius());\n}\n} </code></pre></p>"},{"location":"android/fws/fws_anim/#_2","title":"\u5706\u89d2\u52a8\u753b\u7c7b","text":"<p>RoundCornerAnimation</p> <p>frameworks/base/core/java/android/view/animation/Transformation.java <pre><code>private float mRadius; public void clear() {\n//...\nmRadius = 0.0f;\n}\n\npublic void set(Transformation t) {\n//...\nmRadius = t.getRadius();\n//...\n}\n\npublic void compose(Transformation t) {\n//...\nmRadius += t.getRadius();\n//...\n}  public void postCompose(Transformation t) {\n//...\nmRadius += t.getRadius();\n//...\n}  /**\n * Sets the current Transform's radius\n * @hide\n */\npublic void setRadius(float radius) {\nmRadius = radius;\n}\n\n/**\n * Returns the current Transform's radius\n * @hide\n */\npublic float getRadius() {\nreturn mRadius;\n}\n</code></pre></p>"},{"location":"android/fws/fws_anim/#protolog","title":"\u5f00\u542fProtoLog\u65e5\u5fd7","text":"<p>wm logging enable-text XXX</p>"},{"location":"android/fws/fws_aosp/","title":"\u73af\u5883\u642d\u5efa","text":""},{"location":"android/fws/fws_aosp/#1ubuntu2204","title":"1.\u5b89\u88c5ubuntu\u7cfb\u7edf\uff0822.04\uff09","text":"<p>\u78c1\u76d8\u5927\u5c0f\u8d8a\u5927\u8d8a\u597d\uff0c\u81f3\u5c11500G</p> \u4f18\u7f3a\u70b9  \u65b9\u5f0f VMWare\u65b9\u5f0f WSL2\u65b9\u5f0f Windows11\u5b89\u88c5Ubuntu \u4f18\u70b9 \u6709\u56fe\u5f62\u5316\u754c\u9762\u53ef\u4ee5\u76f4\u63a5\u542f\u52a8\u6a21\u62df\u5668(\u9700\u5173\u95edhyper-v) \u7f16\u8bd1\u901f\u5ea6\u5feb\uff0c\u5360\u7528\u4f53\u79ef\u5c0f\uff0c\u65b9\u4fbf\u548cwindows\u4e4b\u95f4\u64cd\u4f5c \u7f16\u8bd1\u901f\u5ea6\u5feb\uff0c\u72ec\u7acb\u7cfb\u7edf\uff0c\u53ef\u4f7f\u7528\u6a21\u62df\u5668\uff0c\u6e90\u7801\u5728window\u4e0b\u4e5f\u53ef\u8bbf\u95ee \u7f3a\u70b9 \u4e0d\u6d41\u7545\uff0c\u7f16\u8bd1\u901f\u5ea6\u6162\uff0c\u5360\u7528\u4f53\u79ef\u5927\uff0c\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528Android\u5b50\u7cfb\u7edf \u65e0\u56fe\u5f62\u5316\u754c\u9762\uff0c\u7f51\u7edc\u72ec\u7acb\u4e0d\u65b9\u4fbf\u4f7f\u7528vpn\uff0c\u65e0\u6cd5\u4f7f\u7528\u6a21\u62df\u5668 \u7cfb\u7edf\u5360\u7528\u7a7a\u95f4\uff0c\u548cwindow\u4ea4\u4e92\u4e0d\u4fbf"},{"location":"android/fws/fws_aosp/#2android","title":"2.\u4e0b\u8f7dAndroid\u6e90\u7801\u955c\u50cf\u5305(\u53ef\u8df3\u8fc7)","text":"<p>\u78c1\u76d8\u7a7a\u95f4\u5c0f\u53ef\u4f7f\u7528\u4f20\u7edf\u65b9\u5f0f\u4e0b\u8f7d\u6e90\u7801</p> <p>\u5728ubuntu\u7cfb\u7edf\u4e2d\u6253\u5f00\u7ec8\u7aef\uff0c\u6267\u884c\u547d\u4ee4\uff1awget -c \u5730\u5740\u5982\u4e0b</p> <p>https://mirrors.ustc.edu.cn/aosp-monthly/aosp-latest.tar \u6216\u8005 https://mirrors.tuna.tsinghua.edu.cn/aosp-monthly/aosp-latest.tar</p> <p>\u6587\u4ef6\u5927\u698280GB</p> <p>\u6821\u9a8c\uff1amd5sum aosp-latest.tar (\u8f83\u6162)</p> <p>\u89e3\u538b\uff1atar xvf aosp-latest.tar (\u8f83\u6162)</p> <p>\u89e3\u538b\u540e\u5f97\u5230\u76ee\u5f55aosp</p> <p>\u6ce8\uff1a\u62a5\u9519\u5c1d\u8bd5\u4f7f\u7528 <pre><code>wget -U NoSuchBrowser/1.0 \u4e0b\u8f7d\u5730\u5740\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#3gitrepo","title":"3.\u5b89\u88c5git\u548crepo","text":"<p>\u5b89\u88c5git <pre><code>sudo apt install git\ngit config --global user.email 1875287386@qq.com\ngit config --global user.name \"yuli\"\n</code></pre> git\u914d\u7f6egit\u4e0egithub</p> <p>\u5b89\u88c5repo <pre><code>echo \"PATH=~/bin:\\$PATH\" &gt;&gt; ~/.bashrc\nsource ~/.bashrc\nsudo apt install curl\nmkdir ~/bin\ncurl -sSL 'https://gerrit-googlesource.proxy.ustclug.org/git-repo/+/master/repo?format=TEXT' |base64 -d &gt; ~/bin/repo\nchmod +x ~/bin/repo\nexport REPO_URL='https://mirrors.tuna.tsinghua.edu.cn/git/git-repo'\n</code></pre> \u5bf9\u4e8ewsl2\u53ef\u80fd\u65e0\u6cd5\u4e0b\u8f7drepo\uff0c\u4f7f\u7528\u6d4f\u89c8\u5668\u4e0b\u8f7d</p> <p>python\u5feb\u6377\u952e\u521b\u5efa <pre><code>sudo ln -s /usr/bin/python3.10 /usr/bin/python\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#4android","title":"4.\u540c\u6b65Android\u6e90\u7801","text":"<p>\u67e5\u770bAndroid\u7cfb\u7edf\u6e90\u7801\u7684\u7f51\u5740</p> <p>AOSP\u6700\u65b0\u5728\u7ebf\u6e90\u7801(\u9700vpn) https://cs.android.com/android/platform/superproject/main</p> <p>9.0\u4e4b\u524d\uff1ahttp://androidxref.com</p> <p>5.0-14.0+: http://aospxref.com</p> <p>\u8fdb\u5165\u76ee\u5f55aosp\u6267\u884c <pre><code>repo init -u git://mirrors.ustc.edu.cn/aosp/platform/manifest -b android-13.0.0_r43\n</code></pre> \u5176\u4e2d-b\u67e5\u770b\u5730\u5740\uff1a</p> <p>https://source.android.com/setup/start/build-numbers?hl=zh_cn(\u6302vpn)</p> <p>https://source.android.google.cn/docs/setup/reference/build-numbers?hl=zh-cn</p> <p>Pixel6: TQ2A.230505.002\u5bf9\u5e94\u5206\u652fandroid-13.0.0_r43</p>"},{"location":"android/fws/fws_aosp/#_1","title":"\u6dfb\u52a0\u4ea4\u6362\u5185\u5b58","text":"<p>\u5982\u679c\u5df2\u7ecf\u5b58\u5728swapfile\uff0c\u5148\u5173\u95ed <pre><code>sudo swapoff /swapfile\n</code></pre> \u5728\u5220\u9664 <pre><code>sudo rm -rf /swapfile\n</code></pre> \u6700\u540e\u914d\u7f6e <pre><code>sudo dd if=/dev/zero of=/swapfile bs=1G count=20\nsudo mkswap /swapfile\nsudo swapon /swapfile\n</code></pre> \u6dfb\u52a0\u5f00\u542f\u81ea\u542f\uff1a/etc/fstab <pre><code>/swapfile                                 none      swap    sw          0       0\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#_2","title":"\u4f7f\u7528\u4f20\u7edf\u540c\u6b65\u4ee3\u7801","text":"<p>\u8282\u7701\u7a7a\u95f4\uff0c\u7f16\u8f91.repo/manifests.git/config</p> <p>\u5728[remote \"origin\"]\u8282\u70b9\u4e0b\u6dfb\u52a0 <pre><code>[remote \"origin\"]\n    //..\n    depth = 1\n    no-tags = true\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#_3","title":"\u540c\u6b65\u4ee3\u7801","text":"<p>\u8f83\u6162 <pre><code>repo sync -c -j20\n</code></pre> \u62a5\u9519\u95ee\u9898\u89c1</p>"},{"location":"android/fws/fws_aosp/#_4","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<p>\u5b89\u88c5jdk <pre><code>sudo apt install openjdk-11-jre-headless\n</code></pre> \u5176\u4ed6\u4f9d\u8d56 <pre><code>sudo apt-get install git-core gnupg flex bison gperf build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z-dev libgl1-mesa-dev libxml2-utils xsltproc unzip\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#_5","title":"\u63d0\u5347\u7f16\u8bd1","text":"<p>\u4ea4\u6362\u5185\u5b58\u63a7\u5236\uff0c\u91cd\u542f\u751f\u6548 <pre><code>sudo vi /etc/sysctl.conf\nvm.swappiness=70\n</code></pre> swappiness\u503c\u4e3a0\u8868\u793a\u4f18\u5148\u4f7f\u7528\u7269\u7406\u5185\u5b58\uff0c\u503c\u4e3a100\u5219\u4f18\u5148\u4f7f\u7528swap\u5185\u5b58</p> <p>\u67e5\u770b\u547d\u4ee4 <pre><code>cat /proc/sys/vm/swappiness\n</code></pre> \u8bbe\u7f6e\u7f13\u5b58\uff0c\u914d\u7f6ejava\u865a\u62df\u673a\u5185\u5b58 <pre><code>vi ~/.bashrc\n#\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\nexport USE_CCACHE=1\nexport CCACHE_COMPRESS=1\nexport LC_ALL=C\n\nexport _JAVA_OPTIONS=\"-Xmx6g\"\n</code></pre> \u5f00\u542fccache <pre><code>ccache -M 50G\n</code></pre></p>"},{"location":"android/fws/fws_aosp/#5google","title":"5.\u9a71\u52a8\u4e0b\u8f7d(\u9488\u5bf9google\u624b\u673a\uff0c\u53ef\u8df3\u8fc7)","text":"<p>https://developers.google.com/android/drivers</p> <p></p> <p>\u4e0a\u9762\u6e90\u7801\u4e0b\u8f7d\u7684\u662fandroid-13.0.0_r43\u6240\u4ee5\u590d\u5236build ID(TQ2A.230505.002)\u5230\u9a71\u52a8\u7f51\u7ad9</p> <p></p> <p>\u4e0b\u8f7d\u540e\u653e\u5230aosp\u76ee\u5f55\u4e0b\u5e76\u89e3\u538b <pre><code>tar -zxvf google_devices-cheetah-td1a.220804.031-d59f7f42.tgz\n</code></pre> \u6267\u884c <pre><code>./extract-google_devices-cheetah.sh\n</code></pre> \u6309\u56de\u8f66\u540e\u4e00\u76f4\u6309F\u952e\u76f4\u5230\u51fa\u73b0Type \"I ACCEPT\" if you agree to the terms of the license: \u8f93\u5165I ACCEPT\u56de\u8f66\u5373\u53ef</p> <p>\u83b7\u5f97\u4e00\u4e2avendor\u6587\u4ef6\u5939\uff0c\u786e\u4fdd\u5728aosp\u76ee\u5f55\u4e0b</p>"},{"location":"android/fws/fws_aosp/#6","title":"6.\u5185\u6838\u4e0b\u8f7d(\u53ef\u8df3\u8fc7)","text":"<p>https://source.android.google.cn/docs/setup/build/building-kernels?hl=zh-cn#id-version</p> <p></p> <p>\u4e00\u822c\u5df2\u7ecf\u5305\u542b\uff0c\u53ef\u901a\u8fc7\u8def\u5f84\u786e\u8ba4</p>"},{"location":"android/fws/fws_aosp/#7","title":"7.\u6e90\u7801\u7f16\u8bd1","text":"<p><pre><code>export DISABLE_ARTIFACT_PATH_REQUIREMENTS=\"true\"\nsource build/envsetup.sh\nlunch\n</code></pre> lunch\u540e\u4f1a\u5217\u51fa\u7f16\u8bd1\u9009\u9879</p> <p>\u5982\u679c\u662f\u771f\u673a\u4ee3\u53f7\u53ef\u4ee5\u901a\u8fc7\u9a71\u52a8\u754c\u9762\u67e5\u627e\uff0c\u6bd4\u5982Pixel6 (\"oriole\") <pre><code>lunch aosp_oriole-userdebug\n</code></pre> \u7f16\u8bd1\u7248\u672c\u4ecb\u7ecd</p> <ul> <li>user:\u65e0root\u6743\u9650</li> <li>userdebug:\u6709root\uff0c\u9700\u8981\u901a\u8fc7su\u83b7\u53d6</li> <li>eng:\u6709root\uff0cadbd\u8d85\u7ea7\u6743\u9650</li> </ul>"},{"location":"android/fws/fws_aosp/#lunch","title":"\u6dfb\u52a0lunch\u9009\u9879","text":"<p>\u5bf9\u4e8e\u6a21\u62df\u5668\u5fc5\u987bsdk\u5f00\u5934\uff0c\u6bd4\u5982lunch sdk_phone_x86_64-userdebug</p> <p>\u6253\u5f00build/make/target/product/AndroidProducts.mk <pre><code>COMMON_LUNCH_CHOICES := \\\n...\nsdk_x86_64-eng \\\nsdk_phone_x86_64-eng \\\nsdk_x86_64-userdebug \\\nsdk_phone_x86_64-userdebug\n</code></pre></p> <p>\u9009\u62e9\u7248\u672c\u540e\u6267\u884c\u7f16\u8bd1\u547d\u4ee4\uff1amake -j(\u865a\u62df\u673a\u914d\u7f6e\u7684cpu\u6838\u6570)</p>"},{"location":"android/fws/fws_aosp/#_6","title":"\u7f16\u8bd1\u4ee5\u53ca\u547d\u4ee4\u76f8\u5173","text":"<p>fws_aosp_make</p>"},{"location":"android/fws/fws_aosp/#car-api","title":"Car API\u76f8\u5173","text":"<p>\u5373\u7f16\u8bd1\u548cCarService\u901a\u4fe1\u7684\u63a5\u53e3\u5e93</p> <p>make android.car \u53ef\u770b\u5230\u6240\u6709\u65b9\u6cd5\u63a5\u53e3\uff0c\u5305\u62ec\u5177\u4f53\u5b9e\u73b0</p> <p>make android.car-system-stubs \u53ef\u770b\u5230\u6240\u6709\u65b9\u6cd5\u63a5\u53e3\u4f46\u4e0d\u542b\u5177\u4f53\u5b9e\u73b0</p> <p>make android.car-stubs \u4ec5\u5305\u542b\u6ca1\u6709\u88ab@SystemApi\u4fee\u9970\u7684\u65b9\u6cd5\uff0c\u4e14\u4e0d\u542b\u5177\u4f53\u5b9e\u73b0</p> <p>\u6210\u529f\u540ejar\u5728out\\soong.intermediates\\packages\\services\\Car\\car-lib\\android.car\\android_common\\javac\\</p> <p>pixel\u624b\u673a\u5237\u5165\u8f66\u8f7d\u7cfb\u7edf</p> <p>https://source.android.com/docs/automotive/start/pixelxl?hl=zh-cn</p>"},{"location":"android/fws/fws_aosp/#8","title":"8.\u5237\u673a(\u53ef\u8df3\u8fc7)","text":"<p>\u8c37\u6b4c\u539f\u751f\u624b\u673a\u5730\u5740\uff1a</p> <p>\u7ebf\u5237\u5305\uff1ahttps://developers.google.com/android/images</p> <p>OTA\u5305\uff1ahttps://developers.google.com/android/ota</p>"},{"location":"android/fws/fws_aosp/#_7","title":"\u5237\u673a\u7f16\u8bd1\u7684\u5305","text":"<p>\u89e3\u9501\u8bbe\u5907 <pre><code>fastboot flashing unlock\n\u97f3\u91cf\u952e\u9009\u62e9Unlock\n</code></pre> \u67e5\u770b\u7f16\u8bd1\u4ea7\u51fa\u76ee\u5f55\u662f\u5426\u6b63\u786e\uff0c\u9ed8\u8ba4\u662f\u6b63\u786e\u7684\uff0c\u5982\u9700\u914d\u7f6e\u5728.bashrc\u4e2d\u6dfb\u52a0export ANDROID_PRODUCT_OUT=/home/xxx/aosp/out/target/product/oriole <pre><code>echo $ANDROID_PRODUCT_OUT\n</code></pre> \u5237\u5165\u7f16\u8bd1\u4ea7\u7269\uff1a <pre><code>fastboot flashall -w\n</code></pre></p> <p>\u5176\u4ed6\u547d\u4ee4</p> <p>b\u5206\u533a\u76f8\u5173 <pre><code>fastboot set_active other\nfastboot --slot=other flash bootloader bootloader.img\n</code></pre></p> <p>\u62a5\u9519\u95ee\u9898\u89c1</p> <p>wifi\u611f\u53f9\u53f7\u5904\u7406 <pre><code>adb shell settings delete global captive_portal_http_url\nadb shell settings delete global captive_portal_https_url\nadb shell settings put global captive_portal_http_url http://www.google.cn/generate_204\nadb shell settings put global captive_portal_https_url https://www.google.cn/generate_204\n</code></pre> \u98de\u884c\u6a21\u5f0f\u5f00\u5173\u4e00\u4e0b</p>"},{"location":"android/fws/fws_aosp/#9","title":"9.\u542f\u52a8\u6a21\u62df\u5668","text":"<p>1.vmware\u4e2d\uff0c\u6e90\u7801\u7f16\u8bd1\u5b8c\u540e\u76f4\u63a5\u6267\u884cemulator\u5373\u53ef</p> <p>2.\u5982\u679c\u662fwsl2\u4e2d\uff0c\u7531\u4e8e\u65e0\u6cd5\u542f\u52a8\u6a21\u62df\u5668\uff0c\u9700\u8981\u501f\u52a9window\u4e2d\u7684emulator.exe\uff0c\u524d\u63d0\u662f\u5df2\u7ecf\u5b89\u88c5\u597dAndroid Studio\u5e76\u4e14\u521b\u5efa\u4e86\u4e00\u4e2a\u6a21\u62df\u5668\u540d\u4e3aPixel5\uff0c\u6a21\u62df\u5668\u5904\u4e8e\u5173\u95ed\u72b6\u6001\uff0c\u7136\u540e\u6267\u884c\u547d\u4ee4\u542f\u52a8\u6a21\u62df\u5668 emulator.exe -avd Pixel5 -system \"\\wsl.localhost\\Ubuntu-22.04\\home\\yuli\\aosp\\out\\target\\product\\emulator_x86_64\\system.img\" -data \"\\wsl.localhost\\Ubuntu-22.04\\home\\yuli\\aosp\\out\\target\\product\\emulator_x86_64\\userdata.img\"</p> <p>-system\uff1a\u6307\u5b9a\u7f16\u8bd1\u51fa\u6765\u7684system.img\u955c\u50cf</p> <p>-data\uff1a\u6307\u5b9a\u7f16\u8bd1\u51fa\u6765\u7684userdata.img\u955c\u50cf</p> <p>3.ubuntu\u7cfb\u7edf\u4e2d\u76f4\u63a5\u6267\u884cemulator -writable-system <pre><code>adb root\nadb remount\nadb reboot\n</code></pre> \u5373\u53ef\u63a8\u9001\u6587\u4ef6\u5230system</p>"},{"location":"android/fws/fws_aosp/#10as","title":"10.\u6e90\u7801\u5bfc\u5165AS(\u901a\u7528)","text":"<p>\u751f\u6210idegen.jar <pre><code>source build/envsetup.sh\nmmm development/tools/idegen/\ndevelopment/tools/idegen/idegen.sh\nsudo chmod 777 android.iml\nsudo chmod 777 android.ipr\n</code></pre></p> <p>\u6dfb\u52a0\u6392\u9664\u540d\u5355(android.iml) <pre><code>&lt;excludeFolder url=\"file://$MODULE_DIR$/bionic\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/bootable\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/build\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/cts\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/dalvik\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/developers\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/development\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/device\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/docs\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/external\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/hardware\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/kernel\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/out\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/pdk\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/platform_testing\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/prebuilts\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/sdk\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/system\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/test\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/toolchain\" /&gt;\n&lt;excludeFolder url=\"file://$MODULE_DIR$/tools\" /&gt;\n</code></pre> AS\u5bfc\u5165\u65b9\u5f0f\uff1a\u6253\u5f00android.ipr\u6587\u4ef6</p> <p>\u62a5\u5f02\u5e38\uff1a</p> <p>External file changes sync may be slow: The current inotify(7) watch limit is too low.</p> <p>\u89e3\u51b3\uff1a <pre><code>sudo touch /etc/sysctl.d/idea.conf\n</code></pre> \u5185\u5bb9\u586b\u5199\uff1a <pre><code>fs.inotify.max_user_watches = 524288\nsudo sysctl -p --system\n</code></pre> \u91cd\u542fas</p>"},{"location":"android/fws/fws_aosp/#11asfplinux","title":"11.\u6e90\u7801\u5bfc\u5165ASFP(Linux\u4e13\u7528)","text":"<p>\u4e0b\u8f7d\u5b89\u88c5\u5305\uff1a</p> <p>https://dl.google.com/android/asfp/asfp-2023.1.1.19-linux.deb</p> <p>https://dl.google.com/android/asfp/asfp-2023.2.1.19-linux.deb</p> <p>\u4f7f\u7528\u6559\u7a0b\uff1a</p> <p>https://juejin.cn/post/7316927971095576630</p>"},{"location":"android/fws/fws_aosp/#12","title":"12.\u6e90\u7801\u4ed3\u5e93\u672c\u5730\u7ba1\u7406","text":"<p>1.\u79fb\u52a8\u786c\u76d8\u4f5c\u4e3a\u8fdc\u7a0b\u4ed3\u5e93</p> <p>\u6302\u8f7d\u76ee\u5f55\uff1a/media/xxx/xxx/</p> <p>\u65b0\u5efa\u76ee\u5f55\u5982aosp\uff0c\u521d\u59cb\u5316\u88f8\u4ed3\u5e93 <pre><code>cd aosp\ngit init --bare\n</code></pre> \u4f1a\u51fa\u73b0HEAD\u3001branches\u3001config\u3001description\u3001hooks\u3001info\u3001objects\u3001refs\u6587\u4ef6\u6216\u6587\u4ef6\u5939</p> <p>2.\u672c\u5730aosp\u6e90\u7801</p> <p>\u5220\u9664.repo/ <pre><code>git init\ngit checkout -b my-branch\n\necho \"Initial commit\" &gt; README.md\ngit add README.md\ngit commit -m \"Initial commit\"\n\ngit remote add xxx(\u8fdc\u7a0b\u4ed3\u5e93\u540d\u968f\u610f) /media/xxx/xxx/aosp\n</code></pre> \u786e\u4fddgit remote add\u6210\u529f <pre><code>git remote -v\n</code></pre> \u8f93\u51fa\u7c7b\u4f3c <pre><code>xxx /media/xxx/xxx/aosp/ (fetch)\nxxx /media/xxx/xxx/aosp/ (push)\n</code></pre> \u914d\u7f6epush\u5e76\u63a8\u9001 <pre><code>git push --set-upstream xxx my-branch\n</code></pre></p>"},{"location":"android/fws/fws_aosp_make/","title":"\u7f16\u8bd1\u76f8\u5173","text":""},{"location":"android/fws/fws_aosp_make/#_1","title":"\u7f16\u8bd1\u955c\u50cf\u547d\u4ee4","text":"\u547d\u4ee4 \u955c\u50cf\u6587\u4ef6 make snod \u7f16\u8bd1System.img make vnod \u7f16\u8bd1vendor.img make pnod \u7f16\u8bd1product.img make senod \u7f16\u8bd1system_ext.img make onod \u7f16\u8bd1odm.img"},{"location":"android/fws/fws_aosp_make/#_2","title":"\u6e05\u9664\u547d\u4ee4","text":"\u547d\u4ee4 \u4f5c\u7528 m clobber \u6e05\u9664\u6240\u6709\u7f16\u8bd1\u7f13\u5b58 m clean \u6e05\u9664\u7f16\u8bd1\u7f13\u5b58\uff0c\u7b49\u4ef7\u4e8erm -rf out/ m installclean \u6e05\u9664\u6240\u6709\u4e8c\u8fdb\u5236\u6587\u4ef6"},{"location":"android/fws/fws_aosp_make/#_3","title":"\u67e5\u627e\u547d\u4ee4","text":"\u547d\u4ee4 \u67e5\u627e\u8303\u56f4 jgrep \u5728\u6240\u6709java\u6587\u4ef6\u4e2d\u67e5\u627e cgrep \u5728\u6240\u6709c/c++\u6587\u4ef6\u4e2d\u67e5\u627e resgrep \u5728\u6240\u6709res/*.xml\u6587\u4ef6\u4e2d\u67e5\u627e ggrep \u5728\u6240\u6709Gradle\u6587\u4ef6\u4e2d\u67e5\u627e mangrep \u5728\u6240\u6709AndroidManfest.xml\u6587\u4ef6\u4e2d\u67e5\u627e mgrep \u5728\u6240\u6709Makefiles\u548c*.bp\u6587\u4ef6\u4e2d\u67e5\u627e"},{"location":"android/fws/fws_aosp_make/#_4","title":"\u5176\u4ed6\u547d\u4ee4","text":"\u547d\u4ee4 \u4f5c\u7528 printconfig \u6253\u5370\u5f53\u524d\u914d\u7f6e\u4fe1\u606f allmod \u663e\u793aaosp\u6240\u6709module pathmod [module name] \u663e\u793amodule\u6240\u5728\u8def\u5f84 refreshmod \u5237\u65b0module\u5217\u8868 gomod [module name] \u5b9a\u4f4d\u5230\u6307\u5b9amodule\u76ee\u5f55 croot \u56de\u5230aosp\u6839\u76ee\u5f55 <p>\u6a21\u5757\u7f16\u8bd1\uff1amake [module name]</p>"},{"location":"android/fws/fws_aosp_make/#_5","title":"\u5e38\u89c1\u6a21\u5757\u7f16\u8bd1","text":"\u6a21\u5757\u540d make\u65b9\u5f0f\u547d\u4ee4 mmm\u65b9\u5f0f\u547d\u4ee4 init make init mmm system/core/init zygote make app_process mmm frameworks/base/cmds/app_process system_server make services mmm frameworks/base/services framework-res make framework-res mmm frameworks/base/core/res framework-jni make libandroid_runtime mmm frameworks/base/core/jni framework framework-minus-apex mmm frameworks/base/core/java services make services mmm frameworks/base/core/services libandroid_servers make libandroid_servers mmm frameworks/base/core/jni libsensorservice make libsensorservice mmm frameworks/native/services/sensorservice sensorservice make sensorservice mmm frameworks/native/services/sensorservice binder make libbinder mmm frameworks/native/libs/binder <p>\u5176\u4e2d\u7f16\u8bd1framework</p> <p>make framework(Android12\u4e4b\u540e\u4f7f\u7528make framework-minus-apex) \u6216\u8005\u76f4\u63a5mmm frameworks/base</p>"},{"location":"android/fws/fws_aosp_make/#_6","title":"\u751f\u6210\u7cfb\u7edf\u7b7e\u540d\u6587\u4ef6","text":"<p>aosp\u6e90\u7801\u8def\u5f84\uff1abuild/target/product/security/</p> <p>platform.pk8</p> <p>platform.x509.pem <pre><code>openssl pkcs8 -in platform.pk8 -inform DER -outform PEM -out platform.pem -nocrypt\n</code></pre></p> <pre><code>openssl pkcs12 -export -in platform.x509.pem -inkey platform.pem -out platform.pk12 -name dev\n</code></pre> <pre><code>keytool -importkeystore -deststorepass 123456 -destkeystore platform.jks -srckeystore platform.pk12 -srcstoretype PKCS12 -srcstorepass 123456\n</code></pre> <p>build.gradle\u4e2d\u6dfb\u52a0 <pre><code>signingConfigs {\n    config {\n        storeFile file(\"platform.jks\")\n        storePassword '123456'\n        keyAlias 'dev'\n        keyPassword '123456'\n    }\n}\n\nbuildTypes {\n    release {\n        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        signingConfig signingConfigs.config\n    }\n}\n</code></pre> \u5728Androidmanifest.xml\u6dfb\u52a0 <pre><code>android:sharedUserId=\"android.uid.system\"\n</code></pre></p>"},{"location":"android/fws/fws_app_start/","title":"App\u8fdb\u7a0b\u542f\u52a8","text":"<p>\u51b7\u542f\u52a8\u548c\u70ed\u542f\u52a8</p> <p>startActivity</p> <p>Instrumentation: execStartActivity-&gt; ActivityTaskManager.getService().startActivity -&gt; ServiceManager.getService(Context.ACTIVITY_TASK_SERVICE)</p> <p>\u901a\u8fc7AMS\u542f\u52a8\u6d41\u7a0b\u53ef\u77e5\u5728publishBinderService(Context.ACTIVITY_TASK_SERVICE, mService)\u4f1a\u5c06atms\u6dfb\u52a0\u5230ServiceManager\u4e2d</p> <p>ActivityTaskManagerService: startAcitivity-&gt;startActivityAsUser</p> <p>ActivityStater: execute-&gt;executeRequest-&gt;startActivityUnchecked-&gt;startActivityInner</p> <p>RootWindowContainer: resumeFocusedTasksTopActivities</p> <p>Task: resumeTopActivityUncheckedLocked-&gt;resumeTopActivityInnerLocked</p> <p>TaskFragment: resumeTopActivity</p> <p>ActivityTaskSupervisor: startSpecificActivity</p> <p>\u5982\u679c\u8fdb\u7a0b\u5df2\u7ecf\u5b58\u5728\uff1arealStartActivityLocked(\u5e94\u7528\u5185\u542f\u52a8)\uff0c\u5426\u5219\u4ea4\u7ed9atsm\u5904\u7406\u5982\u4e0b(\u684c\u9762\u542f\u52a8)</p> <p>ActivityTaskManagerService: startProcessAsync <pre><code>final Message m = PooledLambda.obtainMessage(ActivityManagerInternal::startProcess,\nmAmInternal, activity.processName, activity.info.applicationInfo, knownToBeDead,\nisTop, hostingType, activity.intent.getComponent());\nmH.sendMessage(m);\n</code></pre> AMS\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u4f1a\u5728Lifecycle\u7684onStart\u65b9\u6cd5\u4e2d\u8c03\u7528start\u65b9\u6cd5 LocalServices.addService(ActivityManagerInternal.class, mInternal)\uff0cLocalService\u7ee7\u627f\u4e8eActivityManagerInternal</p> <p>LocalService\uff1astartProcess-&gt;startProcessLocked</p> <p>ProcessList: startProcessLocked-&gt;startProcess <pre><code>if (hostingRecord.usesAppZygote()) {\nfinal AppZygote appZygote = createAppZygoteForProcessIfNeeded(app);\nstartResult = appZygote.getProcess().start(xxx);\n}\n</code></pre> AppZygote: getProcess-&gt;connectToZygoteIfNeededLocked</p> <p>ZygoteProcess: startChildZygotestartViaZygote-&gt;zygoteSendArgsAndGetResult-&gt;attemptZygoteSendArgsAndGetResult</p> <p>ChildZygoteProcess: new</p> <p>ZygoteProcess: waitForConnectionToZygote-&gt;connect-&gt;preloadApp-&gt;start-&gt;startViaZygote-&gt;zygoteSendArgsAndGetResult-&gt;attemptZygoteSendArgsAndGetResult</p> <p>ZygoteServer: runSelectLoop-&gt;acceptCommandPeer</p> <p>ZygoteConnection: handleChildProc</p> <p>ZygoteInit: zygoteInit</p> <p>RuntimeInit: applicationInit-&gt;findStaticMain</p> <p>\u53cd\u5c04\u8c03\u7528ActivityThread\u7684main\u65b9\u6cd5 <pre><code>Looper.prepareMainLooper();\nActivityThread thread = new ActivityThread();\nthread.attach(false, startSeq);\nLooper.loop();\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u5728SystemServer\u4e2d\u4e5f\u4f1a\u521b\u5efaActivityThread\uff0ccreateSystemContext\u65b9\u6cd5\u4e2d <pre><code>ActivityThread activityThread = ActivityThread.systemMain();\n\npublic static ActivityThread systemMain() {\nThreadedRenderer.initForSystemProcess();\nActivityThread thread = new ActivityThread();\nthread.attach(true, 0);\nreturn thread;\n}\n</code></pre> attach\u53c2\u6570\u4e0d\u540c\uff0cfalse\u60c5\u51b5\u4e0b ams\uff1aattachApplication-&gt;attachApplicationLocked</p>"},{"location":"android/fws/fws_app_start/#app","title":"\u666e\u901aapp\u542f\u52a8","text":"<p>handleLaunchActivity\u6d41\u7a0b <pre><code>public Activity handleLaunchActivity(ActivityClientRecord r,\nPendingTransactionActions pendingActions, Intent customIntent) {\nfinal Activity a = performLaunchActivity(r, customIntent);\n}\n\nprivate Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) {\nContextImpl appContext = createBaseContextForActivity(r);//\u521b\u5efaBaseContext\nActivity activity = null;\n\n//\u53cd\u5c04\u521b\u5efaActivity\njava.lang.ClassLoader cl = appContext.getClassLoader();\nactivity = mInstrumentation.newActivity(cl, component.getClassName(), r.intent);\n\n//...\nApplication app = r.packageInfo.makeApplicationInner(false, mInstrumentation);//\u521b\u5efaApplicaton\n\n//...\n//\u8c03\u7528attch\u65b9\u6cd5\nactivity.attach(appContext, this, getInstrumentation(), r.token,r.ident, app, r.intent, r.activityInfo, title, r.parent,\nr.embeddedID, r.lastNonConfigurationInstances, config,\nr.referrer, r.voiceInteractor, window, r.activityConfigCallback,\nr.assistToken, r.shareableActivityToken);\n//...\n//\u8bbe\u7f6eActivity\u7684\u4e3b\u9898\nint theme = r.activityInfo.getThemeResource();\nif (theme != 0) {\nactivity.setTheme(theme);\n}\n//...\n\nif (r.isPersistable()) {\nmInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);\n} else {\nmInstrumentation.callActivityOnCreate(activity, r.state);\n}\n\n//...\nr.setState(ON_CREATE);//lifecycle\u72b6\u6001\u8bbe\u7f6e\n}\n</code></pre> attach\u65b9\u6cd5 <pre><code>final void attach(Context context, ActivityThread aThread,\nInstrumentation instr, IBinder token, int ident,\nApplication application, Intent intent, ActivityInfo info,\nCharSequence title, Activity parent, String id,\nNonConfigurationInstances lastNonConfigurationInstances,\nConfiguration config, String referrer, IVoiceInteractor voiceInteractor,\nWindow window, ActivityConfigCallback activityConfigCallback, IBinder assistToken,\nIBinder shareableActivityToken) {\n//...\nmWindow = new PhoneWindow(this, window, activityConfigCallback);// \u521b\u5efawindow\u552f\u4e00\u5b9e\u73b0\u7c7b\n//...\n}\n</code></pre> callActivityOnCreate\u65b9\u6cd5 <pre><code>public void callActivityOnCreate(Activity activity, Bundle icicle,\nPersistableBundle persistentState) {\nprePerformCreate(activity);\nactivity.performCreate(icicle, persistentState);\npostPerformCreate(activity);\n}\n\nfinal void performCreate(Bundle icicle, PersistableBundle persistentState) {\nfinal int windowingMode = getResources().getConfiguration().windowConfiguration.getWindowingMode();\n//\u591a\u7a97\u6a21\u5f0f\nmIsInMultiWindowMode = inMultiWindowMode(windowingMode);\n//\u753b\u4e2d\u753b\u6a21\u5f0f\nmIsInPictureInPictureMode = windowingMode == WINDOWING_MODE_PINNED;\n//...\n//\u56de\u8c03\u5230Activity\u751f\u547d\u5468\u671f\u7684onCreate\u65b9\u6cd5\nif (persistentState != null) {\nonCreate(icicle, persistentState);\n} else {\nonCreate(icicle);\n}\n//...\n//fragment\u751f\u547d\u5468\u671f\u5206\u53d1\nmFragments.dispatchActivityCreated();\n//...\n</code></pre></p> <p>handleResumeActivity\u6d41\u7a0b <pre><code>ActivityThread.java\npublic void handleResumeActivity(ActivityClientRecord r, boolean finalStateRequest, boolean isForward, String reason) {\nif (!performResumeActivity(r, finalStateRequest, reason)) {\nreturn;\n}\n//...\n}\n\npublic boolean performResumeActivity(ActivityClientRecord r, boolean finalStateRequest, String reason) {\n//...\nr.activity.performResume(r.startsNotResumed, reason);\n//...\n}\n\nfinal void performResume(boolean followedByPause, String reason) {\n//...\ndispatchActivityPreResumed();\nperformRestart(true /* start */, reason);\n//...\nmInstrumentation.callActivityOnResume(this);\n//...\nmFragments.dispatchResume();\n//...\ndispatchActivityPostResumed();\n}\n\npublic void callActivityOnResume(Activity activity) {\nactivity.mResumed = true;\nactivity.onResume();\n//...\n}\n</code></pre> \u56de\u8c03\u5230Activity\u751f\u547d\u5468\u671f\u7684onResume\u65b9\u6cd5\uff0c\u56de\u5230handleResumeActivity\u63a5\u7740\u5f80\u4e0b\u8d70 <pre><code>public void handleResumeActivity(ActivityClientRecord r, boolean finalStateRequest, boolean isForward, String reason) {\n//...\nif (!r.activity.mFinished &amp;&amp; willBeVisible &amp;&amp; r.activity.mDecor != null &amp;&amp; !r.hideForNow) {\n//...\nr.activity.mVisibleFromServer = true;\nmNumVisibleActivities++;\nif (r.activity.mVisibleFromClient) {\nr.activity.makeVisible();\n}\n}\n}\n\nvoid makeVisible() {\nif (!mWindowAdded) {\nViewManager wm = getWindowManager();\nwm.addView(mDecor, getWindow().getAttributes());\nmWindowAdded = true;\n}\nmDecor.setVisibility(View.VISIBLE);\n}\n\n//WindowManagerImpl.java\npublic void addView(@NonNull View view, @NonNull ViewGroup.LayoutParams params) {\napplyTokens(params);\nmGlobal.addView(view, params, mContext.getDisplayNoVerify(), mParentWindow, mContext.getUserId());\n}\n\n//WindowManagerGlobal.java\npublic void addView(View view, ViewGroup.LayoutParams params,\nDisplay display, Window parentWindow, int userId) {\nViewRootImpl root;\n//...\nif (windowlessSession == null) {\nroot = new ViewRootImpl(view.getContext(), display);\n} else {\nroot = new ViewRootImpl(view.getContext(), display,\nwindowlessSession);\n}\nview.setLayoutParams(wparams);\nmViews.add(view);\nmRoots.add(root);\nmParams.add(wparams);\n\nroot.setView(view, wparams, panelParentView, userId);\n//...\n}\n</code></pre> setView\u4e2d\u901a\u8fc7IWindowSession(Binder)\u4e0ewms\u4ea4\u4e92</p>"},{"location":"android/fws/fws_drag/","title":"\u6e90\u7801","text":""},{"location":"android/fws/fws_drag/#api","title":"\u7cfb\u7edf\u62d6\u62fdAPI","text":"<p>startDragAndDrop(ClipData data, DragShadowBuilder shadowBuilder, Object myLocalState, int flags)</p> <p>ClipData\uff1a\u7528\u4e8e\u5b58\u50a8\u4f20\u9001\u7684\u6570\u636e</p> <p>DragShadowBuilder\uff1a\u62d6\u52a8\u65f6\u5c55\u793a\u7684\u89c6\u56fe\u6216\u9634\u5f71</p> <p>myLocalState\uff1a\u8fd9\u4e2a\u53c2\u6570\u53ef\u4ee5\u7528\u4f5cActivity\u5185\u90e8\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4f20\u8f93\u673a\u5236\u3002\u76d1\u542c\u65b9\u901a\u8fc7DragEvent#getLocalState()\u65b9\u6cd5\u6765\u83b7\u53d6\u6570\u636e\u3002\u5b83\u4e0d\u80fd\u8de8Activity\uff0c\u5982\u679c\u5728\u5176\u4ed6Activity\u8c03\u7528getLocalState()\u65b9\u6cd5\u4f1a\u8fd4\u56denull</p> <p>flags\uff1a\u8bbe\u7f6e\u4e3a0\u8868\u793a\u4e0d\u8bbe\u7f6eflag</p> <ol> <li>DRAG_FLAG_GLOBAL\u8868\u793a\u53ef\u4ee5\u8de8window\u62d6\u62fd\uff0c\u5178\u578b\u7684\u662f\u5206\u5c4f\u72b6\u6001\u4e0b\u7684\u62d6\u62fd</li> <li>DRAG_FLAG_GLOBAL_PERSISTABLE_URI_PERMISSION</li> <li>DRAG_FLAG_GLOBAL_PREFIX_URI_PERMISSION</li> <li>DRAG_FLAG_GLOBAL_URI_READ</li> <li>DRAG_FLAG_GLOBAL_URI_WRITE</li> <li>DRAG_FLAG_OPAQUE</li> <li>DRAG_FLAG_ACCESSIBILITY_ACTION</li> </ol> <p>\u62d6\u62fd\u7b80\u5355\u6587\u672c <pre><code>val shadow = LayoutInflater.from(this).inflate(R.layout.xxx, null)\n\nval builder = MyDragShadowBuilder(shadow)\nview.setOnLongClickListener(object : OnLongClickListener {\n//\u957f\u6309\u4e8b\u4ef6\u89e6\u53d1\u62d6\u62fd\noverride fun onLongClick(v: View?): Boolean {\nval data = ClipData.newPlainText(\"drag text\", content)\nimageView.startDragAndDrop(\ndata,\nbuilder, // \u5982\u679c\u4e0d\u662f\u81ea\u5b9a\u4e49\u9634\u5f71\u76f4\u63a5new View.DragShadowBuilder(view)\nnull,\n0 or View.DRAG_FLAG_GLOBAL or View.DRAG_FLAG_OPAQUE\n)\n\nreturn true\n}\n})\n\nclass MyDragShadowBuilder(private var mShadow: View) :\nView.DragShadowBuilder() {\nprivate val width: Int = 400\nprivate val height: Int = 400\n\noverride fun onProvideShadowMetrics(outShadowSize: Point?, outShadowTouchPoint: Point?) {\n//\u62d6\u52a8\u56fe\u50cf\u7684\u5bbd\u548c\u9ad8\noutShadowSize?.set(width, height)\n\n//\u624b\u6307\u5728\u62d6\u52a8\u56fe\u50cf\u7684\u4f4d\u7f6e \u4e2d\u70b9\noutShadowTouchPoint?.set(width / 2, height / 2)\n}\n\noverride fun onDrawShadow(canvas: Canvas) {\nmShadow.measure(width, height)\nmShadow.layout(0, 0, width, height)\nmShadow.draw(canvas)\n}\n}\n</code></pre></p> <p>\u62d6\u62fd\u5904\u7406\u901a\u8fc7setOnDragListener <pre><code>binding.root.setOnDragListener { v, event -&gt;\nif (event.action == DragEvent.ACTION_DROP) {\nevent.clipData?.let { clipData -&gt;\nif (clipData.description == null) return@let\nval mimeType: String = clipData.description.getMimeType(0)\nclipData.getItemAt(0)?.let {\nif (mimeType.startsWith(\"image/\")) {\ncontentResolver.openInputStream(it.uri)?.use {input-&gt;\nBitmapFactory.decodeStream(input)?.let { bitmap-&gt;\n// \u5904\u7406\u56fe\u7247\n}\n}\n} else if (mimeType.startsWith(\"text/\")) {\n// \u5904\u7406\u6587\u672c\n} else {\n// \u5904\u7406\u5176\u4ed6\u5185\u5bb9\n}\n}\n}\n}\ntrue\n}\n</code></pre></p>"},{"location":"android/fws/fws_drag/#_1","title":"\u6e90\u7801\u5206\u6790","text":""},{"location":"android/fws/fws_drag/#_2","title":"\u5b9e\u6218\u6848\u4f8b","text":"<p>\u6848\u4f8b\u5b9a\u5236</p> <p>\u5e94\u7528\u6a2a\u5c4f https://blog.csdn.net/u012932409/article/details/117379528</p>"},{"location":"android/fws/fws_drag_case/","title":"\u6848\u4f8b","text":""},{"location":"android/fws/fws_drag_case/#_1","title":"\u9879\u76ee\u7b80\u4ecb","text":"<p>\u8de8\u5e94\u7528\u62d6\u62fd\u89c6\u56fe\uff0c\u6bd4\u5982\u6587\u5b57\u3001\u56fe\u7247\u7b49\u5143\u7d20\uff0c\u5177\u4f53\u7531\u5e94\u7528A\u957f\u6309View\u89e6\u53d1\uff0c\u5c06View\u62d6\u62fd\u5230\u53e6\u4e00\u4e2a\u5e94\u7528B\u5e76\u643a\u5e26\u6570\u636e</p> <p>\u573a\u666f\uff1a\u5fae\u4fe1\u56fe\u7247\u62d6\u62fd\u5230\u4fbf\u7b7e\u3001\u5730\u5740\u62d6\u62fd\u5230\u5730\u56fe</p>"},{"location":"android/fws/fws_drag_case/#_2","title":"\u77e5\u8bc6\u50a8\u5907","text":""},{"location":"android/fws/fws_drag_case/#android","title":"Android\u7684\u89e6\u6478\u4e8b\u4ef6\u4f20\u9012","text":"<ol> <li> <p>\u786c\u4ef6\u5c42\uff1a\u7528\u6237\u624b\u6307\u63a5\u89e6\u5c4f\u5e55\u65f6\uff0c\u89e6\u6478\u4f20\u611f\u5668\u68c0\u6d4b\u5230\u89e6\u6478\u70b9\u7684\u4f4d\u7f6e\u3001\u538b\u529b\u7b49\u4fe1\uff0c\u5e76\u5c06\u5176\u8f6c\u5316\u4e3a\u539f\u59cb\u7684\u786c\u4ef6\u4e8b\u4ef6</p> </li> <li> <p>Linux\u5185\u6838\uff1a\u8fd9\u4e9b\u539f\u59cb\u786c\u4ef6\u4e8b\u4ef6\u88ab\u4f20\u9012\u5230Linux\u5185\u6838\u7684\u8f93\u5165\u5b50\u7cfb\u7edf\uff0c\u7ecf\u8fc7\u521d\u6b65\u5904\u7406\u540e\uff0c\u901a\u8fc7/dev/input/eventX\u8bbe\u5907\u8282\u70b9\u66b4\u9732\u7ed9\u7528\u6237\u7a7a\u95f4</p> </li> <li> <p>InputManagerService\uff1aAndroid\u7cfb\u7edf\u7684System Server\u8fdb\u7a0b\u4e2d\u7684InputManagerService\u4f5c\u4e3a\u4e2d\u4ecb\uff0c\u76d1\u542c\u8fd9\u4e9b\u8bbe\u5907\u8282\u70b9\uff0c\u5e76\u901a\u8fc7Binder\u673a\u5236\u5c06\u89e6\u6478\u4e8b\u4ef6\u53d1\u9001\u7ed9\u9700\u8981\u5904\u7406\u7684\u5ba2\u6237\u7aef\uff0c\u901a\u5e38\u662fActivityManagerService</p> </li> <li> <p>ActivityManagerService\uff1a\u63a5\u6536\u5230\u89e6\u6478\u4e8b\u4ef6\u540e\uff0cActivityManagerService\u8d1f\u8d23\u786e\u5b9a\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff08App\uff09\u5e94\u8be5\u63a5\u6536\u8fd9\u4e2a\u4e8b\u4ef6\u3002\u5b83\u6839\u636e\u5f53\u524d\u7684\u7126\u70b9\uff08focus\uff09\u548c\u7a97\u53e3\u5c42\u7ea7\u7ed3\u6784\uff0c\u627e\u5230\u6700\u4e0a\u5c42\u4e14\u53ef\u4ea4\u4e92\u7684\u7a97\u53e3\uff08Window\uff09\uff0c\u8fdb\u800c\u786e\u5b9a\u5bf9\u5e94\u7684Activity</p> </li> <li> <p>WindowManagerService\uff1aActivityManagerService\u5c06\u89e6\u6478\u4e8b\u4ef6\u8f6c\u53d1\u7ed9WindowManagerService\uff0c\u540e\u8005\u8d1f\u8d23\u7ba1\u7406\u6240\u6709\u7a97\u53e3\u7684\u5e03\u5c40\u548c\u4e8b\u4ef6\u5206\u53d1\u3002WindowManagerService\u627e\u5230\u4e0e\u89e6\u6478\u4e8b\u4ef6\u76f8\u5173\u7684\u9876\u5c42\u7a97\u53e3\uff0c\u5e76\u901a\u77e5\u8be5\u7a97\u53e3\u7684Window.Callback\u5bf9\u8c61\uff08\u901a\u5e38\u662fActivity\u7684\u5185\u90e8\u7c7b\uff09</p> </li> <li> <p>DecorView\uff1a\u9876\u5c42\u7a97\u53e3\u901a\u5e38\u662f\u4e00\u4e2aDecorView\uff0c\u5b83\u662fPhoneWindow\u7684\u4e00\u4e2a\u5185\u90e8\u7c7b\uff0c\u7ee7\u627f\u81eaFrameLayout\u3002DecorView\u4f5c\u4e3a\u9876\u7ea7View\uff0c\u63a5\u6536\u5230\u89e6\u6478\u4e8b\u4ef6\u540e\uff0c\u5f00\u59cb\u6309\u7167Android\u7684\u4e8b\u4ef6\u5206\u53d1\u673a\u5236\u5c06\u4e8b\u4ef6\u5411\u4e0b\u4f20\u9012</p> </li> <li> <p>ViewRootImpl\uff1aDecorView\u6240\u5728\u7684ViewRootImpl\u8d1f\u8d23\u5c06\u89e6\u6478\u4e8b\u4ef6\u8fdb\u4e00\u6b65\u5206\u53d1\u7ed9View\u5c42\u6b21\u7ed3\u6784\u3002ViewRootImpl\u5b9e\u73b0\u4e86ViewParent\u63a5\u53e3\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5904\u7406\u89e6\u6478\u4e8b\u4ef6\u7684\u65b9\u6cd5\uff0c\u5982dispatchTouchEvent()</p> </li> <li> <p>ViewGroup &amp; View\uff1a\u89e6\u6478\u4e8b\u4ef6\u6700\u7ec8\u4eceViewRootImpl\u9010\u7ea7\u5411\u4e0b\u5206\u53d1\u5230\u5177\u4f53\u7684ViewGroup\u548cView\u5bf9\u8c61\u3002\u4e8b\u4ef6\u9996\u5148\u4f20\u9012\u5230ViewGroup.dispatchTouchEvent()\uff0c\u5728\u8fd9\u91cc\u53ef\u80fd\u4f1a\u89e6\u53d1onInterceptTouchEvent()\u65b9\u6cd5\u51b3\u5b9a\u662f\u5426\u622a\u65ad\u4e8b\u4ef6\u3002\u5982\u679c\u4e8b\u4ef6\u6ca1\u6709\u88ab\u622a\u65ad\uff0c\u5c06\u7ee7\u7eed\u4f20\u9012\u7ed9\u5b50View\u7684dispatchTouchEvent()\uff0c\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528onTouchEvent()\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u6cbf\u7740View\u6811\u4e00\u76f4\u5411\u4e0b\u4f20\u64ad\uff0c\u76f4\u5230\u67d0\u4e2aView\u6d88\u8d39\u4e86\u4e8b\u4ef6\u6216\u8005\u4e8b\u4ef6\u88ab\u5b8c\u5168\u4f20\u9012\u5230\u6811\u7684\u5e95\u5c42</p> </li> </ol>"},{"location":"android/fws/fws_drag_case/#api","title":"\u7cfb\u7edf\u62d6\u62fdapi\u4f7f\u7528\u548c\u6e90\u7801\u7406\u89e3","text":"<p>\u6e90\u7801\u5206\u6790</p>"},{"location":"android/fws/fws_drag_case/#transaction","title":"Transaction\u4f7f\u7528\u7ed3\u5408\u52a8\u753b\u6846\u67b6","text":""},{"location":"android/fws/fws_drag_case/#_3","title":"\u5b9e\u6218\u6848\u4f8b","text":""},{"location":"android/fws/fws_drag_case/#_4","title":"\u5173\u952e\u70b9\uff1a\u89e6\u6478\u4e8b\u4ef6\u6302\u94a9","text":"<p>frameworks/base/core/java/android/view/View.java</p> <p>\u5728View\u6e90\u7801\u4e2d\u7684dispatchTouchEvent\u65b9\u6cd5\u6302\u94a9\u5b50\uff0c\u63a5\u6536\u89e6\u6478\u4e8b\u4ef6 <pre><code>public boolean dispatchTouchEvent(MotionEvent event) {\nHfcDragViewHelper.getInstance().dispatchHfcTouchEvent(this, event);\n//...\n}\n</code></pre> \u6dfb\u52a0\u957f\u6309\u4e8b\u4ef6 <pre><code>private static final float MOVE_IGNORE_THRESHOLD_DP = 10.0f;\nprivate static final long LONG_PRESS_THRESHOLD_MS = ViewConfiguration.getLongPressTimeout();\nprivate long mDownTime;\nprivate float mDownX;\nprivate float mDownY;\npublic void dispatchHfcTouchEvent(View view, MotionEvent event) {\nfinal int action = event.getAction();\nswitch (action) {\ncase MotionEvent.ACTION_DOWN:\n// \u8bb0\u5f55\u6309\u4e0b\u65f6\u95f4\u548c\u4f4d\u7f6e\nmDownTime = System.currentTimeMillis();\nmDownX = event.getX();\nmDownY = event.getY();\nbreak;\ncase MotionEvent.ACTION_MOVE:\n// \u5224\u65ad\u662f\u5426\u79fb\u52a8\u8ddd\u79bb\u8d85\u8fc7\u957f\u6309\u5ffd\u7565\u9608\u503c\nfloat moveDistance = (float) Math.sqrt(Math.pow(event.getX() - mDownX, 2) + Math.pow(event.getY() - mDownY, 2));\nif (moveDistance &gt; MOVE_IGNORE_THRESHOLD_DP * view.mContext.getResources().getDisplayMetrics().density) {\n// \u79fb\u52a8\u8ddd\u79bb\u8fc7\u5927\uff0c\u53d6\u6d88\u957f\u6309\u68c0\u6d4b\nmDownTime = 0L;\n}\nbreak;\ncase MotionEvent.ACTION_UP:\ncase MotionEvent.ACTION_CANCEL:\n// \u6e05\u9664\u957f\u6309\u68c0\u6d4b\u76f8\u5173\u6570\u636e\nmDownTime = 0L;\nbreak;\n}\n// \u68c0\u67e5\u662f\u5426\u8fbe\u5230\u957f\u6309\u9608\u503c\nif (mDownTime &gt; 0 &amp;&amp; System.currentTimeMillis() - mDownTime &gt;= LONG_PRESS_THRESHOLD_MS) {\n// \u5904\u7406\u957f\u6309\u4e8b\u4ef6\nonLongPress(view);\nmDownTime = 0L; // \u6e05\u9664\u957f\u6309\u68c0\u6d4b\u76f8\u5173\u6570\u636e\n}\n}\n\nprivate void onLongPress(View view) {\n//\u62d6\u62fd\u903b\u8f91\ndragView(view);\n}\n</code></pre></p>"},{"location":"android/fws/fws_drag_case/#_5","title":"\u5173\u952e\u70b9\uff1a\u62d6\u62fd\u89c6\u56fe","text":"<ol> <li>\u5224\u65ad\u5e94\u7528\u662f\u5426\u8bbe\u7f6e\u62d6\u62fdstartDragAndDrop\uff0c\u901a\u8fc7\u52a0hasDrag\u533a\u5206</li> <li>\u907f\u514d\u5e94\u7528\u4e0d\u517c\u5bb9\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u767d\u540d\u5355PM_WRITE_LIST</li> <li>\u5bf9\u4e8e\u7b80\u5355\u5982TextView\u548cImageview\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\uff0c\u5176\u4ed6\u6682\u65f6\u53ea\u80fd\u5177\u4f53\u5206\u6790 <pre><code>public void dragView(View view) {\nif (view == null) {\nLog.e(TAG, \"drag view is null\");\nreturn;\n}\nif (view.hasDrag) {\nLog.e(TAG, \"already has drag view\");\nreturn;\n}\nString packageName = view.mContext.getPackageName();\nif (!PM_WRITE_LIST.contains(packageName)) {\nLog.e(TAG, \"drag pkg is not in write list\");\nreturn;\n}\nif (view instanceof TextView) {\nCharSequence content = ((TextView) view).getText();\ndrawText(view, content);\n} else if (view instanceof ImageView) {\ndrawImage(view);\n} else {\ndrawOther(view);\n}\n}\n</code></pre> frameworks/base/core/java/android/view/View.java</li> </ol> <p>\u5176\u4e2dhasdrag\u6807\u5fd7\u4f4d\u5728startDragAndDrop\u65b9\u6cd5\u4e2d <pre><code>/**\n * @hide\n */\nprotected boolean hasDrag;\n\npublic final boolean startDragAndDrop(ClipData data, DragShadowBuilder shadowBuilder,\nObject myLocalState, int flags) {\n//...\nif (data != null) {\ndata.prepareToLeaveProcess((flags &amp; View.DRAG_FLAG_GLOBAL) != 0);\n}\n// add start\nif (HfcDragViewHelper.getInstance().hasDrag(this)) {\nhasDrag = true;\nHfcDragViewHelper.getInstance().dragStart(mContext, data);\n}\n//...\n</code></pre></p>"},{"location":"android/fws/fws_drag_case/#_6","title":"\u5173\u952e\u70b9\uff1a\u62d6\u62fd\u4e2d\u548c\u62d6\u62fd\u7ed3\u675f\u5904\u7406","text":"<p>frameworks/base/core/java/android/view/ViewRootImpl.java</p> <p>\u5728ViewRootImpl\u6e90\u7801\u4e2d\u6302\u94a9\u5b50handleDragEvent <pre><code>private void handleDragEvent(DragEvent event) {\n// ...\nCariadDragHelper.getInstance().preHandleDragEvent(event, mBasePackageName);\n// Now dispatch the drag/drop event\nboolean result = mView.dispatchDragEvent(event);\nresult = CariadDragHelper.getInstance()\n.handleDragEvent(event, mBasePackageName, result, mWindowSession, mWindow);\n// ...\n}\n</code></pre> \u7528\u6765\u5904\u7406\u62d6\u62fd\u7ed3\u675f\u903b\u8f91 <pre><code>public void preHandleDragEvent(DragEvent event, String basePackageName) {\nif (DragEvent.ACTION_DROP == event.mAction) {\nif (mCurrentDragView != null) {\nif (!\"com.example.drop1\".equals(basePackageName)) {\nevent.mClipData = null;//\u4e0d\u5141\u8bb8\u81ea\u8eab\u5e94\u7528\u62d6\u62fd\u63a5\u6536\n}\n}\n}\n}\n\npublic boolean handleDragEvent(DragEvent event, String basePackageName,\nboolean oriResult, IWindowSession windowSession,\nViewRootImpl.W window) {\n//\u5904\u7406\u62d6\u62fd\u903b\u8f91\nreturn result;\n}\n</code></pre></p> <p>\u5177\u4f53\u6e90\u7801\u5de5\u5177\u7c7b</p> <p>HfcDragViewHelper</p>"},{"location":"android/fws/fws_drag_case/#_7","title":"\u5173\u952e\u70b9\uff1a\u62d6\u62fd\u6570\u636e\u4f20\u9012\u5904\u7406\u3001\u52a8\u753b\u3001\u5927\u5c0f","text":"<p>\u4eceframework\u5230service\u662f\u901a\u8fc7aidl\u7684\u5f62\u5f0f\uff0c\u539f\u751f\u63a5\u53e3(IWindowSession windowSession)\u5177\u4f53\u4e3aperformDrag\u65b9\u6cd5</p> <p>frameworks/base/core/java/android/view/IWindowSession.aidl</p> <p>\u6dfb\u52a0\u65b0\u63a5\u53e3 <pre><code>//\u4f20\u9012\u62d6\u62fd\u4fe1\u606f\u76f8\u5173\uff0c\u62d6\u62fd\u4e2d\u548c\u62d6\u62fd\u7ed3\u675f\u7b49\nboolean notifyDropStatus(boolean oriResult, boolean isOtherWindow, IWindow window,\nin DragEvent event, String packageName);\n\n//\u7528\u4e8e\u4fdd\u5b58\u62d6\u62fd\u89c6\u56fe\nvoid savaBitmap(in ParcelFileDescriptor pfd, in RemoteCallback callback);\n\n//\u7528\u4e8e\u901a\u77e5\u5206\u4eab\u680f\u663e\u793a\u9690\u85cf\nvoid shareBarShowOrHide(String action, String targetPackage, in ClipData data);\n</code></pre> IHfcDrag</p> <p>IHfcDragListener</p>"},{"location":"android/fws/fws_drag_case/#_8","title":"\u56fe\u7247\u4fdd\u5b58","text":"<p>\u5176\u4e2dsaveBitmap\u4e3a\u4f55\u4e0d\u76f4\u63a5\u4fdd\u5b58\uff1f</p> <p>\u5f53\u524d\u62d6\u62fd\u4ee3\u7801\u662f\u5728View\u4e2d\u5373\u6700\u7ec8\u8fd0\u884c\u8fdb\u7a0b\u662f\u5f53\u524d\u5e94\u7528\u8fdb\u7a0b\uff0c\u5982\u679c\u6b64\u5e94\u7528\u6ca1\u6709\u8bfb\u5199\u6743\u9650\u5c31\u65e0\u6cd5\u4fdd\u5b58\u56fe\u7247\uff0c\u9700\u8981\u901a\u8fc7aidl\u7ed1\u5b9a\u67d0\u4e2a\u5e94\u7528(\u81ea\u5b9a\u4e49\u7684\u7cfb\u7edf\u5e94\u7528\u4e2d\u6700\u597d)\u6765\u4fdd\u5b58\u56fe\u7247</p> <p>IWindowSession.aidl\u5177\u4f53\u5b9e\u73b0\u7c7b\u4e4b\u4e00</p> <p>frameworks/base/services/core/java/com/android/server/wm/Session.java</p> <p><pre><code>@Override\npublic boolean notifyDropStatus(boolean oriResult, boolean isOtherWindow, IWindow window, DragEvent event, String packageName) {\nreturn this.mDragDropController.notifyDropStatus(oriResult, isOtherWindow, window, event, packageName);\n}\n\n@Override\npublic void savaBitmap(android.os.ParcelFileDescriptor pfd, RemoteCallback callback) {\nthis.mDragDropController.saveBitmap(pfd, callback);\n}\n\n@Override\npublic void shareBarShowOrHide(String action, String targetPackage, android.content.ClipData data) {\nthis.mDragDropController.shareBarShowOrHide(action, targetPackage, data);\n}\n</code></pre> \u6ce8\uff1auid\u4e3a1000\u7684\u5e94\u7528\u4e0d\u5141\u8bb8\u8c03\u7528\u62d6\u62fd(startDragAndDrop)\u63a5\u53e3\uff0c\u89e3\u51b3\u5728validateAndResolveDragMimeTypeExtras\u65b9\u6cd5\u4e2d\u901a\u8fc7\u5305\u540d\u5141\u8bb8\u5373\u53ef</p> <p>frameworks/base/services/core/java/com/android/server/wm/DragDropController.java</p> <pre><code>IBinder performDrag(int callerPid, int callerUid, IWindow window, int flags, SurfaceControl surface, int touchSource, float touchX, float touchY, float thumbCenterX, float thumbCenterY, ClipData data) {\n//...\nfinal SurfaceControl.Transaction transaction = mDragState.mTransaction;\ntransaction.setAlpha(surfaceControl, 1); //\u4fee\u6539\u62101\ntransaction.show(surfaceControl);\ndisplayContent.reparentToOverlay(transaction, surfaceControl);\nmDragState.updateDragSurfaceLocked(true, touchX, touchY);\nmDragState.startDragLocked(); //\u542f\u52a8\u52a8\u753b\n//...\n}\n\nboolean notifyDropStatus(boolean oriResult, boolean isOtherWindow, IWindow window, DragEvent event, String packageName) {\nif (this.mDragState == null) {\nreturn false;\n}\nreturn mDragState.notifyDropStatus(oriResult, isOtherWindow, window, event, packageName);\n}\n\npublic void saveBitmap(ParcelFileDescriptor pfd, RemoteCallback callback) {\nHfcDragTransitManager.getInstance().bindShareService(mService.mContext, (isBind, iBinder) -&gt; {\nCariadDragTransitManager.getInstance().saveBitmap(pfd, callback);\n});\n}\n\npublic void shareBarShowOrHide(String action, String targetPackage, ClipData data) {\nHfcDragTransitManager.getInstance().bindShareService(mService.mContext, (isBind, iBinder) -&gt; {\nCariadDragTransitManager.getInstance().shareBarShowOrHide(action, targetPackage, data);\n});\n}\n</code></pre> <p>HfcDragTransitManager</p> <p>frameworks/base/services/core/java/com/android/server/wm/DragState.java</p> <p>\u6267\u884c\u62d6\u62fd\u52a8\u753b <pre><code>void startDragLocked() {\ncreateShowAnimationLocked();\n}\n\nprivate void createShowAnimationLocked() {\n//\u52a8\u753b\n}\n</code></pre> \u4fee\u6539\u62d6\u52a8\u65f6\u89c6\u56fe\u4e0d\u5c45\u4e2d\u95ee\u9898 <pre><code>void updateDragSurfaceLocked(boolean keepHandling, float x, float y) {\nif (mAnimator != null) {\nreturn;\n}\n//...\nfloat width = mSurfaceControl.getWidth() / 2;\nfloat height =  mSurfaceControl.getHeight() / 2;\nmTransaction.setPosition(mSurfaceControl, x - width,\ny - height).apply();\n//...\n}\n</code></pre></p> <p>\u5177\u4f53\u52a8\u753b\u4ee5\u53ca\u62d3\u5c55\u529f\u80fd\u6e90\u7801</p> <p>\u52a8\u753b\uff1a\u56fa\u5b9a\u4ece1.2\u500d\u7f29\u653e\u5f53\u672c\u8eab\u5927\u5c0f</p> <p>\u62d3\u5c55\u529f\u80fd\uff1a\u62d6\u62fd\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u62d6\u52a8\u5230\u63a5\u6536\u7684\u5e94\u7528\u663e\u793a\u5982+\u56fe\u6807\uff0c\u4e0d\u652f\u6301\u663e\u793ax\u56fe\u6807\uff0c\u5e94\u7528\u5b58\u5728\u591a\u4e2a\u5206\u4eab\u63a5\u6536\u529f\u80fd\u663e\u793a\u5176\u4ed6\u56fe\u6807</p> <p>DragAnim</p>"},{"location":"android/fws/fws_drag_case/#app","title":"app\u7aef\u5b9e\u73b0","text":"<p>\u529f\u80fd\u5305\u62ec\uff1a\u4fdd\u5b58\u56fe\u7247\uff0c\u663e\u793a\u5206\u4eab\u6846\uff0c\u67e5\u8be2\u652f\u6301\u5206\u4eab\u7684\u5e94\u7528\uff0c\u9ad8\u5fb7\u5730\u56fe\u67e5\u8be2\u7b49</p> <p>sharebar</p>"},{"location":"android/fws/fws_handler/","title":"Handler","text":"<p>\u4e00\u822c\u5904\u7406\u7ebf\u7a0b\u4e4b\u95f4\u95ee\u9898\uff0c\u8fdb\u7a0b\u4e4b\u95f4\u4e00\u822c\u662fbinder \u6e90\u7801\u5206\u6790\u57fa\u4e8eAndroid13</p>"},{"location":"android/fws/fws_handler/#_1","title":"\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u539f\u7406","text":"<p>\u6838\u5fc3\uff1a\u7ebf\u7a0b\u95f4\u5185\u5b58\u5171\u4eab(MessageQueue\u5171\u4eab)\uff0c\u57fa\u4e8e\u94fe\u8868\u7ed3\u6784\u7684Message\u5bb9\u5668\u5b9e\u73b0</p>"},{"location":"android/fws/fws_handler/#_2","title":"\u5185\u5b58\u6cc4\u9732\u539f\u56e0","text":"<p>\u5b8c\u5168\u7406\u89e3\u524d\u63d0\uff1a\u9700\u8981\u7406\u89e3JVM\u865a\u62df\u673a\u539f\u7406</p> <p>\u5f15\u7528\u8bb0\u6570\u6cd5 \u4f8b\u5982\uff1a\u5bf9\u8c61Obj\u88ab\u53d8\u91cfa,b,c\u5f15\u7528\u65f6\uff0c\u8ba1\u6570\u4e3a3\uff0c\u5f53c\u65ad\u5f00\u5f15\u7528\u8ba1\u6570\u53d82\uff0c\u5f53\u8ba1\u6570\u4e3a0\u65f6GC\u5373\u53ef\u6e05\u7406\uff0c\u5e38\u89c1\u4e8epython\u865a\u62df\u673a\u4e2d</p> <p>\u7f3a\u9677\uff1a\u76f8\u4e92\u5f15\u7528\u65f6\u9700\u8981\u989d\u5916\u673a\u5236\u5904\u7406\uff0c\u56e0\u6b64\u4e3b\u6d41\u865a\u62df\u673a\u4e0d\u4f7f\u7528</p> <p>\u5b89\u5353\u4e2d\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u53ef\u4ee5\u91ca\u653e\uff1a\u5f15\u7528\u94fe\u662f\u5426\u5b58\u5728GcRoot\uff0c\u4e00\u65e6\u5b58\u5728\u65e0\u6cd5\u91ca\u653e\u5bf9\u8c61</p> <p>\u6b64\u5904\u5f15\u7528\u94fe:</p> <p>static sMainLooper-&gt;Thread-&gt;ThreadLocal.ThreadLocalMap\u2192Entry(WeakReference)-&gt;Looper-&gt;MessageQueue-&gt;Message-&gt;Handler-&gt;XXActivity.this</p> <p>\u5224\u65adGcRoot\u4f9d\u636e\u4e4b\u4e00\uff1astatic</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u60f3\u529e\u6cd5\u65ad\u5f00\u5f15\u7528\u94fe</p> <ol> <li>Handler\u5b9a\u4e49\u6210\u9759\u6001+\u5f31\u5f15\u7528\u65b9\u5f0f(\u65ad\u5f00Message\u548cHandler\u4e4b\u95f4\u7684\u5f15\u7528)</li> <li>\u624b\u52a8\u79fb\u51faMessage\u65b9\u5f0f(\u65ad\u5f00Messagequeue\u548cMessage\u4e4b\u95f4\u7684\u5f15\u7528)</li> </ol>"},{"location":"android/fws/fws_handler/#threadlocal","title":"ThreadLocal","text":"<p>static final\u7c7b\u578b\uff0c\u751f\u547d\u5468\u671f\u548capp\u8fdb\u7a0b\u4e00\u81f4\uff0c\u7528\u6765\u9694\u79bb\u7ebf\u7a0b\u53d8\u91cf\uff0c\u6b64\u5904\u7528\u6765\u9694\u79bbLooper\u5bf9\u8c61\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u62e5\u6709\u81ea\u8eab\u72ec\u7acb\u7684Looper\u5bf9\u8c61\uff0c\u6e90\u7801\u4e3b\u8981\u770bset\u548cget\u65b9\u6cd5 <pre><code>public void set(T value) {\nThread t = Thread.currentThread();\nThreadLocalMap map = getMap(t);\nif (map != null)\nmap.set(this, value);\nelse\ncreateMap(t, value);\n}\nvoid createMap(Thread t, T firstValue) {\nt.threadLocals = new ThreadLocalMap(this, firstValue);\n}\nThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) {\ntable = new Entry[INITIAL_CAPACITY];//16 Entry\u662f\u7ee7\u627fWeakReference\nint i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);\ntable[i] = new Entry(firstKey, firstValue);\nsize = 1;\nsetThreshold(INITIAL_CAPACITY);\n}\n</code></pre> \u4ee5\u5f53\u524d\u7ebf\u7a0b\u4f5c\u4e3akey\u83b7\u5f97ThreadLocalMap\u5bf9\u8c61\uff0c\u5c06value(\u6b64\u5904\u65f6Looper\u5bf9\u8c61)\u4fdd\u5b58\u5230map\u4e2d\uff0c\u5176\u4e2dkey\u4e3athis\u5373Threadlocal <pre><code>public T get() {\nThread t = Thread.currentThread();\nThreadLocalMap map = getMap(t);\nif (map != null) {\nThreadLocalMap.Entry e = map.getEntry(this);\nif (e != null) {\n@SuppressWarnings(\"unchecked\")\nT result = (T)e.value;\nreturn result;\n}\n}\nreturn setInitialValue();\n}\n</code></pre> \u540c\u7406get\u4e5f\u662f\u5148\u901a\u8fc7\u5f53\u524d\u7ebf\u7a0b\u83b7\u5f97map\u518d\u901a\u8fc7this\u83b7\u53d6\u5bf9\u5e94Looper\u5bf9\u8c61</p>"},{"location":"android/fws/fws_handler/#new-handler","title":"\u4e3b\u7ebf\u7a0b\u4e3a\u4f55\u80fd\u76f4\u63a5new Handler","text":"<p>\u56e0\u4e3a\u5728Activitythread\u4e2d\u5df2\u7ecf\u521b\u5efa\u4e86Looper\u5bf9\u50cf <pre><code>Looper.prepareMainLooper()\n...\nLooper.loop()\n</code></pre> \u5728new Handler\u65f6\u80fd\u83b7\u53d6\u5230Looper\u5bf9\u8c61 <pre><code>mLooper = Looper.myLooper();\nif (mLooper == null) {\nthrow new RuntimeException(\n\"Can't create handler inside thread \" + Thread.currentThread()\n+ \" that has not called Looper.prepare()\");\n}\n</code></pre> \u5176\u4e2dmylooper\u65b9\u6cd5\u662f\u901a\u8fc7ThreadLocal\u4e2d\u53d6\u51faLooper\u5bf9\u8c61\uff0ckey\u4e3a\u7ebf\u7a0bThread\uff0cvalue\u65f6Looper\u5bf9\u8c61\uff0c\u56e0\u6b64\u4e3b\u7ebf\u7a0b\u80fd\u83b7\u53d6\u5230Looper</p>"},{"location":"android/fws/fws_handler/#handler","title":"\u5b50\u7ebf\u7a0b\u521b\u5efaHandler","text":"<p>\u65b9\u5f0f\u4e00\uff1a <pre><code>Thread {\nLooper.prepare()\nHandler(Looper.myLooper()!!) { msg: Message -&gt;\nfalse\n}\nLooper.loop()\n}.start()\n</code></pre> \u65b9\u5f0f\u4e8c\uff1a(\u63a8\u8350) <pre><code>val thread = HandlerThread(\"thread-\")\nthread.start()\nval handler = Handler(thread.looper){msg: Message -&gt;\nfalse\n}\n</code></pre></p>"},{"location":"android/fws/fws_handler/#handlerthread","title":"HandlerThread","text":"<p>\u5b8c\u5168\u7406\u89e3\u524d\u63d0\uff1a\u9700\u8981\u5b66\u4e60\u5e76\u53d1\u76f8\u5173\u77e5\u8bc6\u70b9</p> <p>\u5c01\u88c5\u4e86Looper\u548c\u52a0\u5165\u4e86\u5e76\u53d1\u5904\u7406</p>"},{"location":"android/fws/fws_handler/#_3","title":"\u6e90\u7801\u89e3\u6790","text":"<p>\u95ee\u98981\uff1a\u5fc5\u987b\u8981\u5148\u6267\u884cstart\u5417\uff1f\u4e0d\u9700\u8981\uff0cstart\u7684\u4f5c\u7528\u662fThread\u8c03\u7528start\u540e\u4f1a\u8c03\u7528run\u65b9\u6cd5\uff0c\u7136\u540e\u5c31\u6267\u884c\u529bLooper.prepare\u548cLooper.loop\uff0c\u4ece\u800c\u53ef\u4ee5\u901a\u8fc7getlooper()\u62ff\u5230looper\u5bf9\u8c61\u7ed9handler\uff0c\u5e76\u53d1\u539f\u7406\u5148\u770b\u95ee\u98982\u518d\u770b\u6e90\u7801\u6ce8\u91ca <pre><code>public void run() {\n...\nLooper.prepare();\nsynchronized (this) {\nmLooper = Looper.myLooper();\nnotifyAll();// \u4e3a\u5565\u4e0d\u662fnotify\uff1f\u56e0\u4e3agetlooper\u53ef\u80fd\u88ab\u591a\u4e2aHandler\u4f7f\u7528\u65f6\u8c03\u7528\uff0c\u9700\u8981\u5168\u90e8\u901a\u77e5\n// wait\u662f\u7acb\u523b\u6302\u8d77\u548c\u91ca\u653e\u9501\uff0cnotify\u662f\u9700\u8981\u7b49synchronized\u5305\u88f9\u7684\u6240\u6709\u4ee3\u7801\u6267\u884c\u5b8c\u6210\u624d\u91ca\u653e\u9501\uff0c\u6240\u4ee5\u4e0d\u662f\u8bf4notify\u4e86wait\u5c31\u7acb\u523b\u6267\u884c\uff0c\u800c\u662f\u901a\u77e5wait\u53ef\u4ee5\u51c6\u5907\u5c31\u7eea\n// notifyAll\u4ee3\u7801\u53ef\u4ee5\u8c03\u6362\u987a\u5e8f\uff0c\u53ea\u8981synchronized\u5305\u88f9\u8303\u56f4\u6548\u679c\u4e00\u81f4\n}\n...\nLooper.loop();\n...\n}\npublic Looper getLooper() {\n...\nsynchronized (this) {\nwhile (isAlive() &amp;&amp; mLooper == null) {// \u4e3a\u5565\u4e0d\u662fif\uff1f\u9632\u6b62\u5176\u4ed6\u5730\u65b9\u4e5f\u4f7f\u7528\u5e76\u91ca\u653e\u4e86this\u9501\uff0c\u800c\u6b64\u65f6looper\u53ef\u80fd\u4f9d\u7136\u662fnull\ntry {\nwait(); // \u6302\u8d77\uff0c\u91ca\u653e\u5bf9\u8c61\u9501\uff0c\u9632\u6b62\u4e07\u4e00\u6b64\u65b9\u6cd5\u5148\u6267\u884c\u62ff\u5230\u9501\uff0c\u9700\u8981\u5148\u91ca\u653e\u9501\u8ba9run\u4e2d\u62ff\u5230\u9501\n// sleep\uff1a\u6302\u8d77\uff0c\u4f46\u4e0d\u91ca\u653e\u9501\n} catch (InterruptedException e) {\nwasInterrupted = true;\n}\n}\n}\n...    return mLooper;\n}\n</code></pre> \u95ee\u98982\uff1a\u4e3a\u5565\u6e90\u7801\u4e2d\u9700\u8981\u7528\u5230synchronized\u540c\u6b65\u9501\u673a\u5236 \u56e0\u4e3a\u9700\u8981\u4fdd\u8bc1start\u540eHandler(thread.looper)\u80fd\u786e\u4fdd\u62ff\u5230looper\uff0cHandler\u521b\u5efa\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0c\u800clooper\u662f\u5728\u5b50\u7ebf\u7a0b\u4e2d\u521b\u5efa\uff0c\u4e0d\u52a0\u9501\u53ef\u80fd\u4f1a\u5bfc\u81f4looper\u4e3anull synchronized\uff1a\u5185\u7f6e\u9501\uff0c\u529f\u80fd\uff1a\u4e92\u65a5\u8bbf\u95ee\uff0c\u4f5c\u7528\u4e8e\u65b9\u6cd5\uff0c\u4ee3\u7801\u5757 \u5c0f\u6848\u4f8b\uff1a <pre><code>class A {\nfun method1() { synchronized(this){} }\nfun method2() { synchronized(this){} }\n}\nval a = A()\nval b = A()\na.method1()\na.method2()\nb.method1()\n</code></pre> a.method1()\u548ca.method2()\u662f\u4e92\u65a5\uff0c\u4e0d\u80fd\u540c\u65f6\u8c03\u7528\uff0c\u9501\u662fthis\u5373A\u5bf9\u8c61</p> <p>a.method1()\u548cb.method1()\u4e0d\u662f\u4e92\u65a5\uff0c\u9501\u662fthis\uff0c\u5206\u522b\u662fA\u548cB\u5bf9\u8c61</p> <p>\u95ee\u98983\uff1a\u5982\u679c\u4e0d\u8c03\u7528start\u4f1a\u5982\u4f55\uff1f\u4f1a\u62a5\u7a7a\u6307\u9488\u5f02\u5e38 <pre><code>public Looper getLooper() {\nif (!isAlive()) {\nreturn null;\n}\n...\n}\n</code></pre> isAlive\u7528\u6765\u5224\u65ad\u7ebf\u7a0b\u662f\u5426\u5df2\u7ecfstart <pre><code>public Handler(@NonNull Looper looper, @Nullable Callback callback, boolean async) {\nmLooper = looper;\nmQueue = looper.mQueue;\nmCallback = callback;\nmAsynchronous = async;\n}\n</code></pre> \u7531\u4e8egetlooper\u8fd4\u56denull\uff0c\u6240\u4ee5\u518d\u521b\u5efaHandler\u65f6\u4f1a\u62a5\u7a7a\u6307\u9488 \u5982\u679c\u6ca1\u6709isAlive()\u5904\u7406\u4f1a\u5982\u4f55\uff1f\u4e3b\u7ebf\u7a0b\u4f1a\u6302\u8d77\uff0c\u56e0\u4e3a\u6267\u884c\u4e86wait\uff0c\u5f53\u524d\u7ebf\u7a0b\u6ca1\u6709start\uff0c\u8c03\u7528\u8005\u662f\u4e3b\u7ebf\u7a0b\uff0c\u6240\u4ee5\u4f1a\u5c06\u4e3b\u7ebf\u7a0bwait\u6302\u8d77</p> <p>\u6ce8\uff1await\u4f1a\u91ca\u653e\u9501\uff0cCPU\uff0c\u8d44\u6e90\uff0c\u4f46\u4f1a\u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\uff1bsleep\u65e2\u4e0d\u91ca\u653e\u9501CPU\u8d44\u6e90\u4e5f\u4f1a\u6302\u8d77</p>"},{"location":"android/fws/fws_handler/#messagequeuehandler","title":"MessageQueue\u4e2d\u6dfb\u52a0\u6570\u636e\u65f6\uff0c\u5404\u4e2aHandler\u53ef\u80fd\u5904\u4e8e\u4e0d\u540c\u7ebf\u7a0b\uff0c\u5982\u4f55\u5904\u7406","text":"<p>\u6dfb\u52a0\u6570\u636eenqueueMessage()\uff1a\u5404\u4e2a\u5b50\u7ebf\u7a0b</p> <p>\u53d6\u51fa\u6570\u636enext()\uff1a\u4e3b\u7ebf\u7a0b</p> <p>\u90fd\u4f7f\u7528\u4e86synchronized(this)\uff0c\u524d\u8005\u9501\u53ef\u4ee5\u4fdd\u8bc1\u5404\u4e2a\u5b50\u7ebf\u7a0b\u6dfb\u52a0\u6570\u636e\u7ebf\u7a0b\u5b89\u5168\uff0c\u540e\u8005\u7528\u6765\u4fdd\u8bc1\u6570\u636e\u6dfb\u52a0\u548c\u53d6\u51fa\u7ebf\u7a0b\u5b89\u5168</p>"},{"location":"android/fws/fws_handler/#messagenew","title":"Message\u5bf9\u8c61\u83b7\u53d6\u65b9\u5f0f\uff0c\u662f\u5426\u53ef\u4ee5\u76f4\u63a5new","text":"<p>\u4e0d\u63a8\u8350\u76f4\u63a5new\uff0c\u4f7f\u7528Handler.obtainMessage\u65b9\u5f0f</p> <p>\u539f\u56e0\uff1a\u5728GC\u56de\u6536\u5bf9\u8c61\u65f6\u5b58\u5728stw\u673a\u5236\u8ba9\u6240\u6709\u7ebf\u7a0b\u77ed\u6682\u505c\u4e00\u4e0b\uff0c\u5982\u679cstw\u8fc7\u4e8e\u9891\u7e41\u4f1a\u5bfc\u81f4\u5361\u987f\u3002\u800cobtainMessage\u65b9\u5f0f\u4f18\u5316\u5185\u5b58\u6296\u52a8\u95ee\u9898</p> <p>\u8bbe\u8ba1\u6a21\u5f0f\uff1a\u4eab\u5143\u8bbe\u8ba1\u6a21\u5f0f</p>"},{"location":"android/fws/fws_handler/#looperanr","title":"Looper\u6b7b\u5faa\u73af\u4e3a\u5565\u4e0d\u4f1aANR","text":"<p><pre><code>for (;;) {\nif (!loopOnce(me, ident, thresholdOverride)) {\nreturn;\n}\n}\n</code></pre> \u9700\u8981\u7406\u89e3ANR\u4ea7\u751f\u539f\u7406</p>"},{"location":"android/fws/fws_handler/#epoll","title":"epoll","text":"<p>\u7528\u6765\u7ba1\u7406IO\u963b\u585e\u7684\u673a\u5236</p> <p>\u573a\u666f\uff1a\u6709n\u4e2aIO\u4e8b\u4ef6\u9700\u8981\u540c\u65f6\u5904\u7406 <pre><code>while(true){\n//select(stream[])\nfor(i in stream[]){\nxxx    }\n}\n</code></pre> \u7f3a\u9677\uff1a\u5982\u679c\u6d41\u91cc\u9762\u6ca1\u6709\u6570\u636e\u65f6\uff0c\u4f1a\u6d6a\u8d39CPU\u8d44\u6e90</p> <p>\u6dfb\u52a0select\u540e\uff0c\u5f53\u6d41\u91cc\u9762\u6709\u6570\u636e\u9700\u8981\u5904\u7406\u65f6\u4f1a\u5524\u9192CPU\u6267\u884cfor\u5faa\u73af</p> <p>\u7f3a\u9677\uff1a\u65e0\u6cd5\u5f97\u77e5\u90a3\u4e9b\u6d41\u9700\u8981\u5904\u7406</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898epoll\u767b\u573a <pre><code>while(true){\nactive_stream[] = epoll_wait()\nfor(i in active_stream[]){\nxxx    }\n}\n</code></pre> \u5f53\u6709\u6d41\u9700\u8981\u5904\u7406\u6570\u636e\u65f6\u5c06\u5176\u5b58\u5230stream\u4e2d\uff0c\u5927\u5927\u51cf\u5c11\u65f6\u95f4\u590d\u6742\u5ea6O(n)-&gt;O(1)</p>"},{"location":"android/fws/fws_handler/#android","title":"Android\u6e90\u7801\u4e2d\u5e94\u7528","text":"<p><pre><code>Message next() {\n...\nint nextPollTimeoutMillis = 0;\nfor (;;) {\n...\nnativePollOnce(ptr, nextPollTimeoutMillis);\nsynchronized (this) {\nfinal long now = SystemClock.uptimeMillis();\nMessage prevMsg = null;\nMessage msg = mMessages;\n...\nif (msg != null) {\nif (now &lt; msg.when) {\nnextPollTimeoutMillis = (int) Math.min(msg.when - now, Integer.MAX_VALUE);\n} else {\n...\n}\n} else {\nnextPollTimeoutMillis = -1;\n}\n...\n}\n...\nnextPollTimeoutMillis = 0;\n}\n}\n</code></pre> nextPollTimeoutMillis: \u6570\u503c\u4e3a0\u65f6\u4f1a\u7acb\u5373\u8fd4\u56de\uff0c-1\u4e0d\u786e\u5b9a\uff0c\u5177\u4f53\u65f6\u95f4\u5373\u7b49\u5f85\u8ba1\u65f6\u540e\u8fd4\u56de</p> <p>\u5524\u9192\u5728enqueueMessage\u65b9\u6cd5\u4e2dnativeWake</p>"},{"location":"android/fws/fws_handler/#_4","title":"\u6d88\u606f\u5c4f\u969c","text":"<p>\u4f5c\u7528\uff1a\u4e3aUI\u5237\u65b0\u201c\u5f00\u7eff\u706f\u201d\uff0c\u63d0\u9ad8\u4f18\u5148\u7ea7</p> <p>\u6d88\u606f\u5206\u4e3a\uff1a\u6d88\u606f\u5c4f\u969c\uff0c\u5f02\u6b65\u6d88\u606f\uff0c\u540c\u6b65\u6d88\u606f</p> <p>\u6d88\u606f\u5c4f\u969c\uff1atarget\u4e3anull\uff0cpostSyncBarrier(ViewRootImpl\u5237\u65b0UI\u65f6\u8c03\u7528)</p> <p>\u6d88\u606f\u5c4f\u969c\u548c\u5f02\u6b65\u6d88\u606f\u80af\u5b9a\u6210\u5bf9\u51fa\u73b0\uff0c\u56e0\u4e3a\u53ea\u80fdframework\u8c03\u7528\u4e14\u76ee\u524d\u53ea\u5728ViewRootimpl\u4e2d\u4f7f\u7528 <pre><code>void scheduleTraversals() {\nif (!mTraversalScheduled) {\nmTraversalScheduled = true;\nmTraversalBarrier = mHandler.getLooper().getQueue().postSyncBarrier();\nmChoreographer.postCallback(\nChoreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\n//\u5f53\u6267\u884cmTraversalRunnable\u65f6run\u4e2d\u4f1a\u79fb\u9664\u6d88\u606f\u5c4f\u969c\n//mHandler.getLooper().getQueue().removeSyncBarrier(mTraversalBarrier);\nnotifyRendererOfFramePending();\npokeDrawLockIfNeeded();\n}\n}\n@hide//\u4ec5\u9650\u7cfb\u7edf\u8c03\u7528\npublic int postSyncBarrier() {\nreturn postSyncBarrier(SystemClock.uptimeMillis());\n}\nprivate int postSyncBarrier(long when) {\nsynchronized (this) {\n...\nfinal Message msg = Message.obtain();\n...\nMessage p = mMessages;//mMessages\u53d8\u91cf\u4fdd\u5b58\u4e4b\u524d\u7684\u6d88\u606f\n...\nmsg.next = p;//\u653e\u5230\u6d88\u606f\u5c4f\u969cmsg\u540e\u9762\nmMessages = msg;//mMessages\u53d8\u91cf\u8d4b\u503c\u6210\u6d88\u606f\u5c4f\u969cmsg\n...\nreturn token;\n}\n}\n//mChoreographer.postCallback\u6700\u7ec8\u8c03\u7528\nprivate void postCallbackDelayedInternal(int callbackType,\nObject action, Object token, long delayMillis) {\n...\nscheduleFrameLocked(now);\n...\n}\n}\nprivate void scheduleFrameLocked(long now) {\nif (!mFrameScheduled) {\nmFrameScheduled = true;\nif (USE_VSYNC) { // 4.1\u7cfb\u7edf\u540e\u9ed8\u8ba4\u4e3atrue\n...\nscheduleVsyncLocked();\n...\n} else {\n...\n}\n}\n}\nscheduleVsyncLocked\u8c03\u7528native\u6700\u7ec8\u8c03\u7528FrameDisplayEventReceiver(Runnable)\u7684onVsync\npublic void onVsync(long timestampNanos, long physicalDisplayId, int frame,\nVsyncEventData vsyncEventData) {\n....\nMessage msg = Message.obtain(mHandler, this);\nmsg.setAsynchronous(true);//\u5f02\u6b65\u6d88\u606f\nmHandler.sendMessageAtTime(msg, timestampNanos / TimeUtils.NANOS_PER_MS);\n...\n}\n</code></pre> \u6d88\u606f\u5c4f\u969c\u4f1a\u6dfb\u52a0\u5230Message\u6700\u5f00\u59cb\u5904\uff0c\u7136\u540emChoreographer\u7684msg\u653e\u5728\u5176\u540e</p> <p>\u6d88\u606f\u5c4f\u969c\u6dfb\u52a0\u5230\u5934\u90e8\u8fbe\u5230\u4fdd\u8bc1UI\u5237\u65b0\u4f18\u5148\u7ea7\uff0c\u5728next\u65b9\u6cd5\u4e2d <pre><code>Message prevMsg = null;\nMessage msg = mMessages;\nif (msg != null &amp;&amp; msg.target == null) { // \u6d88\u606f\u5c4f\u969ctarget\u672a\u8bbe\u7f6e\u56e0\u6b64\u4e3anull\n// Stalled by a barrier.  Find the next asynchronous message in the queue.\ndo {\nprevMsg = msg;\nmsg = msg.next;\n} while (msg != null &amp;&amp; !msg.isAsynchronous());// Choreographer\u53d1\u9001\u7684\u6d88\u606f\u8bbe\u7f6e\u4e3atrue\n}\n</code></pre> \u6ce8\uff1a\u6d88\u606f\u5c4f\u969c\u53ea\u80fd\u5c3d\u53ef\u80fd\u4fdd\u8bc1UI\u5237\u65b0\u4f18\u5148\uff0c\u6240\u4ee5\u4f1a\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898 \u5e38\u89c1\u5f15\u53d1\u7684\u95ee\u9898(log\u5728Choreographer\u4e2d\u6267\u884crun\u65b9\u6cd5\u540e\u8c03\u7528doFrame) Skipped xx frames!  The application may be doing too much work on its main thread \u539f\u56e0\uff1a\u521a\u597d\u5728Choreographer\u4e4b\u524d\u5b58\u5728\u5176\u4ed6\u5f02\u6b65\u6d88\u606f(isAsynchronous=true)\uff0c\u5bfc\u81f4while\u5faa\u73af\u904d\u5386\u8017\u65f6\u6216\u8005\u5f02\u6b65\u6d88\u606f\u5904\u7406\u8017\u65f6</p>"},{"location":"android/fws/fws_handler/#idlehandler","title":"Idlehandler","text":"<p>\u7279\u6b8a\u7684Message\uff0c\u4f18\u5148\u7ea7\uff1a\u5f02\u6b65Msg&gt;\u540c\u6b65Msg&gt;idlehandler</p> <p>\u6267\u884c\u524d\u63d0\uff1a\u6ca1\u6709Msg\u9700\u8981\u5904\u7406</p> <p>\u4f7f\u7528\u573a\u666f\uff1a\u7ebf\u7a0b\u7a7a\u95f2\u7684\u65f6\u5019</p> <p>Activity\u542f\u52a8\u751f\u547d\u5468\u671f\u4e2d\u6bd4\u8f83\u8017\u65f6\u7684\u64cd\u4f5c(\u6848\u4f8b\u5728ActivityThread\u4e2d\u7684handleResumeActivity\u6700\u540e)</p>"},{"location":"android/fws/fws_mk_bp/","title":"\u5c0f\u529f\u80fd","text":""},{"location":"android/fws/fws_mk_bp/#apk","title":"\u5185\u7f6eapk\u5230\u7cfb\u7edf","text":"<p>\u7f16\u5199mk\u6587\u4ef6\uff0c\u5c06gradle\u7f16\u8bd1\u51fa\u6765\u7684apk\u91cd\u65b0\u524d\u9762\u6253\u5305\u6210\u7cfb\u7edfapk <pre><code>LOCAL_PATH:=$(call my-dir)\ninclude $(CLEAR_VARS)\nLOCAL_SRC_FILES := build/outputs/apk/release/myapp-release.apk\nLOCAL_MODULE_CLASS := APPS\n#\u53ef\u4ee5\u4e3auser\u3001eng\u3001tests\u3001optional\uff0coptional\u4ee3\u8868\u5728\u4efb\u4f55\u7248\u672c\u4e0b\u90fd\u7f16\u8bd1\nLOCAL_MODULE_TAGS := optional\n#\u7f16\u8bd1\u6a21\u5757\u7684\u540d\u79f0\nLOCAL_MODULE := MyApp\n#\u53ef\u4ee5\u4e3atestkey\u3001platform\u3001shared\u3001media\u3001PRESIGNED\uff08\u4f7f\u7528\u539f\u7b7e\u540d\uff09\uff0cplatform\u4ee3\u8868\u4e3a\u7cfb\u7edf\u5e94\u7528\nLOCAL_CERTIFICATE := platform\n#\u4e0d\u8bbe\u7f6e\u6216\u8005\u8bbe\u7f6e\u4e3afalse\uff0c\u5b89\u88c5\u4f4d\u7f6e\u4e3asystem/app\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3atrue\uff0c\u5219\u5b89\u88c5\u4f4d\u7f6e\u4e3asystem/priv-app\nLOCAL_PRIVILEGED_MODULE := false\n#module\u7684\u540e\u7f00\uff0c\u53ef\u4e0d\u8bbe\u7f6e\nLOCAL_MODULE_SUFFIX := $(COMMON_ANDROID_PACKAGE_SUFFIX)\n# \u5173\u95ed\u9884\u7f16\u8bd1\uff0c\u4e0d\u4f1a\u751f\u6210OAT\u6587\u4ef6\nLOCAL_DEX_PREOPT := true\nLOCAL_PRODUCT_MODULE := false\ninclude $(BUILD_PREBUILT)\n</code></pre> LOCAL_PRODUCT_MODULE\u4e3atrue\u4ea7\u51fa\u76ee\u5f55\u5728/product/\uff0c\u5426\u5219\u5728/system/\u4e0b</p> <p>\u7cfb\u7edf\u5e94\u7528\u767d\u540d\u5355\uff0c\u7f16\u8bd1\u955c\u50cf\u65f6\u5305\u542b\u81ea\u5df1\u7684apk\uff0c\u6700\u7ec8\u7f16\u8bd1\u6210system/app/Myapp</p> <p>build/make/target/product/handheld_system.mk <pre><code>PRODUCT_PACKAGES += \\\n    MyApp \\\n\nPRODUCT_SYSTEM_SERVER_APPS += \\\n    MyApp \\\n</code></pre></p> <p>\u5982\u679c\u60f3\u7f16\u8bd1\u5230\u5176\u4ed6\u76ee\u5f55handheld_product.mk\u548chandheld_system_ext.mk</p> <p>\u53c2\u8003\uff1ahttps://blog.csdn.net/etrospect/article/details/128235015</p>"},{"location":"android/fws/fws_mk_bp/#_1","title":"\u8f93\u5165\u6cd5\u5185\u7f6e","text":"<p>\u53c2\u8003\uff1ahttps://www.jianshu.com/p/e782897c6ab8</p> <p>frameworks/base/services/core/java/com/android/server/InputMethodManagerService.java</p> <p>buildInputMethodListLocked\u65b9\u6cd5\u589e\u52a0\u4ee5\u4e0b\u4ee3\u7801(\u5f85\u786e\u8ba4) <pre><code>// \u5185\u7f6e\u641c\u72d7\u8f93\u5165\u6cd5\nString defaultIme = Settings.Secure.getString(mContext.getContentResolver(),\nSettings.Secure.DEFAULT_INPUT_METHOD);\nif (defaultIme == null) {\ntry {\nSettings.Secure.putString( mContext.getContentResolver(),\nSettings.Secure.DEFAULT_INPUT_METHOD, \"com.sohu.inputmethod.sogou/.SogouIME\");\n} catch (Exception e) {\n}\n}\n</code></pre></p> <ul> <li>\u767e\u5ea6\uff1acom.baidu.input/.ImeService</li> <li>\u8baf\u98de\uff1acom.iflytek.inputmethod/.FlyIME</li> <li>\u817e\u8baf\uff1acom.tencent.qqpinyin/.QQPYInputMethodService</li> <li>\u8c37\u6b4c\uff1acom.google.android.inputmethod.pinyin/.PinyinIME</li> <li>\u641c\u72d7\uff1acom.sohu.inputmethod.sogou/.SogouIME</li> <li>\u89e6\u5b9d\uff1acom.cootek.smartinput5/.TouchPalIM</li> </ul> <p>\u9488\u5bf9LOCAL_PREBUILT_JNI_LIBS := \\</p> <p>\u53ef\u4f7f\u7528\u547d\u4ee4\u5c06\u5f53\u524d\u6587\u4ef6\u5939\u4e0b\u7684so\u6587\u4ef6\u540d\u5230\u6587\u672c\u4e2d\uff0c\u6279\u91cf\u5c06#\u66ff\u6362\u6389\u5373\u53ef <pre><code>find \"$(pwd)\" -type f -printf \"%p#\\n\" &gt; fullpaths.txt\n</code></pre> \u767e\u5ea6\u8f93\u5165\u6cd5\u7f16\u8bd1\u62a5\u9519\u89e3\u51b3\uff1a</p> <p>bp\u6587\u4ef6\u4e2d\u6dfb\u52a0 <pre><code>LOCAL_ENFORCE_USES_LIBRARIES := false\n</code></pre> \u66f4\u591a\u6821\u9a8c\u67e5\u770b\u5b98\u65b9\u6587\u6863\uff1ahttps://source.android.google.cn/devices/tech/dalvik/art-class-loader-context?hl=zh-cn</p>"},{"location":"android/fws/fws_mk_bp/#staap","title":"\u5f00\u542fSta\u548cAp\u5e76\u53d1","text":"<p>wifi\u6a21\u7ec4\uff1a\u6b63\u57faAP6275\u7cfb\u5217 \u6a21\u7ec4\u652f\u6301STA+AP\u5e76\u53d1</p> <p>device/xxx/BoardConfig.mk\u4e2d\u6dfb\u52a0\u6807\u5fd7\u4f4d <pre><code>WIFI_HIDL_FEATURE_DUAL_INTERFACE:=true\n</code></pre></p> <p>kernel-5.10/drivers/net/wireless/rockchip_wlan/rkwifi/bcmdhd/Makefile\u5f00\u653e <pre><code>CONFIG_BCMDHD_STATIC_IF :=y\n\nifeq ($(CONFIG_BCMDHD_STATIC_IF),y)\n    DHDCFLAGS += -DWL_STATIC_IF\nendif\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#_2","title":"\u8bbe\u5907\u5f3a\u5236\u6a2a\u5c4f","text":"<p>\u9002\u7528\u4e8eAndroid11\u4ee5\u4e0a</p> <p>https://blog.csdn.net/u011774634/article/details/125508483</p> <p>frameworks/base/services/core/java/com/android/server/wm/DisplayContent.java <pre><code>int getOrientation() {\nif (true) {\nreturn SCREEN_ORIENTATION_LANDSCAPE;\n}\n//...\n}\n</code></pre></p> <p>frameworks/base/services/core/java/com/android/server/wm/DisplayRotation.java <pre><code>boolean updateRotationUnchecked(boolean forceUpdate) {\nif (true) {\nreturn true;\n}\n//...\n}\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#_3","title":"\u4fee\u6539\u9ed8\u8ba4\u8bed\u8a00","text":"<p>\u6e90\u7801\u8def\u5f84\uff1abuild/tools/buildinfo.sh <pre><code>echo \"persist.sys.language=zh\"\necho \"persist.sys.country=CN\"\necho \"persist.sys.localevar=\"\necho \"persist.sys.timezone=Asia/Shanghai\"\necho \"ro.product.locale.language=zh\"\necho \"ro.product.locale.region=CN\"\n</code></pre></p> <p>\u6e90\u7801\u8def\u5f84\uff1adevice/\u7cfb\u7edf\u54c1\u724c/\u7cfb\u7edf\u578b\u53f7/device.mk <pre><code>PRODUCT_LOCALES := zh_CN\n</code></pre> \u6e90\u7801\u8def\u5f84\uff1abuild/make/target/product/languages_default.mk\u5c06\u4e2d\u6587(zh_CN)\u653e\u5230\u6700\u524d\u9762 <pre><code>PRODUCT_LOCALES := \\\n        zh_CN \\\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#framework","title":"framework\u6e90\u7801\u6dfb\u52a0\u63a5\u53e3","text":""},{"location":"android/fws/fws_mk_bp/#_4","title":"\u95ee\u9898","text":"<p>\u4ee5View\u6e90\u7801\u4e2d\u6dfb\u52a0\u5c5e\u6027\u4e3a\u4f8b <pre><code>public class View implements xxx {\n// ...\n// \u6dfb\u52a0\u5c5e\u6027\nboolean mEnablePressedAnim;\n// ...\n}\n</code></pre> \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e09\u65b9\u5e94\u7528\u901a\u8fc7\u53cd\u5c04\u6dfb\u52a0\u4f1a\u62a5 <pre><code>Accessing hidden field Landroid/view/View;-&gt;mEnablePressedAnim:Z (blocked, reflection, denied)\n</code></pre> \u53cd\u5c04\u4ee3\u7801 <pre><code>private fun fieldChange(view: View, isEnable: Boolean) {\ntry {\nval field = View::class.java.getDeclaredField(\"mEnablePressedAnim\")\nfield.isAccessible = true\nfield.setBoolean(view, isEnable)\n} catch (e: Exception) {\ne.printStackTrace()\n}\n}\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#_5","title":"\u539f\u56e0\u548c\u4f5c\u7528","text":"<p>\u662fgoogle\u5bf9\u975eSDK\u7684api\u8fdb\u884c\u540d\u5355\u9650\u5236</p> <p>https://developer.android.google.cn/guide/app-compatibility/restrictions-non-sdk-interfaces?hl=bg</p> <p>\u9664\u4e86\u5230\u5904csv\u67e5\u770bapi\u540d\u5355\u6807\u8bb0\uff0c\u8fd8\u53ef\u4ee5\u53cd\u7f16\u8bd1\u5f97\u5230smali\u6587\u4ef6\u67e5\u770b <pre><code>.field blacklist mEnablePressedAnim:Z\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#_6","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>\u4e3a\u4e86\u5141\u8bb8\u4e09\u65b9\u5e94\u7528\u8c03\u7528\u6216\u53cd\u5c04\u8c03\u7528</p>"},{"location":"android/fws/fws_mk_bp/#_7","title":"\u4e34\u65f6\u65b9\u6848","text":"<pre><code>adb shell settings put global hidden_api_policy 1\n</code></pre>"},{"location":"android/fws/fws_mk_bp/#aosp12","title":"\u6c38\u4e45\u65b9\u6848\u4e4baosp12\u53ca\u4ee5\u4e0a","text":"<p>\u6e90\u7801\u6587\u4ef6\uff1abuild/soong/apex/platform_bootclasspath_test.go</p> <p>\u641c\u7d22TestPlatformBootclasspath_Fragments platform_bootclasspath\u4e0b\u7684 <pre><code>hidden_api: {\n// ...\nunsupported_packages: [\n\"unsupported-packages.txt\",\n],\n//\u6dfb\u52a0\u4ee5\u4e0b\nsdk: [\n\"sdk.txt\",\n],\n},\n</code></pre> bootclasspath_fragment\u4e0b\u7684 <pre><code>hidden_api: {\n// ...\nunsupported_packages: [\n\"bar-unsupported-packages.txt\",\n],\n//\u6dfb\u52a0\u4ee5\u4e0b\nsdk: [\n\"bar-sdk.txt\",\n],\n},\n</code></pre> \u6e90\u7801\u6587\u4ef6\uff1abuild/soong/java/hidenapi_modular.go</p> <p>\u641c\u7d22type HiddenAPIFlagFileProperties struct <pre><code>Unsupported_packages []string `android:\"path\"`\n//\u6dfb\u52a0\u4ee5\u4e0b\nSdk []string `android:\"path\"`\n</code></pre> \u641c\u7d22[]*hiddenAPIFlagFileCategory <pre><code>{\nPropertyName: \"unsupported_packages\",\npropertyValueReader: func(properties *HiddenAPIFlagFileProperties) []string {\nreturn properties.Unsupported_packages\n},\ncommandMutator: func(command *android.RuleBuilderCommand, path android.Path) {\ncommand.FlagWithInput(\"--unsupported \", path).Flag(\"--packages \")\n},\n},\n//\u6dfb\u52a0\u4ee5\u4e0b\n{\nPropertyName: \"sdk\",\npropertyValueReader: func(properties *HiddenAPIFlagFileProperties) []string {\nreturn properties.Sdk\n},\ncommandMutator: func(command *android.RuleBuilderCommand, path android.Path) {\ncommand.FlagWithInput(\"--sdk \", path)\n},\n},\n</code></pre> \u6e90\u7801\u8def\u5f84: framework/base/boot/hiddenapi/</p> <p>\u6dfb\u52a0\u6587\u4ef6hiddenapi-sdk.txt\uff0c\u6dfb\u52a0\u9700\u8981\u66b4\u9732\u7684\u63a5\u53e3\u5c5e\u6027\u7b49\uff0c\u5982View\u4e2d\u6dfb\u52a0\u5c5e\u6027boolean mEnablePressedAnim\u5219\u5bf9\u5e94\u6dfb\u52a0 <pre><code>Landroid/view/View;-&gt;mEnablePressedAnim:Z\n</code></pre> \u6e90\u7801\u6587\u4ef6\uff1aframework/base/boot/Android.bp <pre><code>unsupported_packages: [\n    \"hiddenapi/hiddenapi-unsupported-packages.txt\",\n],\n//\u6dfb\u52a0\u4ee5\u4e0b\nsdk: [\n    \"hiddenapi/hiddenapi-sdk.txt\",\n],\n</code></pre> \u6267\u884c\u547d\u4ee4\uff1a <pre><code>m api-stubs-docs-non-updatable-update-current-api\nm -j20\n</code></pre></p>"},{"location":"android/fws/fws_mk_bp/#aosp11","title":"\u6c38\u4e45\u65b9\u6848\u4e4baosp11\u53ca\u4ee5\u4e0b","text":"<p>\u6e90\u7801\u6587\u4ef6\uff1a \u76f4\u63a5\u6dfb\u52a0\u5305\u540d\u8fc7\u6ee4</p> <p>framework/base/config/hiddenapi-greylist-packages.txt</p> <p>\u901a\u8fc7\u6dfb\u52a0\u5177\u4f53\u5c5e\u6027\u6216\u65b9\u6cd5\u8fc7\u6ee4</p> <p>framework/base/config/hiddenapi-greylist.txt</p> <p>\u6216\u8005 \u6e90\u7801\u6587\u4ef6\uff1a/build/soong/java/hiddenapi_singleton.go <pre><code>FlagWithInput(\"--greylist-packages \",\nandroid.PathForSource(ctx, \"frameworks/base/config/hiddenapi-greylist-packages.txt\")).\n//\u6dfb\u52a0\u4ee5\u4e0b\nFlagWithInput(\"--whitelist \",\nandroid.PathForSource(ctx, \"frameworks/base/config/hiddenapi-sdk.txt\")).\n</code></pre> \u5bf9\u5e94\u8def\u5f84\u6dfb\u52a0\u6587\u4ef6hiddenapi-sdk.txt</p>"},{"location":"android/fws/fws_mk_bp/#_8","title":"\u7a97\u53e3\u6a21\u7cca","text":"<p>\u5bf9\u4e8eAndroid12\u5f00\u542f\u7cfb\u7edf\u7a97\u53e3\u6a21\u5f0f</p> <p>/device/\u8bbe\u5907/\u578b\u53f7/xxx.mk PRODUCT_PROPERTY_OVERRIDES += \\        ro.surface_flinger.supports_background_blur=1 </p>"},{"location":"android/fws/fws_process/","title":"IPC\u901a\u4fe1","text":""},{"location":"android/fws/fws_process/#_1","title":"\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u6848","text":"<p>\u7ba1\u9053\u3001\u4fe1\u53f7\u3001\u4fe1\u53f7\u91cf\u3001\u5185\u5b58\u5171\u4eab\u3001socket\u3001binder\u3001\u6d88\u606f\u961f\u5217</p> <p>\u7528\u6237\u7a7a\u95f4\u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\u57fa\u672c\u91c7\u7528binder</p> <p>\u865a\u62df\u5185\u5b58\u5206\u4e3a\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\uff0c\u5f7c\u6b64\u9694\u79bb</p> <p>\u7528\u6237\u7a7a\u95f4\uff1a\u7a0b\u5e8f\u4ee3\u7801\u8fd0\u884c\u7684\u5730\u65b9</p> <p>\u5185\u6838\u7a7a\u95f4\uff1a\u5185\u6838\u4ee3\u7801\u8fd0\u884c\u7684\u5730\u65b9\uff0c\u6240\u6709\u8fdb\u7a0b\u5171\u4eab</p> <p>\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u672c\u8d28\uff1a\u5185\u5b58\u62f7\u8d1d</p>"},{"location":"android/fws/fws_process/#_2","title":"\u7ba1\u9053","text":"<p>unix\u6700\u53e4\u8001\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f\uff0c\u7531\u5185\u6838\u7ba1\u7406\u4e00\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684\u7f13\u51b2\u533a\uff0c\u4e00\u7aef\u8fde\u63a5\u8fdb\u7a0b\u7684\u8f93\u51fa\uff0c\u53e6\u4e00\u7aef\u8fde\u63a5\u8fdb\u7a0b\u7684\u8f93\u5165</p> <p>\u9650\u5236</p> <ol> <li>\u5927\u5c0f\u9650\u52364k</li> <li>\u534a\u53cc\u5de5\uff0c\u540c\u4e00\u65f6\u523b\u6570\u636e\u53ea\u80fd\u6d41\u5411\u4e00\u4e2a\u65b9\u5411\uff0c\u9700\u8981\u5efa\u7acb\u4e24\u4e2a\u7ba1\u9053</li> <li>\u53ea\u652f\u6301\u7236\u5b50\u548c\u5144\u5f1f\u8fdb\u7a0b\u4e4b\u95f4\u901a\u4fe1</li> </ol>"},{"location":"android/fws/fws_process/#_3","title":"\u4fe1\u53f7","text":"<p>\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u6ce8\u518cSIGNALQUIT\u4fe1\u53f7\u5b9e\u73b0\u76d1\u542cANR</p>"},{"location":"android/fws/fws_process/#_4","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u7231\u5947\u827axCrash\u3001\u53cb\u76df+U-APM\u3001\u817e\u8bafMatrix</p>"},{"location":"android/fws/fws_process/#_5","title":"\u4fe1\u53f7\u91cf","text":"<p>\u8ba1\u6570\u5668\uff0c\u63a7\u5236\u591a\u4e2a\u8fdb\u7a0b\u5171\u4eab\u8d44\u6e90\u8bbf\u95ee\uff0c\u4e3b\u8981\u7528\u4e8e\u8fdb\u7a0b\u95f4\u4ee5\u53ca\u540c\u4e00\u8fdb\u7a0b\u5185\u4e0d\u540c\u7ebf\u7a0b\u4e4b\u95f4\u7684\u540c\u6b65\u624b\u6bb5</p>"},{"location":"android/fws/fws_process/#_6","title":"\u5171\u4eab\u5185\u5b58","text":"<p>Android\u4e2d\u63d0\u4f9b\u533f\u540d\u5171\u4eab\u5185\u5b58Ashmem\uff0c\u5b58\u5728\u4e92\u65a5\u9501\uff0c\u5bb9\u6613\u51fa\u73b0\u6570\u636e\u4e0d\u540c\u6b65\uff0c\u6b7b\u9501\u7b49\u95ee\u9898</p> <p>\u6b65\u9aa4</p> <ol> <li>\u901a\u8fc7MemoryFile\u5f00\u8f9f\u5185\u5b58\u7a7a\u95f4\uff0c\u83b7\u5f97ParcelFileDescriptor <pre><code>val memoryFile = MemoryFile(\"test\", 1024)\nval getFileDescriptor = MemoryFile::class.java.getDeclaredMethod(\"getFileDescriptor\")\nval pfd = getFileDescriptor.invoke(memoryFile)?.let {\nParcelFileDescriptor.dup(it as FileDescriptor)\n}\n</code></pre></li> <li>\u5c06ParcelFileDescriptor\u4f20\u9012\u7ed9\u5176\u4ed6\u8fdb\u7a0b\uff0c\u5229\u7528Binder\u673a\u5236</li> <li>A\u8fdb\u7a0b\u5f80\u5185\u5b58\u5171\u4eab\u5199\u6570\u636e <pre><code>memoryFile.outputStream.write(byteArrayOf(1,2,3))\n</code></pre></li> <li>B\u8fdb\u7a0b\u5f80\u5185\u5b58\u5171\u4eab\u8bfb\u53d6\u6570\u636e <pre><code>pfd?.let {\nval content = byteArrayOf()\nFileInputStream(it.fileDescriptor).read(content)\n}\n</code></pre></li> </ol>"},{"location":"android/fws/fws_process/#_7","title":"\u5e94\u7528\u573a\u666f","text":"<p>Android\u89c6\u56fe\u6570\u636e\u4e0eSurfaceFlinger\u7684\u901a\u4fe1\u3001\u817e\u8bafmmkv\u3001Facebook fresco\u7b49</p>"},{"location":"android/fws/fws_process/#_8","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u5177\u6709\u5f02\u6b65\u80fd\u529b\uff0c\u89e3\u51b3\u4fe1\u53f7\u627f\u8f7d\u4fe1\u606f\u5c11\u95ee\u9898\uff0c\u5177\u6709\u4f20\u8f93\u80fd\u529b\uff0c\u514b\u670d\u7ba1\u9053\u53ea\u80fd\u627f\u8f7d\u65e0\u683c\u5f0f\u5b57\u8282\u6d41\u4ee5\u53ca\u7f13\u51b2\u533a\u5927\u5c0f\u53d7\u9650\u95ee\u9898</p>"},{"location":"android/fws/fws_process/#_9","title":"\u5e94\u7528\u573a\u666f","text":"<p>Android\u4e2d\u7684Handler\u4f7f\u7528\u5230\u6d88\u606f\u961f\u5217</p>"},{"location":"android/fws/fws_process/#socket","title":"Socket","text":"<p>\u4f20\u8f93\u6548\u7387\u4f4e\uff0c\u5f00\u9500\u5927</p>"},{"location":"android/fws/fws_process/#_10","title":"\u5e94\u7528\u573a\u666f","text":"<p>Zygote\u8fdb\u7a0b\u4f7f\u7528LocalSocket\u63a5\u6536\u542f\u52a8\u5e94\u7528\u7684\u901a\u77e5</p> <p>\u66f4\u591aSocket\u77e5\u8bc6</p>"},{"location":"android/fws/fws_process/#binder","title":"Binder","text":""},{"location":"android/fws/fws_process/#_11","title":"\u5e94\u7528\u573a\u666f","text":"<p>Android\u4e2dsystem_server\u4e0e\u4e0a\u5c42app\u4ea4\u4e92\u3001Intent\u3001ContentProvider\u3001AIDL\u3001Broadcast\u3001Messager\u7b49</p> <p>\u9009\u62e9Binder\u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7684IPC\u7684\u539f\u56e0</p> <ol> <li>\u6027\u80fd\u4e0a\uff0c\u8de8\u8fdb\u7a0b\u901a\u4fe1\u6570\u636e\u62f7\u8d1d\uff0c\u5185\u5b58\u5171\u4eab(0\u6b21)&gt;Binder(1\u6b21)&gt;\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001Socket(2\u6b21)</li> <li>Binder\u62e5\u6709\u53ef\u9760\u7684\u8eab\u4efd\u6807\u8bb0\u7b56\u7565\uff0c\u4f20\u7edfIPC\u662f\u7531\u7528\u6237\u586b\u5199UID/PID\u5bb9\u6613\u88ab\u6076\u610f\u7a0b\u5e8f\u5229\u7528\uff0cBinder\u4e3a\u6bcf\u4e2aapp\u5206\u914dUID\uff0c\u901a\u8fc7UID\u9274\u522b\u8eab\u4efd</li> <li>Binder\u57fa\u4e8eC/S\u67b6\u6784\uff0c\u804c\u8d23\u660e\u786e\u3001\u67b6\u6784\u6e05\u6670\uff0c\u7a33\u5b9a\u6027\u66f4\u597d</li> </ol>"},{"location":"android/fws/fws_process/#ipc","title":"\u4f20\u7edfIPC\u539f\u7406","text":""},{"location":"android/fws/fws_process/#binder_1","title":"Binder\u539f\u7406","text":"<p>Binder\u4e0d\u662f\u5185\u6838\u7684\u4e00\u90e8\u5206\uff0c\u9700\u8981\u901a\u8fc7Linux\u7684\u52a8\u6001\u52a0\u8f7d\u6a21\u5757\u673a\u5236\u52a0\u8f7d\u4e00\u4e2a\u53ebBinder\u9a71\u52a8\u7684\u5185\u6838\u6a21\u5757\uff0c\u7136\u540e\u5404\u8fdb\u7a0b\u53ef\u901a\u8fc7\u6b21\u6a21\u5757\u8fdb\u7a0b\u901a\u4fe1</p> <p>\u5185\u5b58\u6620\u5c04\uff1a\u901a\u8fc7mmap()\u5b9e\u73b0\uff0c\u7b80\u5355\u8bf4\u5c31\u662f\u7528\u6237\u7a7a\u95f4\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\u6620\u5c04\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u4e4b\u540e\u53cc\u65b9\u4fee\u6539\u7684\u5185\u5bb9\u90fd\u80fd\u53ca\u65f6\u88ab\u611f\u77e5</p> <p></p> <p>\u6570\u636e\u63a5\u6536\u7f13\u5b58\u533a\u901a\u8fc7Binder\u9a71\u52a8\u5efa\u7acb</p> <p>\u53ef\u4ee5\u662f\u540c\u6b65\u4e5f\u53ef\u4ee5\u662f\u5f02\u6b65oneway</p>"},{"location":"android/fws/fws_process/#android","title":"Android\u4e2d\u7684\u8fdb\u7a0b","text":"<p>\u7a7a\u8fdb\u7a0b\u3001\u524d\u53f0\u8fdb\u7a0b(\u5e94\u7528\u754c\u9762\u663e\u793a)\u3001\u540e\u53f0\u8fdb\u7a0b(HOME\u4e4b\u540e\u7684)\u3001\u53ef\u89c1\u8fdb\u7a0b(\u88ab\u5f39\u7a97(Activity)\u906e\u6321)\u3001\u670d\u52a1\u8fdb\u7a0b(\u542f\u52a8service)</p>"},{"location":"android/fws/fws_rk/","title":"RK3588J","text":""},{"location":"android/fws/fws_rk/#rk","title":"RK\u677f\u5b50\u76f8\u5173","text":"<p>\u677f\u5b50\u6559\u7a0b\uff1a</p> <p>https://wiki.t-firefly.com/zh_CN/Core-3588J/android_compile_android12.0_firmware.html</p> <p>itx3588j\u5f00\u53d1\u677f\uff1a</p> <p>https://www.t-firefly.com/product/industry/itx3588j</p>"},{"location":"android/fws/fws_rk/#nfc","title":"nfc\u6a21\u5757","text":"<p>nfc pn7160 \u5b89\u5353\u9002\u914d\u6587\u6863</p> <p>https://www.nxp.com.cn/docs/en/application-note/AN13189.pdf</p> <p>\u6587\u6863\u4e2d\uff1a so\u6587\u4ef6\u4e0b\u8f7d\u5730\u5740\uff1a</p> <p>https://github.com/NXP/nfc-NXPNFCC_FW/blob/master/InfraFW/pn7160/32-bit/libpn7160_fw.so</p>"},{"location":"android/fws/fws_sensor/","title":"\u6e90\u7801","text":""},{"location":"android/fws/fws_sensor/#_1","title":"\u6e90\u7801\u5206\u6790","text":"<p>\u5b66\u4e60\u535a\u5ba2\uff1a</p> <p>https://blog.csdn.net/hmorey/article/details/123609816?spm=1001.2014.3001.5506</p> <p>https://blog.csdn.net/sdkdlwk/article/details/86490684?spm=1001.2014.3001.5506</p> <p>https://blog.csdn.net/hoisjdoiajsd/article/details/130640491</p> <p>https://blog.csdn.net/qq_30624591/article/details/104517480</p> <p>https://blog.csdn.net/frank_zyp/article/details/53782614</p> <p>https://blog.csdn.net/frank_zyp/category_6571508.html</p> <p>https://blog.csdn.net/frank_zyp/article/details/53582306</p> <p>https://blog.csdn.net/Bleach3/article/details/107381719/</p> <p>https://blog.csdn.net/huilin9960/article/details/80704481?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-9-80704481-blog-125324506.235v43pc_blog_bottom_relevance_base9&amp;spm=1001.2101.3001.4242.6&amp;utm_relevant_index=10</p> <p>https://blog.csdn.net/u014787262/article/details/125324506</p> <p>https://blog.csdn.net/TangYuanTuoHai/article/details/135996477</p> <p>https://dhexx.cn/news/show-591575.html?action=onClick</p> <p>https://blog.csdn.net/u012439416/article/details/79684098</p> <p>https://blog.csdn.net/u012439416/article/details/74612903</p> <p>https://blog.csdn.net/luansxx/article/details/120959705</p> <p>https://blog.csdn.net/kehyuanyu/article/details/43195029</p>"},{"location":"android/fws/fws_sensor/#_2","title":"\u5b9e\u6218\u6848\u4f8b","text":"<p>\u6848\u4f8b\u5b9a\u5236</p>"},{"location":"android/fws/fws_sensor_case/","title":"\u6848\u4f8b","text":""},{"location":"android/fws/fws_sensor_case/#_1","title":"\u9879\u76ee\u7b80\u4ecb","text":"<p>\u8bbe\u5907A\u6ca1\u6709\u4f20\u611f\u5668\u786c\u4ef6\uff0c\u8bbe\u5907B\u6b63\u5e38\u624b\u673a\uff0c\u5b9e\u73b0\u8bbe\u5907A\u6570\u636e\u4ece\u8bbe\u5907B\u4e2d\u83b7\u53d6</p> <p>\u9700\u8981\u7528\u7684\u7684\u5e93</p> <p>LocalSocket</p> <p>Socket(cpp\u7248)</p> <p>Netty</p>"},{"location":"android/fws/fws_sensor_case/#a","title":"\u8bbe\u5907A","text":""},{"location":"android/fws/fws_sensor_case/#framework","title":"framework\u5c42\u4fee\u6539\u70b9","text":"<ol> <li>frameworks/base/core/java/android/hardware/SystemSensorManager.java</li> </ol> <p>\u4e3b\u8981\u6dfb\u52a0LocalSocket\u5ba2\u6237\u7aef\u903b\u8f91\uff0c\u7528\u6765\u63a5\u6536\u4f20\u611f\u5668\u6570\u636e</p> <pre><code>private Handler mMainHandler;\npublic SystemSensorManager(Context context, Looper mainLooper) {\n// ...\nmMainHandler = new Handler(Looper.getMainLooper(), message -&gt; {\ntry {\n//\u6570\u636e\u5f62\u5f0ftype:handle:inAccuracy:timestamp:value1...valuen\nString msg = (String) message.obj;\nString[] split = msg.split(\":\");\nint type = Integer.parseInt(split[0]);\nint handle = Integer.parseInt(split[1]);\nint inAccuracy = Integer.parseInt(split[2]);\nlong timestamp = Long.parseLong(split[3]);\nint valueSize = split.length - 4;\nfloat[] values = new float[valueSize];\nfor (int i = 0; i &lt; valueSize; i++) {\nvalues[i] = Float.parseFloat(split[i + 4]);\n}\nfor (SensorEventQueue value : mSensorListeners.values()) {\nif (value != null) {\nSensor sensor = mHandleToSensor.get(handle);\nif (sensor != null) {\nint registerType = sensor.getType();\nif (type == registerType) {\nvalue.dispatchSensorEvent(sensor.getHandle(), values, inAccuracy, timestamp);\n}\n}\n}\n}\n} catch (NumberFormatException e) {\ne.printStackTrace();\n}\nreturn true;\n});\nLocalSocketClientHandler lscHandler = new LocalSocketClientHandler();\nlscHandler.setMsgListener(msgListener);\nlscHandler.start(\"sensor_socket\");\n}\n\nprivate android.hardware.LocalSocketClientHandler.MsgListener msgListener = new LocalSocketClientHandler.MsgListener() {\n@Override\npublic void onMsgReceive(String msg) {\nMessage message = mMainHandler.obtainMessage();\nmessage.obj = msg;\nmMainHandler.sendMessage(message);\n}\n};\n</code></pre> <p>\u7f16\u8bd1\u6a21\u5757framework.jar</p> <p>\u7f16\u8bd1\u547d\u4ee4make framework-minus-apex</p> <ol> <li>frameworks/base/services/core/java/com/android/server/sensors/SensorService.java</li> </ol> <p>\u4e3b\u8981\u6dfb\u52a0LocalSocket\u670d\u52a1\u7aef\u903b\u8f91\u4ee5\u53ca\u6ce8\u518cjni\u56de\u8c03\u7c7b\uff0c\u5f53cpp\u5c42\u6709\u4f20\u611f\u5668\u6570\u636e\u65f6\u4f1a\u8c03\u7528LocalSocketServerHandler\u4e2d\u7684dispatchSensorEvent\u65b9\u6cd5\u6765\u4f20\u9012\u6570\u636e</p> <pre><code>private static native long startSensorServiceNative(ProximityActiveListener listener, LocalSocketServerHandler lls);\n\npublic SensorService(Context ctx) {\n//...\nLocalSocketServerHandler mLssHandler = new LocalSocketServerHandler();\nmLssHandler.start(\"sensor_socket\");\nsynchronized (mLock) {\n//...\nlong ptr = startSensorServiceNative(new ProximityListenerDelegate(), mLssHandler);\n//...\n}\n}\n</code></pre> <p>\u540c\u76ee\u5f55\u6dfb\u52a0LocalSocketServerHandler.java\u548cClient.java\u8f85\u52a9\u7c7b\uff0c\u529f\u80fd\u662f\u5c01\u88c5LocalSocket\u7684\u4f7f\u7528\uff0cLocalSocketServerHandler\u4e2d\u989d\u5916\u6dfb\u52a0\u65b9\u6cd5dispatchSensorEvent <pre><code>// Called from native code.\npublic void dispatchSensorEvent(String msg) {\nsend(msg);\n}\n</code></pre></p> <p>\u7f16\u8bd1\u6a21\u5757services.jar</p> <p>\u7f16\u8bd1\u547d\u4ee4make services</p>"},{"location":"android/fws/fws_sensor_case/#native","title":"native\u5c42\u4fee\u6539\u70b9","text":"<ol> <li>frameworks/base/core/jni/android_hardware_SensorManager.cpp</li> </ol> <p>\u4e3b\u8981\u662f\u5c4f\u853d\u76f4\u63a5\u4ece\u5e95\u5c42\u5171\u4eab\u5185\u5b58\u4e2d\u8bfb\u53d6\u903b\u8f91\uff0c\u7edf\u4e00\u5728Java\u5c42SystemSensorManager\u7684\u6570\u636e\u5904\u7406</p> <pre><code> void destroy() {\n//        \u6ca1\u6ce8\u518c\u5c31\u4e0d\u9700\u8981\u6ce8\u9500\n//        mMessageQueue-&gt;getLooper()-&gt;removeFd( mSensorQueue-&gt;getFd() );\n}\nvirtual void onFirstRef() {\nLooperCallback::onFirstRef();\n//        \u5e94\u7528\u5c42\u4f20\u611f\u5668\u56de\u8c03\u4e0d\u8981\u4ece\u8fd9\u91cc\u56de\u8c03\uff0c\u800c\u662f\u4eceLocalSocket\u56de\u8c03\u6570\u636e\n//        mMessageQueue-&gt;getLooper()-&gt;addFd(mSensorQueue-&gt;getFd(), 0,\n//                ALOOPER_EVENT_INPUT, this, mSensorQueue.get());\n}\n</code></pre> <p>\u7f16\u8bd1\u6a21\u5757libandroid_runtime.so</p> <p>\u7f16\u8bd1\u547d\u4ee4make libandroid_runtime</p> <ol> <li>frameworks/native/services/sensorservice/SensorService.cpp\u3001SensorService.h\u548cAndroid.bp \u4e3b\u8981\u662f\u521b\u5efasocket\u53bb\u63a5\u6536\u624b\u673a\u7aef\u6570\u636e</li> </ol> <p>Android.bp <pre><code>cc_library_shared {\n    name: \"libsensorservice\",\n\n    srcs: [\n        //...\n        \"ThreadPool.cpp\",\n    ],\n    //...\n}\n</code></pre> SensorService.h\u58f0\u660e\u4e00\u4e9b\u5c5e\u6027\u548c\u51fd\u6570 <pre><code>class ProximityActiveListener : public virtual RefBase {\n//...\n};\n\n// add start\nclass SensorEventSocketListener : public virtual RefBase {\npublic:\nvirtual void onSocketEvent(char buffer[]) = 0;\n};\n// add end\n//...\u539f\u751f\nvoid uncapRates(userid_t userId);\n\n// add\nvoid startServer(int port);\nvoid receiveClient();\nvoid analysisResponse(char buffer[]);\nvoid sendMsg(const std::string&amp; message);\nsp&lt;SensorEventSocketListener&gt; mSensorEventSocketListener;\nvoid SensorService::setSensorEventListener(const sp&lt;SensorEventSocketListener&gt;&amp; callback);\n//...\n</code></pre> SensorService.cpp\u5b9e\u73b0\u5177\u4f53\u51fd\u6570 <pre><code>//SensorService.cpp\nvoid SensorService::startServer(int port){\n//\u5177\u4f53\u89c1ServerSocket.cpp\n}\nvoid SensorService::sendMsg(const std::string&amp; message){\n//\u5177\u4f53\u89c1ServerSocket.cpp\n}\nvoid SensorService::receiveClient(){\n//\u5177\u4f53\u89c1ServerSocket.cpp\n}\nvoid SensorService::setSensorEventListener(const sp&lt;SensorEventSocketListener&gt;&amp; callback) {\nmSensorEventSocketListener = callback;\n}\n\n//\u89e3\u6790\u6570\u636e\u5199\u5230BitTube\u4e2d\nvoid SensorService::analysisResponse(char buffer[]){\nif (mSensorEventSocketListener != nullptr) {\n// \u5e94\u7528\u5c42\u56de\u8c03\nmSensorEventSocketListener-&gt;onSocketEvent(buffer);\n}\nConnectionSafeAutolock connLock = mConnectionHolder.lock(mLock);\nchar* token = strtok(buffer, \":\");\nif (token == nullptr) {\nreturn;\n}\nint32_t type = std::strtol(token, nullptr, 10);\ntoken = strtok(nullptr, \":\");\nif (token == nullptr) {\nreturn;\n}\nint32_t handle = std::strtol(token, nullptr, 10);\ntoken = strtok(nullptr, \":\");\nif (token == nullptr) {\nreturn;\n}\nint8_t accuracy;\nchar* endptr;\nlong long tmpAccuracy = std::strtol(token, &amp;endptr, 10);\nif (*endptr == '\\0' &amp;&amp; tmpAccuracy &gt;= std::numeric_limits&lt;int8_t&gt;::min() &amp;&amp; tmpAccuracy &lt;= std::numeric_limits&lt;int8_t&gt;::max()) {\naccuracy = static_cast&lt;int8_t&gt;(tmpAccuracy);\n} else {\naccuracy = 0;\nALOGE(\"Error converting string to int8_t: invalid input or out of range.\");\n}\ntoken = strtok(nullptr, \":\");\nif (token == nullptr) {\nreturn;\n}\nint64_t timestamp = std::strtoll(token, nullptr, 10);\ntoken = strtok(nullptr, \":\");\nif (token == nullptr) {\nreturn;\n}\nsize_t arraySize = sizeof(mSensorEventBuffer-&gt;data) / sizeof(mSensorEventBuffer-&gt;data[0]);\nfor (size_t i = 0; i &lt; arraySize; ++i) {\nif (token == nullptr) {\nbreak;\n}\nmSensorEventTemp-&gt;data[i] = std::strtof(token, nullptr);\ntoken = strtok(nullptr, \":\");\n}\n\nmSensorEventBuffer-&gt;type = type;\nmSensorEventBuffer-&gt;sensor = handle;\nsp&lt;SensorInterface&gt; sensor = getSensorInterfaceFromHandle(handle);\nmSensorEventBuffer-&gt;version = sensor-&gt;getSensor().getVersion();\nmSensorEventBuffer-&gt;timestamp = timestamp;\n\nswitch (type) {\ncase ASENSOR_TYPE_ACCELEROMETER:\nmSensorEventBuffer-&gt;orientation.x = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;orientation.y = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;orientation.z = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;orientation.status = accuracy;\nbreak;\ncase ASENSOR_TYPE_MAGNETIC_FIELD:\nmSensorEventBuffer-&gt;magnetic.x = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;magnetic.y = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;magnetic.z = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;magnetic.status = accuracy;\nbreak;\ncase SENSOR_TYPE_ORIENTATION:\nmSensorEventBuffer-&gt;acceleration.x = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;acceleration.y = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;acceleration.z = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;acceleration.status = accuracy;\nbreak;\ncase ASENSOR_TYPE_GYROSCOPE:\nmSensorEventBuffer-&gt;gyro.x = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;gyro.y = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;gyro.z = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;gyro.status = accuracy;\nbreak;\ncase SENSOR_TYPE_LIGHT:\nmSensorEventBuffer-&gt;light = mSensorEventTemp-&gt;data[0];\nbreak;\ncase SENSOR_TYPE_PRESSURE:\nmSensorEventBuffer-&gt;pressure = mSensorEventTemp-&gt;data[0];\nbreak;\ncase SENSOR_TYPE_TEMPERATURE:\nmSensorEventBuffer-&gt;temperature = mSensorEventTemp-&gt;data[0];\nbreak;\ncase SENSOR_TYPE_PROXIMITY:\nmSensorEventBuffer-&gt;distance = mSensorEventTemp-&gt;data[0];\nbreak;\ncase ASENSOR_TYPE_GRAVITY:\nmSensorEventBuffer-&gt;orientation.x = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;orientation.y = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;orientation.z = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;orientation.status = accuracy;\nbreak;\ncase ASENSOR_TYPE_LINEAR_ACCELERATION:\nmSensorEventBuffer-&gt;acceleration.azimuth = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;acceleration.pitch = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;acceleration.roll = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;acceleration.status = accuracy;\nbreak;\ncase SENSOR_TYPE_ROTATION_VECTOR:\ncase SENSOR_TYPE_GEOMAGNETIC_ROTATION_VECTOR:\nmSensorEventBuffer-&gt;data[0] = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;data[1] = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;data[2] = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;data[3] = mSensorEventTemp-&gt;data[3];\nmSensorEventBuffer-&gt;data[4] = mSensorEventTemp-&gt;data[4];\nbreak;\ncase SENSOR_TYPE_RELATIVE_HUMIDITY:\nmSensorEventBuffer-&gt;relative_humidity = mSensorEventTemp-&gt;data[0];\nbreak;\ncase SENSOR_TYPE_GAME_ROTATION_VECTOR: {\nmSensorEventBuffer-&gt;data[0] = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;data[1] = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;data[2] = mSensorEventTemp-&gt;data[2];\nmSensorEventBuffer-&gt;data[3] = mSensorEventTemp-&gt;data[3];\nbreak;\n}\ncase SENSOR_TYPE_GYROSCOPE_UNCALIBRATED:\nmSensorEventBuffer-&gt;uncalibrated_gyro.x_bias = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_gyro.y_bias = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_gyro.z_bias = mSensorEventTemp-&gt;data[2];;\nmSensorEventBuffer-&gt;uncalibrated_gyro.x_uncalib = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_gyro.y_uncalib = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_gyro.z_uncalib = mSensorEventTemp-&gt;data[2];\nbreak;\ncase SENSOR_TYPE_MAGNETIC_FIELD_UNCALIBRATED:\nmSensorEventBuffer-&gt;uncalibrated_magnetic.x_bias = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_magnetic.y_bias = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_magnetic.z_bias = mSensorEventTemp-&gt;data[2];;\nmSensorEventBuffer-&gt;uncalibrated_magnetic.x_uncalib = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_magnetic.y_uncalib = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_magnetic.z_uncalib = mSensorEventTemp-&gt;data[2];\nbreak;\ncase SENSOR_TYPE_ACCELEROMETER_UNCALIBRATED:\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.x_bias = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.y_bias = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.z_bias = mSensorEventTemp-&gt;data[2];;\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.x_uncalib = mSensorEventTemp-&gt;data[0];\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.y_uncalib = mSensorEventTemp-&gt;data[1];\nmSensorEventBuffer-&gt;uncalibrated_accelerometer.z_uncalib = mSensorEventTemp-&gt;data[2];\nbreak;\ndefault:\nmemcpy(mSensorEventBuffer-&gt;data,mSensorEventTemp-&gt;data,16);\nbreak;\n}\n\nconst std::vector&lt;sp&lt;SensorEventConnection&gt;&gt; activeConnections = connLock.getActiveConnections();\nfor (const sp&lt;SensorEventConnection&gt;&amp; connection : activeConnections) {\nSensorEventQueue::write(connection-&gt;mChannel,\nreinterpret_cast&lt;ASensorEvent const*&gt;(mSensorEventBuffer), 1);\n}\n}\n\n//\u7a0b\u5e8f\u8fdb\u7a0b\u5b58\u6d3b\u72b6\u6001\u76d1\u542c\u56de\u8c03\uff0c\u53d1\u9001\u5230\u624b\u673a\u7aef\uff0c\u6570\u636e\u5f62\u5f0fstate:uid:active(idle)\nvoid SensorService::onUidStateChanged(uid_t uid, UidState state) {\nstd::string result = \"state:\" + std::to_string(uid) + \":\" + (state == UID_STATE_ACTIVE ? \"active\" : \"idle\") + \"\\n\";\nsendMsg(result);\n//...\n}\n\n// \u76d1\u542c\u67d0\u4e2a\u4f20\u611f\u5668\u65f6\u4f1a\u8c03\u7528\nstatus_t SensorService::enable(const sp&lt;SensorEventConnection&gt;&amp; connection,\nint handle, nsecs_t samplingPeriodNs, nsecs_t maxBatchReportLatencyNs, int reservedFlags,\nconst String16&amp; opPackageName) {\n//...\nsp&lt;SensorInterface&gt; sensor = getSensorInterfaceFromHandle(handle);\nif (sensor == nullptr ||\n!canAccessSensor(sensor-&gt;getSensor(), \"Tried enabling\", opPackageName)) {\nreturn BAD_VALUE;\n}\n//add start\nstd::string result = \"enable:\" + std::to_string(sensor-&gt;getSensor().getType())\n+ \":\" + std::to_string(handle) + \":\" + std::to_string(connection-&gt;getUid()) + \"\\n\";\nsendMsg(result);\n//add end\n//...\n//add start\nif (client_sockfd != -1) {\nreturn NO_ERROR;\n}\n//add end\nstatus_t err = sensor-&gt;batch(connection.get(), handle, 0, samplingPeriodNs,\nmaxBatchReportLatencyNs);\n//...\n}\n\nstatus_t SensorService::disable(const sp&lt;SensorEventConnection&gt;&amp; connection, int handle) {\n//...\nMutex::Autolock _l(mLock);\nstatus_t err = cleanupWithoutDisableLocked(connection, handle);\nif (err == NO_ERROR) {\nsp&lt;SensorInterface&gt; sensor = getSensorInterfaceFromHandle(handle);\n//add start\nstd::string result = \"disable:\" + std::to_string(sensor-&gt;getSensor().getType())\n+ \":\" + std::to_string(connection-&gt;getUid()) + \"\\n\";\nsendMsg(result);\nif (client_sockfd != -1) {\nreturn NO_ERROR;\n}\n//add end\nerr = sensor != nullptr ? sensor-&gt;activate(connection.get(), false) : status_t(BAD_VALUE);\n}\n//...\n}\n</code></pre></p> <p>\u7f16\u8bd1\u6a21\u5757libsensorservice.so</p> <p>\u7f16\u8bd1\u547d\u4ee4make libsensorservice</p> <ol> <li>frameworks/base/services/core/jni/com_android_server_sensor_SensorService.cpp</li> </ol> <p>\u4e3b\u8981\u662f\u5efa\u7acbSensorService.java\u548cSensorService.cpp\u7684\u901a\u8def</p> <pre><code>#define LOCAL_SOCKET_CLASS \\\n\"com/android/server/sensors/LocalSocketServerHandler\"\nnamespace android {\n\n//...\nstatic jmethodID sMethodIdDispatchSensorEvent;\n\nclass NativeSensorService {\n//modify\nNativeSensorService(JNIEnv* env, jobject listener, jobject ssl);\n//...\nsp&lt;ProximityActiveListenerDelegate&gt; mProximityActiveListenerDelegate;\n//add start\nclass SensorEventSocketListenerDelegate : public SensorService::SensorEventSocketListener {\npublic:\nSensorEventSocketListenerDelegate(JNIEnv* env, jobject ssl);\n~SensorEventSocketListenerDelegate();\nvoid onSocketEvent(char buffer[]) override;\nprivate:\njobject mHandle;\n};\nsp&lt;SensorEventSocketListenerDelegate&gt; mSensorEventSocketListenerDelegate;\n//add end\n};\n\nNativeSensorService::SensorEventSocketListenerDelegate::SensorEventSocketListenerDelegate(\nJNIEnv *env, jobject ssl): mHandle(env-&gt;NewGlobalRef(ssl)) {}\n\nNativeSensorService::SensorEventSocketListenerDelegate::~SensorEventSocketListenerDelegate() {\nAndroidRuntime::getJNIEnv()-&gt;DeleteGlobalRef(mHandle);\n}\n\n//\u8c03\u7528java\u5c42\u7684LocalServerHandler\u4e2d\u7684dispatchSensorEvent\u65b9\u6cd5\nvoid NativeSensorService::SensorEventSocketListenerDelegate::onSocketEvent(char *buffer) {\nauto jniEnv = GetOrAttachJNIEnvironment(sJvm);\nif (sMethodIdDispatchSensorEvent != nullptr) {\njstring jMsg = jniEnv-&gt;NewStringUTF(buffer);\njniEnv-&gt;CallVoidMethod(mHandle, sMethodIdDispatchSensorEvent, jMsg);\njniEnv-&gt;DeleteLocalRef(jMsg);\n}\n}\n\nNativeSensorService::NativeSensorService(JNIEnv* env, jobject listener, jobject ssl)\n: mProximityActiveListenerDelegate(new ProximityActiveListenerDelegate(env, listener)),\nmSensorEventSocketListenerDelegate(new SensorEventSocketListenerDelegate(env, ssl)) {\n//...\nmService = new SensorService();\n//add\nmService-&gt;setSensorEventListener(mSensorEventSocketListenerDelegate);\n//...\n}\n\n//modify\nstatic jlong startSensorServiceNative(JNIEnv* env, jclass, jobject listener, jobject ssl) {\nNativeSensorService* service = new NativeSensorService(env, listener, ssl);\nreturn reinterpret_cast&lt;jlong&gt;(service);\n}\n\n\nstatic const JNINativeMethod methods[] = {\n{\n// modify\n\"startSensorServiceNative\", \"(L\" PROXIMITY_ACTIVE_CLASS \";L\" LOCAL_SOCKET_CLASS \";)J\",\nreinterpret_cast&lt;void*&gt;(startSensorServiceNative)\n},\n//...\n};\n\nint register_android_server_sensor_SensorService(JavaVM* vm, JNIEnv* env) {\n//...\njclass sensorServiceClass = FindClassOrDie(env, LOCAL_SOCKET_CLASS);\nsMethodIdDispatchSensorEvent = GetMethodIDOrDie(env, sensorServiceClass, \"dispatchSensorEvent\", \"(Ljava/lang/String;)V\");\n//...\n}\n}; // namespace android\n</code></pre> <p></p> <p>\u7f16\u8bd1\u6a21\u5757libandroid_servers.so</p> <p>\u7f16\u8bd1\u547d\u4ee4make libandroid_servers</p>"},{"location":"android/fws/fws_sensor_case/#b","title":"\u8bbe\u5907B","text":"<p>app\u5c42: netty_client\u9879\u76ee\uff0c\u4e3b\u8981\u662f\u901a\u8fc7netty\u5c06\u4f20\u611f\u5668\u6570\u636e\u4f20\u9012\u5230native\u5c42SensorService.cpp</p> <p>\u5904\u7406\u6536\u5230\u7684\u6307\u4ee4 <pre><code>override fun messageReceived(msg: String) {\nlifecycleScope.launch {\nval cmd = msg.split(\":\")\ntry {\nval flag = cmd[0]\nif (\"enable\" == flag) {\nval type = cmd[1].toInt()\nval uid = cmd[3].toInt()\nval handle = cmd[2]\nval listener = typeToListener(type, handle)\nregisterSensorListener(type, listener)\nsensorCacheManager.enable(type, uid)\n} else if (\"disable\" == flag) {\nval type = cmd[1].toInt()\nval uid = cmd[2].toInt()\nsensorCacheManager.disable(type, uid)\n} else if (\"state\" == flag) {\nval active = cmd[2] == \"active\"\nif (!active) {\nval uid = cmd[1].toInt()\nsensorCacheManager.state(uid)\n}\n}\n} catch (e: Exception) {\ne.printStackTrace()\n}\n}\n}\n</code></pre> \u901a\u8fc7type\u627e\u5230\u6307\u5b9aSensor\uff0ctypeToListener <pre><code>private fun typeToListener(type: Int, handle: String) = when (type) {\nSensor.TYPE_ACCELEROMETER -&gt; {\naccelerometerListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_MAGNETIC_FIELD -&gt; {\nmagneticFieldListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_ORIENTATION -&gt; {\norientationListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_GYROSCOPE -&gt; {\ngyroscopeListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_LIGHT -&gt; {\nlightListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_PRESSURE -&gt; {\npressureListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_TEMPERATURE -&gt; {\ntemperatureListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_PROXIMITY -&gt; {\nproximityListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_GRAVITY -&gt; {\ngravityListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_LINEAR_ACCELERATION -&gt; {\nlinearAccelerationListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_ROTATION_VECTOR -&gt; {\nrotationVectorListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_GAME_ROTATION_VECTOR -&gt; {\ngameRotationVectorListener.apply { this.handle = handle }\n}\n\nSensor.TYPE_GEOMAGNETIC_ROTATION_VECTOR -&gt; {\ngeomagneticRotationVectorListener.apply { this.handle = handle }\n}\n\nelse -&gt; null\n}\n</code></pre> \u5176\u4e2daccelerometerListener\u7b49\u8fd9\u4e9blistener\uff0c\u5982\u4e0b(\u5176\u4ed6\u7c7b\u4f3c\u540d\u5b57\u4e0d\u540c\u800c\u5df2) <pre><code> private val accelerometerListener by lazy {\nobject : SensorEventListener {\nvar handle: String = \"\"\noverride fun onSensorChanged(event: SensorEvent) {\nsendSensorData(event, handle)\n}\n\noverride fun onAccuracyChanged(sensor: Sensor, accuracy: Int) {\nLog.d(TAG, \"onAccuracyChanged: type ${sensor.type},accuracy $accuracy\")\n}\n}\n}\n</code></pre> \u6ce8\u518c\u6216\u53cd\u6ce8\u518cSensor <pre><code>private fun registerSensorListener(type: Int, listener: SensorEventListener?) {\nif (listener == null) {\nLog.e(TAG, \"sensor listener is null\")\nreturn\n}\nif (sensorCacheManager.hasEnable(type)) {\nLog.e(TAG, \"sensor has register\")\nreturn\n}\nsensorManager.registerListener(\nlistener,\nsensorManager.getDefaultSensor(type),\nSensorManager.SENSOR_DELAY_NORMAL\n)\nLog.e(TAG, \"sensor register: $type\")\n}\n\nprivate fun unRegisterSensorListener(type: Int, listener: SensorEventListener?) {\nif (listener == null) {\nLog.e(TAG, \"sensor listener is null\")\nreturn\n}\nif (sensorCacheManager.hasEnable(type)) {\nLog.e(TAG, \"sensor has no register\")\nreturn\n}\nsensorManager.unregisterListener(listener)\nLog.e(TAG, \"sensor unregister: $type\")\n}\n</code></pre> \u76d1\u542c\u5230\u6570\u636e\u540e\u53d1\u9001\u7ed9\u8bbe\u5907B sendSensorData <pre><code> private fun sendSensorData(event: SensorEvent, handle: String) {\nif (handle.isEmpty()) {\nLog.d(TAG, \"sendSensorData: handle is null\")\nreturn\n}\nval builder = StringBuilder()\nbuilder.append(event.sensor.type).append(\":\")\n.append(handle).append(\":\")\n.append(event.accuracy).append(\":\")\n.append(event.timestamp)\nevent.values.forEach {\nbuilder.append(\":\").append(it)\n}\nSensorClientHandler.sendMsg(builder.toString())\n}\n</code></pre></p>"},{"location":"android/fws/fws_sensor_case/#_2","title":"\u6574\u4f53\u6d41\u7a0b","text":"<ol> <li>\u8bbe\u5907A\u5f00\u673a\u542f\u52a8SensorService\u7cfb\u7edf\u670d\u52a1\u5f00\u542f(\u539f\u751f\u903b\u8f91)</li> <li>\u624b\u673a\u7aef\u542f\u52a8Netty\u5ba2\u6237\u7aef\u5e76\u8fde\u63a5</li> <li>\u8bbe\u5907A\u4e09\u65b9\u5e94\u7528\u6216\u8005\u6e38\u620f\u76d1\u542c\u4f20\u611f\u5668</li> <li>\u8bbe\u5907A\u5982\u679c\u662f\u5e94\u7528fw(SystemSensorManager)\u88ab\u521b\u5efa\u5e76\u901a\u8fc7LocalSocket\u8fde\u63a5\u5230SensorService\u4e2d\u7684\u670d\u52a1\u7aef\uff0c\u7b49\u5f85\u6d88\u606f</li> <li>\u8bbe\u5907A\u4e0a\u89e6\u53d1\u4f20\u611f\u5668\u65e0\u8bba\u662f\u5e94\u7528\u8fd8\u662f\u6e38\u620f\u90fd\u4f1a\u8c03\u7528\u5230SensorService\u4e2d\u7684enable/disable\u51fd\u6570\uff0c\u901a\u8fc7Socket\u5411\u624b\u673a\u7aef\u53d1\u9001\u6d88\u606f\uff0c\u643a\u5e26\u4f20\u611f\u5668\u7c7b\u578b\u4fe1\u606f</li> <li>SensorService\u6536\u5230\u624b\u673a\u7684\u6570\u636e\uff0c\u89e3\u6790\u540e\u5c06\u6570\u636e\u4f20\u56de\u5e94\u7528\u548c\u6e38\u620f</li> <li>\u5982\u679c\u5e94\u7528\u6216\u6e38\u620f\u9000\u51faonUidStateChanged\uff0c\u5411\u624b\u673a\u53d1\u9001uid\u7684\u7a0b\u5e8f\u6d88\u606f\uff0c\u624b\u673a\u5173\u95ed\u5bf9\u5e94\u4f20\u611f\u5668\u6570\u636e</li> </ol>"},{"location":"android/fws/fws_sensor_case/#_3","title":"\u65b9\u6848\u6574\u4f53\u6d41\u7a0b\u56fe","text":""},{"location":"android/fws/fws_split_case/","title":"\u6848\u4f8b","text":""},{"location":"android/fws/fws_split_case/#ui","title":"\u5206\u5c4fUI\u5b9a\u5236","text":""},{"location":"android/fws/fws_split_case/#_1","title":"\u5206\u5c4f\u80cc\u666f\u900f\u660e\u663e\u793a\u58c1\u7eb8","text":"<p>\u65b9\u6848\u4e00\uff1a</p> <p>frameworks/base/core/java/com/android/internal/policy/DecorView.java <pre><code>protected void onLayout(boolean changed, int left, int top, int right, int bottom) {\nsuper.onLayout(changed, left, top, right, bottom);\n// ...\nif (changed) {\nWindowConfiguration wc = mContext.getResources().getConfiguration().windowConfiguration;\nif (wc.getActivityType() == ACTIVITY_TYPE_HOME) {\nreturn;\n}\nRect bounds = wc.getBounds();\nif (bounds.left != 0) {\n// split\nLog.e(TAG, \"onLayout split\");\nmWindow.toggleWallpaper(true);\n} else {\n// full\nLog.e(TAG, \"onLayout full\");\nmWindow.toggleWallpaper(false);\n}\n}\n}\n</code></pre> frameworks/base/core/java/com/android/internal/policy/PhoneWindow.java <pre><code>private boolean mOldShowWallpaper;\n\npublic void toggleWallpaper(boolean showWallpaper) {\nif (showWallpaper) {\nmOldShowWallpaper = isShowingWallpaper();\nsetFlags(FLAG_SHOW_WALLPAPER, FLAG_SHOW_WALLPAPER&amp;(~getForcedWindowFlags()));\n} else {\nif (!mOldShowWallpaper) {\nclearFlags(FLAG_SHOW_WALLPAPER);\n}\n}\n}\n</code></pre> \u65b9\u6848\u4e8c\uff1a</p> <p>frameworks/base/services/core/java/com/android/server/wm/LetterboxUiController.java <pre><code>private void updateWallpaperForLetterbox(WindowState mainWindow) {\n@LetterboxBackgroundType int letterboxBackgroundType =\nmLetterboxConfiguration.getLetterboxBackgroundType();\n//...\nwallpaperShouldBeShown |= mainWindow.getWindowingMode() == WindowConfiguration.WINDOWING_MODE_MULTI_WINDOW;\n//...\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#_2","title":"\u5206\u9694\u680f\u4fee\u6539","text":"<p>frameworks/base/</p> <p>libs/WindowManager/Shell/src/com/android/wm/shell/common/split/DividerView.java</p> <p>\u5206\u5272\u680fbar\uff1amHandle(R.id.docked_divider_handle)</p> <p>\u5206\u5272\u680f\u5e03\u5c40\uff1alibs/WindowManager/Shell/res/layout/split_divider.xml</p> <p>\u5206\u5272\u680f\u80cc\u666f\uff1aDockedDividerBackground</p> <p>libs/WindowManager/Shell/res/values-land/styles.xml libs/WindowManager/Shell/res/values/styles.xml</p> <p>\u5206\u5272\u680f\uff1a libs/WindowManager/Shell/res/values/dimen.xml</p> <p>\u767d\u6761\u5bbd\u5ea6\uff1asplit_divider_handle_height</p> <p>\u603b\u5bbd\u5ea6\uff1asplit_divider_bar_width</p> <p>\u52a0\u8f7d\u5206\u5272\u680f\u5e03\u5c40\uff1a libs/WindowManager/Shell/src/com/android/wm/shell/common/split/SplitWindowManager.java</p> <p>\u542f\u52a8\u5206\u5c4f\uff1a</p> <p>frameworks/base/libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/StageCoordinator.java</p> <p>startTasksWithLegacyTransition</p>"},{"location":"android/fws/fws_split_case/#_3","title":"\u5706\u89d2\u88c1\u526a","text":"<p>SplitWindowManager\u521d\u59cb\u5316\u5728</p> <p>libs/WindowManager/Shell/src/com/android/wm/shell/common/split/SplitLayout.java</p> <p>updateBounds\uff1a\u8bbe\u7f6e\u5206\u5c4fRect <pre><code>private void updateBounds(int position, Rect bounds1, Rect bounds2, Rect dividerBounds,\nboolean setEffectBounds) {\n// ...\nmStatusBarHeight = getStatusBarHeight(mContext);\nmNavigationBarHeight = getNavigationBarHeight(mContext);\nfinal boolean isLandscape = isLandscape(mRootBounds);\nif (isLandscape) {\n//...\nbounds1.left += mNotchRect != null ? mNotchRect.width() : 128;\nbounds1.right = position;\nbounds1.top += mStatusBarHeight;\nbounds1.bottom -= 30;\nbounds2.top += mStatusBarHeight;\nbounds2.left = bounds1.right + mDividerSize;\nbounds2.right -= mNavigationBarHeight;\nbounds2.bottom -= 30;\n} else {\n//...\nbounds1.top += mStatusBarHeight;\nbounds1.left += 30;\nbounds1.right -= 30;\nbounds2.top = bounds1.bottom + mDividerSize;\nbounds2.bottom -= mNavigationBarHeight;\nbounds2.left += 30;\nbounds2.right -= 30;\n}\n}\npublic int getStatusBarHeight(Context context) {\nint result = 0;\nint resourceId = context.getResources().getIdentifier(\"status_bar_height\", \"dimen\", \"android\");\nif (resourceId &gt; 0) {\nresult = context.getResources().getDimensionPixelSize(resourceId);\n}\nreturn result;\n}\n\npublic int getNavigationBarHeight(Context context) {\nResources resources = context.getResources();\nint resourceId = resources.getIdentifier(\"navigation_bar_height\", \"dimen\", \"android\");\nint result = 0;\nif (resourceId &gt; 0) {\nresult = resources.getDimensionPixelSize(resourceId);\n}\nreturn result;\n}\n</code></pre> applySurfaceChanges: \u5706\u89d2\u88c1\u526a <pre><code>public void applySurfaceChanges(SurfaceControl.Transaction t, SurfaceControl leash1,\nSurfaceControl leash2, SurfaceControl dimLayer1, SurfaceControl dimLayer2,\nboolean applyResizingOffset) {\n//...\nt.setPosition(leash1, mTempRect.left, mTempRect.top)\n.setWindowCrop(leash1, mTempRect.width(), mTempRect.height())\n.setCornerRadius(leash1, 30);\ngetRefBounds2(mTempRect);\nt.setPosition(leash2, mTempRect.left, mTempRect.top)\n.setWindowCrop(leash2, mTempRect.width(), mTempRect.height())\n.setCornerRadius(leash1, 30);\n//...\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#_4","title":"\u5bfc\u822a\u680f\u80cc\u666f\u4fee\u6539","text":"<p>packages/SystemUI/src/com/android/systemui/navigationbar/NavigationBarTransitions.java <pre><code>public NavigationBarTransitions(\nNavigationBarView view,\nIWindowManager windowManagerService,\nLightBarTransitionsController.Factory lightBarTransitionsControllerFactory) {\nsuper(view, R.drawable.nav_background);\nmView = view;\nview.setBackgroundColor(Color.TRANSPARENT);\n//...\n}\n</code></pre></p> <p>\u6a2a\u5c4f\u65f6\u83b7\u53d6\u4fa7\u8fb9\u5218\u6d77\u5bbd\u5ea6 <pre><code>val rootWindowInsets: WindowInsets = window.decorView.rootWindowInsets\nif (rootWindowInsets != null) {\nval displayCutout = rootWindowInsets.displayCutout\nif (displayCutout != null) {\nval boundingRects: List&lt;Rect&gt; = displayCutout.boundingRects\nif (boundingRects.isNotEmpty()) {\nval rect: Rect = boundingRects[0]\n}\n}\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#bar","title":"\u5e94\u7528\u6dfb\u52a0bar","text":"<p>DecorView\u4e2d <pre><code>void onResourcesLoaded(LayoutInflater inflater, int layoutResource) {\nif (mDecorCaptionView != null) {\n//...\n} else {\ncreateDecorPointBarView();\n//...\n}\n//...\n}\n\n@Override\nprotected void onConfigurationChanged(Configuration newConfig) {\nsuper.onConfigurationChanged(newConfig);\n\n//...\ncreateDecorPointBarView();\n\n//...\n}\n\nprivate PointBarView mPointBarView;\n\nprivate boolean isActivity() {//\u4e0d\u80fd\u5224\u65ad\u51faDialogFragment\nboolean isActivity;\nif (\"com.tencent.mm\".equals(mContext.getPackageName())) {\nisActivity = mWindow != null &amp;&amp; mWindow.getAppToken() != null &amp;&amp; !mWindow.isFloating();\n} else {\nisActivity = mWindow != null &amp;&amp; mWindow.getAppToken() != null &amp;&amp; !mWindow.isFloating() &amp;&amp; !mWindow.isTranslucent();\n}\nLog.e(TAG, \"isActivity: \" + isActivity);\nreturn isActivity;\n}\n\nprivate void createDecorPointBarView() {\ntry {\nLog.e(TAG, \"createDecorPointBarView start:\" +getContext().getPackageName());\nif (mPointBarView == null) {\nfinal WindowManager.LayoutParams attrs = mWindow.getAttributes();\nfinal boolean isApplication = attrs.type == TYPE_BASE_APPLICATION ||\nattrs.type == TYPE_APPLICATION || attrs.type == TYPE_DRAWN_APPLICATION;\nfinal WindowConfiguration winConfig = getResources().getConfiguration().windowConfiguration;\n//\u81ea\u5b9a\u4e49Launcher\nboolean isLauncher = \"xxx.xxx\".equals(getContext().getPackageName());\nif (!isLauncher &amp;&amp; isActivity() &amp;&amp; isApplication &amp;&amp; winConfig.getActivityType() != WindowConfiguration.ACTIVITY_TYPE_HOME) {\nLayoutParams lp = new LayoutParams(120, 33,\nGravity.CENTER_HORIZONTAL);\nmPointBarView = new PointBarView(getContext());\nif (mPointBarView.getParent() == null) {\npost(()-&gt; addView(mPointBarView, lp));\n}\nLog.e(TAG, \"create PointBarView success\");\n}\n}\nif (mPointBarView != null) {\nLayoutParams lp = (LayoutParams) mPointBarView.getLayoutParams();\nfinal WindowConfiguration winConfig = getResources().getConfiguration().windowConfiguration;\nRect bounds = winConfig.getBounds();\nRect maxBounds = winConfig.getMaxBounds();\nboolean isLandscape = maxBounds.width() &gt; maxBounds.height();\nif (isLandscape) {\nlp.topMargin = bounds.left != 0 ? 0 : SystemBarUtils.getStatusBarHeight(getContext());\nlp.height = bounds.left != 0 ? 80 : 50;\n} else {\nlp.topMargin = bounds.top != 0 ? 0 : SystemBarUtils.getStatusBarHeight(getContext());\nlp.height = bounds.top != 0 ? 80 : 50;\n}\nmPointBarView.hidePopupWindowIfNeeded();\nif (mPointBarView.getParent() == null) {\naddView(mPointBarView, lp);\n} else {\nmPointBarView.setLayoutParams(lp);\n}\n}\n} catch (Exception e) {\nLog.e(TAG, \"create DecorPointBarView error: \" + e.getMessage());\n}\n}\n</code></pre> \u72b6\u6001\u680f\u53d8\u5316\u5904\u7406 <pre><code>@Override\npublic WindowInsets onApplyWindowInsets(WindowInsets insets) {\n//...\nadjustPointBarLayoutParams(insets);\nreturn insets;\n} private void adjustPointBarLayoutParams(WindowInsets insets) {\nLog.e(TAG, \"adjustPointBarLayoutParams: \" + insets.getSystemWindowInsetsAsRect());\nif (mPointBarView != null &amp;&amp; mPointBarView.getLayoutParams() != null) {\ntry {\nfinal WindowConfiguration winConfig = getResources().getConfiguration().windowConfiguration;\nboolean isSplit = winConfig.getBounds().left != 0;\nLayoutParams layoutParams = (LayoutParams) mPointBarView.getLayoutParams();\nboolean statusBarVisible = insets.isVisible(WindowInsets.Type.statusBars())\n|| insets.getSystemWindowInsetTop() &gt; 0;\nlayoutParams.topMargin = isSplit ? 0 : getTopHeight(statusBarVisible);\nmPointBarView.post(()-&gt;{\nif (mPointBarView.getParent() == null) {\naddView(mPointBarView, layoutParams);\n} else {\nmPointBarView.setLayoutParams(layoutParams);\n}\nLog.e(TAG, \"adjustPointBarLayoutParams result: \" + layoutParams.topMargin);\n});\n} catch (Exception e) {\nLog.e(TAG, \"adjustPointBarLayoutParams error: \" + e.getMessage());\n}\n}\n}\n\nprivate int getTopHeight(boolean statusBarVisible) {\nboolean isWx = \"com.tencent.mm\".equals(mContext.getPackageName());\nint topHeight = isWx ? 86 : 99;\nreturn statusBarVisible ? topHeight : topHeight - 86;\n}\n\nprivate boolean isStatusBarVisible() {\nreturn getRootWindowInsets() != null &amp;&amp; getRootWindowInsets().isVisible(WindowInsets.Type.statusBars());\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#_5","title":"\u6e90\u7801\u4ee5\u53ca\u8d44\u6e90\u914d\u7f6e","text":"<p>\u6dfb\u52a0\u5f15\u7528\uff0c\u80fd\u5728java\u4ee3\u7801\u4e2d\u8c03\u7528\u8d44\u6e90id <pre><code>&lt;java-symbol type=\"layout\" name=\"point_bar_popup\" /&gt;\n&lt;java-symbol type=\"drawable\" name=\"icon_point_bar_left\" /&gt;\n&lt;java-symbol type=\"drawable\" name=\"icon_point_bar_right\" /&gt;\n&lt;java-symbol type=\"drawable\" name=\"icon_point_bar_float\" /&gt;\n&lt;java-symbol type=\"drawable\" name=\"dots\" /&gt;\n&lt;java-symbol type=\"drawable\" name=\"drag_text_bg\" /&gt;\n&lt;java-symbol type=\"style\" name=\"Animation.PopupWindow.HfcBar\" /&gt;\n</code></pre> PopupWindow\u52a8\u753b <pre><code>&lt;style name=\"Animation.PopupWindow.HfcBar\"&gt;\n&lt;item name=\"windowEnterAnimation\"&gt;@anim/cariad_popup_enter&lt;/item&gt;\n&lt;item name=\"windowExitAnimation\"&gt;@anim/cariad_popup_exit&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> View\u6e90\u7801</p> <p>PointBarView</p> <p>PointBarLinearLayout</p> <p>PointBarImageView</p>"},{"location":"android/fws/fws_split_case/#_6","title":"\u9ad8\u65af\u6a21\u7cca","text":""},{"location":"android/fws/fws_split_case/#_7","title":"\u5206\u5c4f\u5e94\u7528\u62d6\u62fd\u6a21\u7cca\u4ee5\u53ca\u6dfb\u52a0\u5e94\u7528\u540d\u79f0","text":"<p>frameworks/base/libs/WindowManager/Shell/src/com/android/wm/shell/common/split/SplitLayout.java <pre><code>private int mTempPosition;\npublic int getTempPosition() {\nreturn mTempPosition - mDividePosition;\n}\nprivate void updateBounds(int position) {  mTempPosition = position;\n//...\n}\n\n@Override\npublic void onLayoutSizeChanging(SplitLayout layout) {\nmSyncQueue.runInSync(t -&gt; {\nupdateSurfaceBounds(layout, t);\nmMainStage.onResizing(getMainStageBounds(), t, layout.getTempPosition());\nmSideStage.onResizing(getSideStageBounds(), t, layout.getTempPosition());\n});\n}\n</code></pre></p> <p>frameworks/base/libs/WindowManager/Shell/src/com/android/wm/shell/common/split/SplitDecorManager.java</p> <p>\u5e03\u5c40 frameworks/base/libs/WindowManager/Shell/res/layout/split_decor.xml <pre><code>&lt;TextView\nandroid:id=\"@+id/split_resizing_name\"\nandroid:layout_width=\"wrap_content\"\nandroid:layout_height=\"wrap_content\"\nandroid:layout_marginTop=\"25dp\"\nandroid:textColor=\"#FF000000\"\nandroid:visibility=\"gone\"\nandroid:maxLines=\"1\"\nandroid:ellipsize=\"end\"\nandroid:textSize=\"27sp\" /&gt;\n</code></pre> \u5728java\u4ee3\u7801\u4e2dmResizingIconView\u521d\u59cb\u5316\u7684\u5730\u65b9\u521d\u59cb\u5316\u6587\u672c\u7ec4\u4ef6</p> <pre><code>private static final int ICON_RADIUS = 17;\nprivate TextView mResizingTextView;\nprivate SurfaceControl mScreenshotLeash;\nprivate int mIconLeashWidth, mIconLeashHeight;\n\nmResizingTextView = rootLayout.findViewById(R.id.split_resizing_name);\n\npublic void onResizing(ActivityManager.RunningTaskInfo resizingTask, Rect newBounds,\nRect sideBounds, SurfaceControl.Transaction t, int offsetX, int offsetY,\nboolean immediately, int tempPosition) {\n//...\nboolean isLeftLeash = newBounds.left == SystemBarUtils.SPLIT_LEFT_RIGHT_PADDING;\nif (mScreenshotLeash == null) { //\u6dfb\u52a0\u5e94\u7528\u622a\u56fe\u5c42\nRect temp = new Rect(newBounds);\nif (isLeftLeash) {\ntemp.offset(-SystemBarUtils.SPLIT_LEFT_RIGHT_PADDING, -newBounds.top);\n} else {\ntemp.offset(-newBounds.left, -newBounds.top);\n}\nmScreenshotLeash = ScreenshotUtils.takeScreenshot(t, mHostLeash, temp, SPLIT_DIVIDER_LAYER - 2);\n}\nt.setPosition(mScreenshotLeash, 0, 0);\nint oriWidth = isLeftLeash ? newBounds.width() - tempPosition : newBounds.width() + tempPosition;\nif (oriWidth != 0) {\nfloat scaleX = newBounds.width() * 1.0f / oriWidth;\nfloat bgRadius = SystemBarUtils.SPLIT_WINDOW_CORNER_RADIUS * 2 / scaleX;\nt.setMatrix(mScreenshotLeash, scaleX, 0, 0, 1.0f);\nt.setCornerRadius(mScreenshotLeash, bgRadius);\n}\nif (mBackgroundLeash == null) {\n//...\nt.setColor(mBackgroundLeash, Color.valueOf(Color.WHITE).getComponents())\n.setAlpha(mBackgroundLeash, 0.85f)\n.setBackgroundBlurRadius(mBackgroundLeash, 50)\n}\nif (mIcon == null &amp;&amp; resizingTask.topActivityInfo != null) {\nmResizingIconView.setOutlineProvider(new ViewOutlineProvider() {\n@Override\npublic void getOutline(View view, Outline outline) {\noutline.setRoundRect(0, 0, view.getWidth(), view.getHeight(),\nICON_RADIUS * view.getContext().getResources().getDisplayMetrics().density);\n}\n});\nmResizingIconView.setClipToOutline(true);\nString appName = getAppNameFromActivityInfo(mResizingIconView.getContext(),\nresizingTask.topActivityInfo);\nmResizingTextView.setText(appName);\nmResizingTextView.setVisibility(View.VISIBLE);\n//...\nDisplayMetrics displayMetrics = mResizingIconView.getContext().getResources().getDisplayMetrics();\nlp.width = mIconLeashWidth = displayMetrics.widthPixels / 2;\n\nTextPaint paint = mResizingTextView.getPaint();\npaint.setTextSize(mResizingTextView.getTextSize());\nint textViewWidth = newBounds.width() - mResizingTextView.getPaddingLeft() - mResizingTextView.getPaddingRight();\n\nStaticLayout staticLayout = StaticLayout.Builder.obtain(appName, 0, appName.length(), paint, textViewWidth)\n.setMaxLines(mResizingTextView.getMaxLines())\n.setLineSpacing(mResizingTextView.getLineSpacingExtra(), mResizingTextView.getLineSpacingMultiplier())\n.setIncludePad(mResizingTextView.getIncludeFontPadding())\n.build();\n\nint totalHeight = staticLayout.getHeight() + mResizingTextView.getPaddingTop() + mResizingTextView.getPaddingBottom();\nmIconLeashHeight = (int) (100 * displayMetrics.density + totalHeight);\nlp.height = mIconLeashHeight;\n//...\n}\nt.setPosition(mIconLeash, newBounds.width() / 2.0f - mIconLeashWidth / 2.0f,\nnewBounds.height() / 2.0f - mIconLeashHeight / 2.0f);\n}\n\nprivate String getAppNameFromActivityInfo(Context context, ActivityInfo activityInfo) {\nPackageManager packageManager = context.getPackageManager();\nString name = activityInfo.applicationInfo.loadLabel(packageManager).toString();\nreturn name;\n}\n\npublic void onResized(Rect newBounds, SurfaceControl.Transaction t) {\nif (mScreenshotLeash != null) {\nt.remove(mScreenshotLeash);\nmScreenshotLeash = null;\n}\nif (mIcon != null) {\n//...    \nmResizingTextView.setVisibility(View.GONE);\nmResizingTextView.setText(\"\");\n//... \n}\n}\n\npublic void release(SurfaceControl.Transaction t) {\n//...\nif (mScreenshotLeash != null) {\nt.remove(mScreenshotLeash);\nmScreenshotLeash = null;\n}\n//...\n}\n</code></pre>"},{"location":"android/fws/fws_split_case/#icon","title":"\u5206\u5c4f\u62d6\u52a8icon\u4e0d\u6b63\u786e\u95ee\u9898","text":"<p>frameworks/base/libs/WindowManager/Shell/src/com/android/wm/shell/splitscreen/StageTaskListener.java</p> <p>\u901a\u8fc7\u5305\u540d\u5904\u7406 <pre><code>void onResizing(Rect newBounds, SurfaceControl.Transaction t, int tempPosition) {\nif (mSplitDecorManager != null &amp;&amp; mRootTaskInfo != null &amp;&amp; mRootTaskInfo.topActivity != null) {\nif (\"xxx.xxx.xxx\".equals(mRootTaskInfo.topActivity.getPackageName())) {\nint size = mChildrenTaskInfo.size();\nfor (int i = 0; i &lt; size; i++) {\nActivityManager.RunningTaskInfo runningTaskInfo = mChildrenTaskInfo.valueAt(i);\nif (runningTaskInfo != null &amp;&amp; runningTaskInfo.topActivity != null) {\nif (!\"xxx.xxx.xxx\".equals(runningTaskInfo.topActivity.getPackageName())) {\nLog.e(TAG, \"onResizing child: \" + runningTaskInfo.topActivity.toShortString() );\nmSplitDecorManager.onResizing(runningTaskInfo, newBounds, t, tempPosition);\nbreak;\n}\n}\n}\n} else {\nmSplitDecorManager.onResizing(mRootTaskInfo, newBounds, t, tempPosition);\n}\n}\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#_8","title":"\u5206\u5c4f\u754c\u9762\u80cc\u666f\u6a21\u7cca","text":"<p>\u539f\u7406\uff1a\u5728\u58c1\u7eb8\u56fe\u5c42\u4e0a\u6dfb\u52a0\u4e00\u5c42\u906e\u7f69\u5c42</p> <p>\u6e90\u7801\u8def\u5f84\uff1aframeworks/base/core/java/android/service/wallpaper/WallpaperService.java</p>"},{"location":"android/fws/fws_split_case/#_9","title":"\u65b9\u5f0f\u4e00(\u8017\u6027\u80fd)","text":"<p>\u76f4\u63a5\u4f7f\u7528SurfaceControl.Transaction\u4e2d\u7684setBackgroundBlurRadius <pre><code>SurfaceControl mMaskSurfaceControl;\nSurfaceControl.Transaction mTransaction = new SurfaceControl.Transaction();\nprivate Surface getOrCreateBLASTSurface(int width, int height, int format) {\nSurface ret = null;\nif (mBlastBufferQueue == null) {\n//...\ncreateMaskSurfaceControl();\n} else {\n//...\n}\n\nreturn ret;\n}\nprivate void createMaskSurfaceControl() {\nif (mMaskSurfaceControl == null) {\nmMaskSurfaceControl = new SurfaceControl.Builder()\n.setName(\"Wallpaper mask layer\")\n.setCallsite(\"Wallpaper.Mask.Layer\")\n.setParent(mBbqSurfaceControl)\n.setColorLayer()\n.build();\nmTransaction.setColor(mMaskSurfaceControl, Color.valueOf(Color.WHITE).getComponents())\n.setAlpha(mMaskSurfaceControl, 0.2f)\n.setBackgroundBlurRadius(mMaskSurfaceControl, 50)\n.apply();\n}\n}\n\npublic void showOrHideMaskSurfaceControl(boolean show) {\nif (show) {\nmTransaction.show(mMaskSurfaceControl);\n} else {\nmTransaction.hide(mMaskSurfaceControl);\n}\nmTransaction.apply();\n}\n</code></pre></p>"},{"location":"android/fws/fws_split_case/#_10","title":"\u65b9\u5f0f\u4e8c","text":"<p>\u539f\u7406\uff1a\u83b7\u53d6\u58c1\u7eb8\u7136\u540e\u8fdb\u884c\u6a21\u7cca\u5904\u7406\uff0c\u518d\u6dfb\u52a0\u56fe\u5c42</p> <p>frameworks/base/core/java/android/service/wallpaper/WallpaperService.java <pre><code>SurfaceControl mMaskSurfaceControl;\n\nSurfaceControl.Transaction mTransaction = new SurfaceControl.Transaction();\n\npublic class Engine {\n/**\n * @hide\n */\npublic void onMaskData() {\n\n}\n\nvoid detach() {\n//...\nif (mCreated) {\ndestroyMaskSurface();\n}\n}\n\nprivate void destroyMaskSurface() {\nif (mMaskSurfaceControl != null) {\nmTransaction.remove(mMaskSurfaceControl).apply();\nmMaskSurfaceControl = null;\n}\n}\n/**\n     * Show mask on wallpaper when enter split mode\n     * @hide\n     * @param show whether show mask\n     */\npublic void showOrHideMaskSurfaceControl(boolean show) {\nif (mMaskSurfaceControl == null) {\nLog.e(TAG, \"showOrHideMaskSurfaceControl error due to mMaskSurfaceControl is null: show = [\" + show + \"]\");\nreturn;\n}\nif (show) {\nmTransaction.show(mMaskSurfaceControl);\n} else {\nmTransaction.hide(mMaskSurfaceControl);\n}\nmTransaction.apply();\n}\n\nvoid updateMaskData(Bitmap bitmap) {\nBitmap blur = SystemBarUtils.blurBitmap(mDisplayContext, bitmap, 0.3f, 25.0f);\nint width = bitmap.getWidth();\nint height = bitmap.getHeight();\nint format = PixelFormat.RGBA_8888;\nint usage = GraphicBuffer.USAGE_HW_TEXTURE | GraphicBuffer.USAGE_SW_WRITE_OFTEN;\nGraphicBuffer graphicBuffer = GraphicBuffer.create(width, height, format, usage);\n\nCanvas canvas = graphicBuffer.lockCanvas();\ncanvas.drawBitmap(blur, 0, 0, null);\ngraphicBuffer.unlockCanvasAndPost(canvas);\nmTransaction.setBuffer(mMaskSurfaceControl, graphicBuffer);\nmTransaction.apply();\n\nonMaskData();\n}\nprivate void createMaskSurfaceControl() {\nLog.e(TAG, \"createMaskSurfaceControl: \" + mMaskSurfaceControl);\nif (mMaskSurfaceControl == null) {\nmMaskSurfaceControl = new SurfaceControl.Builder()\n.setName(\"Wallpaper mask layer\")\n.setCallsite(\"Wallpaper.Mask.Layer\")\n.setParent(mSurfaceControl)\n.setFormat(PixelFormat.TRANSLUCENT)\n.setBLASTLayer()\n.build();\nmTransaction.setColorSpace(mMaskSurfaceControl, ColorSpace.get(ColorSpace.Named.SRGB))\n.apply();\n}\n}\n\nprivate Surface getOrCreateBLASTSurface(int width, int height, int format) {\n//...\nif (mBlastBufferQueue == null) {\ncreateMaskSurfaceControl();\n}\n//...\n}\n\npublic void reportShown() {\nmConnection.engineShown(this);\n\nif (mEngine != null) {\nmEngine.updateMaskData(mWallpaperManager.getBitmap(false));\n}\n}\n}\n</code></pre></p> <p>\u5728\u5b50\u7c7b\u4e2d\u6bcf\u6b21\u58c1\u7eb8\u5207\u6362\u7684\u65f6\u5019\u66f4\u65b0\u6a21\u7cca\u56fe\u5c42</p> <p>frameworks/base/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java <pre><code>class GLEngine extends Engine implements DisplayListener {\n@Override\npublic void onMaskData() {\nsuper.onMaskData();\nif (isShowMask) {\nshowOrHideMaskSurfaceControl(true);\n}\n}\n}\n</code></pre> \u6a21\u7cca\u5b9e\u73b0api\uff1a</p> <p>https://blog.csdn.net/abc6368765/article/details/127657069 https://blog.csdn.net/liaosongmao1/article/details/130820665</p> <pre><code>/**\n * Blur the bitmap\n * @param context the context\n * @param bitmap pending bitmap\n * @param scale scale the bitmap to achieve more blur\n * @param radius blur radius between 0~25\n * @return\n */\npublic static Bitmap blurBitmap(Context context, Bitmap bitmap, float scale, float radius) {\nif (bitmap == null) {\nreturn null;\n}\nLog.i(\"TAG\", \"blurBitmap bitmap: \" + bitmap.getByteCount());\nint oriWidth = bitmap.getWidth();\nint oriHeight = bitmap.getHeight();\nint scaleWidth = Math.round(oriWidth * scale);\nint scaleHeight = Math.round(oriHeight * scale);\nBitmap scaledBitmap = Bitmap.createScaledBitmap(bitmap, scaleWidth, scaleHeight, false);\n// \u7528\u9700\u8981\u521b\u5efa\u9ad8\u65af\u6a21\u7ccabitmap\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684bitmap\nBitmap outBitmap = Bitmap.createBitmap(scaledBitmap);\n// \u521d\u59cb\u5316Renderscript\uff0c\u8be5\u7c7b\u63d0\u4f9b\u4e86RenderScript context\uff0c\u521b\u5efa\u5176\u4ed6RS\u7c7b\u4e4b\u524d\u5fc5\u987b\u5148\u521b\u5efa\u8fd9\u4e2a\u7c7b\uff0c\u5176\u63a7\u5236RenderScript\u7684\u521d\u59cb\u5316\uff0c\u8d44\u6e90\u7ba1\u7406\u53ca\u91ca\u653e\nRenderScript rs = RenderScript.create(context);\n// \u521b\u5efa\u9ad8\u65af\u6a21\u7cca\u5bf9\u8c61\nScriptIntrinsicBlur blurScript = ScriptIntrinsicBlur.create(rs, Element.U8_4(rs));\n// \u521b\u5efaAllocations\uff0c\u6b64\u7c7b\u662f\u5c06\u6570\u636e\u4f20\u9012\u7ed9RenderScript\u5185\u6838\u7684\u4e3b\u8981\u65b9\u6cd5\uff0c\u5e76\u5236\u5b9a\u4e00\u4e2a\u540e\u5907\u7c7b\u578b\u5b58\u50a8\u7ed9\u5b9a\u7c7b\u578b\nAllocation allIn = Allocation.createFromBitmap(rs, scaledBitmap);\nAllocation allOut = Allocation.createFromBitmap(rs, outBitmap);\n//\u8bbe\u5b9a\u6a21\u7cca\u5ea6(\u6ce8\uff1aRadius\u6700\u5927\u53ea\u80fd\u8bbe\u7f6e25.f)\nblurScript.setRadius(radius);\n// Perform the Renderscript\nblurScript.setInput(allIn);\nblurScript.forEach(allOut);\n// Copy the final bitmap created by the out Allocation to the outBitmap\nallOut.copyTo(outBitmap);\n// recycle the original bitmap\nbitmap.recycle();\n// After finishing everything, we destroy the Renderscript.\nrs.destroy();\nBitmap recBitmap = Bitmap.createScaledBitmap(outBitmap, oriWidth, oriHeight, true);\nreturn applyDarkness(recBitmap, 0.2f);\n}\n\npublic static Bitmap applyDarkness(Bitmap image, float darkness) {\nif (image == null) {\nreturn null;\n}\nBitmap outputBitmap = Bitmap.createBitmap(image.getWidth(), image.getHeight(), image.getConfig());\nCanvas canvas = new Canvas(outputBitmap);\ncanvas.drawBitmap(image, 0, 0, null);\n\nPaint paint = new Paint();\npaint.setColor(Color.BLACK);\npaint.setAlpha((int) (darkness * 255));\ncanvas.drawRect(0, 0, image.getWidth(), image.getHeight(), paint);\n\nreturn outputBitmap;\n}\n</code></pre>"},{"location":"android/fws/fws_split_case/#_11","title":"\u52a8\u6001\u63a7\u5236\u6a21\u7cca","text":"<p>frameworks/base/packages/SystemUI/src/com/android/systemui/ImageWallpaper.java <pre><code>private Engine mEngine;\n\nprivate WallpaperReceive mWallpaperReceive;\n\nboolean isShowMask;\n\n@Override\npublic void onCreate() {\n//...\nmWallpaperReceive = new WallpaperReceive();\nIntentFilter filter = new IntentFilter();\nfilter.addAction(\"action.wallpaper.mask_visibility\");\nregisterReceiver(mWallpaperReceive, filter, \"com.android.systemui.permission.WALLPAPER_MASK\", null);\n}\n\n@Override\npublic Engine onCreateEngine() {\nreturn mEngine = new GLEngine();\n}\n\n@Override\npublic void onDestroy() {\n//...\nif (mWallpaperReceive != null) {\nunregisterReceiver(mWallpaperReceive);\n}\n}\n\nprivate class WallpaperReceive extends BroadcastReceiver {\n\n@Override\npublic void onReceive(Context context, Intent intent) {\nLog.d(TAG, \"onReceive() called with: context = [\" + context + \"], intent = [\" + intent + \"]\"+ this);\nif (\"action.wallpaper.mask_visibility\".equals(intent.getAction())) {\nif (mEngine != null) {\nboolean maskShow = intent.getBooleanExtra(\"mask\", false);\nif (isShowMask == maskShow) {\nLog.i(TAG, \"onReceive not update surface\");\nreturn;\n}\nmEngine.showOrHideMaskSurfaceControl(maskShow);\nisShowMask = maskShow;\n}\n}\n}\n}\n</code></pre> \u7528\u4e8e\u5e7f\u64ad\u4ec5\u9650\u540c\u7b7e\u540d\u5e94\u7528\u4f7f\u7528\uff0c\u4fdd\u8bc1\u53ea\u80fd\u7cfb\u7edf\u5e94\u7528\u63a7\u5236</p> <p>frameworks/base/packages/SystemUI/AndroidManifest.xml</p> <p></p> <p>\u5177\u4f53\u63a7\u5236\u4ee3\u7801 <pre><code>private void showOrHideWallpaperMask(boolean isShow) {\nIntent intent = new Intent(\"action.wallpaper.mask_visibility\");\nintent.putExtra(\"mask\", isShow);\ncontext.sendBroadcast(intent);\n}\n</code></pre></p>"},{"location":"android/fws/fws_surface/","title":"Android\u56fe\u5f62\u7cfb\u7edf","text":""},{"location":"android/fws/fws_surface/#android","title":"Android\u4e4b\u56fe\u5f62\u7cfb\u7edf","text":""},{"location":"android/fws/fws_surface/#view","title":"View","text":""},{"location":"android/fws/fws_surface/#viewrootimpl","title":"ViewRootImpl","text":""},{"location":"android/fws/fws_surface/#window","title":"Window","text":""},{"location":"android/fws/fws_surface/#display","title":"Display","text":""},{"location":"android/fws/fws_surface/#surfaceview","title":"SurfaceView","text":""},{"location":"android/fws/fws_surface/#textureview","title":"TextureView","text":""},{"location":"android/fws/fws_surface/#canvas","title":"Canvas","text":"<p>Android\u4e2d\u7684\u753b\u5e03</p>"},{"location":"android/fws/fws_surface/#surface","title":"Surface","text":"<p>\u7ed8\u5236\u56fe\u5f62\u7684\u8f7d\u4f53\uff0c\u663e\u793a\u5185\u5bb9\u5982View\uff0cbitmap\u7b49\uff0c\u771f\u6b63\u7684\u753b\u5e03\uff0c\u4f1a\u5173\u8054\u4e00\u4e2aCanvas</p> <p>\u6bcf\u4e2aSuface\u90fd\u4f1a\u5728SurfaceFlinger\u4e2d\u6709\u5bf9\u5e94\u7684Layer\u56fe\u5c42</p>"},{"location":"android/fws/fws_surface/#surfaceflinger","title":"SurfaceFlinger","text":"<p>\u8d1f\u8d23\u628aLayer\u6309\u9700\u6df7\u5408\u5904\u7406\u540e\u8f93\u51fa\u5230Frame Buffer\u4e2d\uff0c\u518d\u7531Display\u8bbe\u5907\uff08\u5c4f\u5e55\u6216\u663e\u793a\u5668\uff09\u628aFrame Buffer\u91cc\u7684\u6570\u636e\u5448\u73b0\u5230\u5c4f\u5e55\u4e0a <pre><code>adb shell dumpsys SurfaceFlinger\n</code></pre></p>"},{"location":"android/fws/fws_surface/#surfacecontrol","title":"SurfaceControl","text":"<p>\u63a7\u5236Surface\u7684\u5c5e\u6027\u548c\u5c42\u6b21\u7ed3\u6784\uff0c\u4e00\u4e2aSurfaceControl\u5173\u8054\u4e00\u4e2aSurface\uff0c\u5e95\u5c42\u4f1a\u521b\u5efaSurface\u4e00\u822c\u4e0d\u9700\u8981\u5f00\u53d1\u8005\u521b\u5efa\u548c\u9500\u6bc1</p>"},{"location":"android/fws/fws_surface/#api","title":"API\u4ecb\u7ecd","text":""},{"location":"android/fws/fws_surface/#surfacecontroltransaction","title":"SurfaceControl.Transaction","text":"<p>\u7528\u6765\u64cd\u4f5cSurfaceControl\uff0c\u6bd4\u5982\u900f\u660e\u5ea6\u3001\u5927\u5c0f\u3001\u4f4d\u7f6e\u3001\u5706\u89d2\u7b49\u5c5e\u6027\uff0c\u8c03\u7528apply\u63d0\u4ea4\u624d\u4f1a\u751f\u6548</p>"},{"location":"android/fws/fws_surface/#api_1","title":"API\u4ecb\u7ecd","text":"<p>setBackgroundBlurRadius</p> <p>\u8bbe\u7f6e\u56fe\u5c42\u9ad8\u65af\u6a21\u7cca\uff0c\u786c\u4ef6\u8981\u6c42\u9ad8(\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bbe\u5907\u5361\u987f\uff0candroid12\u4ee5\u4e0a\u9ed8\u8ba4\u5f00\u542f)</p> <p>\u5f00\u542f\u65b9\u5f0f</p> <p>\u6e90\u7801\u7f16\u8bd1\u65b9\u5f0f\uff1a</p> <p>device/\u54c1\u724c/\u578b\u53f7/xxx.mk\u4e2d\u6dfb\u52a0 <pre><code>PRODUCT_PROPERTY_OVERRIDES += \\\n    ro.surface_flinger.supports_background_blur=1\n</code></pre> root\u65b9\u5f0f\uff1avendor/build.prop\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5373\u53ef</p>"},{"location":"android/fws/fws_surface/#viewsurface","title":"\u901a\u8fc7View\u521b\u5efaSurface\u56fe\u5c42","text":"<pre><code>final SurfaceSession session = new SurfaceSession();\nfinal SurfaceControl surfaceControl = new SurfaceControl.Builder(session)\n.setName(\"drag surface\")\n.setParent(root.getSurfaceControl())\n.setBufferSize(view.getWidth(), view.getHeight())\n.setFormat(PixelFormat.TRANSLUCENT)\n.setCallsite(\"View.startDragAndDrop\")\n.build();\nfinal Surface surface = new Surface();\nsurface.copyFrom(surfaceControl);\nfinal Canvas canvas = isHardwareAccelerated()\n? surface.lockHardwareCanvas()\n: surface.lockCanvas(null);\ntry {\ncanvas.drawColor(0, PorterDuff.Mode.CLEAR);\nview.draw(canvas);\n} finally {\nsurface.unlockCanvasAndPost(canvas);\n}\n\n// \u4e00\u822c\u7cfb\u7edf\u4e2d\u5df2\u6709Transaction\u5982wms\u4e2dmService.mTransactionFactory.get()\nSurfaceControl.Transaction transaction = new SurfaceControl.Transaction();\ntransaction.show(surfaceControl);\n// \u91cd\u65b0\u8bbe\u7f6e\u65b0\u7684\u7236\u7ea7SurfaceControl\ntransaction.reparent(surfaceControl, getDisplayContent().getOverlayLayer())\ntransaction.apply();\n\n// surface\u9700\u8981\u9500\u6bc1\nsurface.destory();\nsession.kill();\n</code></pre>"},{"location":"android/fws/fws_surface/#surface_1","title":"Surface\u6dfb\u52a0\u56fe\u5c42","text":"<pre><code>private SurfaceControl mAddLeash;\n\n// \u5728\u5f53\u524dmSurfaceControl\u4e0a\u6dfb\u52a0+\u56fe\u6807\nprivate void makeAddLeash() {\ntry (SurfaceControl.Transaction transaction =\nmService.mTransactionFactory.get()) {\nif (mAddLeash != null) {\ntransaction.show(mAddLeash);\ntransaction.apply();\nreturn;\n}\nmAddLeash = new SurfaceControl.Builder()\n.setName(\"drag add layer\")\n.setFormat(PixelFormat.TRANSLUCENT)\n.setParent(mSurfaceControl)\n.setCallsite(\"DragState.createShowAnimationLocked\")\n.setBLASTLayer()\n.build();\n//bitmap\u8f6c\u6210HardwareBuffer\u9700\u8981\u914d\u7f6e\u4e3aHARDWARE\u683c\u5f0f\nBitmapFactory.Options options = new BitmapFactory.Options();\noptions.inPreferredConfig = Bitmap.Config.HARDWARE;\n\nHardwareBuffer hardwareBuffer = BitmapFactory.decodeResource(mService.mContext.getResources(),\ncom.android.internal.R.drawable.ic_input_add, options).getHardwareBuffer();\n// android13\u63a8\u8350\u76f4\u63a5\u4f20HardwareBuffer\ntransaction.setBuffer(mAddLeash, GraphicBuffer.createFromHardwareBuffer(hardwareBuffer));\ntransaction.setColorSpace(mAddLeash, ColorSpace.get(ColorSpace.Named.SRGB));\ntransaction.show(mAddLeash);\ntransaction.setPosition(mAddLeash,\nmSurfaceControl.getWidth() - hardwareBuffer.getWidth(), 0);\n//\u751f\u6548\u5fc5\u987b\u8c03\u7528apply\ntransaction.apply();\n}\n}\n\n// \u63a7\u5236+\u56fe\u6807\u663e\u793a\u548c\u9690\u85cf\nprivate void visibleAddLeash(boolean isShow){\ntry (SurfaceControl.Transaction transaction =\nmService.mTransactionFactory.get()) {\nif (mAddLeash != null) {\nif (isShow) {\ntransaction.show(mAddLeash);\n} else {\ntransaction.hide(mAddLeash);\n}\ntransaction.apply();\n}\n}\n}\n</code></pre>"},{"location":"android/fws/fws_system_server/","title":"Fws system server","text":"<p><pre><code>if (\"start-system-server\".equals(argv[i])) {\nstartSystemServer = true;\n}\nif (startSystemServer) {\nRunnable r = forkSystemServer(abiList, zygoteSocketName, zygoteServer);\n\n// {@code r == null} in the parent (zygote) process, and {@code r != null} in the\n// child (system_server) process.\nif (r != null) {\nr.run();\nreturn;\n}\n}\nif (!enableLazyPreload) {\n...\npreload(bootTimingsTraceLog);// \u52a0\u8f7d\u7cfb\u7edfres\u8d44\u6e90\u3001sdk class\u548c\u5176\u4ed6libc\n...\n}\ncaller = zygoteServer.runSelectLoop(abiList);// \u6b7b\u5faa\u73af\uff0c\u63a5\u6536\u5176\u4ed6\u8fdb\u7a0b\u7684Socket\u6d88\u606f\n</code></pre> forkSystemServer\u65b9\u6cd5 <pre><code>String[] args = {\n\"--setuid=1000\",\n\"--setgid=1000\",\n\"--setgroups=1001,1002,1003,1004,1005,1006,1007,1008,1009,1010,1018,1021,1023,\"\n+ \"1024,1032,1065,3001,3002,3003,3005,3006,3007,3009,3010,3011,3012\",\n\"--capabilities=\" + capabilities + \",\" + capabilities,\n\"--nice-name=system_server\",\n\"--runtime-args\",\n\"--target-sdk-version=\" + VMRuntime.SDK_VERSION_CUR_DEVELOPMENT,\n\"com.android.server.SystemServer\",\n}\nZygoteCommandBuffer commandBuffer = new ZygoteCommandBuffer(args);\ntry {\nparsedArgs = ZygoteArguments.getInstance(commandBuffer);//\u89e3\u6790\u53c2\u6570\n} catch (EOFException e) {\nthrow new AssertionError(\"Unexpected argument error for forking system server\", e);\n}\n// \u521b\u5efaSystemServer\u8fdb\u7a0b\npid = Zygote.forkSystemServer(\nparsedArgs.mUid, parsedArgs.mGid,\nparsedArgs.mGids,\nparsedArgs.mRuntimeFlags,\nnull,\nparsedArgs.mPermittedCapabilities,\nparsedArgs.mEffectiveCapabilities);\nreturn handleSystemServerProcess(parsedArgs);\n</code></pre></p> <p>handleSystemServerProcess\u65b9\u6cd5\u4e2d\u6267\u884czygoteInit\u65b9\u6cd5 <pre><code>return ZygoteInit.zygoteInit(parsedArgs.mTargetSdkVersion,\nparsedArgs.mDisabledCompatChanges,\nparsedArgs.mRemainingArgs, cl);\n</code></pre> zygoteInit\u65b9\u6cd5\u4e2d <pre><code>ZygoteInit.nativeZygoteInit();\nreturn RuntimeInit.applicationInit(targetSdkVersion, disabledCompatChanges, argv,classLoader);\n</code></pre> nativeZygoteInit\u662fAndroidRuntime.cpp\u4e2d\u6ce8\u518c\u7684jni\u51fd\u6570 <pre><code>static void com_android_internal_os_ZygoteInit_nativeZygoteInit(JNIEnv* env, jobject clazz)\n{\ngCurRuntime-&gt;onZygoteInit();\n}\n</code></pre> \u6700\u7ec8\u4f1a\u5728app_main.cpp\u4e2d <pre><code>virtual void onZygoteInit()\n{\nsp&lt;ProcessState&gt; proc = ProcessState::self();\nALOGV(\"App process: starting thread pool.\\n\");\nproc-&gt;startThreadPool();//\u542f\u52a8Binder\u7ebf\u7a0b\u6c60\n}\n</code></pre> frameworks/base/core/java/com/android/internal/os/RuntimeInit.java \u6700\u7ec8\u901a\u8fc7\u53cd\u5c04\u8c03\u7528com.android.server.SystemServer\u7684main\u65b9\u6cd5 <pre><code>return findStaticMain(args.startClass, args.startArgs, classLoader);//\u8fd4\u56de\u7684\u65f6Runnable\uff0c\u56de\u5230\u6700\u5f00\u59cb\u7684r.run()\u4f1a\u901a\u8fc7\u53cd\u5c04\u6267\u884cmain\u65b9\u6cd5\n\npublic void run() {\n\u7701\u7565...\nmMethod.invoke(null, new Object[] { mArgs });\n\u7701\u7565...\n}\n</code></pre> frameworks/base/services/java/com/android/server/SystemServer.java <pre><code>public static void main(String[] args) {\nnew SystemServer().run();\n}\n</code></pre> \u8c03\u7528run\u65b9\u6cd5\uff0c\u91cd\u8981\u4ee3\u7801\u5982\u4e0b <pre><code>private void run() {\nLooper.prepareMainLooper();\nSystem.loadLibrary(\"android_servers\");//\u52a0\u8f7dlibandroid_servers.so\ncreateSystemContext();//\u521d\u59cb\u5316\u7cfb\u7edf\u4e0a\u4e0b\u6587\nmSystemServiceManager = new SystemServiceManager(mSystemContext);\nstartBootstrapServices(t);\nstartCoreServices(t);\nstartOtherServices(t);\nstartApexServices(t);\nLooper.loop();// looper\u6b7b\u5faa\u73af\uff0c\u4fdd\u8bc1\u8fdb\u7a0b\u4e0d\u4f1a\u9000\u51fa\n}\n</code></pre></p>"},{"location":"android/im/aidl/","title":"AIDL","text":""},{"location":"android/im/aidl/#_1","title":"\u652f\u6301\u6570\u636e\u7c7b\u578b","text":"<p>java\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1aint\u3001long\u3001boolean\u3001float\u3001double\u3001char\u3001byte</p> <p>\u5bf9\u8c61\u7c7b\u578b\uff1aString\u3001CharSequence\u3001ArrayList\u3001HashMap</p> <p>\u81ea\u5b9a\u4e49\u7c7b\u578b\uff1aParcelable</p>"},{"location":"android/im/aidl/#_2","title":"\u65b9\u5411\u6807\u8bb0","text":"<p>kotlin\u6570\u636e\u7c7b <pre><code>data class Person(var name: String, var age: Int)\n</code></pre> aidl\u6570\u636e\u7c7b <pre><code>package xxx;\nparcelable Person;\n</code></pre> \u6570\u636e\u63a5\u53e3 <pre><code>package xxx;\nimport xxx.Person;\ninterface IRemote {\n    void sendPerson(in Person person);\n    void sendPerson(out Person person);\n    void sendPerson(inout Person person);\n    oneway void sendPerson(in Person person);\n}\n</code></pre> in\uff1a\u4e0d\u5199\u9ed8\u8ba4\u6b64\u503c\uff0c\u7531cilent\u7aef\u6d41\u5411server\u7aef\uff0c\u5982client\u7aef\u53d1\u9001Person(\"A\", 20)\uff0cserver\u4fee\u6539\u540eclient\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd</p> <p>out\uff1a\u7531server\u7aef\u6d41\u5411client\u7aef\uff0c\u5982client\u7aef\u53d1\u9001Person(\"A\", 20)\uff0cserver\u5f97\u5230\u7684\u662fPerson(null, 0)\uff0cserver\u4fee\u6539\u540eclient\u540c\u6b65\u4fee\u6539</p> <p>inout\uff1a\u5bf9\u8c61\u53ef\u4ee5\u53cc\u5411\u6d41\u52a8</p> <p>oneway: \u5f02\u6b65</p>"},{"location":"android/im/aidl/#_3","title":"\u8fdb\u7a0b\u95f4\u901a\u4fe1","text":""},{"location":"android/im/aidl/#_4","title":"\u4e0d\u540c\u5e94\u7528","text":""},{"location":"android/im/aidl/#server","title":"server\u7aef","text":"<p>\u5728aidl\u76ee\u5f55\u4e0bpackage\u76ee\u5f55\u4e0b\u521b\u5efa\u4e24\u4e2aaidl\u6587\u4ef6 <pre><code>package xxx;\ninterface IRemoteCallback {\n    void onMessageReceived(String message);\n}\n\npackage xxx;\nimport xxx.IRemoteCallback;\ninterface IRemote {\n    void sendMsg(String msg);\n    void registerCallback(in IRemoteCallback callback);\n    void unregisterCallback(in IRemoteCallback callback);\n}\n</code></pre> \u521b\u5efa\u7ba1\u7406\u7c7b <pre><code>object AidlManager {\nprivate val TAG = \"AidlManager\"\n\nprivate val callbackList by lazy { RemoteCallbackList&lt;IRemoteCallback&gt;() }\n\nval binder: IRemote.Stub = object : IRemote.Stub() {\noverride fun sendMsg(msg: String) {\nval callbackCount = callbackList.beginBroadcast()\nfor (i in 0 until callbackCount) {\ntry {\ncallbackList.getBroadcastItem(i).onMessageReceived(msg)\n} catch (e: RemoteException) {\nLog.e(TAG, \"sendMsg: ${e.message}\")\n}\n}\ncallbackList.finishBroadcast()\n}\n\noverride fun registerCallback(callback: IRemoteCallback) {\ncallbackList.register(callback)\n}\n\noverride fun unregisterCallback(callback: IRemoteCallback) {\ncallbackList.unregister(callback)\n}\n}\n}\n</code></pre> \u521b\u5efa\u670d\u52a1 <pre><code>class AidlServerService : Service() {\n\noverride fun onBind(intent: Intent): IBinder = AidlManager.binder\n\noverride fun onStartCommand(intent: Intent, flags: Int, startId: Int): Int {\nsuper.onStartCommand(intent, flags, startId)\nreturn START_STICKY\n}\n}\n</code></pre> \u6e05\u5355\u6587\u4ef6\u914d\u7f6e <pre><code>&lt;service android:name=\"xxx\"\nandroid:enabled=\"true\"\nandroid:exported=\"true\"&gt;\n&lt;intent-filter&gt;\n&lt;action android:name=\"service.aidlserver\" /&gt;\n&lt;/intent-filter&gt;\n&lt;/service&gt;\n</code></pre></p>"},{"location":"android/im/aidl/#client","title":"client\u7aef","text":"<p>\u590d\u5236\u6574\u4e2aserver\u7aef\u7684aidl\u76ee\u5f55\uff0cpackage\u5fc5\u987b\u548cserver\u4fdd\u6301\u4e00\u81f4 <pre><code>private var mIRemote: IRemote? = null\nprivate val iRemoteCallback: IRemoteCallback = MyCallback()\n\ninner class MyCallback : IRemoteCallback.Stub() {\noverride fun onMessageReceived(message: String) {\nMainScope().launch {\n// \u5904\u7406server\u7aef\u8fd4\u56de\u6d88\u606f\n}\n}\n}\nprivate val serviceConnection: ServiceConnection = object : ServiceConnection {\noverride fun onServiceConnected(name: ComponentName, service: IBinder) {\nmIRemote = IRemote.Stub.asInterface(service)\ntry {\nmIRemote!!.registerCallback(iRemoteCallback)\n} catch (e: RemoteException) {\nLog.e(TAG, \"onServiceConnected: ${e.message}\")\n}\n}\n\noverride fun onServiceDisconnected(name: ComponentName) {\ntry {\nmIRemote!!.unregisterCallback(iRemoteCallback)\nmIRemote = null\n} catch (e: RemoteException) {\nLog.e(TAG, \"onServiceDisconnected: ${e.message}\")\n}\n}\n}\n//\u7ed1\u5b9a\u670d\u52a1\nval intent = Intent(IRemote::class.java.name)\nintent.action = \"service.aidlserver\"//\u4fdd\u6301\u548cserver\u914d\u7f6e\u4e00\u81f4\nintent.setPackage(\"server\u5305\u540d\")\nbindService(intent, serviceConnection, BIND_AUTO_CREATE)\n</code></pre> \u914d\u7f6e\u6e05\u5355\u6587\u4ef6\uff0cmanifest\u6807\u7b7e\u4e0b\u6dfb\u52a0\u5e94\u7528\u611f\u77e5\u80fd\u529b <pre><code>&lt;queries&gt;\n&lt;package android:name=\"server\u5305\u540d\" /&gt;\n&lt;/queries&gt;\n</code></pre> \u6ce8\uff1a</p> <ol> <li>registerCallback\u7684\u610f\u4e49\u5728\u4e8eserver\u4e5f\u53ef\u4e3b\u52a8sendMsg\u7ed9client(\u4e5f\u53ef\u4f7f\u7528\u5f02\u6b65)\uff0c\u5426\u5219\u76f4\u63a5\u5229\u7528\u8fd4\u56de\u503c\u5373\u53ef</li> <li>\u83b7\u53d6server\u6216\u8005client\u6807\u8bb0\u53ef\u901a\u8fc7getCallingPid()\u786e\u8ba4</li> </ol>"},{"location":"android/im/aidl/#_5","title":"\u540c\u5e94\u7528\u4e0d\u540c\u8fdb\u7a0b","text":"<p>\u548c\u4e0d\u540c\u5e94\u7528\u7c7b\u4f3c\uff0c\u4e0d\u9700\u8981\u590d\u5236aidl\u6587\u4ef6\u5939\u548c\u914d\u7f6equeries</p>"},{"location":"android/im/aidl/#_6","title":"\u5176\u4ed6","text":"<p>android studio\u4e0d\u80fd\u521b\u5efaaidl\u65e0\u6cd5\u65b0\u5efaAIDL\u6587\u4ef6</p>"},{"location":"android/im/base/","title":"\u57fa\u7840","text":""},{"location":"android/im/base/#_1","title":"\u8de8\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f","text":"<ol> <li>AIDL+Service</li> <li>\u5e7f\u64ad</li> </ol>"},{"location":"android/im/base/#_2","title":"\u8de8\u8bbe\u5907\u901a\u4fe1","text":"<ol> <li>Socket</li> </ol>"},{"location":"android/im/bluetooth/","title":"\u84dd\u7259","text":""},{"location":"android/im/bluetooth/#_1","title":"\u7ecf\u5178\u84dd\u7259","text":""},{"location":"android/im/bluetooth/#_2","title":"\u6dfb\u52a0\u6743\u9650","text":"<pre><code>&lt;uses-permission android:name=\"android.permission.BLUETOOTH\"/&gt;\n&lt;uses-permission android:name=\"android.permission.BLUETOOTH_SCAN\"/&gt;\n&lt;uses-permission android:name=\"android.permission.BLUETOOTH_ADMIN\"/&gt;\n&lt;uses-permission android:name=\"android.permission.BLUETOOTH_CONNECT\"/&gt;\n&lt;uses-permission android:name=\"android.permission.BLUETOOTH_PRIVILEGED\"\ntools:ignore=\"ProtectedPermissions\" /&gt;\n&lt;uses-permission android:name=\"android.permission.BLUETOOTH_ADVERTISE\"/&gt;\n&lt;uses-permission android:name=\"com.google.android.things.permission.MANAGE_BLUETOOTH\" /&gt;\n&lt;uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\"/&gt;\n</code></pre>"},{"location":"android/im/bluetooth/#_3","title":"\u52a8\u6001\u7533\u8bf7\u6743\u9650","text":""},{"location":"android/im/bluetooth/#xxpermissions","title":"\u4f7f\u7528\u4e09\u65b9\u6743\u9650\u5e93XXPermissions","text":"<pre><code>XXPermissions.with(this)\n.permission(Permission.ACCESS_FINE_LOCATION)\n.permission(Permission.Group.BLUETOOTH)\n.request(object : OnPermissionCallback {\noverride fun onGranted(permissions: MutableList&lt;String&gt;, allGranted: Boolean) {\nif (!allGranted) {\ntoast(\"\u83b7\u53d6\u90e8\u5206\u6743\u9650\u6210\u529f\uff0c\u4f46\u90e8\u5206\u6743\u9650\u672a\u6b63\u5e38\u6388\u4e88\")\nreturn\n}\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {\nval lm: LocationManager = getSystemService(Context.LOCATION_SERVICE) as LocationManager\nif (!lm.isProviderEnabled(LocationManager.GPS_PROVIDER)){\nToast.makeText(this@MainActivity, \"\u8bf7\u60a8\u5148\u5f00\u542fgps,\u5426\u5219\u84dd\u7259\u4e0d\u53ef\u7528\", Toast.LENGTH_SHORT).show()\n// \u521b\u5efa\u6307\u5411\u7cfb\u7edf\u5b9a\u4f4d\u670d\u52a1\u8bbe\u7f6e\u7684Intent\nval intent = Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS)\n// \u542f\u52a8\u8be5Intent\uff0c\u7528\u6237\u5c06\u88ab\u5e26\u5230\u7cfb\u7edf\u8bbe\u7f6e\u4e2d\u7684\u5b9a\u4f4d\u670d\u52a1\u9875\u9762\nstartActivity(intent)\n} else {\nif (!bluetoothAdapter.isEnabled) {\nstartActivity(Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE))\n} else {\nif (Build.MODEL != SERVER_MODEL) {\nregisterReceiver(receiver, BluetoothReceiver.markFilter())\nscanBluetooth()\n}\n}\n}\n}\n}\n\noverride fun onDenied(permissions: MutableList&lt;String&gt;, doNotAskAgain: Boolean) {\nif (doNotAskAgain) {\ntoast(\"\u88ab\u6c38\u4e45\u62d2\u7edd\u6388\u6743\uff0c\u8bf7\u624b\u52a8\u6388\u4e88\u5b9a\u4f4d\u9644\u8fd1\u6743\u9650\")\n// \u5982\u679c\u662f\u88ab\u6c38\u4e45\u62d2\u7edd\u5c31\u8df3\u8f6c\u5230\u5e94\u7528\u6743\u9650\u7cfb\u7edf\u8bbe\u7f6e\u9875\u9762\nXXPermissions.startPermissionActivity(this@MainActivity, permissions)\n} else {\ntoast(\"\u83b7\u53d6\u6743\u9650\u5931\u8d25\")\n}\n}\n})\n</code></pre>"},{"location":"android/im/bluetooth/#_4","title":"\u6ce8\u518c\u84dd\u7259\u5e7f\u64ad\u76d1\u542c","text":"<pre><code>registerReceiver(receiver, BluetoothReceiver.markFilter())\n\n@SuppressLint(\"MissingPermission\")\nclass BluetoothReceiver(private val block: (device: BluetoothDevice?) -&gt; Unit) : BroadcastReceiver() {\nprivate val TAG = \"BlueToothReceiver\"\noverride fun onReceive(context: Context, intent: Intent) {\nwhen (intent.action) {\nBluetoothDevice.ACTION_ACL_CONNECTED -&gt; Log.d(TAG, \"ACTION_ACL_CONNECTED\")\nBluetoothDevice.ACTION_ACL_DISCONNECTED -&gt; Log.d(\nTAG,\n\"ACTION_ACL_DISCONNECTED\"\n) // \u8fde\u63a5\u65ad\u5f00\uff0c\u505c\u6b62\u901a\u4fe1\nBluetoothDevice.ACTION_FOUND -&gt; {\n// \u627e\u5230\u8bbe\u5907\nval device =\nintent.getParcelableExtra&lt;BluetoothDevice&gt;(BluetoothDevice.EXTRA_DEVICE)\nblock(device)\n}\n\nBluetoothDevice.ACTION_BOND_STATE_CHANGED -&gt; {\n// \u8fdc\u7a0b\u8bbe\u5907\u7684\u7ed1\u5b9a\u72b6\u6001\u53d1\u751f\u53d8\u5316\nLog.d(TAG, \"ACTION_BOND_STATE_CHANGED\")\nwhen ((intent.getParcelableExtra&lt;Parcelable&gt;(BluetoothDevice.EXTRA_DEVICE) as BluetoothDevice?)!!.bondState) {\nBluetoothDevice.BOND_NONE -&gt; {}\nBluetoothDevice.BOND_BONDING -&gt; {}\nBluetoothDevice.BOND_BONDED -&gt; {}\n}\n}\n}\n}\n\ncompanion object {\n/**\n         * \u8bbe\u7f6eIntent\u8fc7\u6ee4\u5668\n         *\n         * @return\n         */\nfun markFilter(): IntentFilter {\nval filter = IntentFilter()\nfilter.addAction(BluetoothDevice.ACTION_FOUND)\nfilter.addAction(BluetoothDevice.ACTION_BOND_STATE_CHANGED)\nfilter.addAction(BluetoothDevice.ACTION_ACL_CONNECTED)\nfilter.addAction(BluetoothDevice.ACTION_ACL_DISCONNECTED)\nreturn filter\n}\n}\n}\n</code></pre>"},{"location":"android/im/bluetooth/#_5","title":"\u542f\u52a8/\u5173\u95ed\u84dd\u7259\u670d\u52a1\u7aef","text":"<p>BtServer <pre><code>btServer = BtServer(btServerListener)\nbtServer!!.startServer()\nbtServer?.close()\n</code></pre></p>"},{"location":"android/im/bluetooth/#_6","title":"\u542f\u52a8/\u5173\u95ed\u84dd\u7259\u5ba2\u6237\u7aef","text":"<p>BtClinet <pre><code>btClient = BtClient(blueDev, object : BluetoothListener{\noverride fun onStart() {\nMainScope().launch {\nholder.binding.blueItemStatusTv.text = \"\u6b63\u5728\u8fde\u63a5...\"\n}\n}\noverride fun onMsgRecv(socket: BluetoothSocket?, msg: String) {\nMainScope().launch {\nblock(true, msg)\n}\n}\noverride fun onError(error: String) {\nMainScope().launch {\nblock(false, error)\nholder.binding.blueItemStatusTv.text = \"\u5df2\u914d\u5bf9\"\n}\n}\noverride fun onConnected(msg: String) {\nMainScope().launch {\nholder.binding.blueItemStatusTv.text = \"\u5df2\u8fde\u63a5\"\n}\n}\n}).also {\nMainScope().launch {\nit.startClient()\n}\n}\nblueAdapter?.close()\n</code></pre> \u5176\u4e2d\u76d1\u542c\u56de\u8c03 <pre><code>val BLUE_UUID = UUID.fromString(\"00001101-0000-1000-8000-00805F9B34FB\")\ninterface BluetoothListener {\nfun onStart()\nfun onMsgRecv(socket: BluetoothSocket?, msg: String)\nfun onError(error: String)\nfun onConnected(msg: String)\n}\n</code></pre> \u5ba2\u6237\u7aef\u4e00\u822c\u662f\u5217\u8868\u5f62\u5f0f\u5c55\u73b0</p> <p>\u6bcf\u4e2a\u84dd\u7259\u8bbe\u5907\u7c7bBluetoothDevice</p> <p>\u5730\u5740: blueDev.address</p> <p>\u540d\u79f0: blueDev.name</p> <p>\u5df2\u914d\u5bf9\uff1a blueDev.bondState == BluetoothDevice.BOND_BONDED</p> <p>\u83b7\u53d6\u5217\u8868\uff1a\u6ce8\u518c\u5e7f\u64ad\u540e\u56de\u8c03\u6dfb\u52a0\u8bbe\u5907 <pre><code>private val receiver = BluetoothReceiver {\nit?.let { blueDev -&gt;\nif (blueDev !in blueBeans &amp;&amp; blueDev.name != null) {\nblueAdapter?.add(blueDev)\nblueAdapter?.notifyItemInserted(blueBeans.size)\n}\n}\n}\n</code></pre> \u542f\u52a8\u84dd\u7259\u626b\u63cf\u540e\uff0c\u5e7f\u64ad\u624d\u4f1a\u56de\u8c03 <pre><code>fun scanBluetooth() {\nblueBeans.clear()\nblueAdapter?.notifyDataSetChanged()\nval bondedDevices = bluetoothAdapter.bondedDevices // \u83b7\u53d6\u4ee5\u53ca\u914d\u5bf9\u7684\u8bbe\u5907\nbondedDevices?.forEach { device -&gt;\nblueBeans.add(device)\nblueAdapter?.notifyItemInserted(blueBeans.size)\n}\nif (bluetoothAdapter.isDiscovering) {\nbluetoothAdapter.cancelDiscovery()// \u53d6\u6d88\u626b\u63cf\n}\nbluetoothAdapter.startDiscovery()// \u5f00\u59cb\u626b\u63cf\n}\n</code></pre></p>"},{"location":"android/im/bluetooth/#_7","title":"\u5176\u4ed6","text":"<p>\u83b7\u53d6ip\u5730\u5740 <pre><code>fun getIPAddress(): String? {\ntry {\nval interfaces = NetworkInterface.getNetworkInterfaces()\nwhile (interfaces.hasMoreElements()) {\nval networkInterface = interfaces.nextElement()\nif (networkInterface.name == sKeyInterfaceName) {\nval addresses = networkInterface.inetAddresses\nwhile (addresses.hasMoreElements()) {\nval inetAddress = addresses.nextElement()\nif (!inetAddress.isLoopbackAddress &amp;&amp; !inetAddress.isLinkLocalAddress\n&amp;&amp; inetAddress.isSiteLocalAddress\n) {\nreturn inetAddress.hostAddress\n}\n}\n}\n}\n} catch (e: Exception) {\ne.printStackTrace()\n}\nreturn null\n}\n</code></pre> \u5224\u65ad\u662f\u5426\u662fIP\u5730\u5740 <pre><code>fun isIPv4Address(ipString: String): Boolean {\n// IPv4 \u5730\u5740\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u5f62\u5982 \"0.0.0.0\" \u81f3 \"255.255.255.255\" \u7684\u683c\u5f0f\nval ipv4Regex = \"^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$\"\nval pattern = Pattern.compile(ipv4Regex)\nreturn pattern.matcher(ipString).matches()\n}\n</code></pre></p>"},{"location":"android/im/broadcast_receiver/","title":"\u5e7f\u64ad","text":""},{"location":"android/im/broadcast_receiver/#_1","title":"\u5f00\u673a\u81ea\u542f\u5e7f\u64ad","text":""},{"location":"android/im/broadcast_receiver/#_2","title":"\u58f0\u660e\u6743\u9650\u548c\u6ce8\u518c","text":"<pre><code>&lt;uses-permission android:name=\"android.permission.RECEIVE_BOOT_COMPLETED\" /&gt;\n\n&lt;receiver\nandroid:name=\".bridge.BridgeBroadcastReceiver\"\nandroid:exported=\"true\"&gt;\n&lt;intent-filter&gt;\n&lt;action android:name=\"android.intent.action.BOOT_COMPLETED\" /&gt;\n&lt;/intent-filter&gt;\n&lt;/receiver&gt;\n</code></pre>"},{"location":"android/im/broadcast_receiver/#_3","title":"\u56de\u8c03\u76d1\u542c","text":"<p>\u5f00\u542f\u81ea\u542f\u540e\u53ef\u4ee5\u542f\u52a8\u670d\u52a1 <pre><code>class BridgeBroadcastReceiver : BroadcastReceiver() {\noverride fun onReceive(context: Context?, intent: Intent?) {\nintent?.let {\nwhen (it.action) {\nIntent.ACTION_BOOT_COMPLETED -&gt; {\nServiceManager.bindService()\n}\n}\n}\n}\n}\n</code></pre></p>"},{"location":"android/im/localsocket/","title":"LocalSocket","text":"<p>LocalSocket\u662f\u5b89\u5353\u7279\u6709\uff0c\u5254\u9664\u91ccSocket\u7f51\u7edc\u90e8\u5206</p> <p>app\u4e2d\u4e00\u822c\u65e0\u6cd5\u4f7f\u7528\uff0cjava\u5c42\u4f7f\u7528</p>"},{"location":"android/im/localsocket/#_1","title":"\u5c01\u88c5\u597d\u7684\u5de5\u5177","text":"<p>LocalSocketClientHandler</p> <p>Client</p> <p>LocalSocketServerHandler</p> <p>MsgListener</p>"},{"location":"android/im/localsocket/#client","title":"client\u7aef","text":"<p>\u521b\u5efa\u5ba2\u6237\u7aef\u5bf9\u8c61 <pre><code>private val clientHandler by lazy { LocalSocketClientHandler() }\n</code></pre> \u542f\u52a8\u5ba2\u6237\u7aef <pre><code>clientHandler.start(\"xxx\")//\u548c\u670d\u52a1\u7aef\u4fdd\u6301\u76f8\u540c\u540d\u5b57\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>clientHandler.send(\"xxx\")\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>localSocketServerHandler.setMsgListener(object : MsgListener {\noverride fun onMsgReceive(msg: String, client: LocalSocket) {\n//TODO\uff1a\u5904\u7406\u63a5\u6536\u5230\u6d88\u606f\n}\n\noverride fun onConnect(client: LocalSocket) {\n//TODO\uff1a\u8fde\u63a5\u6210\u529f\n}\n\noverride fun onClose(client: LocalSocket) {\n//TODO\uff1a\u5ba2\u6237\u7aef\u5173\u95ed\n}\n})\n</code></pre> \u5173\u95ed\u5ba2\u6237\u7aef <pre><code>clientHandler.closeClient()\n</code></pre></p>"},{"location":"android/im/localsocket/#server","title":"server\u7aef","text":"<p>\u521b\u5efa\u670d\u52a1\u7aef\u5bf9\u8c61 <pre><code>private val localSocketServerHandler by lazy { LocalSocketServerHandler() }\n</code></pre> \u542f\u52a8\u670d\u52a1\u7aef <pre><code>localSocketServerHandler.start(\"xxx\")\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>localSocketServerHandler.send(\"xxx\")\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>localSocketServerHandler.setMsgListener(object : MsgListener {\noverride fun onMsgReceive(msg: String, client: LocalSocket) {\n//TODO\uff1a\u5904\u7406\u63a5\u6536\u5230\u6d88\u606f\n}\n\noverride fun onConnect(client: LocalSocket) {\n//TODO\uff1a\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\n}\n\noverride fun onClose(client: LocalSocket) {\n//TODO\uff1a\u6709\u5ba2\u6237\u7aef\u5173\u95ed\n}\n})\n</code></pre> \u5173\u95ed\u670d\u52a1\u7aef <pre><code>localSocketServerHandler.closeServer()\n</code></pre></p>"},{"location":"android/im/netty/","title":"Netty","text":"<p><pre><code>MediaScannerConnection.scanFile(\nProxyApplication.getINSTANCE(),\narrayOf(imageMsg),\narrayOf(\"image/jpeg\")\n) { path: String?, uri: Uri? -&gt;\n// \u56fe\u7247\u626b\u63cf\u5b8c\u6bd5\uff0c\u7528\u6765\u4fdd\u8bc1\u56fe\u7247\u5199\u5165\u5b8c\u6574\u540e\u7ee7\u7eed\u5176\u4ed6\u64cd\u4f5c\n}\n</code></pre> netty\u53ef\u4ee5\u4e0eSocket\u6df7\u5408\u4f7f\u7528\uff0c\u5373client\u662fnetty\u7f16\u5199\uff0cserver\u662fsocket\u7f16\u5199\uff0c\u53cd\u4e4b\u4ea6\u53ef</p>"},{"location":"android/im/netty/#_1","title":"\u6dfb\u52a0\u4f9d\u8d56","text":"<pre><code>dependencies {\n    api (\"io.netty:netty-all:5.0.0.Alpha2\")\n}\n</code></pre>"},{"location":"android/im/netty/#_2","title":"\u5c01\u88c5\u7684\u5de5\u5177","text":""},{"location":"android/im/netty/#_3","title":"\u670d\u52a1\u7aef","text":"<p>com/hfc/netty/StringServerHandler</p> <p>com/hfc/netty/StringServerListener</p>"},{"location":"android/im/netty/#_4","title":"\u5ba2\u6237\u7aef","text":"<p>com/hfc/netty/StringClientHandler</p> <p>com/hfc/netty/StringClientListener</p>"},{"location":"android/im/netty/#_5","title":"\u57fa\u7c7b","text":"<p>com/hfc/netty/base/BaseHandler</p> <p>com/hfc/netty/base/SimpleChannelHandler</p> <p>com/hfc/netty/base/SimpleListener</p>"},{"location":"android/im/netty/#_6","title":"\u7b80\u5355\u4f7f\u7528","text":"<p>StringServerHandler\u548cStringClientHandler\u662f\u57fa\u4e8eString\u6d88\u606f\u5c01\u88c5\uff0c\u6d88\u606f\u89e3\u6790\u662f\u901a\u8fc7\u6362\u884c\u7b26</p>"},{"location":"android/im/netty/#server","title":"server\u7aef","text":"<p>\u542f\u52a8\u670d\u52a1\uff0c\u53c2\u6570port\u4e0d\u4f20\u9ed8\u8ba41235 <pre><code>StringServerHandler.startServer()\n</code></pre> \u5173\u95ed\u670d\u52a1 <pre><code>StringServerHandler.close()\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>StringServerHandler.registerListener(object : StringServerListener {\noverride fun channelActive() {\nlifecycleScope.launch {\n// \u5efa\u7acb\u8fde\u63a5\u5b8c\u6210\n}\n}\n\noverride fun channelInActive(msg: String) {\nlifecycleScope.launch {\n// \u65ad\u5f00\u8fde\u63a5\n}\n}\n\noverride fun messageReceived(msg: String) {\nlifecycleScope.launch {\n// \u6536\u5230\u6d88\u606f\n}\n}\n})\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>StringServerHandler.sendMsg(msg)\n</code></pre></p>"},{"location":"android/im/netty/#client","title":"client\u7aef","text":"<p>\u542f\u52a8\u670d\u52a1\uff0c\u53c2\u6570ip\u5730\u5740\uff0c\u5fc5\u4f20String\u7c7b\u578b\uff0cport\u4e0d\u4f20\u9ed8\u8ba41235 <pre><code>StringClientHandler.startClient(ipStr)\n</code></pre> \u5173\u95ed\u670d\u52a1 <pre><code>StringClientHandler.close()\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>StringClientHandler.registerListener(object : StringClientHandler {\noverride fun channelActive() {\nlifecycleScope.launch {\n// \u5efa\u7acb\u8fde\u63a5\u5b8c\u6210\n}\n}\n\noverride fun channelInActive(msg: String) {\nlifecycleScope.launch {\nwhen (msg) {\n\"ConnectException\" -&gt; {\n// \u670d\u52a1\u5668\u7aef\u672a\u542f\u52a8\n}\nelse -&gt; {\n// \u670d\u52a1\u5668\u7aef\u5173\u95ed\n}\n}\n}\n}\n\noverride fun messageReceived(msg: String) {\nlifecycleScope.launch {\n// \u6536\u5230\u6d88\u606f\n}\n}\n})\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>StringClientHandler.sendMsg(msg)\n</code></pre></p>"},{"location":"android/im/netty/#_7","title":"\u81ea\u5b9a\u4e49\u6d88\u606f\u4f53","text":"<p>\u4ee5\u4f20\u9012bitmap\u548cStirng\u4e3a\u4f8b</p> <ol> <li> <p>Listener\u63a5\u53e3\u7f16\u5199\uff0c\u7ee7\u627fSimpleListener <pre><code>fun messageReceived(bitmap: Bitmap)\nfun messageReceived(msg: String)\n</code></pre></p> </li> <li> <p>\u7f16\u5199Handler\uff0c\u7ee7\u627fBaseHandler&lt;\u4e0a\u9762Listener&gt;\uff0c\u7f16\u5199\u542f\u52a8\u51fd\u6570\u548c\u53d1\u9001\u6d88\u606f\u51fd\u6570 <pre><code>fun startServer(port: Int = 1234) {\nbuildTcpServer(port) { socketChannel -&gt;\nsocketChannel.pipeline().addLast(ByteArrayMessageEncoder())\nsocketChannel.pipeline().addLast(ByteArrayMessageDecoder())\nsocketChannel.pipeline()\n.addLast(object :\nSimpleChannelHandler&lt;ByteArrayMessage, ByteArrayServerListener&gt;(listener, this) {\noverride fun messageReceived(\nctx: ChannelHandlerContext,\nmsg: ByteArrayMessage\n) {\nwhen (msg.type) {\n0 -&gt; {\n//\u8f6c\u6210Bitmap\n}\n\n1 -&gt; {\n//\u8f6c\u6210String\n}\n}\n}\n})\n}\n}\n\nfun sendMsg(msg: ByteArrayMessage) {\ncheckHandlerContext {\nmainScope.launch {\nwithContext(Dispatchers.IO) {\nit.writeAndFlush(msg)\n}\n}\n}\n}\n</code></pre> \u5177\u4f53\u89c1</p> </li> </ol>"},{"location":"android/im/netty/#_8","title":"\u81ea\u5b9a\u4e49\u89e3\u7801\u5668","text":"<p>com/hfc/netty/decoder/ByteArrayMessageDecoder</p>"},{"location":"android/im/netty/#_9","title":"\u81ea\u5b9a\u4e49\u7f16\u7801\u5668","text":"<p>com/hfc/netty/encoder/ByteArrayMessageEncoder</p>"},{"location":"android/im/netty/#_10","title":"\u81ea\u5b9a\u4e49\u6570\u636e\u5305","text":"<p>com/hfc/netty/pack/ByteArrayMessage</p>"},{"location":"android/im/netty/#_11","title":"\u81ea\u5b9a\u4e49\u5ba2\u6237\u7aef","text":"<p>com/hfc/netty/ByteArrayClientHandler</p> <p>com/hfc/netty/ByteArrayClientListener</p>"},{"location":"android/im/netty/#_12","title":"\u81ea\u5b9a\u4e49\u670d\u52a1\u7aef","text":"<p>com/hfc/netty/ByteArrayServerHandler</p> <p>com/hfc/netty/StringServerHandler</p> <p>\u53d1\u9001\u56fe\u7247\u5b57\u8282 <pre><code>private val imgs = listOf(R.mipmap.test1, R.mipmap.test2, R.mipmap.test3)\nlifecycleScope.launch {\nval bitmapsFlow: List&lt;ByteArrayMessage&gt; = imgs.asFlow()\n.map { resourceId -&gt;\nBitmapFactory.decodeResource(resources, resourceId)\n}.map { bitmap -&gt;\nval baos = ByteArrayOutputStream().apply {\nbitmap.compress(Bitmap.CompressFormat.PNG, 100, this)\n}\nval byte = baos.toByteArray()\nByteArrayMessage(byte, byte.size)\n}\n.flowOn(Dispatchers.IO)\n.toList()\nAlbumClientHandler.sendMsg(bitmapsFlow)\n}\n</code></pre></p>"},{"location":"android/im/nfc/","title":"nfc","text":""},{"location":"android/im/nfc/#_1","title":"\u7406\u8bba","text":""},{"location":"android/im/nfc/#nfc","title":"NFC\u6807\u7b7e","text":"<ul> <li>\u4e00\u79cd\u5185\u7f6eNFC\u82af\u7247\u7684\u5c0f\u578b\u7535\u5b50\u6807\u7b7e</li> <li>\u53ef\u4ee5\u5b58\u50a8\u4fe1\u606f\uff0c\u5982\u7f51\u5740\u3001\u6587\u5b57\u3001\u7535\u8bdd\u53f7\u7801\u6216\u7279\u5b9a\u6307\u4ee4</li> <li>\u4e0d\u9700\u8981\u7535\u6c60</li> <li>NFC\u529f\u80fd\u7684\u8bbe\u5907\uff08\u5982\u667a\u80fd\u624b\u673a\uff09\u9760\u8fd1\u65f6\uff0c\u53ef\u4ee5\u65e0\u7ebf\u65b9\u5f0f\u6fc0\u6d3b\u5e76\u4ea4\u6362\u4fe1\u606f</li> </ul>"},{"location":"android/im/nfc/#_2","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4ea7\u54c1\u9632\u4f2a\u3001\u4fe1\u606f\u67e5\u8be2\u3001\u5e7f\u544a\u4e92\u52a8\u3001\u667a\u80fd\u5bb6\u5c45\u63a7\u5236\u3001\u4ee5\u53ca\u5b9e\u73b0\u5feb\u901f\u8bbe\u7f6e\u624b\u673a\uff08\u5982\u5207\u6362\u9759\u97f3\u6a21\u5f0f\u3001\u5f00\u542fWi-Fi\u7b49\uff09</p> <p>\u5de5\u4f5c\u539f\u7406\u57fa\u4e8eISO 14443A\u6216ISO 15693\u534f\u8bae\uff0c\u901a\u5e38\u572813.56MHz\u7684\u9ad8\u9891\u4e0b\u8fd0\u4f5c\uff0c\u8bfb\u5199\u8ddd\u79bb\u4e00\u822c\u57281-10\u5398\u7c73\u4e4b\u95f4</p>"},{"location":"android/im/nfc/#nfc_1","title":"\u624b\u673anfc\u6a21\u5757","text":"<ul> <li>\u8fd1\u573a\u901a\u4fe1\u6a21\u5757\uff0c\u9700\u8981\u6253\u901a\u9a71\u52a8\u5982pn7160</li> <li>\u7ed3\u5408RFID\uff08\u5c04\u9891\u8bc6\u522b\uff09\u548c\u65e0\u7ebf\u901a\u4fe1\u6280\u672f</li> </ul>"},{"location":"android/im/nfc/#_3","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u79fb\u52a8\u652f\u4ed8\u3001\u6570\u636e\u4f20\u8f93\u3001\u65e0\u7ebf\u914d\u5bf9\uff08\u5982\u84dd\u7259\u97f3\u7bb1\u3001\u8033\u673a\uff09\u4ee5\u53ca\u6a21\u62df\u5b9e\u4f53\u5361\u7247\uff08\u5982\u516c\u4ea4\u5361\u3001\u95e8\u7981\u5361\uff09\u7b49\u529f\u80fd</p>"},{"location":"android/im/nfc/#_4","title":"\u57fa\u672c\u4f7f\u7528","text":""},{"location":"android/im/nfc/#_5","title":"\u58f0\u660e\u6743\u9650","text":"<pre><code>&lt;uses-permission android:name=\"android.permission.NFC\" /&gt;\n\n&lt;uses-feature\nandroid:name=\"android.hardware.nfc\"\nandroid:required=\"true\" /&gt;\n</code></pre>"},{"location":"android/im/nfc/#nfc_2","title":"nfc\u9002\u914d\u5668","text":"<p>\u5fc5\u987b\u4f9d\u8d56\u4e8eactivity\uff0c\u5982\u679c\u83b7\u53d6\u4e0d\u5230\u5219\u8bbe\u5907\u4e0d\u652f\u6301nfc <pre><code>val nfcAdapter = NfcAdapter.getDefaultAdapter(activity)\nif (nfcAdapter == null) {\nToast.makeText(activity, \"\u8bbe\u5907\u4e0d\u652f\u6301NFC\", Toast.LENGTH_SHORT).show()\n}\n</code></pre></p>"},{"location":"android/im/nfc/#nfc_3","title":"\u5f00\u542fnfc","text":"<p>\u5982\u679cnfc\u6ca1\u5f00\u542f\uff0c\u53ef\u8df3\u8f6c\u5230\u8bbe\u7f6e\u754c\u9762\u5f00\u542f <pre><code>if (!nfcAdapter.isEnabled) {\nToast.makeText(activity, \"NFC\u672a\u5f00\u542f\uff0c\u8bf7\u5f00\u542fNFC\u529f\u80fd\", Toast.LENGTH_SHORT).show()\nval intent = Intent(Settings.ACTION_NFC_SETTINGS)\nactivity.startActivity(intent)\n}\n</code></pre></p>"},{"location":"android/im/nfc/#nfc_4","title":"\u68c0\u6d4bnfc\u6807\u7b7e\u7b49\u8bbe\u5907","text":"<p>\u65b9\u5f0f\u4e00\uff1areader\u6a21\u5f0f\uff0c\u5141\u8bb8\u5728\u540e\u53f0\u68c0\u6d4b(\u4e5f\u9700\u8981activity) <pre><code>// \u5f00\u542f\nval flags = NfcAdapter.FLAG_READER_NFC_A or\nNfcAdapter.FLAG_READER_NFC_B or\nNfcAdapter.FLAG_READER_NFC_F or\nNfcAdapter.FLAG_READER_NFC_V or\nNfcAdapter.FLAG_READER_NFC_BARCODE\nnfcAdapter?.enableReaderMode(activity, { tag -&gt; }, flags, null)\n\n// \u5173\u95ed\nnfcAdapter?.disableReaderMode(activity)\n</code></pre></p> <p>\u65b9\u5f0f\u4e8c\uff1a\u5206\u53d1\u6a21\u5f0f\uff0c\u754c\u9762\u663e\u793a\u65f6\u9996\u5148\u62e6\u622a\uff0c\u5426\u5219\u8d70\u7cfb\u7edf <pre><code>// \u5f00\u542f\nval intent = Intent(activity, activity::class.java).apply {\naddFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP)\n}\nval pendingIntent = PendingIntent.getActivity(\nactivity, 0, intent,\nPendingIntent.FLAG_MUTABLE or PendingIntent.FLAG_UPDATE_CURRENT\n)\nnfcAdapter.enableForegroundDispatch(\nactivity,\npendingIntent,\nintentFiltersArray,\ntechListsArray\n)\n// \u5173\u95ed\nnfcAdapter.disableForegroundDispatch(activity)\n</code></pre> \u5728activity\u4e2d\u91cd\u5199onNewIntent <pre><code>override fun onNewIntent(intent: Intent) {\nsuper.onNewIntent(intent)\nhandleIntent(intent)\n}\n\nprivate fun handleIntent(intent: Intent?) {\nintent?.let {\nif (NfcAdapter.ACTION_NDEF_DISCOVERED == it.action) {\nit.getParcelableArrayExtra(NfcAdapter.EXTRA_NDEF_MESSAGES)?.let { rawMessages -&gt;\n\n}\n}\n}\n}\n</code></pre></p>"},{"location":"android/im/nfc/#activity","title":"Activity\u4f7f\u7528","text":"<p>\u4e00\u822c\u5728onResume\u548conPause\u4e2d\u5f00\u542fnfc\u68c0\u6d4b <pre><code>public override fun onResume() {\n    super.onResume()\n//        NfcManager.enableNfcDispatcher(this)\n    NfcManager.enableNfcReaderMode(this) {\n        it?.let { message -&gt;\n        }\n    }\n}\n\npublic override fun onPause() {\n    super.onPause()\n    NfcManager.disableNfcDispatcher(this)\n//        NfcManager.disableNfcReaderMode(this)\n}\n</code></pre></p>"},{"location":"android/im/nfc/#_6","title":"\u89e3\u6790\u6807\u7b7e","text":"<p>\u4ee5\u6587\u672c\u5185\u5bb9\u4e3a\u4f8b\uff0c\u5176\u4ed6\u8fd8\u6709\uff1aURL\u3001\u7535\u8bdd\u3001\u540d\u7247\u3001\u84dd\u7259\u3001WIFI\u3001\u5e94\u7528\u3001\u4f4d\u7f6e\u3001\u6570\u636e\u3001\u6536\u85cf\u5939\u7b49 <pre><code>val ndef = Ndef.get(tag)\nif (ndef != null) {\nndef.connect()\ntry {\nndef.cachedNdefMessage.records.forEach { record -&gt;\nif (record.tnf == NdefRecord.TNF_WELL_KNOWN &amp;&amp;\nrecord.type.contentEquals(NdefRecord.RTD_TEXT)\n) {\ntry {\nval payload = record.payload\nval textEncoding = if ((payload[0].toInt() and 0x80) == 0) \"UTF-8\" else \"UTF-16\"\nval languageSize = payload[0].toInt() and 0x3F\nString(\npayload, languageSize + 1,\npayload.size - languageSize - 1, Charset.forName(textEncoding)\n)\n} catch (e: UnsupportedEncodingException) {\nLog.e(TAG, \"Unsupported Encoding\", e)\n}\n} else {\n/* \u53ef\u4ee5\u5728\u8fd9\u91cc\u6dfb\u52a0\u5bf9\u5176\u4ed6\u7c7b\u578bNDEF\u8bb0\u5f55\u7684\u652f\u6301 */\nLog.e(TAG, \"other type: ${record.type}\" )\n}\n}\n} finally {\nndef.close()\n}\n}\n</code></pre></p>"},{"location":"android/im/nfc/#_7","title":"\u5de5\u5177\u7c7b","text":"<p>NfcManager</p>"},{"location":"android/im/nfc/#nfc_5","title":"nfc\u5199\u6570\u636e","text":"<p>\u8d2d\u4e70nfc\u6807\u7b7e\u8d34</p> <p>\u5de5\u5177\uff1a\u4e0b\u8f7dNFC\u6807\u7b7e\u52a9\u624b</p>"},{"location":"android/im/service/","title":"Service","text":""},{"location":"android/im/service/#_1","title":"\u524d\u53f0\u670d\u52a1","text":""},{"location":"android/im/service/#_2","title":"\u58f0\u660e\u6743\u9650\u548c\u6ce8\u518c","text":"<p>\u5176\u4e2d\u7535\u91cf\u4f18\u5316\u7528\u4e8e\u4fdd\u6d3b\u76f8\u5173\uff0cWAKE_LOCK\u7528\u6765\u4fdd\u8bc1\u4f20\u8f93\u6570\u636e\u65f6\u4fdd\u8bc1cpu\u6d3b\u8dc3\u4e5f\u7528\u4e8e\u4fdd\u6301\u5e38\u4eae <pre><code>&lt;uses-permission android:name=\"android.permission.POST_NOTIFICATIONS\" /&gt;\n&lt;uses-permission android:name=\"android.permission.NOTIFICATION_SERVICE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.FOREGROUND_SERVICE_DATA_SYNC\" /&gt;\n&lt;uses-permission android:name=\"android.permission.VIBRATE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.WAKE_LOCK\" /&gt;\n&lt;uses-permission android:name=\"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS\" /&gt;\n\n&lt;service\nandroid:name=\".bridge.BridgeService\"\nandroid:enabled=\"true\"\nandroid:exported=\"true\"\nandroid:foregroundServiceType=\"dataSync\" /&gt;\n</code></pre></p>"},{"location":"android/im/service/#_3","title":"\u542f\u52a8\u670d\u52a1","text":"<pre><code>private fun startService() {\nval intent = Intent(ProxyApplication.application, BridgeService::class.java)\nintent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\nProxyApplication.application.startForegroundService(intent)\n} else {\nProxyApplication.application.startService(intent)\n}\n}\n</code></pre>"},{"location":"android/im/service/#_4","title":"\u521b\u5efa\u901a\u77e5","text":"<p>\u524d\u53f0\u670d\u52a1\u5fc5\u987b\u521b\u5efa\u901a\u77e5 <pre><code>private val BRIDGE_CHANNEL_ID = \"channel_xx\"\nprivate val BRIDGE_CHANNEL_NAME = \"BridgeService\"\nprivate val BRIDGE_NOTIFICATION_ID = 1\n\nprivate val notificationManager by lazy {\ngetSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n}\n\noverride fun onCreate() {\nsuper.onCreate()\ncreateNotificationForForegroundService()\n}\n\noverride fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\nLog.i(TAG, \"onStartCommand: $intent\")\nintent?.let {\n\n}\nreturn START_STICKY\n}\n\n@SuppressLint(\"RemoteViewLayout\")\nfun createNotificationForForegroundService() {\n// \u9002\u914d8.0\u53ca\u4ee5\u4e0a\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O &amp;&amp;\nnotificationManager.getNotificationChannel(BRIDGE_CHANNEL_ID) == null\n) {\nval channel = NotificationChannel(\nBRIDGE_CHANNEL_ID,\nBRIDGE_CHANNEL_NAME,\nNotificationManager.IMPORTANCE_DEFAULT\n)\nnotificationManager.createNotificationChannel(channel)\n}\n\n// \u9002\u914d12.0\u53ca\u4ee5\u4e0a\nval flag = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.S) {\nPendingIntent.FLAG_IMMUTABLE\n} else {\nPendingIntent.FLAG_UPDATE_CURRENT\n}\n\n// \u6dfb\u52a0\u81ea\u5b9a\u4e49\u901a\u77e5view\nval views = RemoteViews(packageName, R.layout.notification_bridge)\n\n// \u521b\u5efaBuilder\nval builder: NotificationCompat.Builder = NotificationCompat.Builder(\nthis, BRIDGE_CHANNEL_ID)\n.setSmallIcon(R.mipmap.ic_launcher)\n.setAutoCancel(true)\n.setCustomContentView(views)\n.setPriority(1000)\n\nval type = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {\nServiceInfo.FOREGROUND_SERVICE_TYPE_DATA_SYNC\n} else {\n0\n}\nif (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.Q) {\nstartForeground(BRIDGE_NOTIFICATION_ID, builder.build(), type)\n}\n}\n</code></pre></p>"},{"location":"android/im/udp/","title":"Udp","text":""},{"location":"android/im/udp/#_1","title":"\u670d\u52a1\u7aef","text":"<p>object UdpTask {     private val timer by lazy { Timer() }     private val timerTask by lazy {         object : TimerTask() {             override fun run() {                 Log.d(\"yuli\", \"schedule to send ip\")                 try {                     udpSocket.send(sendPacket)                 } catch (e: Exception) {                     Log.e(\"yuli\", \"run: ${e.message}\")                 }             }         }     }     private val udpSocket by lazy {         DatagramSocket().apply { broadcast = true }     }     private val helloMsg by lazy { \"hello\".toByteArray() }</p> <pre><code>private val sendPacket by lazy {\n    DatagramPacket(\n        helloMsg,\n        helloMsg.size,\n        InetAddress.getByName(\"255.255.255.255\"),\n        12344\n    )\n}\n\nfun sayHelloForJava() {\n    MainScope().launch {\n        sayHello()\n    }\n}\n\nsuspend fun sayHello(){\n    try {\n        sayHelloInner()\n    } catch (e: Exception) {\n        e.printStackTrace()\n        Log.e(\"yuli\", \"run: ${e.message}\")\n    } finally {\n        udpSocket.close()\n        Log.d(\"yuli\", \"close socket\")\n    }\n}\n\nprivate suspend fun sayHelloInner() {\n    withContext(Dispatchers.IO) {\n        udpSocket.send(sendPacket)\n        timer.scheduleAtFixedRate(timerTask, 1000, 1000)\n    }\n\n    withContext(Dispatchers.IO) {\n        Log.d(\"yuli\", \"ready while to receive ok\")\n        while (true) {\n            val receiveData = ByteArray(1024)\n            val receivePacket = DatagramPacket(receiveData, receiveData.size)\n\n            udpSocket.receive(receivePacket)\n            val responseMessage = String(receivePacket.data, 0, receivePacket.length)\n            Log.d(\"yuli\", \"receive: $responseMessage\")\n            if (\"ok\" == responseMessage) {\n                timer.cancel()\n                break\n            }\n        }\n    }\n}\n\nfun stop(){\n    timer.cancel()\n    try {\n        udpSocket.close()\n    } catch (e: Exception) {\n        e.printStackTrace()\n    }\n}\n</code></pre> <p>}</p>"},{"location":"android/im/udp/#_2","title":"\u5ba2\u6237\u7aef","text":"<p>object UdpTask {     private val udpSocket by lazy {         DatagramSocket(12344).apply { broadcast = true }     }</p> <pre><code>fun receiveHelloForJava(callback: (String) -&gt; Unit) {\n    MainScope().launch {\n        receiveHello(callback)\n    }\n}\n\nsuspend fun receiveHello(callback: (String) -&gt; Unit) {\n    try {\n        receiveHelloInner(callback)\n    } catch (e: Exception) {\n        e.printStackTrace()\n    } finally {\n        udpSocket.close()\n        Log.d(\"yuli\", \"close socket\")\n    }\n}\n\nprivate suspend fun receiveHelloInner(callback: (String) -&gt; Unit) {\n    withContext(Dispatchers.IO) {\n        while (true) {\n            val receiveData = ByteArray(1024)\n            val receivePacket = DatagramPacket(receiveData, receiveData.size)\n\n            udpSocket.receive(receivePacket)\n            val ip = receivePacket.address.hostAddress ?: \"\"\n            Log.e(\"yuli\", \"recvIp: $ip\")\n            if (ip.isNotEmpty()) {\n                callback(ip)\n                val confirm = \"ok\".toByteArray()\n                val packet = DatagramPacket(confirm, confirm.size,\n                    receivePacket.address,\n                    receivePacket.port)\n                udpSocket.send(packet)\n                Log.e(\"yuli\", \"send ok\")\n                break\n            }\n        }\n    }\n}\n</code></pre> <p>}</p>"},{"location":"android/java/java_annotation/","title":"Java annotation","text":""},{"location":"android/java/java_annotation/#1","title":"1.\u57fa\u672c\u4f7f\u7528","text":"<p><pre><code>@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.SOURCE)\npublic @interface MyAnnotation {\nString value();\n}\n</code></pre> value\u6bd4\u8f83\u7279\u6b8a\uff0c\u5728\u4f7f\u7528\u65f6\u65e0\u9700\u6307\u5b9a <pre><code>@MyAnnotation(\"MyClass\")\npublic class MyClass {\n\uff5d\n</code></pre> \u5982\u679c\u6362\u6210\u522b\u7684\u540d\u5b57\u5982id\uff0c\u5219\u9700\u8981\u5982\u4e0b\u5199\u6cd5 <pre><code>@MyAnnotation(id = \"MyClass\")\npublic class MyClass {\n\uff5d\n</code></pre> \u5982\u679c\u662f\u591a\u4e2a\u5143\u7d20\u5219\u5fc5\u987b\u5168\u90e8\u4ee5xxx = aa\uff0cyyy = bb\u5199\u6cd5</p>"},{"location":"android/java/java_annotation/#target","title":"@Target","text":"<p>\u4f5c\u7528\u4e8e\u4ec0\u4e48\u5bf9\u8c61\u4e0a\uff0c\u5982\u4e0b\u8868\u793a\u53ef\u4ee5\u4f5c\u7528\u5728\u7c7b\u4e0a\u3001\u5c5e\u6027\u4e0a\u3001\u65b9\u6cd5\u4e0a <pre><code>@Target({ElementType.TYPE, ElementType.FIELD, ElementType.METHOD})\n</code></pre> * ElementType.ANNOTATION_TYPE \u53ef\u4ee5\u5e94\u7528\u4e8e\u6ce8\u89e3\u7c7b\u578b\u3002 * ElementType.CONSTRUCTOR \u53ef\u4ee5\u5e94\u7528\u4e8e\u6784\u9020\u51fd\u6570\u3002 * ElementType.FIELD \u53ef\u4ee5\u5e94\u7528\u4e8e\u5b57\u6bb5\u6216\u5c5e\u6027\u3002 * ElementType.LOCAL_VARIABLE \u53ef\u4ee5\u5e94\u7528\u4e8e\u5c40\u90e8\u53d8\u91cf\u3002 * ElementType.METHOD \u53ef\u4ee5\u5e94\u7528\u4e8e\u65b9\u6cd5\u7ea7\u6ce8\u89e3\u3002 * ElementType.PACKAGE \u53ef\u4ee5\u5e94\u7528\u4e8e\u5305\u58f0\u660e\u3002 * ElementType.PARAMETER \u53ef\u4ee5\u5e94\u7528\u4e8e\u65b9\u6cd5\u7684\u53c2\u6570\u3002 * ElementType.TYPE \u53ef\u4ee5\u5e94\u7528\u4e8e\u7c7b\u7684\u4efb\u4f55\u5143\u7d20\u3002</p>"},{"location":"android/java/java_annotation/#retention","title":"@Retention","text":"<ul> <li>RetentionPolicy.SOURCE\u4ec5\u4fdd\u7559\u5728\u6e90\u7ea7\u522b\u4e2d\uff0c\u5e76\u88ab\u7f16\u8bd1\u5668\u5ffd\u7565</li> <li>RetentionPolicy.CLASS\u5728\u7f16\u8bd1\u65f6\u7531\u7f16\u8bd1\u5668\u4fdd\u7559\uff0c\u4f46 Java \u865a\u62df\u673a(JVM)\u4f1a\u5ffd\u7565</li> <li>RetentionPolicy.RUNTIME\u7531 JVM \u4fdd\u7559\uff0c\u56e0\u6b64\u8fd0\u884c\u65f6\u73af\u5883\u53ef\u4ee5\u4f7f\u7528\u5b83</li> </ul>"},{"location":"android/java/java_annotation/#inherited","title":"@Inherited","text":"<p>\u6ce8\u89e3\u4f5c\u2f64\u88ab\u2f26\u7c7b\u7ee7\u627f</p>"},{"location":"android/java/java_annotation/#_1","title":"\u573a\u666f","text":"<p>SOURCE\uff1a</p> <p>1.APT\u6280\u672f\uff0c\u4e00\u822c\u7528\u4e8e\u751f\u6210\u8f85\u52a9\u7c7b\uff0c\u4f8b\u5982Arouter\u3001butterKnidnife\u7b49\u6846\u67b6</p> <p>\u4e3a\u5565APT\u53ea\u9700\u8981SOURCE\u7ea7\u522b\uff0c\u56e0\u4e3a\u6ce8\u89e3\u7a0b\u5e8f\u8fd0\u884c\u65f6\u673a\u662f\u5728javac\u89e3\u6790\u6e90\u7801\u7684\u65f6\u5019\uff0cSOURCE\u6ce8\u89e3\u7ea7\u522b\u521a\u597d\u662f\u4fdd\u7559\u5230\u6e90\u7801\u7ea7\u522b\uff0c\u5373\u80fd\u88ab\u89e3\u6790\u5230</p> <p>2.\u8bed\u6cd5\u68c0\u67e5\uff0c\u6bd4\u5982@IntDef\u3001DrawableRes\u3001@Override\u7b49</p> <p>CLASS\uff1a 1.AspectJ\u3001\u70ed\u4fee\u590dRoubust</p> <p>RUNTIME\uff1a \u4e00\u822c\u7ed3\u5408\u53cd\u5c04\u6280\u672f</p> <p>TypeVariable     \u6cdb\u578b\u7c7b\u578b\u53d8\u91cf\u3002\u53ef\u4ee5\u6cdb\u578b\u4e0a\u4e0b\u9650\u7b49\u4fe1\u606f\uff1b</p> <p>ParameterizedType     \u5177\u4f53\u7684\u6cdb\u578b\u7c7b\u578b\uff0c\u53ef\u4ee5\u83b7\u5f97\u5143\u6570\u636e\u4e2d\u6cdb\u578b\u7b7e\u540d\u7c7b\u578b(\u6cdb\u578b\u771f\u5b9e\u7c7b\u578b)</p> <p>GenericArrayType     \u5f53\u9700\u8981\u63cf\u8ff0\u7684\u7c7b\u578b\u662f\u6cdb\u578b\u7c7b\u7684\u6570\u7ec4\u65f6\uff0c\u6bd4\u5982List[],Map[]\uff0c\u6b64\u63a5\u53e3\u4f1a\u4f5c\u4e3aType\u7684\u5b9e\u73b0\u3002</p> <p>WildcardType     \u901a\u914d\u7b26\u6cdb\u578b\uff0c\u83b7\u5f97\u4e0a\u4e0b\u9650\u4fe1\u606f\uff1b</p>"},{"location":"android/java/java_base/","title":"\u57fa\u7840\u6982\u5ff5","text":""},{"location":"android/java/java_base/#_1","title":"\u8fdb\u7a0b\u548c\u7ebf\u7a0b","text":"<p>\u8fdb\u7a0b\uff1a\u7a0b\u5e8f\u8fd0\u884c\u8d44\u6e90\u5206\u914d\u7684\u6700\u5c0f\u5355\u4f4d</p> <p>\u8d44\u6e90\uff1aCPU\u3001\u5185\u5b58\u7a7a\u95f4\u3001\u78c1\u76d8IO\u7b49</p> <p>\u8fdb\u7a0b\u548c\u8fdb\u7a0b\u4e4b\u95f4\u72ec\u7acb\uff0c\u8fdb\u7a0b\u4e2d\u7531\u591a\u6761\u7ebf\u7a0b\u5171\u4eab\u5168\u90e8\u8d44\u6e90</p> <p>\u7ebf\u7a0b\uff1aCPU\u8c03\u5ea6\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u4f9d\u8d56\u4e8e\u8fdb\u7a0b\u800c\u5b58\u5728</p>"},{"location":"android/java/java_base/#cpu","title":"CPU\u65f6\u95f4\u7247\u8f6e\u8f6c\u673a\u5236","text":"<p>\u4e00\u79cd\u7b97\u6cd5\uff0c\u53c8\u79f0RR\u8c03\u5ea6\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u88ab\u5206\u914d\u4e00\u4e2a\u65f6\u95f4\u6bb5(\u65f6\u95f4\u7247)\uff0c\u662f\u8fdb\u7a0b\u5141\u8bb8\u8fd0\u884c\u7684\u65f6\u95f4</p>"},{"location":"android/java/java_base/#_2","title":"\u5e76\u884c\u548c\u5e76\u53d1","text":"<p>\u5e76\u884c\uff1a\u540c\u65f6\u6267\u884c\u4e0d\u540c\u7684\u4efb\u52a1\uff0c\u5982\u8fb9\u5403\u996d\u8fb9\u6253\u7535\u8bdd</p> <p>\u5e76\u53d1\uff1a\u4ea4\u66ff\u6267\u884c\u4e0d\u540c\u7684\u4efb\u52a1</p>"},{"location":"android/java/java_base/#_3","title":"\u9ad8\u5e76\u53d1\u7f16\u7a0b\u4f18\u52bf","text":"<ol> <li>\u5145\u5206\u5229\u7528CPU\u8d44\u6e90</li> <li>\u52a0\u5feb\u54cd\u5e94\u7528\u6237\u7684\u65f6\u95f4\uff0c\u5982\u767e\u5ea6\u4e91\u4e0b\u8f7d\u591a\u4e2a\u6587\u4ef6</li> <li>\u4ee3\u7801\u6a21\u5757\u5316\u3001\u5f02\u6b65\u5316\u3001\u7b80\u5355\u5316</li> </ol> <p>OS\u9650\u5236</p> <p>Linux\u6bcf\u4e2a\u8fdb\u7a0b\u6700\u591a1000\u4e2a\u7ebf\u7a0b\uff0cWindow\u6700\u591a2000\u4e2a\u7ebf\u7a0b</p>"},{"location":"android/java/java_base/#threadlocal","title":"ThreadLocal","text":"<p>\u7ebf\u7a0b\u7ea7\u522b\u53d8\u91cf\uff0c\u5e76\u53d1\u6a21\u5f0f\u4e0b\u662f\u7edd\u5bf9\u5b89\u5168\u7684\u53d8\u91cf</p> <p></p> <p>\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\uff1aThread t = Thread.currentThread();</p> <p>\u80fd\u4fdd\u8bc1\u6bcf\u4e00\u4e2athread\u4e2d\u6709\u72ec\u7acb\u4e00\u4efd <pre><code>object : ThreadLocal&lt;String&gt;(){\noverride fun initialValue(): String? {\nreturn \"123\"\n}\n}\n</code></pre> \u5185\u5b58\u6cc4\u6f0f\u539f\u56e0</p> <p></p> <p>sThreadLocal\u5982\u679c\u8bbe\u7f6enull\u5373\u7b2c\u4e00\u4e2ax\u53ef\u4ee5\u65ad\u5f00\uff0cKey\u662f\u5f31\u5f15\u7528\u5373\u7b2c\u4e8c\u4e2ax\u53ef\u4ee5\u65ad\u5f00\uff0c\u5982\u679cThread\u4e00\u76f4\u6267\u884c\u5219Value\u662f\u5f3a\u5f15\u7528\u4e0d\u4f1a\u88abgc\u56de\u6536\uff0c\u6240\u4ee5\u53ca\u65f6remove\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f</p>"},{"location":"android/java/java_base/#_4","title":"\u540c\u6b65\u3001\u5f02\u6b65\u3001\u963b\u585e\u3001\u975e\u963b\u585e","text":"<p>\u540c\u6b65\u548c\u5f02\u6b65\u3001\u963b\u585e\u548c\u975e\u963b\u585e\u672c\u8d28\u4e0a\u662f\u4e00\u5bf9\u76f8\u5bf9\u7684\u6982\u5ff5\u3002</p> <p>\u5728\u8fdb\u7a0b\u901a\u4fe1\u8fd9\u4e2a\u5c42\u9762\uff0c\u540c\u6b65\u548c\u5f02\u6b65\u9488\u5bf9\u7684\u662f\u53d1\u9001\u65b9\u800c\u8a00\uff0c\u53d6\u51b3\u4e8e\u5c06\u6570\u636e\u5199\u5230\u5185\u6838\u7f13\u51b2\u533a\u8fdb\u7a0b\u7684\u884c\u4e3a\uff0c\u7ee7\u7eed\u7b49\u5f85\u53d1\u9001\u5219\u4e3a\u540c\u6b65\uff0c\u53cd\u4e4b\u5373\u4e3a\u5f02\u6b65\u3002</p> <p>\u5728\u8fdb\u7a0b\u901a\u4fe1\u8fd9\u4e2a\u5c42\u9762\uff0c\u963b\u585e\u975e\u963b\u585e\u9488\u5bf9\u7684\u662f\u63a5\u6536\u65b9\u800c\u8a00\uff0c\u53d6\u51b3\u4e8e\u5c06\u5185\u6838\u4e2d\u7684\u6570\u636e\u80fd\u5426\u7acb\u5373\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u5982\u679c\u4e0d\u80fd\u76f4\u63a5\u62f7\u8d1d\u5219\u4e3a\u963b\u585e\uff0c\u53cd\u4e4b\u5219\u4e3a\u975e\u963b\u585e</p> <p>\u540c\u6b65\u5f02\u6b65\u662f\u8f93\u5165\u5230\u7ed3\u679c\u9700\u4e0d\u9700\u8981\u7b49\u5f85\u51b3\u5b9a\uff0c\u963b\u585e\u548c\u975e\u963b\u585e\u662f\u4e00\u79cd\u72b6\u6001\u7531\u7b49\u5f85\u7ed3\u679c\u65f6\u662f\u5426\u53ef\u4ee5\u505a\u5176\u4ed6\u4e8b\u60c5\u51b3\u5b9a</p>"},{"location":"android/java/java_base/#_5","title":"\u963b\u585e\u961f\u5217","text":"<p>\u4e00\u822c\u7528\u6765\u89e3\u51b3\u751f\u4ea7\u6d88\u8d39\u8005\u95ee\u9898</p> <p>BlockingQueue</p> <p>add\u548cremove\u4e0d\u963b\u585e\uff0c\u4f46add\u65f6\u6ee1\u4e86\u6216\u8005remove\u65f6\u6ca1\u6570\u636e\u65f6\u4f1a\u629b\u51fa\u5f02\u5e38</p> <p>offer\u548cpoll\u4e0d\u963b\u585e\uff0coffer\u65f6\u6ee1\u4e86\u8fd4\u56de\u503c\u4e3afalse\uff0cpoll\u65f6\u6ca1\u6570\u636e\u4f1a\u8fd4\u56denull</p> <p>put\u548ctake\u4f1a\u963b\u585e</p>"},{"location":"android/java/java_base/#_6","title":"\u5e38\u7528\u963b\u585e\u961f\u5217","text":"<p>ArrayBlockingQueue\uff1a\u6570\u636e\u7ed3\u6784\uff0c\u6709\u754c</p> <p>LinkedBlockingQueue\uff1a\u94fe\u8868\u7ed3\u6784\uff0c\u6709\u754c</p> <p>PriorityBlockingQueue\uff1a\u4f18\u5148\u7ea7\u6392\u5217\uff0c\u65e0\u754c</p> <p>DelayQueue\uff1a\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u65e0\u754c</p> <p>SynchronousQueue\uff1a\u4e0d\u5b58\u50a8\u5143\u7d20</p> <p>LinkedTransferQueue\uff1a\u94fe\u8868\u7ed3\u6784\uff0c\u65e0\u754c</p> <p>LinkedBlockingDeque\uff1a\u94fe\u8868\u7ed3\u6784\uff0c\u53cc\u5411</p> <p>\u6709\u754c\uff1a\u5bb9\u91cf\u6709\u9650\uff0c\u5373\u6ee1\u4e86\u540e\u4f1a\u88ab\u963b\u585e</p> <p>\u65e0\u754c\uff1a\u5bb9\u91cf\u65e0\u9650\uff0c\u5373\u4e0d\u4f1a\u88ab\u963b\u585e</p>"},{"location":"android/java/java_basic/","title":"\u57fa\u7840","text":""},{"location":"android/java/java_basic/#fieldproperty","title":"field\u548cproperty\u533a\u522b","text":"<p>field\uff1a\u5b57\u6bb5 property\uff1a\u5c5e\u6027 property = field + get/set\u65b9\u6cd5 <pre><code>B.class.getDeclaredFields(); // field\u83b7\u53d6\nIntrospector.getBeanInfo(B.class); // property\u83b7\u53d6\n</code></pre></p>"},{"location":"android/java/java_basic/#_1","title":"\u9759\u6001\u5c5e\u6027\u548c\u9759\u6001\u65b9\u6cd5","text":"<p>\u53ef\u4ee5\u88ab\u5b50\u7c7b\u7ee7\u627f</p> <p>\u9759\u6001\u65b9\u6cd5\u4e0d\u80fd\u88ab\u91cd\u5199</p> <p>\u4e24\u8005\u90fd\u53ef\u4ee5\u88ab\u8986\u76d6 <pre><code>class Parent {\npublic static int a = 0;\n\npublic static void findA() {\nSystem.out.println(\"parent\");\n}\n}\n\nclass Child extends Parent {\n}\n\nChild.findA();//parent\nSystem.out.println(Child.a);//0\n</code></pre> \u5b50\u7c7b\u4fee\u6539 <pre><code>class Child extends Parent {\npublic static int a = 1;\n\npublic static void findA() {\nSystem.out.println(\"child\");\n}\n}\nChild.findA();//child\nSystem.out.println(Child.a);//1\n</code></pre></p>"},{"location":"android/java/java_collection/","title":"\u6570\u636e\u7ed3\u6784","text":"<p>java\u4e2d\u6240\u6709\u6570\u636e\u7ed3\u6784\u90fd\u662f\u57fa\u4e8e\u6570\u7ec4\u548c\u94fe\u8868\u5b9e\u73b0</p> <p>\u6570\u7ec4\uff1a\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4</p> <p>\u94fe\u8868\uff1aLinkedList</p> <p>\u5176\u4ed6\u6570\u636e\u7ed3\u6784</p> <p>\u5806\uff1aHeap\uff0c\u672c\u8d28\u662f\u4e8c\u53c9\u6811\u7684\u7279\u6027\u6765\u7ef4\u62a4\u4e00\u7ef4\u6570\u7ec4\uff0c\u548c\u6811\u7684\u533a\u522b\uff1a\u4e0d\u662f\u7528\u6307\u9488\u5b9e\u73b0\uff0c\u5185\u5b58\u7531\u4e8e\u6811\uff0c\u591a\u7528\u4e8e\u6392\u5e8f</p> <p>\u5806\u6392\u5e8f\uff1a\u4e8c\u53c9\u6811\u6700\u540e\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff1alength/2-1</p> <p>\u5927\u9876\u5806\u3001\u5c0f\u9876\u5806</p> <p>\u6808\uff1aStack</p> <p>\u961f\u5217\uff1aQueue</p> <p>\u6811\uff1aTree\uff0c\u57fa\u4e8e\u6307\u9488\u5b9e\u73b0</p> <p>\u56fe\uff1aGraph\uff0c\u6709\u5411\u65e0\u73af\u56fe</p> <p>\u6563\u5217\u8868\uff1aHash</p>"},{"location":"android/java/java_collection/#arraylist","title":"ArrayList\u89e3\u6790","text":"<p>\u4f7f\u7528\u4e0d\u540c\u6784\u9020\u65b9\u6cd5\u7684\u533a\u522b <pre><code>public ArrayList() {\nthis.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n}\nArrayList(int initialCapacity)\n</code></pre> \u4f7f\u7528\u9ed8\u8ba4\u6784\u9020\u65b9\u6cd5 <pre><code>private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};\n\nthis.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;\n</code></pre> \u4f1a\u521d\u59cb\u5316elementData\u6570\u7ec4\uff0c\u957f\u5ea6\u4e3a0\uff0c\u53ef\u4ee5\u770b\u51faArrayList\u662f\u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0</p> <p>\u4f7f\u7528\u6709\u53c2\u6784\u9020\u65b9\u6cd5 <pre><code>private static final Object[] EMPTY_ELEMENTDATA = {}\n\nif (initialCapacity &gt; 0) {\nthis.elementData = new Object[initialCapacity];\n} else if (initialCapacity == 0) {\nthis.elementData = EMPTY_ELEMENTDATA;//\u548c\u9ed8\u8ba4\u6709\u533a\u522b\n} else {\nthrow new IllegalArgumentException(\"Illegal Capacity: \"+\ninitialCapacity);\n}\n</code></pre> \u5982\u679cinitialCapacity\u4f200\u5c31\u548c\u9ed8\u8ba4\u6784\u9020\u4e00\u6837\uff0c\u5982\u679c\u5927\u4e8e0\u5c31\u4f1a\u521d\u59cb\u5316\u957f\u5ea6\u4e3ainitialCapacity\u7684\u6570\u7ec4</p>"},{"location":"android/java/java_collection/#_1","title":"\u95ee\u9898\u63a2\u8ba8","text":"<p>\u65e2\u7136\u53ef\u4ee5\u8bbe\u7f6e\u521d\u59cb\u5316\u6570\u7ec4\u957f\u5ea6\uff0c\u662f\u4e0d\u662f\u610f\u5473\u7740\u5c31\u53ef\u4ee5add(1, xxx)\uff0c\u4e0d\u4e00\u5b9a\u4ece\u7b2c0\u4e2a\u5f00\u59cb\u6dfb\u52a0\u6570\u636e\uff1f</p> <p>\u7b54\u6848\u662f\u9519\u8bef\u7684\uff0c\u5f53\u6211\u4eec\u8c03\u7528add\u65b9\u6cd5\u65f6\u76f4\u63a5\u62a5\u4e0b\u6807\u8d8a\u754c <pre><code>private int size;\npublic void add(int index, E element) {\nif (index &gt; size || index &lt; 0)\nthrow new IndexOutOfBoundsException(outOfBoundsMsg(index));\n\nensureCapacityInternal(size + 1);  // Increments modCount!!\nSystem.arraycopy(elementData, index, elementData, index + 1,\nsize - index);\nelementData[index] = element;\nsize++;\n}\n</code></pre> \u539f\u56e0\u662fthis.size\u5e76\u6ca1\u6709\u5728\u6784\u9020\u65b9\u6cd5\u4e2d\u521d\u59cb\u5316\u6b64\u65f6\u4e3a0\uff0cindex\u5982\u679c\u662f0\u5c31\u6ca1\u95ee\u9898\uff0cthis.size\u5c06\u6b63\u5e38\u8d4b\u503c</p> <p>initialCapacity\u610f\u4e49\u4f55\u5728\uff1f</p> <p>\u6539\u53d8elementData\u5927\u5c0f\uff0c\u5373\u6b64\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u5f53\u8c03\u7528add(xx)\u662f\u4f1a\u8c03\u7528ensureCapacityInternal\u65b9\u6cd5 <pre><code>private static final int DEFAULT_CAPACITY = 10;\nprivate void ensureCapacityInternal(int minCapacity) {\nif (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {\nminCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);\n}\n\nensureExplicitCapacity(minCapacity);\n}\nprivate void ensureExplicitCapacity(int minCapacity) {\nmodCount++;\nif (minCapacity - elementData.length &gt; 0)\ngrow(minCapacity);\n}\n</code></pre> minCapacity\u662fthis.size+1\uff0c\u5982\u679c\u8c03\u7528\u9ed8\u8ba4\u6784\u9020\u5219minCapacity\u5c31\u662f10\uff0cif\u6761\u4ef6\u6210\u7acb <pre><code>private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;\nprivate void grow(int minCapacity) {\nint oldCapacity = elementData.length;\nint newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);\nif (newCapacity - minCapacity &lt; 0)\nnewCapacity = minCapacity;\nif (newCapacity - MAX_ARRAY_SIZE &gt; 0)\nnewCapacity = hugeCapacity(minCapacity);\nelementData = Arrays.copyOf(elementData, newCapacity);\n}\n</code></pre> \u8fd9\u91cc\u56e0\u4e3a\u6570\u7ec4\u957f\u5ea6\u662f0\uff0c\u9ed8\u8ba4\u6784\u9020\u7684\u8bddoldCapacity=0\uff0cminCapacity\u4e3a10\uff0c\u5219newCapacity=10\uff0celementData\u6269\u5bb9\u621010\u4e2a\u5bb9\u91cf\u5927\u5c0f\u3002\u4e0b\u6b21add\u65f6size\u53d8\u6210\u4e861\uff0cminCapacity=size+1=2\uff0c\u5219minCapacity - elementData.length=-8\uff0c\u4e0d\u4f1a\u8c03\u7528grow\u3002\u7b49\u5230size=10\u65f6\uff0cminCapacity=11\uff0c\u53c8\u8fdb\u5165grow\uff0cnewCapacity=10+10/2=15</p>"},{"location":"android/java/java_collection/#_2","title":"\u603b\u7ed3","text":"<p>1.ArrayList\u9ed8\u8ba4\u5bb9\u91cf\u662f10</p> <p>2.this.size\u8868\u793a\u7684\u662f\u5bb9\u5668\u6b63\u771f\u7684\u6570\u636e\u4e2a\u6570\uff0c\u5e76\u4e0d\u662f\u7528\u6765\u8868\u793a\u5bb9\u91cf\u5927\u5c0f</p> <p>3.initialCapacity\u4fee\u6539\u9ed8\u8ba4\u5bb9\u91cf\uff0c\u4f18\u70b9\u662f\u53ef\u4ee5\u7528\u6765\u4f18\u5316\u6269\u5bb9\u6b21\u6570</p> <p>4.ArrayList\u6700\u5927\u5bb9\u91cf\u4e3aInteger.MAX_VALUE - 8</p> <p>-8\u7684\u539f\u56e0\u662f\u5bf9\u8c61\u5934\u5927\u5c0f\u9700\u898132 byte=8 int</p> <p>5.\u4e0b\u6b21\u6269\u5bb9\u5927\u7ea6\u4e3a\u539f\u6765\u76841.5\u500d(\u53ef\u80fd\u9664\u4e0d\u5c3d\uff0c\u598213-&gt;19\u7ea61.46)</p> <p>6.\u9664\u4e86\u6784\u9020\u65b9\u6cd5\u8bbe\u7f6e\u5bb9\u91cf\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7ensureCapacity(int minCapacity)</p> <p>\u6ce8\u610f\uff1a\u7406\u8bba\u5f53\u5bb9\u91cf\u53d8\u6210\u6700\u5927\u503c\u540e\u5982\u679c\u518dadd\u4f1a\u53d8\u6210Integer.MAX_VALUE\uff0c\u518dadd\u65f6minCapacity\u4f1a\u53d8\u6210\u8d1f\u6570\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff0c\u5b9e\u9645\u5185\u5b58\u65e9\u5c31\u4e0d\u591f\u8fbe\u4e0d\u5230Integer.MAX_VALUE - 8 <pre><code>private static int hugeCapacity(int minCapacity) {\nif (minCapacity &lt; 0) // overflow\nthrow new OutOfMemoryError();\nreturn (minCapacity &gt; MAX_ARRAY_SIZE) ?\nInteger.MAX_VALUE :\nMAX_ARRAY_SIZE;\n}\n</code></pre> \u83b7\u53d6\u5bf9\u8c61\u5185\u5b58\u5927\u5c0f</p> <p>https://repo.maven.apache.org/maven2/org/apache/lucene/lucene-core/ <pre><code>ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();\nlong listSize = RamUsageEstimator.sizeOfCollection(list);\nlist.add(\"100\");\nlong itemSize = RamUsageEstimator.sizeOfCollection(list);\nlong oneSize = itemSize - listSize;\ndouble intMaxSize = oneSize * Integer.MAX_VALUE * 1.0 / 1024 / 1024 / 1024;\nSystem.out.println(oneSize + \",\" + intMaxSize);\n</code></pre></p>"},{"location":"android/java/java_collection/#hashmap","title":"HashMap","text":"<p>\u6784\u9020\u65b9\u6cd5 <pre><code>static final float DEFAULT_LOAD_FACTOR = 0.75f;\npublic HashMap() {\nthis.loadFactor = DEFAULT_LOAD_FACTOR;\n}\npublic HashMap(int initialCapacity, float loadFactor) {\n//...\nif (initialCapacity &gt; MAXIMUM_CAPACITY)\ninitialCapacity = MAXIMUM_CAPACITY;\n//...\nthis.loadFactor = loadFactor;\nthis.threshold = tableSizeFor(initialCapacity);\n}\n</code></pre></p> <p>tableSizeFor\u7528\u6765\u4fdd\u8bc1\u5bb9\u91cf\u662f2\u7684\u500d\u6570 <pre><code>static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;\nstatic final int tableSizeFor(int cap) {\nint n = cap - 1;\nn |= n &gt;&gt;&gt; 1;\nn |= n &gt;&gt;&gt; 2;\nn |= n &gt;&gt;&gt; 4;\nn |= n &gt;&gt;&gt; 8;\nn |= n &gt;&gt;&gt; 16;\nreturn (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n}\n</code></pre> &gt;&gt;&gt;\u662f\u65e0\u7b26\u53f7\u53f3\u79fb\uff0c&gt;&gt;\u662f\u4f4d\u79fb <pre><code>System.out.println(tableSizeFor(16));\nSystem.out.println(tableSizeFor(21));\nSystem.out.println(tableSizeFor(43));\n\u8f93\u51fa\uff1a16\u300132\u300164\n</code></pre> put\u65b9\u6cd5\u89e3\u6790 <pre><code>static final int TREEIFY_THRESHOLD = 8;\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\nboolean evict) {\nNode&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;\nif ((tab = table) == null || (n = tab.length) == 0)\nn = (tab = resize()).length;//\u9996\u6b21\u6269\u5bb9\nif ((p = tab[i = (n - 1) &amp; hash]) == null)\ntab[i] = newNode(hash, key, value, null);//\u6ca1\u6709\u53d1\u751fhash\u78b0\u649e\u5c31\u76f4\u63a5\u5b58\u5230\u6570\u7ec4\u4e2d\nelse {\n//\u51fa\u73b0\u78b0\u649e\u5373\u6570\u7ec4\u4e2d\u5df2\u7ecf\u6709\u503c\nNode&lt;K,V&gt; e; K k;\nif (p.hash == hash &amp;&amp;\n((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))\ne = p;//key\u662f\u540c\u4e00\u4e2a\uff0c\u76f4\u63a5\u8d4b\u503c\nelse if (p instanceof TreeNode)\ne = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);//\u4f7f\u7528\u7ea2\u9ed1\u6811\u4fdd\u5b58\nelse {\nfor (int binCount = 0; ; ++binCount) {\nif ((e = p.next) == null) {\np.next = newNode(hash, key, value, null);\nif (binCount &gt;= TREEIFY_THRESHOLD - 1)\ntreeifyBin(tab, hash);//\u5982\u679c\u94fe\u8868\u5403\u9995\u90fd\u8d85\u8fc78\u4e2a\u5c31\u8f6c\u6210\u7ea2\u9ed1\u6811\u4fdd\u5b58\nbreak;\n}\n//...\n}//\u4f7f\u7528\u94fe\u8868\u4fdd\u5b58\n}\nif (e != null) {\nV oldValue = e.value;\nif (!onlyIfAbsent || oldValue == null)\ne.value = value;\nafterNodeAccess(e);\nreturn oldValue;//key\u76f8\u540c\uff0c\u8fd4\u56de\u88ab\u8986\u76d6\u7684value\u503c\n}\n}\n//...\nif (++size &gt; threshold)// \u8fbe\u5230\u603b\u5bb9\u91cf\u76840.75\u65f6\u4f1a\u6269\u5bb9\nresize();\nreturn null;\n}\n</code></pre></p> <p>resize\u65b9\u6cd5\u7528\u6765\u6269\u5bb9 <pre><code>static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4;//16\nnewCap = DEFAULT_INITIAL_CAPACITY;\nnewThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\nthreshold = newThr;\nNode&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];//\u521d\u59cb\u5316\u957f\u5ea6\u4e3a16\u7684\u6570\u7ec4\n</code></pre> \u4e0b\u6b21\u6269\u5bb9\u770bthreshold\u5927\u5c0f\uff0c\u9ed8\u8ba4\u662f0.75*16=12\uff0c\u5373\u5f53\u5bb9\u91cf\u4e3a12\u65f6\u4f1a\u8fdb\u884c\u4e00\u6b21\u6269\u5bb9</p> <p>\u81ea\u5b9a\u4e49\u9996\u6b21\u6269\u5bb9\u5927\u5c0f\u6d41\u7a0b(\u6269\u5bb9\u9488\u5bf9\u7684\u662f\u6570\u7ec4\uff0c\u5e76\u975e\u5bb9\u91cf\u5927\u5c0f\uff0c\u5bb9\u91cf=size)</p> <p>\u8c03\u7528\u4e24\u4e2a\u53c2\u6570\u6784\u9020\u65b9\u6cd5 <pre><code>new HashMap&lt;&gt;(27, 0.5F)\n\n-&gt;HashMap()\nthis.loadFactor = 0.5;\nthis.threshold = tableSizeFor(27);//32\n\n-&gt;resize()\nint newCap, newThr = 0;\nint oldThr = threshold;//32\nelse if (oldThr &gt; 0) newCap = oldThr;//32\nif (newThr == 0) {\nfloat ft = (float)newCap * loadFactor;//32*0.5=16\nnewThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?\n(int)ft : Integer.MAX_VALUE);//16\n}\nthreshold = newThr;\nNode&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];\ntable = newTab;\n</code></pre></p> <p>\u4e0b\u6b21\u6269\u5bb9\u90fd\u662f\u539f\u6765\u76842\u500d <pre><code>int oldThr = threshold;\nelse if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;\noldCap &gt;= DEFAULT_INITIAL_CAPACITY)\nnewThr = oldThr &lt;&lt; 1;\n</code></pre></p>"},{"location":"android/java/java_collection/#sparsearray","title":"SparseArray","text":"<p>\u4e8c\u5206\u67e5\u627e\u6cd5\u3001\u7ed3\u6784\u662f\u4e24\u4e2a\u6570\u7ec4\uff0c\u9ed8\u8ba4\u5bb9\u91cf\u662f10(\u975e\u96c6\u5408\u5927\u5c0f) <pre><code>private int[] mKeys;\nprivate Object[] mValues;\npublic SparseArray() {\nthis(10);\n}\n</code></pre></p> <p>\u6269\u5bb9\u673a\u5236\uff0c\u5982\u679c\u521d\u59cb\u5bb9\u91cf\u5c0f\u4e8e4\u76f4\u63a5\u6269\u5bb9\u62108\uff0c\u5426\u5219\u90fd\u662f\u6269\u5bb9\u6210\u539f\u6765\u76842\u500d <pre><code>public static int growSize(int currentSize) {\nreturn currentSize &lt;= 4 ? 8 : currentSize * 2;\n}\n</code></pre></p>"},{"location":"android/java/java_collection/#concurrenthashmap","title":"ConcurrentHashMap","text":""},{"location":"android/java/java_collection/#linkedhashmap","title":"LinkedHashMap","text":"<p>\u7ee7\u627f\u4e8eHashMap <pre><code>val map = object : LinkedHashMap&lt;String, String&gt;() {\noverride fun removeEldestEntry(eldest: MutableMap.MutableEntry&lt;String, String&gt;): Boolean {\nreturn size &gt; 3\n}\n}\n</code></pre> \u9650\u5236map\u5927\u5c0f\uff0cFIFO\u6dd8\u6c70\u673a\u5236\uff0c\u4e0a\u9762\u8d85\u8fc73\u4e2a\u540e\u4f1a\u4ece\u7b2c0\u4e2a\u5f00\u59cb\u79fb\u9664</p>"},{"location":"android/java/java_collection/#_3","title":"\u7b97\u6cd5","text":""},{"location":"android/java/java_collection/#_4","title":"\u4e8c\u5206\u67e5\u627e","text":"<p>\u524d\u63d0\uff1a\u5df2\u7ecf\u6709\u5e8f\u6392\u5217</p>"},{"location":"android/java/java_collection/#_5","title":"\u6392\u5e8f\u7b97\u6cd5","text":"<p>\u5192\u6ce1\u3001\u9009\u62e9\u3001\u63d2\u5165\u3001\u5f52\u5e76\u3001\u5806\u3001\u5feb\u901f\u3001\u5e0c\u5c14\u3001\u8ba1\u6570\u3001\u57fa\u6570\u3001\u6876\u6392\u5e8f</p>"},{"location":"android/java/java_collection/#_6","title":"\u5192\u6ce1\u6392\u5e8f","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a\u4e24\u4e24\u6bd4\u8f83\uff0c\u5c06\u6700\u5c0f\u7684\u6216\u6700\u5927\u7684\u6392\u5230\u6700\u540e</p> <p>\u6bd4\u5982\uff1a5 8 1 75 \u5347\u5e8f</p> <p>\u7b2c\u4e00\u8f6e\uff1a5,8 8,1-&gt;1,8 8,75\u53d8\u62105 1 8 75\uff0c\u6b64\u65f675\u65e0\u9700\u6bd4\u8f83</p> <p>\u7b2c\u4e8c\u8f6e\uff1a5,1-&gt;1,5 5,8\u53d8\u62101 5 8 75\uff0c\u6b64\u65f68\u4e5f\u65e0\u9700\u6bd4\u8f83</p> <p>\u7b2c\u4e09\u8f6e\uff1a1,5\u7ed3\u675f</p> <p>\u6240\u4ee5\u8f6e\u6570\u662f\u6570\u7ec4\u957f\u5ea6-1\uff0c\u6bcf\u8f6e\u6bd4\u8f83\u6b21\u6570\u662f\u6570\u7ec4\u957f\u5ea6-1-\u7b2c\u51e0\u8f6e</p> <pre><code>fun bubbleSort(arr: IntArray, isAsc: Boolean) {\nif (arr.isNotEmpty()) {\nfor (i in arr.indices) {\nfor (j in 0 until arr.size - 1 - i) {\nval asc = if (isAsc) arr[j + 1] &gt; arr[j]\nelse arr[j + 1] &lt; arr[j]\nif (asc) {\nval temp = arr[j + 1]\narr[j + 1] = arr[j]\narr[j] = temp\n}\n}\n}\n}\nprintln(arr.contentToString())\n}\n</code></pre>"},{"location":"android/java/java_collection/#_7","title":"\u9009\u62e9\u6392\u5e8f","text":"<p>\u6838\u5fc3\u601d\u60f3\uff1a\u627e\u5230\u6700\u5927\u6216\u6700\u5c0f\u503c\u7528\u4e0b\u6807\u8bb0\u5f55\uff0c\u653e\u5230\u6700\u524d\u9762</p> <p>\u6bd4\u5982\uff1a5 8 1 75 \u5347\u5e8f(\u627e\u6700\u5c0f\u503c) \u4e0b\u6807index</p> <p>\u7b2c\u4e00\u8f6e\uff1aindex = 2\uff0c1\u548c5\u4ea4\u6362\uff0c\u6b64\u65f6\u53d8\u62108 5 75</p> <p>\u7b2c\u4e8c\u8f6e\uff1aindex = 1\uff0c8\u548c5\u4ea4\u6362\uff0c\u6b64\u65f6\u53d8\u62108 75</p> <p>\u7b2c\u4e09\u8f6e\uff1aindex = 0\u7ed3\u675f</p> <pre><code>fun selectSort(arr: IntArray, isAsc: Boolean) {\nfor (i in arr.indices) {\nvar index: Int = i\nfor (j in i+1 until arr.size) {\nval asc = if (isAsc) arr[j] &lt; arr[index]\nelse arr[j] &gt; arr[index]\nif (asc) {\nindex = j\n}\n}\nval temp = arr[index]\narr[index] = arr[i]\narr[i] = temp\n}\nprintln(arr.contentToString())\n}\n</code></pre>"},{"location":"android/java/java_genericity/","title":"\u6cdb\u578b","text":""},{"location":"android/java/java_genericity/#1","title":"1.\u6cdb\u578b\u5b9a\u4e49","text":""},{"location":"android/java/java_genericity/#_1","title":"\u6cdb\u578b\u7c7b","text":"<pre><code>public class NormalGeneric&lt;K&gt; {\nprivate K data;\n}\n</code></pre>"},{"location":"android/java/java_genericity/#_2","title":"\u6cdb\u578b\u63a5\u53e3","text":"<pre><code>public interface Genertor&lt;T&gt; {\npublic T next();\n}\n</code></pre>"},{"location":"android/java/java_genericity/#_3","title":"\u63a5\u53e3\u5b9e\u73b0\u4e00","text":"<pre><code>public class ImplGenertor&lt;T&gt; implements Genertor&lt;T&gt; {\n@Override\npublic T next() {\nreturn null;\n}\n}\n</code></pre>"},{"location":"android/java/java_genericity/#_4","title":"\u63a5\u53e3\u5b9e\u73b0\u4e8c","text":"<pre><code>public class ImplGenertor2 implements Genertor&lt;String&gt; {\n@Override\npublic String next() {\nreturn null;\n}\n}\n</code></pre>"},{"location":"android/java/java_genericity/#_5","title":"\u6cdb\u578b\u65b9\u6cd5","text":"<p><pre><code>public class GenericMethod {\npublic &lt;T&gt; T genericMethod(T...a){\nreturn a[a.length/2];\n}\n}\n</code></pre> \u6ce8\uff1a\u6709<code>&lt;T&gt;</code>\u624d\u662f\u6cdb\u578b\u65b9\u6cd5\uff0c\u4e14\u548c\u6cdb\u578b\u7c7b\u65e0\u5173\uff0c\u5982 <pre><code>public class GenericMethod&lt;T&gt; {\npublic &lt;T&gt; T genericMethod(T...a){\nreturn a[a.length/2];\n}\n}\n</code></pre> \u6b64\u5904\u7c7b\u4e2d\u7684T\u548c\u65b9\u6cd5\u4e2d\u7684T\u6beb\u65e0\u5173\u8054</p>"},{"location":"android/java/java_genericity/#2","title":"2.\u6cdb\u578b\u9650\u5b9a","text":"<p>\u5229\u7528extends\u5173\u952e\u5b57\uff0c\u53ef\u4ee5\u662f\u7c7b\u6216\u63a5\u53e3\uff0c\u82e5\u6709\u7c7b\u5219\u53ea\u80fd\u5b58\u5728\u4e00\u4e2a\u4e14\u5fc5\u987b\u6392\u5217\u5728\u9996\u4e2a <pre><code>public static &lt;T extends ArrayList &amp; Comparable&gt; T min(T a, T b){\nif(a.compareTo(b)&gt;0) return a; else return b;\n}\n</code></pre></p>"},{"location":"android/java/java_genericity/#3","title":"3.\u6cdb\u578b\u5c40\u9650\u6027\u3001\u7ea6\u675f","text":"<p>1.\u4e0d\u80fd\u5b9e\u4f8b\u5316\u5373new <pre><code>new T();\n</code></pre> 2.static\u4fee\u9970\u4e2d\u4e0d\u53ef\u4f7f\u7528\uff0c\u5982\u4e0b\u7f16\u8bd1\u62a5\u9519\uff0c\u9664\u4e86\u9759\u6001\u6cdb\u578b\u65b9\u6cd5\u5982\u4e0a\u9762min\u65b9\u6cd5 <pre><code>private static T instance;\nprivate static void getInstance(T t){}\n</code></pre> \u4e0d\u53ef\u4f7f\u7528\u539f\u56e0\uff1a\u9759\u6001\u5148\u4e8e\u5bf9\u8c61\u521b\u5efa\uff0c\u6cdb\u578b\u662f\u5728\u5bf9\u8c61\u521b\u5efa\u65f6\u624d\u786e\u5b9a</p> <p>3.\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4e0d\u5141\u8bb8\u4f5c\u4e3a\u6cdb\u578b\u53c2\u6570\u4f20\u5165 <pre><code>Restrict&lt;int&gt;\n</code></pre> 4.\u4e0d\u5141\u8bb8\u4f7f\u7528instanceof\u5224\u65ad\uff0c\u5982\u4e0b\u7f16\u8bd1\u62a5\u9519 <pre><code>if(restrict instanceof Restrict&lt;Double&gt;)\n</code></pre> 5.\u6570\u7ec4\u53ef\u4ee5\u7533\u660e\u4f46\u4e0d\u80fd\u5b9e\u4f8b\u5316\uff0c\u5982\u4e0b\u7b2c2\u884c\u7f16\u8bd1\u62a5\u9519 <pre><code>Restrict&lt;Double&gt;[] restrictArray;\nRestrict&lt;Double&gt;[] restricts = new Restrict&lt;Double&gt;[10];\n</code></pre> 6.\u4e0d\u80fd\u4f7f\u7528\u5728extends Exception/Throwable\u4e2d\uff0c\u5982\u4e0b\u7f16\u8bd1\u62a5\u9519 <pre><code>class Problem&lt;T&gt; extends Exception{\n}\n</code></pre> 7.\u4e0d\u80fd\u6355\u83b7\u6cdb\u578b\u5f02\u5e38 <pre><code>public &lt;T extends Throwable&gt; void doWork(T x){//\u4e0d\u62a5\u9519\ntry{\n\n}catch(T t){//\u7f16\u8bd1\u62a5\u9519\n//do sth;\n}\n}\n</code></pre> \u6b63\u786e\u5199\u6cd5 <pre><code>public &lt;T extends Throwable&gt; void doWorkSuccess(T t) throws T{\ntry{\n\n}catch(Throwable e){\nthrow t;\n}\n}\n</code></pre></p>"},{"location":"android/java/java_genericity/#4","title":"4.\u6cdb\u578b\u4e2d\u7684\u7ee7\u627f\u548c\u901a\u914d\u7b26","text":"<p><pre><code>Pair&lt;Employee&gt;\u548cPair&lt;Worker&gt;\u6ca1\u6709\u4efb\u4f55\u7ee7\u627f\u5173\u7cfb\npublic class Worker extends Employee {\n}\npublic class Pair&lt;T&gt; {\nPair&lt;Employee&gt; employeePair = new Pair&lt;Worker&gt;();//\u7f16\u8bd1\u62a5\u9519\n}\n</code></pre> \u6b63\u786e\u65b9\u5f0f <pre><code>private class ExtendPair&lt;T&gt; extends Pair&lt;T&gt;{\n}\npublic class Pair&lt;T&gt; {\nPair&lt;String&gt; pair = new ExtendPair&lt;&gt;();\n}\n</code></pre></p>"},{"location":"android/java/java_genericity/#_6","title":"\u901a\u914d\u7b26\u4ea7\u751f\u539f\u56e0","text":"<p><pre><code>public class Fruit{}\npublic class Orange extends Fruit {}\npublic class GenericType&lt;T&gt; {}\npublic static void print(GenericType&lt;Fruit&gt; p){}\npublic static void use(){\nGenericType&lt;Fruit&gt; a = new GenericType&lt;&gt;();\nprint(a);\nGenericType&lt;Orange&gt; b = new GenericType&lt;&gt;();\n//print(b);//Orange\u5c5e\u4e8eFruit\u4f46\u4e0d\u80fd\u4f7f\u7528\u4e0d\u5408\u7406\n}\n</code></pre> \u4f7f\u7528\u901a\u914d\u7b26\u89e3\u51b3\uff0c\u5982\u4e0b <pre><code>public static void print(GenericType&lt;? extends Fruit&gt; p){}\n</code></pre> \u6b64\u5904\u9650\u5b9a\u4e86\u4e0a\u754c\u4e3aFruit\uff0c\u5982 <pre><code>public class Fruit extends Food{}\nprint(new GenericType&lt;Food&gt;());//\u7f16\u8bd1\u62a5\u9519\uff0c\u8d85\u8fc7\u6cdb\u578b\u4e0a\u754c\uff0c\u6700\u5927\u662fFruit\nprint(new GenericType&lt;Fruit&gt;());//\u7f16\u8bd1\u901a\u8fc7\n</code></pre> \u6ce8\uff1a?\u4e00\u822c\u4f7f\u7528\u5728\u53d8\u91cf\u4e2d</p>"},{"location":"android/java/java_genericity/#_7","title":"\u901a\u914d\u7b26\u7f3a\u9677","text":"<p><pre><code>public class GenericType&lt;T&gt; {\nprivate T data;\npublic T getData() {\nreturn data;\n}\npublic void setData(T data) {\nthis.data = data;\n}\n}\nGenericType&lt;? extends Fruit&gt; c = new GenericType&lt;&gt;();\nc.setData(new Orange());//\u62a5\u9519\nc.setData(new Fruit());//\u62a5\u9519\nc.setData(null);//\u7f16\u8bd1\u901a\u8fc7\nFruit x = c.getData();//\u7f16\u8bd1\u901a\u8fc7\n</code></pre> \u6ce8\uff1anull\u662f\u53ef\u4ee5set\u7684</p> <p>extends\u9650\u5236\u4e0a\u754c\uff0c\u4e0b\u754c\u4f7f\u7528super <pre><code>public static void print(GenericType&lt;? super Fruit&gt; p){}\npublic class Fruit extends Food{}\nprint(new GenericType&lt;Orange&gt;());//\u7f16\u8bd1\u62a5\u9519\uff0c\u6ca1\u8fbe\u5230\u4e0b\u754c\uff0c\u81f3\u5c11\u662fFruit\nprint(new GenericType&lt;Fruit&gt;());//\u7f16\u8bd1\u901a\u8fc7\n</code></pre> \u79bb\u8c31\u73b0\u8c61 <pre><code>GenericType&lt;? super Fruit&gt; c = new GenericType&lt;&gt;();\nc.setData(new Orange());//\u7f16\u8bd1\u901a\u8fc7\nc.setData(new Fruit());//\u7f16\u8bd1\u901a\u8fc7\nc.setData(new Food());//\u62a5\u9519\nObject x = c.getData();//\u7f16\u8bd1\u901a\u8fc7\n</code></pre></p>"},{"location":"android/java/java_genericity/#_8","title":"\u603b\u7ed3","text":"<p>1.\u5bf9\u4e8e\u65b9\u6cd5\u6765\u8bf4(print)\uff0c? extends X\u53ea\u80fd\u4f20&lt;=X\u7c7b\u578b\uff0c? super X\u53ea\u80fd\u4f20&gt;=X\u7c7b\u578b</p> <p>2.\u5bf9\u4e8e\u5b9e\u4f8b\u6765\u8bf4</p> <p>? extends X\u80fd\u5b89\u5168\u8bfb\u53d6(get)\uff0cnull\u53ef\u4ee5set</p> <p>? super X\u80fd\u5b89\u5168\u5199\u5165(set)\uff0cget\u53ea\u80fd\u62ff\u5230Object\uff0cset\u53ea\u80fd\u4f20&lt;=X\u7684\u7c7b</p> <p>?\u8868\u793a\u65e0\u9650\u5236\uff0cGenericType&lt;?&gt;</p> <p>3.\u53ea\u80fd\u7533\u660e\u5728\u53d8\u91cf\u4e2d(\u4e34\u65f6\u53d8\u91cf\u3001\u65b9\u6cd5\u53c2\u6570\u53d8\u91cf\u3001\u6210\u5458\u53d8\u91cf\u7b49)</p>"},{"location":"android/java/java_genericity/#5","title":"5.\u865a\u62df\u673a\u6cdb\u578b\u5b9e\u73b0(\u4f2a\u6cdb\u578b\uff1a\u7c7b\u578b\u64e6\u9664)","text":"<p>\u5373\u6cdb\u578b\u53ea\u5728\u7f16\u8bd1\u5668\u6709\u6548 <pre><code>public class GenericRaw&lt;T&gt; {\nprivate T data;\npublic T getData() {\nreturn data;\n}\npublic void setData(T data) {\nthis.data = data;\n}\n}\n</code></pre> \u865a\u62df\u673a\u7f16\u8bd1\u540e\u4f1a\u5c06T\u7528Object\u4ee3\u66ff <pre><code>public class GenericRaw&lt;T extends ArrayList &amp; Comparable&gt; {\nprivate T data;\npublic T getData() {\nreturn data;\n}\npublic void setData(T data) {\nthis.data = data;\n}\npublic void test(){\ndata.compareTo()\n//((Comparable)data).compareTo()\n}\n}\n</code></pre> \u865a\u62df\u673a\u7f16\u8bd1\u540e\u4f1a\u5c06T\u7528ArrayList\u4ee3\u66ff\uff0c\u5728\u4f7f\u7528\u5230Comparable\u76f8\u5173\u65b9\u6cd5\u65f6\uff0c\u81ea\u52a8\u63d2\u5165\u5f3a\u8f6c\u4ee3\u7801\uff0c\u5982\u4e0a\u9762test\u65b9\u6cd5\u4e2d \u5bf9\u4e8e\u91cd\u8f7d\u65b9\u6cd5 <pre><code>public static String method(List&lt;String&gt; stringList){\nreturn \"OK\";\n}\npublic static Integer method(List&lt;Integer&gt; stringList){\nreturn 1;\n}\n</code></pre> \u5bf9\u4e8e\u7f16\u8bd1\u5668\u6765\u8bf4\u4e0a\u9762\u4e24\u4e2a\u65b9\u6cd5\u4e0d\u5c5e\u4e8e\u91cd\u8f7d\uff0c\u901a\u8fc7\u65b9\u6cd5\u540d+\u65b9\u6cd5\u53c2\u6570 \u7531\u4e8e\u6cdb\u578b\u64e6\u9664\u6b64\u5904\u65b9\u6cd5\u53c2\u6570\u88ab\u8ba4\u5b9a\u4e3a\u4e00\u81f4</p> <p>\u4e86\u89e3\uff1a\u6cdb\u578b\u64e6\u9664\uff0c\u539f\u59cb\u6cdb\u578b\u7c7b\u578b\u5176\u5b9e\u5b58\u5728\u4e8eSignature\u4e2d\uff0c\u6cdb\u578b\u64e6\u9664\u4e5f\u662f\u4e3a\u4e86\u517c\u5bb9jdk1.5\u4e4b\u524d\u7248\u672c(\u6ca1\u6709\u6cdb\u578b\u6982\u5ff5)</p>"},{"location":"android/java/java_genericity/#6","title":"6.\u6cdb\u578b\u7684\u597d\u5904","text":"<p>1.\u591a\u79cd\u6570\u636e\u7c7b\u578b\u6267\u884c\u76f8\u540c\u7684\u4ee3\u7801</p> <p>2.\u907f\u514d\u7c7b\u578b\u5f3a\u8f6c\u62a5\u7c7b\u578b\u8f6c\u5316\u5f02\u5e38</p>"},{"location":"android/java/java_jvm/","title":"\u865a\u62df\u673a","text":""},{"location":"android/java/java_jvm/#jdkjrejvm","title":"JDK\u3001JRE\u3001JVM","text":"<p>jdk\u5305\u542bjre\u548cjvm</p> <p>jdk\u63d0\u4f9b\u5de5\u5177\uff1ajava\u3001javac\u3001javap\u7b49\u5de5\u5177</p> <p>jre\u5305\u542bjava\u7c7b\u5e93\u548cjvm</p> <p>jvm\u662f\u4e00\u79cd\u89c4\u8303\uff0cClassloader\u7528\u6765\u52a0\u8f7dclass\uff0c\u7136\u540e\u4f7f\u7528\u89e3\u6790\u5668\u7ffb\u8bd1\u4ee3\u7801</p> <p>jvm\u662f\u7528c++\u8bed\u8a00\u7f16\u5199</p> <p>\u89e3\u91ca\u6267\u884c\uff1a\u7528c++\u89e3\u91ca\u5668\u53bb\u89e3\u6790class\u4e2d\u7684\u4ee3\u7801\uff0c\u6240\u4ee5\u7ecf\u8fc7\u7ffb\u8bd1\u901f\u5ea6\u4f1a\u6162\u4e00\u70b9</p> <p>JIT\u6267\u884c\uff1aclass\u4ee3\u7801\u7ffb\u8bd1\u6210\u6c47\u7f16\u7801(codecache)\uff0c\u901f\u5ea6\u76f8\u5bf9\u6bd4\u8f83\u5feb</p> <p>jvm\u53ea\u63a5\u6536\u5b57\u8282\u7801(class)\u548c\u5f00\u53d1\u8bed\u8a00\u65e0\u5173\u6027(kotlin,groovy\u7b49\u6700\u7ec8\u8f6c\u6210\u5b57\u8282\u7801\u5373\u53ef)\uff0c\u8de8\u5e73\u53f0(\u4e0d\u540c\u64cd\u4f5c\u7cfb\u7edf\u6709\u5bf9\u5e94JDK)</p> <p>\u53ea\u8981\u7b26\u5408jvm\u89c4\u8303\u53ef\u4ee5\u81ea\u884c\u5f00\u53d1jvm</p>"},{"location":"android/java/java_jvm/#jvm","title":"Jvm\u7684\u5185\u5b58\u533a\u57df","text":"<p>\u6267\u884cjava\u7a0b\u5e8f\u65f6\u4f1a\u628a\u5185\u5b58\u5206\u4e3a\u4e94\u4e2a\u533a\u57df\uff1a\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u3001\u65b9\u6cd5\u533a\u3001\u5806\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668</p> <p></p> <p>\u8fd0\u884c\u65f6\u6570\u636e\u533a\u6839\u636e\u7ebf\u7a0b\u5212\u5206\uff1a\u7ebf\u7a0b\u5171\u4eab\u533a\u548c\u7ebf\u7a0b\u79c1\u6709\u533a</p> <p></p> <p>\u7ebf\u7a0b\u5171\u4eab\u533a(\u88ab\u6240\u6709\u7ebf\u7a0b\u5171\u4eab\uff0c\u6709\u4e14\u53ea\u6709\u4e00\u4efd)\uff1a\u65b9\u6cd5\u533a\u548c\u5806</p> <p>\u7ebf\u7a0b\u79c1\u6709\u533a\uff1a\u591a\u4e2a\u7ebf\u7a0b</p> <p>\u9664\u4e86\u8fd0\u884c\u65f6\u6570\u636e\u533a\u8fd8\u6709\u76f4\u63a5\u5185\u5b58(\u6ca1\u6709\u88ab\u865a\u62df\u5316\u7684\u5185\u5b58\uff0c\u6bd4\u5982\u7cfb\u7edf\u5185\u5b588G\uff0cjvm\u865a\u62df\u5316\u4e865G\uff0c\u5269\u4f593G\u88ab\u79f0\u4e3a\u76f4\u63a5\u5185\u5b58)</p> <p>\u65b9\u6cd5\u533a\uff1a\u8fd0\u884c\u65f6\u5e38\u91cf</p> <p>\u7ebf\u7a0b\uff1a\u865a\u62df\u673a\u6808\u3001\u672c\u5730\u65b9\u6cd5\u6808\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668</p>"},{"location":"android/java/java_jvm/#_1","title":"\u865a\u62df\u673a\u6808","text":"<p>1.\u5927\u5c0f\u53d6\u51b3\u4e8e\u5e73\u53f0\uff0c\u67e5\u8be2\u94fe\u63a5</p> <p>https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html</p> <p>-Xsssize</p> <p>64\u4f4d\u7cfb\u7edf\u90fd\u662f1M</p> <p>\u5373\u6bcf\u4e2a\u7ebf\u7a0b\u81f3\u5c111M\u5927\u5c0f\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u51cf\u5c0f\u5927\u5c0f\u4f18\u5316\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20</p> <p>-Xss1m</p> <p>-Xss1024k</p> <p>-Xss1048576</p> <p>2.\u7528\u6765\u5b58\u653e\u5f53\u524d\u7ebf\u7a0b\u8fd0\u884c\u65b9\u6cd5\u6240\u6709\u7684\u6570\u636e\u3001\u6307\u4ee4\u3001\u8fd4\u56de\u5730\u5740\uff0c\u7531\u4e8e\u662f\u6808\u7ed3\u6784\uff0c\u6240\u4ee5\u5148\u8fdb\u540e\u51fa\uff0c\u8c03\u7528\u65f6\u5165\u6808\uff0c\u5b8c\u6210\u65f6\u51fa\u6808</p> <p>\u6bd4\u5982\u65b9\u6cd5main\u8c03\u7528A\uff0c\u5373A\u5728main\u4e0a\u9762\uff0c\u6bcf\u4e2a\u65b9\u6cd5\u4f1a\u4ea7\u751f\u4e00\u4e2a\u6808\u5e27</p> <p>\u6808\u6ea2\u51fa\uff1a\u8c03\u7528\u65b9\u6cd5\u6570\u91cf\u603b\u5927\u5c0f\u8d85\u8fc71M\u5bfc\u81f4\u629b\u51fa\u7684\u5f02\u5e38\uff0c\u5e38\u89c1\u6b7b\u9012\u5f52</p> <p>\u6808\u5e27\uff1a\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u64cd\u4f5c\u6570\u6808\uff0c\u52a8\u6001\u8fde\u63a5\uff0c\u5b8c\u6210\u51fa\u53e3</p> <p>\u5c40\u90e8\u53d8\u91cf\u8868\uff1a\u5b58\u653e\u5c40\u90e8\u53d8\u91cf(java\u7684\u516b\u5927\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3001\u5bf9\u8c61\u5f15\u7528\u3001returnAddress\u7c7b\u578b)</p> <p>\u64cd\u4f5c\u6570\u6808\uff1a\u5b58\u653e\u65b9\u6cd5\u6267\u884c\u7684\u64cd\u4f5c\u6570\uff0c\u64cd\u4f5c\u7684\u5143\u7d20\u53ef\u4ee5\u662f\u4efb\u610fjava\u6570\u636e\u7c7b\u578b\uff0c\u4f1a\u590d\u7528</p> <p>\u52a8\u6001\u8fde\u63a5\uff1ajava\u8bed\u8a00\u7279\u6027\u591a\u6001\u76f8\u5173</p> <p>\u5b8c\u6210\u51fa\u53e3(\u8fd4\u56de\u5730\u5740)\uff1a\u8c03\u7528\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u5730\u5740\u4f5c\u4e3a\u8fd4\u56de</p> <ul> <li>\u6b63\u5e38\u8fd4\u56de\uff1a\u6062\u590d\u4e0a\u5c42\u65b9\u6cd5\u7684\u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808\uff1b\u628a\u8fd4\u56de\u503c(\u5982\u679c\u6709)\u538b\u5165\u8c03\u7528\u7740\u6808\u5e27\u7684\u64cd\u4f5c\u6570\u6808\u4e2d\uff1b\u8c03\u6574\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u503c\u6307\u5411\u65b9\u6cd5\u8c03\u7528\u6307\u4ee4\u540e\u7684\u4e00\u6761\u6307\u4ee4</li> <li>\u5f02\u5e38\u8fd4\u56de\uff1a\u7531\u5f02\u5e38\u5904\u7406\u8868&lt;\u975e\u6808\u5e27\u4e2d\u7684&gt;\u6765\u786e\u5b9a</li> </ul>"},{"location":"android/java/java_jvm/#_2","title":"\u7a0b\u5e8f\u8ba1\u6570\u5668","text":"<p>\u6307\u5411\u5f53\u524d\u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u7684\u5b57\u8282\u7801\u884c\u53f7(\u6307\u4ee4\u5730\u5740)\uff0c\u5360\u7528\u5f88\u5c11\u5185\u5b58\uff0c\u552f\u4e00\u4e0d\u4f1a\u9020\u6210OOM\u7684\u5185\u5b58\u533a\u57df</p> <p>\u8fd0\u884c\u6d41\u7a0b <pre><code>public class JvmTest {\npublic int work() {\nint x = 3;\nint y = 6;\nint z = (x + y) * 14;\nreturn z;\n}\n\npublic static void main(String[] args) {\nJvmTest test = new JvmTest();\ntest.work();\n}\n}\n</code></pre> \u6267\u884cjavap -v JvmTest.class\u540e\u5f97\u5230\u5b57\u8282\u7801(work\u65b9\u6cd5\u90e8\u5206) </p> <p>\u91cd\u70b9\u603b\u7ed3\uff1a</p> <ul> <li>\u6267\u884cmain\u65b9\u6cd5\u65f6\u4f1a\u6267\u884cmain\u7ebf\u7a0b</li> <li>\u4e3b\u8981\u5c55\u793a\u865a\u62df\u673a\u6808\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668</li> <li>iconst_3\uff1a3\u5bf9\u5e94\u7684\u662f\u6570\u503c3</li> <li>istore_1\uff1a1\u5bf9\u5e94\u7684\u662f\u504f\u79fb\u503c</li> <li>iload_1\uff1a1\u5bf9\u5e94\u7684\u662f\u504f\u79fb\u503c</li> <li>bipush: int\u503c\u8d85\u8fc75\u4ee5\u540e\u4f7f\u7528\uff0c\u4f1a\u5360\u7528\u66f4\u5927\u7a7a\u95f4\uff0c\u6240\u6709\u504f\u79fb\u91cf\u5360\u7528\u4e862\u4e2a(\u56fe\u4e2d\u6ca1\u67093\u548c9\u7684\u539f\u56e0)</li> <li>\u7a0b\u5e8f\u8ba1\u6570\u5668\u548c\u6808\u5e27\u5e76\u4e0d\u662f\u4e00\u4e00\u5bf9\u5e94\uff0c\u53ea\u6709\u4e00\u4e2a\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u5bf9\u6bcf\u4e2a\u6808\u5e27\u8ba1\u6570\u65f6\u90fd\u662f\u4ece0\u5f00\u59cb\uff0c\u4f46\u865a\u62df\u673a\u6808\u53ea\u4f1a\u6267\u884c\u9876\u90e8\u6808\u5e27\uff0c\u6240\u4ee5\u7a0b\u5e8f\u8ba1\u6570\u5668\u4e0d\u4f1a\u91cd\u590d\u6df7\u4e71\u73b0\u8c61</li> <li>\u6bcf\u6b21\u4f7f\u7528\u6570\u636e\u90fd\u9700\u8981\u7ecf\u8fc7\u64cd\u4f5c\u6570\u6808\uff0c\u5b58\u5165\u53d8\u91cf\u8868\u3001\u8ba1\u7b97\u64cd\u4f5c\u3001\u8fd4\u56de\u6570\u636e\u7b49</li> <li>\u5982\u679c\u662fstatic\u65b9\u6cd5\u5219\u6ca1\u6709this(0\u4f4d\u7f6e)</li> </ul> <p>\u5177\u4f53\u6f14\u793a\u6d41\u7a0b\u5982\u52a8\u56fe</p> <p></p> <p>\u66f4\u591a\u6307\u4ee4\u53ef\u901a\u8fc7\u4ee5\u4e0b\u7f51\u7ad9\u67e5\u770b\u8bf4\u660e</p> <p>https://cloud.tencent.com/developer/article/1333540</p>"},{"location":"android/java/java_jvm/#_3","title":"\u672c\u5730\u65b9\u6cd5","text":"<p>java\u4e2d\u65e0\u6cd5\u76f4\u63a5\u64cd\u4f5c\u7ebf\u7a0b\uff0c\u901a\u8fc7\u672c\u5730\u65b9\u6cd5\u6808(native\u65b9\u6cd5)\uff0c\u7ed3\u6784\u7c7b\u4f3c\u4e8e\u865a\u62df\u673a\u6808\uff0c\u4f46\u7a0b\u5e8f\u8ba1\u6570\u5668\u65e0\u6cd5\u8bb0\u5f55</p>"},{"location":"android/java/java_jvm/#_4","title":"\u5806","text":"<p>\u5b58\u653e\u6240\u6709new\u51fa\u6765\u7684\u4e1c\u2ec4\uff0c\u662fGC\u7ba1\u7406\u7684\u4e3b\u8981\u533a\u57df</p> <p>\u5806\u5185\u5b58\u5206\u4e09\u4ee3\uff0c\u65b0\u2f63\u4ee3\uff0c\u2f7c\u5e74\u4ee3\uff0c\u6301\u4e45\u4ee3</p>"},{"location":"android/java/java_jvm/#_5","title":"\u2f45\u6cd5\u533a","text":"<p>\u88ab\u865a\u62df\u673a\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u7b49</p>"},{"location":"android/java/java_jvm/#_6","title":"\u76f4\u63a5\u5185\u5b58","text":"<p>NIO\u4e2d\u7684DirectByteBuffer\uff0c\u4f1a\u81ea\u5df1\u91ca\u653e</p> <p>unsafe\u7c7b</p> <p>\u76f4\u63a5\u7533\u8bf7\u5185\u5b58\u76f8\u5173\uff0c\u9700\u8981\u624b\u52a8\u7ba1\u7406\uff0c\u8df3\u8fc7JVM\u7684\u5783\u573e\u56de\u6536(\u4e0d\u4f1a\u81ea\u52a8\u91ca\u653e)</p> <p>ByteBuffer.allocateDirect()\u65b9\u5f0f\u7533\u8bf7\u5185\u5b58\u4f1a\u81ea\u52a8\u91ca\u653e</p>"},{"location":"android/java/java_jvm/#jvm_1","title":"\u6df1\u5165\u7406\u89e3JVM\u5185\u5b58","text":"<p>\u65e0\u975e\u5c31\u662f\u865a\u62df\u5316</p> <p>jps\u67e5\u770b\u8fdb\u7a0b\u53f7\uff0cjinfo -flags \u8fdb\u7a0b\u53f7\u67e5\u770b\u4fe1\u606f</p> <p> <pre><code>public class JavaTest {\npublic final static String TYPE = \"type\";\npublic static String TAG = \"tag\";\npublic static void main(String[] args) throws Exception {\nFruit fruit1 = new Fruit();\nfruit1.setName(TYPE + \"-apple\");\nfruit1.setPrice(15.3);\nThread.sleep(Integer.MAX_VALUE);\nfor (int i = 0; i &lt; 1; i++) {\nSystem.gc();//15\u6b21\u540e\u8fdb\u5165\u8001\u5e74\u4ee3\n}\nFruit fruit2 = new Fruit();\nfruit2.setName(TAG + \"-watermelon\");\nfruit2.setPrice(28.5);\nThread.sleep(Integer.MAX_VALUE);\n}\n}\n\nclass Fruit {\nString name;\ndouble price;\npublic void setName(String name) {\nthis.name = name;\n}\n\npublic void setPrice(double price) {\nthis.price = price;\n}\n}\n</code></pre> 1. JVM\u7533\u8bf7\u5185\u5b58 2. \u521d\u59cb\u5316\u8fd0\u884c\u65f6\u6570\u636e\u533a 3. \u7c7b\u52a0\u8f7d</p> <p></p> <ol> <li>\u6267\u884c\u65b9\u6cd5</li> <li>\u521b\u5efa\u5bf9\u8c61</li> </ol> <p></p> <ol> <li>\u4e0d\u65ad\u6267\u884c\u65b9\u6cd5</li> </ol>"},{"location":"android/java/java_jvm/#jhsdb","title":"JHSDB","text":"<p>\u67e5\u770b\u5185\u5b58\u5de5\u5177</p> <p>\u6b65\u9aa4</p> <ol> <li>\u8fd0\u884c\u7a0b\u5e8f</li> <li>\u83b7\u53d6\u8fdb\u7a0b\u53f7\uff1ajps</li> </ol> <p>22176 JavaTest</p> <ol> <li>\u542f\u52a8\u5185\u5b58\u5de5\u5177</li> </ol> <p>\u65e7\u7248\u672c\uff1a <pre><code>java -cp .\\sa-jdi.jar sun.jvm.hostspot.HSDB\n</code></pre> \u65b0\u7248\u672c\uff1a(jdk11\u4ee5\u540e) <pre><code>jhsdb hsdb\n</code></pre> \u5176\u4ed6\u5185\u5bb9\u8865\u5145(jre\u6587\u4ef6\u5939\u751f\u6210) <pre><code>bin\\jlink.exe --module-path jmods --add-modules java.desktop --output jre\n</code></pre> 4. attach\u8fdb\u7a0b</p> <p> </p>"},{"location":"android/java/java_jvm/#_7","title":"\u67e5\u770b\u5806\u60c5\u51b5","text":"<p>Tools-Heap Parameters</p> <p></p> <p>\u5206\u914d\u5730\u5740\u8d77\u59cb\u503c\u548c\u7ed3\u675f\u503c\uff1a0x0000000604800000, 0x0000000800000000</p>"},{"location":"android/java/java_jvm/#_8","title":"\u67e5\u770b\u5bf9\u8c61\u60c5\u51b5","text":"<p>Tools-Object Histogram</p> <p>\u8fc7\u6ee4\uff1acom.yigai.lib.Fruit</p>"},{"location":"android/java/java_jvm/#_9","title":"\u67e5\u770b\u6808\u60c5\u51b5","text":""},{"location":"android/java/java_jvm/#_10","title":"\u67e5\u770b\u65b9\u6cd5\u533a","text":"<p>Tools-Class Browser</p> <p>\u5185\u5b58\u6ea2\u51fa</p> <p>java.lang.OutOfMemory: Metaspace \u65b9\u6cd5\u533a</p> <p>java.lang.OutOfMemory: Java heap space \u5806</p> <p>java.lang.OutOfMemory: Direct buffer memory \u76f4\u63a5\u5185\u5b58</p> <p>java.lang.StackOverflowError: StackOverflow \u6808</p>"},{"location":"android/java/java_jvm/#15","title":"\u5783\u573e\u56de\u6536\u4e3a\u5565\u662f15\u6b21","text":"<p>\u5bf9\u8c61\u7ecf\u5386\u4e00\u6b21\u5783\u573e\u56de\u6536\uff0c\u5982\u679c\u6ca1\u6709\u88ab\u56de\u6536\uff0cage\u4f1a+1\uff0c\u8fbe\u5230\u8001\u5e74\u4ee3\uff0c\u800c\u5e95\u5c42\u8bb0\u5f55\u5e74\u9f84\u7684\u5b57\u6bb5\u662f4\u4f4d\u4e8c\u8fdb\u5236(1111=15)</p>"},{"location":"android/java/java_jvm/#_11","title":"\u7c7b\u7684\u751f\u547d\u5468\u671f","text":"<p>\u52a0\u8f7d-\u9a8c\u8bc1-\u51c6\u5907-\u89e3\u6790-\u521d\u59cb\u5316-\u4f7f\u7528-\u5378\u8f7d</p> <p>\u8fde\u63a5\u9636\u6bb5\uff1a\u9a8c\u8bc1-\u51c6\u5907-\u89e3\u6790</p> <p>\u7c7b\u52a0\u8f7d\uff1a\u52a0\u8f7d-\u8fde\u63a5-\u521d\u59cb\u5316</p>"},{"location":"android/java/java_jvm/#_12","title":"\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f","text":"<p>\u521b\u5efa-\u5e94\u7528-\u4e0d\u53ef\u89c1-\u4e0d\u53ef\u8fbe-\u6536\u96c6-\u7ec8\u7ed3-\u5bf9\u8c61\u7a7a\u95f4\u91cd\u65b0\u5206\u914d</p>"},{"location":"android/java/java_jvm/#_13","title":"\u521b\u5efa\u9636\u6bb5","text":"<ul> <li>\u5206\u914d\u5bf9\u8c61\u7a7a\u95f4</li> <li>\u6784\u9020\u5bf9\u8c61</li> <li>\u7236\u7c7b\u6210\u5458\u6309\u987a\u5e8f\u521d\u59cb\u5316\uff0c\u9012\u5f52\u8c03\u7528\u7236\u7c7b\u6784\u9020</li> <li>\u5b50\u7c7b\u6210\u5458\u6309\u987a\u5e8f\u521d\u59cb\u5316  \u5b50\u7c7b\u6784\u9020\u8c03\u7528</li> </ul> <p>\u521b\u5efa\u65b9\u5f0f\uff1anew\u3001\u53cd\u5c04\u3001clone\u3001\u5e8f\u5217\u5316</p>"},{"location":"android/java/java_jvm/#_14","title":"\u5e94\u7528\u9636\u6bb5","text":"<p>\u5bf9\u8c61\u81f3\u5c11\u88ab\u4e00\u4e2a\u5f3a\u5f15\u7528\u6301\u6709</p>"},{"location":"android/java/java_jvm/#_15","title":"\u4e0d\u53ef\u89c1\u9636\u6bb5","text":"<p>\u5bf9\u8c61\u5728\u4ee3\u7801\u533a\u57df\u5916\u5373{}\u5916\u79f0\u4e3a\u4e0d\u53ef\u89c1</p>"},{"location":"android/java/java_jvm/#_16","title":"\u4e0d\u53ef\u8fbe\u9636\u6bb5","text":"<p>\u5bf9\u8c61\u5f15\u7528\u6839\u96c6\u5408\u4e2d\u627e\u4e0d\u5230\u76f4\u63a5\u6216\u95f4\u63a5\u7684\u5f3a\u5f15\u7528</p>"},{"location":"android/java/java_jvm/#_17","title":"\u6536\u96c6\u9636\u6bb5","text":"<p>\u5783\u573e\u56de\u6536\u5668\u53d1\u73b0\u5bf9\u8c61\u5904\u4e8e\u4e0d\u53ef\u8fbe\u9636\u6bb5\u4e14\u5783\u573e\u56de\u6536\u5668\u5bf9\u8be5\u5bf9\u8c61\u7684\u5185\u5b58\u7a7a\u95f4\u91cd\u5199\u5206\u914d\u505a\u597d\u51c6\u5907\u65f6\uff0c\u8fdb\u5165\u6536\u96c6\u9636\u6bb5</p>"},{"location":"android/java/java_jvm/#_18","title":"\u7ec8\u7ed3\u9636\u6bb5","text":"<p>\u5f53\u5bf9\u8c61\u6267\u884cfinalize\u65b9\u6cd5\u540e\u4efb\u5904\u4e8e\u4e0d\u53ef\u8fbe\u72b6\u6001\uff0c\u6b64\u9636\u6bb5\u662f\u7b49\u5f85\u5783\u573e\u56de\u6536\u5668\u56de\u6536\u5bf9\u8c61</p>"},{"location":"android/java/java_jvm/#_19","title":"\u5bf9\u8c61\u7a7a\u95f4\u91cd\u65b0\u5206\u914d","text":"<p>\u5783\u573e\u56de\u6536\u5668\u5bf9\u8be5\u5bf9\u8c61\u7684\u5185\u5b58\u7a7a\u95f4\u8fdb\u884c\u56de\u6536\u6216\u91cd\u65b0\u5206\u914d\uff0c\u5bf9\u8c61\u5f7b\u5e95\u6d88\u5931</p>"},{"location":"android/java/java_jvm/#jvm_2","title":"JVM\u521b\u5efa\u5bf9\u8c61\u8fc7\u7a0b","text":"<p>\u7c7b\u52a0\u8f7d-\u68c0\u67e5\u52a0\u8f7d-\u5206\u914d\u7a7a\u95f4-\u5185\u5b58\u7a7a\u95f4\u521d\u59cb\u5316-\u8bbe\u7f6e-\u5bf9\u8c61\u521d\u59cb\u5316</p>"},{"location":"android/java/java_jvm/#_20","title":"\u5206\u914d\u7a7a\u95f4","text":"<p>\u5212\u5206\u5185\u5b58\u65b9\u5f0f\uff1a\u6307\u9488\u78b0\u649e\u548c\u7a7a\u95f2\u5217\u8868(\u53d6\u51b3\u4e8e\u5806\u7a7a\u95f4\u662f\u5426\u89c4\u6574\uff0c\u5373\u4e0d\u788e\u7247\u5316)\uff0c\u524d\u8005\u6548\u7387\u9ad8\u540e\u8005\u9700\u8981\u67e5\u8868</p> <p>\u5e76\u53d1\u95ee\u9898\u89e3\u51b3\u65b9\u5f0f\uff1aTLABs\u548cCAS</p> <p>\u9ed8\u8ba4\u91c7\u7528\u5728\u65b0\u751f\u4ee3\u7684Eden\u4e2d\u5f00\u8f9f\u7a7a\u95f4\u65b9\u5f0f(TLABs)\u6765\u89e3\u51b3\u591a\u7ebf\u7a0b\u7533\u8bf7\u5185\u5b58\uff0c\u7981\u7528(-XX:-UseTLAB)\u540e\u91c7\u7528CAS\u65b9\u5f0f</p>"},{"location":"android/java/java_jvm/#cas","title":"CAS","text":"<p>CPU\u6307\u4ee4\uff0c\u65e0\u9501\u5316\uff0c\u4e50\u89c2\u673a\u5236\uff0c\u5177\u6709\u539f\u5b50\u6027\uff0c\u5373\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u5b89\u5168</p>"},{"location":"android/java/java_jvm/#_21","title":"\u5185\u5b58\u7a7a\u95f4\u521d\u59cb\u5316","text":"<p>\"\u96f6\"\u503c\uff0c\u5982int\u9ed8\u8ba4\u4e3a0\uff0cboolean\u9ed8\u8ba4\u4e3afalse</p>"},{"location":"android/java/java_jvm/#_22","title":"\u8bbe\u7f6e","text":"<p>\u5bf9\u8c61\u5934</p> <p>\u7ec4\u6210\uff1a\u7c7b\u578b\u6307\u9488\u3001mark word(\u54c8\u5e0c\u7801\u3001GC\u5206\u4ee3\u5e74\u9f84\u3001\u9501\u72b6\u6001\u6807\u8bc6\u3001\u7ebf\u7a0b\u6301\u6709\u7684\u9501\u3001\u504f\u5411\u7ebf\u7a0bID\u3001\u504f\u5411\u65f6\u95f4\u6233)\u3001\u8bb0\u5f55\u6570\u7ec4\u957f\u5ea6\u7684\u6570\u636e(\u5982\u679c\u662f\u5bf9\u8c61\u6570\u7ec4)</p>"},{"location":"android/java/java_jvm/#_23","title":"\u5bf9\u8c61","text":"<p>\u7531\u5bf9\u8c61\u5934\u3001\u5b9e\u4f8b\u6570\u636e\u3001\u5bf9\u9f50\u586b\u5145(\u975e\u5fc5\u987b)\u7ec4\u6210</p>"},{"location":"android/java/java_jvm/#_24","title":"\u5bf9\u8c61\u521d\u59cb\u5316","text":"<p>\u6784\u9020\u65b9\u6cd5\u6267\u884c</p>"},{"location":"android/java/java_jvm/#_25","title":"\u5bf9\u8c61\u7684\u8bbf\u95ee\u5b9a\u4f4d","text":"<p>\u53e5\u67c4\u65b9\u5f0f\u8bbf\u95ee\u5bf9\u8c61\u3001\u76f4\u63a5\u6307\u9488\u65b9\u5f0f\u8bbf\u95ee\u5bf9\u8c61(\u5feb\uff0c\u4e3b\u6d41\u865a\u62df\u673a\u91c7\u7528\u65b9\u6848)</p>"},{"location":"android/java/java_jvm/#_26","title":"\u5224\u65ad\u5bf9\u8c61\u5b58\u6d3b","text":"<p>\u5f15\u7528\u8ba1\u6570\u7b97\u6cd5\uff1a\u5728\u5bf9\u8c61\u5934\u6807\u8bb0\u88ab\u5f15\u7528\u6b21\u6570\uff0c\u65e0\u6cd5\u89e3\u51b3\u5faa\u73af\u5f15\u7528(python\u901a\u8fc7\u53e6\u542f\u7ebf\u7a0b\u89e3\u51b3)</p> <p>\u6839\u53ef\u8fbe\u6027\u5206\u6790\uff1aGC roots(RootSet)\uff0c\u76ee\u524dJVM\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4eceGC roots\u4f5c\u4e3a\u8d77\u70b9\u5411\u4e0b\u641c\u7d22\u8def\u5f84\u6210\u4e3a\u5f15\u7528\u94fe\uff0c\u5b58\u5728\u5373\u53ef\u8fbe</p> <p>\u5e38\u89c1GC roots\uff1a\u9759\u6001\u53d8\u91cf\u3001\u7ebf\u7a0b\u6808\u53d8\u91cf(\u5c40\u90e8\u53d8\u91cf\u8868\u4e2d\u7684\u5bf9\u8c61)\u3001\u5e38\u91cf\u6c60\u3001JNI\u6307\u9488</p> <p>\u989d\u5916\uff1a\u5185\u90e8\u5f15\u7528(class\u5bf9\u8c61\u3001\u5f02\u5e38\u5bf9\u8c61\u3001\u7c7b\u52a0\u8f7d\u5668)\u3001\u540c\u6b65\u9501(synchronized\u5bf9\u8c61)\u3001\u5185\u90e8\u5bf9\u8c61(JVXBean)\u3001\u4e34\u65f6\u5bf9\u8c61(\u8de8\u4ee3\u5f15\u7528)</p>"},{"location":"android/java/java_jvm/#class","title":"class\u5bf9\u8c61\u56de\u6536\u6761\u4ef6(\u5378\u8f7d)","text":"<ol> <li>new\u51fa\u7684\u6240\u6709\u5bf9\u8c61\u88ab\u56de\u6536\uff0c\u5373Java\u5806\u4e2d\u4e0d\u5b58\u5728\u8be5\u7c7b\u53ca\u5176\u4efb\u4f55\u6d3e\u751f\u5b50\u7c7b\u7684\u5b9e\u4f8b</li> <li>\u5bf9\u5e94\u7684\u7c7b\u52a0\u8f7d\u5668\u88ab\u56de\u6536</li> <li>\u8be5\u7c7b\u5bf9\u5e94\u7684 java.lang.Class \u5bf9\u8c61\u6ca1\u6709\u5728\u4efb\u4f55\u5730\u65b9\u88ab\u5f15\u7528\uff0c\u65e0\u6cd5\u5728\u4efb\u4f55\u5730\u65b9\u901a\u8fc7\u53cd\u5c04\u8bbf\u95ee\u8be5\u7c7b\u7684\u65b9\u6cd5</li> <li>\u53c2\u6570\u63a7\u5236\uff1a-Xnoclassgc\u53c2\u6570\u7981\u7528\u7c7b\u7684\u5783\u573e\u6536\u96c6\uff0c\u5982\u679c\u7981\u7528\u6ee1\u8db3\u4ee5\u4e0a3\u70b9\u4e5f\u65e0\u6cd5\u56de\u6536</li> </ol> <p>\u53ef\u8fbe\u5373\u4e0d\u53ef\u56de\u6536 <pre><code>Fruit fruit1 = new Fruit();\n</code></pre> \u53ef\u8fbe\u5c31\u662f\u5f15\u7528\u6307\u5411\uff0cFruit\u5bf9\u8c61\u4e0e\u5c40\u90e8\u53d8\u91cffruit1\u5b58\u5728\u4e00\u4e2a\u53ef\u8fbe\u6027\u5173\u7cfb</p> <p>\u5783\u573e\u56de\u6536\u6253\u5370\uff1a-Xlog:gc(-XX:+PrintGC\u8fc7\u65f6\uff0cjdk8\u4ee5\u4e0b\u4f7f\u7528)</p> <p></p> <p>\u6f14\u793a\u6848\u4f8b <pre><code>public class JavaTest {\npublic JavaTest instance;\nprivate byte[] bytes = new byte[10 * 1024 * 1024];\n\npublic static void main(String[] args) {\nJavaTest test1 = new JavaTest();\nJavaTest test2 = new JavaTest();\ntest1.instance = test2;// \u5f15\u7528\u5faa\u73af\ntest2.instance = test1;\ntest1 = null;//\u4e3a\u4e86\u80fd\u7acb\u9a6c\u89e6\u53d1gc\ntest2 = null;\nSystem.gc();\n}\n}\n\u65e5\u5fd7\uff1a\n[0.006s][info][gc] Using G1\n[0.067s][info][gc] GC(0) Pause Full (System.gc()) 25M-&gt;0M(16M) 2.411ms\n</code></pre> \u53ef\u4ee5\u770b\u5230\u5185\u5b58\u4ece25M(\u5305\u542b\u4e86\u4e24\u4e2abytes\u6570\u7ec4\u5927\u5c0f\uff0c\u6bcf\u4e2a10M)\u53d8\u62100M\uff0c\u8868\u660e\u5df2\u56de\u6536</p>"},{"location":"android/java/java_jvm/#finalize","title":"finalize","text":"<p>\u7528\u6765\u5728\u5bf9\u8c61\u88ab\u56de\u6536\u4e4b\u524d\u505a\u6e05\u7406\u5de5\u4f5c\uff0c\u4f46\u6267\u884c\u7ea7\u522b\u8f83\u4f4e(\u9700\u8981\u8c03\u7528Thread.sleep\u4f11\u7720)\uff0c\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528</p> <p>FinalizeGC\uff0c\u5176\u5b9e\u662f\u591a\u7ebf\u7a0b\u8fdb\u884c\uff0cJVM\u5185\u90e8\u4f7f\u7528\u4f1anew Finalizer\u5bf9\u8c61\uff0c\u5b8c\u5168\u53ef\u4ee5\u4f7f\u7528try finally\u4ee3\u66ff</p>"},{"location":"android/java/java_jvm/#_27","title":"\u5404\u79cd\u5f15\u7528","text":"<pre><code>public class JavaTest {\npublic String name;\n\npublic JavaTest(String name) {\nthis.name = name;\n}\n\n@Override\npublic String toString() {\nreturn \"JavaTest{\" +\n\"name='\" + name + '\\'' +\n'}';\n}\n}\n</code></pre>"},{"location":"android/java/java_jvm/#_28","title":"\u5f3a\u5f15\u7528","text":"<p>= (\u8eab\u8fb9\u91cd\u8981\u7684\u4eba\uff0c\u4eb2\u4eba)</p>"},{"location":"android/java/java_jvm/#softreference","title":"\u8f6f\u5f15\u7528SoftReference","text":"<p>(\u8001\u5a46\uff0c\u53ef\u79bb\u5a5a)\uff1a\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\u65f6\u5982\u5373\u5c06\u53d1\u751fOOM\u65f6\u4f1a\u88ab\u56de\u6536 <pre><code>\u5148\u914d\u7f6e\u5806\u5185\u5b58\u548c\u6700\u5927\u5185\u5b58\u4e3a20m\uff1a-Xms20m -Xmx20m\npublic static void main(String[] args) {\nJavaTest test1 = new JavaTest(\"name\");\nSoftReference&lt;JavaTest&gt; sr = new SoftReference&lt;&gt;(test1);\ntest1 = null; //\u5f3a\u5f15\u7528\u5148\u56de\u6536\nSystem.out.println(sr.get());  // JavaTest{name='name'}\nSystem.gc();\nSystem.out.println(\"gc\");\nLinkedList&lt;byte[]&gt; list = new LinkedList&lt;&gt;();\nfor (int i = 0; i &lt; 20; i++) {\ntry {\nlist.add(new byte[1 * 1024 * 1024]);\n} catch (Throwable e) {\nSystem.out.println(\"error:\" + sr.get()); // null\n}\n}\n}\n</code></pre></p>"},{"location":"android/java/java_jvm/#weakreference","title":"\u5f31\u5f15\u7528WeakReference","text":"<p>(\u5973\u670b\u53cb\uff0c\u60f3\u5206\u5c31\u5206)\uff1a\u53ea\u8981gc\u5c31\u4f1a\u88ab\u56de\u6536 <pre><code> public static void main(String[] args) {\nJavaTest test1 = new JavaTest(\"name\");\nWeakReference&lt;JavaTest&gt; sr = new WeakReference&lt;&gt;(test1);\ntest1 = null;\nSystem.out.println(sr.get());\nSystem.gc();\nSystem.out.println(\"gc\");\nSystem.out.println(sr.get()); // null\n}\n</code></pre></p>"},{"location":"android/java/java_jvm/#phantomreference","title":"\u865a\u5f15\u7528PhantomReference","text":"<p>(\u6280\u5e08\uff0c\u4e00\u4e0d\u5c0f\u5fc3\u5c31\u627e\u4e0d\u5230\u4e86)\uff1a\u76f4\u63a5\u5185\u5b58\u4e2d\u6709Cleaner\u7c7b\u7ee7\u627f\u865a\u5f15\u7528\uff0c\u4e3b\u8981\u7528\u6765\u8ddf\u8e2a\u5bf9\u8c61\u5783\u573e\u56de\u6536\u7684\u6d3b\u52a8</p>"},{"location":"android/java/java_jvm/#_29","title":"\u5bf9\u8c61\u5206\u914d\u7b56\u7565","text":"<p>\u51e0\u4e4e\u6240\u6709\u5bf9\u8c61\u90fd\u662f\u5728\u5806\u4e2d\u5206\u914d\uff0c\u5e76\u4e0d\u662f100%</p>"},{"location":"android/java/java_jvm/#_30","title":"\u865a\u62df\u673a\u4f18\u5316\u6280\u672f","text":"<p>\u9003\u9038\u5206\u6790+\u89e6\u53d1JIT(\u70ed\u70b9\u6570\u636e)\uff0c\u672c\u5730\u7ebf\u7a0b\u5206\u914d\u7f13\u5b58</p> <p>HotSpot(java\u865a\u62df\u673a\u5b9e\u73b0)</p> <p>\u65b9\u6cd5\u5faa\u73af\u4e07\u6b21\u89e6\u53d1JIT(\u70ed\u70b9\u6570\u636e)\uff0cjvm\u4f1a\u8fdb\u884c\u9003\u9038\u5206\u6790(\u6808\u4e0a\u5206\u914d)</p> <p>\u9003\u9038\u5206\u6790\u9ed8\u8ba4\u5f00\u542f\u53ea\u652f\u6301HotSpot\u5b9e\u73b0\u7684\u865a\u62df\u673a\uff0c\u5173\u95ed-XX:+DoEscapeAnalysis\uff0c\u7981\u7528\u540e\u5206\u914d\u5230\u5806\u7a7a\u95f4\u4f1a\u89e6\u53d1gc</p>"},{"location":"android/java/java_jvm/#_31","title":"\u5206\u914d\u539f\u5219","text":"<ul> <li>\u5bf9\u8c61\u4f18\u5148\u5728Eden\u5206\u914d</li> <li>\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\uff1a\u5185\u90e8\u4f1a\u7edf\u8ba1\u8001\u5e74\u4ee3\u5e73\u5747\u5206\u914d\u7684\u5bf9\u8c61\u7a7a\u95f4\u5927\u5c0f\uff0c\u598210M\uff0c\u6b64\u65f6\u5982\u679c\u65b0\u751f\u4ee3\u664b\u7ea7\u7684\u5bf9\u8c61\u662f8M\uff0c\u5373\u65e0\u9700\u89e6\u53d1\u664b\u7ea7\u56de\u6536</li> <li>\u5927\u5bf9\u8c61\u8fdb\u5165\u8001\u5e74\u4ee3(Tenured)\uff1aserial\u3001parnew\u4e24\u6b3e\u5783\u573e\u56de\u6536\u671f\u751f\u6548</li> <li>\u957f\u671f\u5b58\u6d3b\u7684\u5bf9\u8c61\u8fdb\u5165\u8001\u5e74\u4ee3(15\u6b21\uff0c\u53ef\u901a\u8fc7-XX:MaxTenuringThreshold=10\u4fee\u6539)</li> <li>\u52a8\u6001\u5bf9\u8c61\u5e74\u9f84\u5224\u5b9a</li> </ul> <p>from-&gt;to age+1\u53cd\u4e4b\u4e5f+1</p>"},{"location":"android/java/java_jvm/#_32","title":"\u5783\u573e\u56de\u6536\u57fa\u7840\u77e5\u8bc6","text":"<p>GC\uff1a\u5783\u573e\u56de\u6536</p> <p>\u5806\u7a7a\u95f4\uff1a\u65b0\u751f\u4ee3(Eden\u3001from\u3001to 8\uff1a1\uff1a1)\u548c\u8001\u5e74\u4ee3</p> <p>\u5783\u573e\u56de\u6536\u5668</p> <p>\u56de\u6536\u65b0\u751f\u4ee3\uff1aMinor GC/Young GC \u56de\u6536\u8001\u5e74\u4ee3\uff1aMajor GC/Old GC\uff0c\u4e00\u822c\u90fd\u4f1a\u89e6\u53d1Full GC</p>"},{"location":"android/java/java_jvm/#copying","title":"\u590d\u5236\u7b97\u6cd5(Copying)","text":"<p>\u627e\u5230\u53ef\u8fbe\u5f15\u7528\u94fe\uff0c\u5c06\u5185\u5b58\u5206\u4e3a\u4e24\u4efd\uff0c\u5c06\u53ef\u8fbe\u5bf9\u8c61\u590d\u5236\u5230\u53e6\u4e00\u8fb9</p> <p></p> <p>\u7279\u70b9</p> <ol> <li>\u5b9e\u73b0\u7b80\u5355\u3001\u8fd0\u884c\u9ad8\u6548</li> <li>\u6ca1\u6709\u5185\u5b58\u788e\u7247</li> <li>\u7a7a\u95f4\u5229\u7528\u7387\u53ea\u6709\u4e00\u534a</li> </ol>"},{"location":"android/java/java_jvm/#appel","title":"Appel\u5f0f\u590d\u5236\u56de\u6536\u7b97\u6cd5","text":"<p>Eden\u533a\u7684\u6765\u6e90\uff0c\u63d0\u9ad8\u7a7a\u95f4\u5229\u7528\u7387\u548c\u7a7a\u95f4\u5206\u914d\u62c5\u4fdd\uff0c\u53ea\u9002\u7528\u4e8e\u65b0\u751f\u4ee3</p> <p></p> <p>S1\u662ffrom\uff0cS0\u662fto</p>"},{"location":"android/java/java_jvm/#mark-sweep","title":"\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5(Mark-Sweep)","text":"<p>\u627e\u5230\u53ef\u8fbe\u94fe\u7136\u540e\u6e05\u9664\u5783\u573e</p> <p>\u7279\u70b9</p> <ol> <li>\u4f4d\u7f6e\u4e0d\u8fde\u7eed\uff0c\u4ea7\u751f\u788e\u7247</li> <li>\u53ef\u4ee5\u4e0d\u6682\u505c(\u4f18\u52bf\uff0c\u56e0\u4e3a\u6ca1\u6709\u5bf9\u8c61\u79fb\u52a8)</li> <li>\u4e24\u6b21\u626b\u63cf\uff0c\u7b2c\u4e00\u6b21\u626b\u63cf\u6807\u8bb0\u51fa\u54ea\u4e9b\u53ef\u4ee5\u56de\u6536\u8fdb\u884c\u6807\u8bb0\uff0c\u7b2c\u4e8c\u6b21\u8fdb\u884c\u6e05\u9664</li> </ol> <p></p>"},{"location":"android/java/java_jvm/#mark-compact","title":"\u6807\u8bb0\u6574\u7406\u7b97\u6cd5(Mark-Compact)","text":"<p>\u6807\u8bb0-&gt;\u6574\u7406-&gt;\u6e05\u9664</p> <p>\u7279\u70b9</p> <ol> <li>\u6ca1\u6709\u5185\u5b58\u788e\u7247</li> <li>\u6307\u9488\u9700\u8981\u79fb\u52a8</li> <li>\u4e24\u6b21\u626b\u63cf</li> </ol> <p></p>"},{"location":"android/java/java_jvm/#_33","title":"\u5e38\u89c1\u5783\u573e\u56de\u6536\u5668","text":"<p>\u5355\u7ebf\u7a0b\uff1aSerial\u3001Serial Old</p> <p>\u591a\u7ebf\u7a0b\uff1aParallel Scavenga\u3001Parallel Old\u3001ParNew\u3001CMS\u3001G1</p> <p>PS\u7ec4\u5408\uff1aParallel Scavenga\u3001Parallel Old\u4f1a\u81ea\u52a8\u6269\u5bb9\uff0c\u4f34\u968fGC\uff0c\u4e0d\u9700\u8981\u6307\u5b9aEden\u3001from\u3001to\u7684\u6bd4\u4f8b\u662f\u52a8\u6001\u7684\uff0c\u541e\u5410\u91cf\u6700\u9ad8</p> \u56de\u6536\u5668 \u56de\u6536\u5bf9\u8c61\u548c\u7b97\u6cd5 \u56de\u6536\u5668\u7c7b\u578b Serial \u65b0\u751f\u4ee3\u3001\u590d\u5236\u7b97\u6cd5 \u5355\u7ebf\u7a0b Serial Old \u8001\u5e74\u4ee3\u3001\u6807\u8bb0\u6574\u7406\u7b97\u6cd5 \u5355\u7ebf\u7a0b Parallel Scavenga \u65b0\u751f\u4ee3\u3001\u590d\u5236\u7b97\u6cd5 \u591a\u7ebf\u7a0b Parallel  Old \u8001\u5e74\u4ee3\u3001\u6807\u8bb0\u6574\u7406\u7b97\u6cd5 \u591a\u7ebf\u7a0b ParNew \u65b0\u751f\u4ee3\u3001\u590d\u5236\u7b97\u6cd5 \u5355\u7ebf\u7a0b CMS \u8001\u5e74\u4ee3\u3001\u6807\u8bb0\u6e05\u9664\u7b97\u6cd5 \u591a\u7ebf\u7a0b G1 \u8de8\u65b0\u751f\u4ee3\u548c\u8001\u5e74\u4ee3\u3001\u6807\u8bb0\u6574\u7406+\u5316\u6574\u4e3a\u96f6 \u591a\u7ebf\u7a0b <p>\u54cd\u5e94\u4f18\u5148\u7684\u539f\u56e0</p> <p>\u6bd4\u5982\u6e38\u620f\u670d\u52a1\u5668\uff0cGC\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u7ebf\u7a0b\u6682\u505c\u89e6\u53d1stop the world</p>"},{"location":"android/java/java_jvm/#cms","title":"CMS","text":"<p>Concurrent Mark Sweep\uff0c\u53ea\u9488\u5bf9\u8001\u5e74\u4ee3\uff0cjava14\u540e\u88ab\u79fb\u9664</p> <p>ParNew\u4e3aCMS\u5b9a\u5236\uff0c\u7528\u6765\u56de\u6536\u65b0\u751f\u4ee3</p> <p>\u521d\u59cb\u6807\u8bb0\u3001\u5e76\u53d1\u6807\u8bb0\u3001\u91cd\u65b0\u6807\u8bb0\u3001\u5e76\u53d1\u6e05\u7406\u3001\u91cd\u7f6e\u7ebf\u7a0b</p> <p>\u521d\u59cb\u6807\u8bb0\uff1a\u6682\u505c\u6240\u6709\u7528\u6237\u7ebf\u7a0b(\u65f6\u95f4\u77ed)</p> <p>\u5e76\u53d1\u6807\u8bb0\uff1a\u65f6\u95f4\u957f\uff0c\u7528\u6237\u548cGC\u540c\u65f6\u8fd0\u884c</p> <p>\u91cd\u65b0\u6807\u8bb0\uff1a\u65f6\u95f4\u77ed\uff0c\u6682\u505c\u6240\u6709\u7528\u6237\u7ebf\u7a0b</p> <p>\u5e76\u53d1\u6e05\u7406\uff1a\u65f6\u95f4\u957f\uff0c\u7528\u6237\u548cGC\u540c\u65f6\u8fd0\u884c\uff0c\u4f1a\u4ea7\u751f\u6d6e\u52a8\u5783\u573e\uff0c\u9700\u8981\u4e0b\u4e00\u6b21\u624d\u4f1a\u56de\u6536\uff0c\u56e0\u6b64\u9700\u8981\u9884\u7559\u4e00\u90e8\u5206\u7a7a\u95f4</p> <p>\u95ee\u9898\uff1aCPU\u654f\u611f\u3001\u6d6e\u52a8\u5783\u573e\u3001\u5185\u5b58\u788e\u7247(\u5206\u914d\u5927\u5bf9\u8c61\u65f6\u53ef\u80fd\u4f1a\u8ba9jvm\u4f1a\u5207\u6362\u6210Serial Old\uff0c\u79f0\u9000\u5316\uff0c\u5806\u8d8a\u5927\u8017\u65f6\u8d8a\u957f)</p> <p>\u670d\u52a1\u5668\u7ef4\u62a4\uff1a\u91cd\u542f\u540eCMS\u5c31\u6ca1\u6709\u5185\u5b58\u788e\u7247</p> <p>VM\u53c2\u6570\uff1a-Xlog:gc*(--XX:+PrintGCDetails) --XX:UseConcMarkSweepGC</p> <p>G1\uff1a\u5806\u7a7a\u95f48G\u4ee5\u4e0a\u63a8\u8350\uff0c&lt;6G\u7528CMS\uff0cjdk1.8\u4ee5\u4e0a\u9ed8\u8ba4\u91c7\u7528G1</p>"},{"location":"android/java/java_jvm/#jvm_3","title":"JVM\u8c03\u4f18","text":""},{"location":"android/java/java_jvm/#_34","title":"\u6269\u5bb9\u65b0\u751f\u4ee3","text":"<p>\u4e3a\u4f55\u80fd\u63d0\u9ad8GC\u6548\u7387\u5417\uff1f</p> <p>\u65b0\u751f\u4ee3\u91c7\u7528\u590d\u5236\u7b97\u6cd5\uff0c\u5373\u5148\u8fdb\u884c\u626b\u63cf(\u53ef\u8fbe\u6027\u5206\u6790\u7b97\u6cd5\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u5b58\u6d3b\uff0c\u8017\u65f6\u8f83\u5c11\u5047\u8bbe\u4e3aT1)\uff0c\u7136\u540e\u8fdb\u884c\u5bf9\u8c61\u590d\u5236\u4eceEden\u5230From\u5230To(\u8017\u65f6\u8f83\u5927\u5047\u8bbe\u4e3aT2)</p> <p>\u5047\u8bbe\u65b0\u751f\u4ee3\u5bb9\u91cfR\uff0c\u5bf9\u8c61A\u5b58\u6d3b\u65f6\u95f4750ms\uff0cMinorGC\u95f4\u9694500ms \u6269\u5bb9\u540e\u4e3a2R\uff0cA\u7684\u5b58\u6d3b\u65f6\u95f4\u4e0d\u4f1a\u53d8\uff0cMinorGC\u95f4\u9694\u53d8\u62101000ms(\u7531\u4e8e\u7a7a\u95f4\u6269\u5927\u4e00\u500d)\uff0c\u5219\u6269\u5bb9\u524d\u603b\u8017\u65f6\u4e3aT1+T2\uff0c\u6269\u5bb9\u540e\u4e3a2T1\uff0c\u56e0\u4e3a\u6269\u5bb9\u540e\u5bf9\u8c61\u5df2\u7ecf\u6ca1\u5b58\u6d3b\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u80fd\u63d0\u9ad8GC\u6548\u7387\uff0c\u9664\u975e\u90fd\u662f\u8001\u5e74\u4ee3\u5bf9\u8c61</p>"},{"location":"android/java/java_jvm/#_35","title":"\u907f\u514d\u8de8\u4ee3\u626b\u9762","text":"<p>\u8001\u5e74\u4ee3\u5f15\u7528\u4e86\u65b0\u751f\u4ee3\uff0c\u5bfc\u81f4\u51fa\u73b0\u6574\u5806\u626b\u63cf\uff0c\u5185\u90e8\u4f18\u5316\u65b9\u6848\u5361\u8868</p> <p>\u5361\u8868(card table)\uff1a\u5f53\u51fa\u73b0\u8de8\u4ee3\u5f15\u7528\u65f6\uff0c\u4f1a\u5728\u5361\u8868\u4e0a\u8fdb\u884c\u6807\u8bb0\uff0c\u8fd9\u6837\u626b\u63cf\u53ea\u9700\u8981\u626b\u65b0\u751f\u4ee3\u548c\u88ab\u6807\u8bb0\u7684\u6570\u636e</p> <p>\u5e38\u91cf\u6c60(\u65b9\u6cd5\u533a) Class\u5e38\u91cf\u6c60\u3001\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u3001\u8fd0\u884c\u65f6\u5e38\u91cf\u6c60 <pre><code>new String(\"a\") == new String(\"a\");// false\nnew String(\"a\").intern() == new String(\"a\").intern();// true\u4ece\u5e38\u91cf\u6c60\u83b7\u53d6\n</code></pre></p>"},{"location":"android/java/java_jvm/#_36","title":"\u603b\u7ed3\u56fe","text":""},{"location":"android/java/java_lock/","title":"\u9501","text":""},{"location":"android/java/java_lock/#_1","title":"\u9501\u7684\u5206\u7c7b","text":""},{"location":"android/java/java_lock/#vs","title":"\u4e50\u89c2\u9501vs\u60b2\u89c2\u9501","text":"<p>\u4e50\u89c2\u9501\uff1a\u4e0d\u52a0\u9501\u66f4\u65b0\u6570\u636e\u65f6\u4f1a\u5224\u65ad\u662f\u5426\u88ab\u4fee\u6539\uff0c\u5982\u88ab\u4fee\u6539\u4f1a\u53d1\u9001\u81ea\u65cb(\u53ef\u7406\u89e3\u4e3a\u6b7b\u5faa\u73af)\uff0cjava.util.concurret.atomic\u5305\u4e0b\u7684\u539f\u5b50\u53d8\u91cf\u7c7b\uff0c\u57fa\u4e8eCAS\u5b9e\u73b0</p> <p>\u60b2\u89c2\u9501\uff1a\u83b7\u53d6\u6570\u636e\u65f6\u90fd\u4f1a\u4e0a\u9501\uff0csynchronized</p> <p>\u4e00\u822c\u4e50\u89c2\u9501\u6027\u80fd\u6bd4\u60b2\u89c2\u9501\u597d\uff0c\u539f\u56e0\u662f\uff1a\u4e0a\u4e0b\u6587\u5207\u6362\u9700\u89813-5ms\uff0ccpu\u6267\u884c\u6307\u4ee4\u7ea60.6ns\uff0c\u62ff\u9501\u81f3\u5c11\u9700\u89812\u6b21\u4e0a\u4e0b\u6587\u5207\u6362</p>"},{"location":"android/java/java_lock/#vs_1","title":"\u72ec\u4eab\u9501vs\u5171\u4eab\u9501","text":"<p>\u72ec\u4eab\u9501\uff1a\u9501\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u6240\u6301\u6709\uff0cReentrantLock</p> <p>\u5171\u4eab\u9501\uff1a\u9501\u80fd\u88ab\u591a\u4e2a\u7ebf\u7a0b\u6240\u6301\u6709\uff0cReadWriteLock\u4e2d\u8bfb\u9501\u662f\u5171\u4eab\u9501\uff0c\u5199\u9501\u662f\u72ec\u4eab\u9501</p>"},{"location":"android/java/java_lock/#vs_2","title":"\u4e92\u65a5\u9501vs\u8bfb\u5199\u9501","text":"<p>\u5e7f\u4e49\u8bf4\u6cd5</p> <p>\u4e92\u65a5\u9501\uff1a\u5177\u4f53\u5b9e\u73b0ReentrantLock</p> <p>\u8bfb\u5199\u9501\uff1a\u5177\u4f53\u5b9e\u73b0ReadWriteLock</p>"},{"location":"android/java/java_lock/#_2","title":"\u53ef\u91cd\u5165\u9501","text":"<p><pre><code>synchronized void A(){}\nsynchronized void B(){}\n</code></pre> \u6b64\u5904\u9501\u7684\u662f\u5bf9\u8c61\uff0c\u5373\u5bf9\u4e8e\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0d\u80fd\u540c\u65f6\u8c03\u7528A\u3001B\u65b9\u6cd5\uff0c\u5982\u679c\u4e0d\u53ef\u91cd\u5165\uff0cA\u65b9\u6cd5\u83b7\u5f97\u9501\u540e\u8fd8\u6ca1\u91ca\u653e\u9501\u4e4b\u524d\uff0cB\u4e5f\u80fd\u83b7\u5f97\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501</p>"},{"location":"android/java/java_lock/#_3","title":"\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501","text":"\u516c\u5e73\u9501 \u975e\u516c\u5e73\u9501 \u5b9a\u4e49 \u591a\u4e2a\u7ebf\u7a0b\u6392\u961f\u7533\u8bf7\u9501 \u591a\u4e2a\u7ebf\u7a0b\u90fd\u5c1d\u8bd5\u83b7\u5f97\u9501\uff0c\u5148\u5360\u5148\u5f97 \u4f18\u70b9 \u6240\u6709\u7ebf\u7a0b\u90fd\u80fd\u83b7\u5f97\u9501 \u51cf\u5c11cpu\u5524\u9192\u5f00\u9500\uff0c\u541e\u5410\u6548\u7387\u53d8\u9ad8 \u7f3a\u70b9 \u9664\u4e86\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u540e\u7eed\u7ebf\u7a0b\u4f1a\u963b\u585e\u5bfc\u81f4\u589e\u52a0cpu\u5524\u9192\u5f00\u9500\u53d8\u5927\uff0c\u541e\u5410\u6548\u7387\u53d8\u4f4e \u6709\u53ef\u80fd\u5bfc\u81f4\u67d0\u4e9b\u7ebf\u7a0b\u4e00\u76f4\u65e0\u6cd5\u83b7\u5f97\u9501 <p>ReentrantLock\u9ed8\u8ba4\u662f\u975e\u516c\u5e73\u9501\uff0cReentrantLock(true)\u4e3a\u516c\u5e73\u9501\uff0c\u5206\u522b\u5bf9\u5e94NonfairSync\u548cFairSync</p>"},{"location":"android/java/java_lock/#_4","title":"\u5206\u6bb5\u9501","text":"<p>\u662f\u4e00\u79cd\u8bbe\u8ba1\uff0cConcurrentHashMap\u5206\u6bb5\u9501\u5c01\u88c5\u4e3aSegment</p>"},{"location":"android/java/java_lock/#_5","title":"\u504f\u5411\u9501/\u8f7b\u91cf\u7ea7\u9501/\u91cd\u91cf\u7ea7\u9501","text":"<p>\u6307\u9501\u7684\u72b6\u6001\uff0c\u504f\u5411\u9501\u6307\u4e00\u6bb5\u540c\u6b65\u4ee3\u7801\u4e00\u76f4\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee</p> <p>\u8f7b\u91cf\u7ea7\u9501\uff1a\u504f\u5411\u9501\u88ab\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540e\u5347\u7ea7\uff0c\u5176\u4ed6\u7ebf\u7a0b\u901a\u8fc7\u81ea\u65cb\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u4e0d\u4f1a\u963b\u585e</p> <p>\u91cd\u91cf\u7ea7\u9501\uff1a\u8f7b\u91cf\u7ea7\u9501\u65f6\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u81ea\u65cb\u4e00\u5b9a\u6b21\u6570\u540e\u65e0\u6cd5\u83b7\u5f97\u9501\u5c31\u8fdb\u5165\u963b\u585e</p>"},{"location":"android/java/java_lock/#_6","title":"\u81ea\u65cb\u9501","text":"<p>\u5c1d\u8bd5\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u7acb\u5373\u963b\u585e\uff0c\u91c7\u53d6\u5faa\u73af\u7684\u65b9\u5f0f\u83b7\u53d6\u9501\uff0c\u51cf\u5c11\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6d88\u8017\uff0c\u7f3a\u70b9\u662f\u6d88\u8017cpu</p>"},{"location":"android/java/java_lock/#sleepwait","title":"sleep\u548cwait\u7684\u533a\u522b","text":"<p>Thread.Sleep(0)\u7684\u4f5c\u2f64\uff0c\u89e6\u53d1\u64cd\u4f5c\u7cfb\u7edf\u2f74\u523b\u91cd\u65b0\u8fdb\u2f8f\u2f00\u6b21CPU\u7ade\u4e89</p> <p>1\u3001sleep\u662fThread\u7684\u9759\u6001\u2f45\u6cd5\uff0cwait\u662fObject\u7684\u2f45\u6cd5\uff0c\u4efb\u4f55\u5bf9\u8c61\u5b9e\u4f8b\u90fd\u80fd\u8c03\u2f64\u3002</p> <p>2\u3001sleep\u4e0d\u4f1a\u91ca\u653e\u9501\uff0c\u5b83\u4e5f\u4e0d\u9700\u8981\u5360\u2f64\u9501\u3002wait\u4f1a\u91ca\u653e\u9501\uff0c\u4f46\u8c03\u2f64\u5b83\u7684\u524d\u63d0\u662f\u5f53\u524d\u7ebf\u7a0b\u5360\u6709\u9501(\u5373\u4ee3\u7801\u8981\u5728synchronized\u4e2d)\u3002</p> <p>3\u3001\u5b83\u4eec\u90fd\u53ef\u4ee5\u88abinterrupt\u2f45\u6cd5\u4e2d\u65ad</p> <p>4\u3001notify\u662f\u9700\u8981\u7b49synchronized\u5305\u88f9\u7684\u6240\u6709\u4ee3\u7801\u6267\u884c\u5b8c\u6210\u624d\u91ca\u653e\u9501</p> sleep wait \u540c\u6b65 \u65e0\u9650\u5236 synchronized\u4e2d\u4f7f\u7528 \u4f5c\u7528\u5bf9\u8c61 \u5b9a\u4e49\u5728Thread\u4e2d\uff0c\u4f5c\u7528\u57df\u5f53\u524d\u7ebf\u7a0b \u5b9a\u4e49\u5728Object\u4e2d\uff0c\u4f5c\u7528\u4e8e\u672c\u8eab \u91ca\u653e\u9501 \u5426 \u662f \u5524\u9192\u6761\u4ef6 \u8d85\u65f6\u6216\u8c03\u7528interrupt\u65b9\u6cd5 \u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528notify\u6216notifyAll \u65b9\u6cd5\u5c5e\u6027 \u5b9e\u4f8b\u65b9\u6cd5 \u9759\u6001\u2f45\u6cd5"},{"location":"android/java/java_lock/#_7","title":"\u6b7b\u9501","text":"<ol> <li>\u4e92\u65a5\u6761\u4ef6\uff0c\u6bcf\u4e2a\u8d44\u6e90\u6bcf\u6b21\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\uff08\u6216\u8fdb\u7a0b\uff0c\u4e0b\u540c\uff09\u4f7f\u7528</li> <li>\u8bf7\u6c42\u4e0e\u4fdd\u6301\u6761\u4ef6\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bd5\u56fe\u83b7\u53d6\u8d44\u6e90\uff0c\u4f46\u53d1\u751f\u4e86\u963b\u585e\uff0c\u5219\u9700\u5bf9\u5df2\u83b7\u5f97\u7684\u8d44\u6e90\u4fdd\u6301\u4e0d\u653e</li> <li>\u4e0d\u5265\u593a\u6761\u4ef6\uff0c\u6307\u7ebf\u7a0b\u5df2\u83b7\u5f97\u7684\u8d44\u6e90\uff0c\u5728\u672a\u4f7f\u7528\u5b8c\u4e4b\u524d\uff0c\u4e0d\u4f1a\u88ab\u5f3a\u884c\u5265\u593a</li> <li>\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\uff0c\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u5fc5\u987b\u5f62\u6210\u201c\u5faa\u73af\u7b49\u5f85\u201d\uff0c\u624d\u6709\u53ef\u80fd\u5f62\u6210\u6b7b\u9501</li> </ol> <p>\u603b\u7ed3\uff1a</p> <ol> <li>\u591a\u4e2a\u64cd\u4f5c\u8005(m&gt;=2)\uff0c\u4e89\u593a\u591a\u4e2a\u8d44\u6e90(n&gt;=2)\uff0c\u4e14n&lt;=m</li> <li>\u4e89\u593a\u8d44\u6e90\u7684\u987a\u5e8f\u4e0d\u5bf9</li> <li>\u62ff\u5230\u8d44\u6e90\u4e0d\u653e\u624b</li> </ol> <p>\u9632\u6b62\u6b7b\u9501\uff1a\u4ece2\u548c3\u89e3\u51b3\uff0c\u4e0d\u4f7f\u7528\u4e92\u65a5\u9501\uff0clock\u9501\u8d85\u65f6\u673a\u5236\u91ca\u653e\u9501\uff0c\u8d44\u6e90\u6807\u8bb0\u6709\u5e8f\u53bb\u9501\u8d44\u6e90\uff0c\u94f6\u884c\u5bb6\u7b97\u6cd5</p>"},{"location":"android/java/java_lock/#aqs","title":"AQS","text":"<p>AbstractqueuedSynchronizer</p>"},{"location":"android/java/java_reflex/","title":"\u53cd\u5c04","text":""},{"location":"android/java/java_reflex/#class","title":"\u83b7\u5f97 Class \u5bf9\u8c61","text":"<p>\u83b7\u53d6Class\u5bf9\u8c61\u7684\u4e09\u79cd\u65b9\u5f0f</p> <ol> <li>\u901a\u8fc7\u7c7b\u540d\u83b7\u53d6 \u7c7b\u540d.class</li> <li>\u901a\u8fc7\u5bf9\u8c61\u83b7\u53d6 \u5bf9\u8c61\u540d.getClass()</li> <li>\u901a\u8fc7\u5168\u7c7b\u540d\u83b7\u53d6 Class.forName(\u5168\u7c7b\u540d) classLoader.loadClass(\u5168\u7c7b\u540d)</li> </ol> <p>\u4f7f\u7528 Class \u7c7b\u7684 forName \u9759\u6001\u65b9\u6cd5 <pre><code>public static Class&lt;?&gt; forName(String className)\n</code></pre> \u76f4\u63a5\u83b7\u53d6\u67d0\u4e00\u4e2a\u5bf9\u8c61\u7684 class <pre><code>Class&lt;?&gt; klass = int.class;\nClass&lt;?&gt; classInt = Integer.TYPE;\n</code></pre> \u8c03\u7528\u67d0\u4e2a\u5bf9\u8c61\u7684 getClass() \u65b9\u6cd5 <pre><code>StringBuilder str = new StringBuilder(\"123\");\nClass&lt;?&gt; klass = str.getClass();\n</code></pre></p>"},{"location":"android/java/java_reflex/#_1","title":"\u5224\u65ad\u662f\u5426\u4e3a\u67d0\u4e2a\u7c7b\u7684\u5b9e\u4f8b","text":"<p>\u4e00\u822c\u5730\uff0c\u6211\u4eec\u7528 instanceof \u5173\u952e\u5b57\u6765\u5224\u65ad\u662f\u5426\u4e3a\u67d0\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u3002\u540c\u65f6\u6211\u4eec\u4e5f\u53ef\u4ee5\u501f\u52a9\u53cd\u5c04\u4e2d Class \u5bf9\u8c61\u7684isInstance() \u65b9\u6cd5\u6765\u5224\u65ad\u662f\u5426\u4e3a\u67d0\u4e2a\u7c7b\u7684\u5b9e\u4f8b\uff0c\u5b83\u662f\u4e00\u4e2a native \u65b9\u6cd5\uff1a <pre><code>public native boolean isInstance(Object obj);\n</code></pre> \u5224\u65ad\u662f\u5426\u4e3a\u67d0\u4e2a\u7c7b\u7684\u7c7b\u578b <pre><code>public boolean isAssignableFrom(Class&lt;?&gt; cls)\n</code></pre></p>"},{"location":"android/java/java_reflex/#_2","title":"\u521b\u5efa\u5b9e\u4f8b","text":"<p>\u901a\u8fc7\u53cd\u5c04\u6765\u751f\u6210\u5bf9\u8c61\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\u3002</p> <p>\u4f7f\u7528Class\u5bf9\u8c61\u7684newInstance()\u65b9\u6cd5\u6765\u521b\u5efaClass\u5bf9\u8c61\u5bf9\u5e94\u7c7b\u7684\u5b9e\u4f8b\u3002 <pre><code>Class&lt;?&gt; c = String.class;\nObject str = c.newInstance();\n</code></pre> \u5148\u901a\u8fc7Class\u5bf9\u8c61\u83b7\u53d6\u6307\u5b9a\u7684Constructor\u5bf9\u8c61\uff0c\u518d\u8c03\u7528Constructor\u5bf9\u8c61\u7684newInstance()\u65b9\u6cd5\u6765\u521b\u5efa\u5b9e\u4f8b\u3002\u8fd9 \u79cd\u65b9\u6cd5\u53ef\u4ee5\u7528\u6307\u5b9a\u7684\u6784\u9020\u5668\u6784\u9020\u7c7b\u7684\u5b9e\u4f8b\u3002 <pre><code>//\u83b7\u53d6String\u6240\u5bf9\u5e94\u7684Class\u5bf9\u8c61\nClass&lt;?&gt; c = String.class;\n//\u83b7\u53d6String\u7c7b\u5e26\u4e00\u4e2aString\u53c2\u6570\u7684\u6784\u9020\u5668\nConstructor constructor = c.getConstructor(String.class);\n//\u6839\u636e\u6784\u9020\u5668\u521b\u5efa\u5b9e\u4f8b\nObject obj = constructor.newInstance(\"23333\");\nSystem.out.println(obj);\n</code></pre></p>"},{"location":"android/java/java_reflex/#_3","title":"\u83b7\u53d6\u6784\u9020\u5668\u4fe1\u606f","text":"<p>\u5f97\u5230\u6784\u9020\u5668\u7684\u65b9\u6cd5 <pre><code>Constructor getConstructor(Class[] params) -- \u83b7\u5f97\u4f7f\u7528\u7279\u6b8a\u7684\u53c2\u6570\u7c7b\u578b\u7684public\u6784\u9020\u51fd\u6570(\u5305\u62ec\u7236\u7c7b\uff09\nConstructor[] getConstructors() -- \u83b7\u5f97\u7c7b\u7684\u6240\u6709\u516c\u5171\u6784\u9020\u51fd\u6570\nConstructor getDeclaredConstructor(Class[] params) -- \u83b7\u5f97\u4f7f\u7528\u7279\u5b9a\u53c2\u6570\u7c7b\u578b\u7684\u6784\u9020\u51fd\u6570(\u5305\u62ec\u79c1\u6709)\nConstructor[] getDeclaredConstructors() -- \u83b7\u5f97\u7c7b\u7684\u6240\u6709\u6784\u9020\u51fd\u6570(\u4e0e\u63a5\u5165\u7ea7\u522b\u65e0\u5173)\n</code></pre></p>"},{"location":"android/java/java_reflex/#_4","title":"\u83b7\u53d6\u7c7b\u7684\u6210\u5458\u53d8\u91cf\uff08\u5b57\u6bb5\uff09\u4fe1\u606f","text":"<p>\u83b7\u5f97\u5b57\u6bb5\u4fe1\u606f\u7684\u65b9\u6cd5 <pre><code>Field getField(String name) -- \u83b7\u5f97\u547d\u540d\u7684\u516c\u5171\u5b57\u6bb5\nField[] getFields() -- \u83b7\u5f97\u7c7b\u7684\u6240\u6709\u516c\u5171\u5b57\u6bb5\nField getDeclaredField(String name) -- \u83b7\u5f97\u7c7b\u58f0\u660e\u7684\u547d\u540d\u7684\u5b57\u6bb5\nField[] getDeclaredFields() -- \u83b7\u5f97\u7c7b\u58f0\u660e\u7684\u6240\u6709\u5b57\u6bb5\n</code></pre></p>"},{"location":"android/java/java_reflex/#_5","title":"\u8c03\u7528\u65b9\u6cd5","text":"<p>\u83b7\u5f97\u65b9\u6cd5\u4fe1\u606f\u7684\u65b9\u6cd5 <pre><code>Method getMethod(String name, Class[] params) -- \u4f7f\u7528\u7279\u5b9a\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u83b7\u5f97\u547d\u540d\u7684\u516c\u5171\u65b9\u6cd5\nMethod[] getMethods() -- \u83b7\u5f97\u7c7b\u7684\u6240\u6709\u516c\u5171\u65b9\u6cd5\nMethod getDeclaredMethod(String name, Class[] params) -- \u4f7f\u7528\u7279\u5199\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u83b7\u5f97\u7c7b\u58f0\u660e\u7684\u547d\u540d\u7684\u65b9\u6cd5\nMethod[] getDeclaredMethods() -- \u83b7\u5f97\u7c7b\u58f0\u660e\u7684\u6240\u6709\u65b9\u6cd5\n</code></pre> \u8c03\u7528invoke\u6765\u8c03\u7528\u65b9\u6cd5 <pre><code>public Object invoke(Object obj, Object... args)\n</code></pre></p>"},{"location":"android/java/java_reflex/#_6","title":"\u9759\u6001\u4ee3\u7406","text":"<p>\u5b9a\u4e49\u62bd\u8c61\u63a5\u53e3 <pre><code>/**\n * \u4ee3\u7406\u62bd\u8c61\u89d2\u8272\n */\npublic interface Massage {\nvoid massage(String name);\n}\npublic interface Wash {\nvoid wash();\n}\n</code></pre> \u5b9a\u4e49\u4ee3\u7406\u5bf9\u8c61 <pre><code>public class Agent implements Massage {\nprivate final Massage massage;\npublic Agent(Massage massage) {\nthis.massage = massage;\n}\n@Override\npublic void massage(String name) {\nmassage.massage(name);\n}\n}\npublic class WashAgent implements Wash {\nprivate final Wash mWash;\npublic WashAgent(Wash wash) {\nthis.mWash = wash;\n}\n@Override\npublic void wash() {\nthis.mWash.wash();\n}\n}\n</code></pre> \u5b9a\u4e49\u5b9e\u73b0\u7c7b <pre><code>public class Alvin implements Massage, Wash {\n@Override\npublic void massage(String name) {\nSystem.out.println(\"massage\");\n}\n@Override\npublic void wash() {\nSystem.out.println(\"wash\");\n}\n}\n</code></pre> \u6d4b\u8bd5 <pre><code>Massage massage = new Alvin();\nWash wash = new Alvin();\nAgent agent = new Agent(massage);\nagent.massage(\"Alvin\");\nWashAgent washAgent = new WashAgent(wash);\nwashAgent.wash();\n</code></pre></p>"},{"location":"android/java/java_reflex/#_7","title":"\u52a8\u6001\u4ee3\u7406","text":"<pre><code>Alvin alvin = new Alvin();\nObject o = Proxy.newProxyInstance(MyClass.class.getClassLoader(),\nnew Class[]{Massage.class, Wash.class},//\u4f20\u5165\u9700\u8981\u4ee3\u7406\u7684class\nnew InvocationHandler() {\n@Override\npublic Object invoke(Object o, Method method, Object[] objects) throws Throwable {\n//\u53cd\u5c04\u8c03\u7528\u65b9\u6cd5\uff0cmethod\u662f\u8c03\u7528\u7684\u65b9\u6cd5\u6bd4\u5982massage\u548cwash\n//objects\u662f\u65b9\u6cd5\u53c2\u6570\u503c\u6bd4\u5982\u201cAlvin\u201d\nreturn method.invoke(alvin, objects);\n}\n});\nMassage mag = (Massage) o;\nmag.massage(\"Alvin\");//\u4f1a\u89e6\u53d1invoke\u56de\u8c03\n\nWash wh = (Wash) o;\nwh.wash();//\u4f1a\u89e6\u53d1invoke\u56de\u8c03\n</code></pre>"},{"location":"android/java/java_safe/","title":"\u7ebf\u7a0b\u5b89\u5168","text":""},{"location":"android/java/java_safe/#_1","title":"\u8868\u73b0","text":"<p>\u539f\u2f26\u6027\u3001\u53ef\u2ec5\u6027\u3001\u6709\u5e8f\u6027</p>"},{"location":"android/java/java_safe/#_2","title":"\u89e3\u51b3\u65b9\u5411","text":"<p>1.\u4e0d\u53ef\u53d8</p> <p>final\u5173\u952e\u5b57\u4fee\u9970\u7684\u7c7b\u6216\u6570\u636e\u4e0d\u53ef\u4fee\u6539\uff0c\u5982String\u7c7b\uff0cInteger\u7c7b</p> <p>2.\u7ebf\u7a0b\u5c01\u95ed</p> <p>Ad-hoc \u7ebf\u7a0b\u5c01\u95ed\u3001ThreadLocal\u3001\u5806\u6808\u5c01\u95ed</p> <p>3.\u540c\u6b65</p> <p>\u60b2\u89c2\u9501\u548c\u4e50\u89c2\u9501(\u2fae\u963b\u585e\u540c\u6b65)</p> <p>\u60b2\u89c2\u9501\uff1asynchronized\u3001Lock(ReentrantReadWriteLock/ReentrantLock)\u3001\u53ef\u89c1\u6027</p> <p>\u4e50\u89c2\u9501\uff1aCAS\u3001volatile\u3001\u6709\u5e8f\u6027\u3001\u539f\u5b50\u6027</p>"},{"location":"android/java/java_safe/#cas","title":"CAS","text":"<p>\u4e50\u89c2\u9501\uff0c\u6bd4\u8f83\u4e0e\u4ea4\u6362\u7684\u65e0\u9501\u7b97\u6cd5\uff0c\u975e\u963b\u585e\u540c\u6b65</p>"},{"location":"android/java/java_safe/#_3","title":"\u539f\u7406","text":"<ol> <li> <p>CAS\u6307\u4ee4\u6bcf\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u6210\u529f\uff0c\u4ee5i=0,i++\u4e3a\u4f8b</p> </li> <li> <p>\u7ebf\u7a0b1\u3001\u7ebf\u7a0b2\u3001\u7ebf\u7a0b3\u540c\u65f6\u6267\u884c\u65f6\uff0c\u5206\u522b\u4f1a\u5728\u81ea\u5df1\u5185\u5b58\u7a7a\u95f4\u8ba1\u7b97\u597di++\u7684\u503c\uff0c\u5373\u4e3a1</p> </li> <li> <p>\u7ebf\u7a0b1\u6267\u884cCAS\u6307\u4ee4\uff0c\u6bd4\u8f83\u539fi\u548c\u81ea\u5df1\u8ba1\u7b97\u7684\u503c\u5982\u679c\u4e0d\u540c\u5219\u8fdb\u884c\u4ea4\u6362\uff0c\u5373\u4e3b\u5185\u5b58i\u53d8\u62101</p> </li> <li> <p>\u7ebf\u7a0b2\u6267\u884cCAS\u6307\u4ee4\u53d1\u73b0i\u548c\u81ea\u5df1\u7684\u503c\u76f8\u540c\uff0c\u5219\u91cd\u65b0\u4ece\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6i\u5e76\u8fdb\u884ci++\uff0c\u8be5\u8fc7\u7a0b\u6210\u4e3a\u81ea\u65cb\uff0c\u518d\u6267\u884cCAS\u6267\u884c\uff0c\u6bd4\u8f83\u548c\u4ea4\u6362i\u53d8\u62102\u3002\u7ebf\u7a0b3\u548c\u7ebf\u7a0b2\u7c7b\u4f3c</p> </li> </ol> <p>\u7f3a\u70b9\uff1a\u5faa\u73af\u65f6\u95f4\u957f\u8bdd\u5f00\u9500\u5927\uff0cABA\u95ee\u9898(\u6570\u636e\u4e2d\u9014\u88ab\u4fee\u6539\u8fc7)\uff0c\u4e0d\u80fd\u4fdd\u8bc1\u591a\u4e2a\u5171\u4eab\u53d8\u91cf\u7684\u539f\u5b50\u6027</p>"},{"location":"android/java/java_safe/#_4","title":"\u539f\u5b50\u64cd\u4f5c\u7c7b","text":"<p>\u66f4\u65b0\u57fa\u672c\u7c7b\u578b\u7c7b\uff1aAtomicBoolean\u3001AtomicInteger\u3001AtomicLong</p> <p>\u66f4\u65b0\u6570\u7ec4\u7c7b\uff1aAtomicIntegerArray\u3001AtomicLongArray\u3001AtomicReferenceArray</p> <p>\u66f4\u65b0\u5f15\u7528\u7c7b\u578b\uff1aAtomicReference\u3001AtomicMarkableReference\u3001AtomicStampedReference</p> <p>AtomicMarkableReference\u548cAtomicStampedReference\u7528\u6765\u89e3\u51b3ABA\u95ee\u9898\uff0c\u901a\u8fc7\u7248\u672c\u63a7\u5236\u524d\u8005\u662fboolean\u7c7b\u578b\uff0c\u540e\u8005\u662fint\u7c7b\u578b</p>"},{"location":"android/java/java_safe/#synchronized","title":"Synchronized","text":"<p>\u4fdd\u8bc1\u4e92\u65a5\u7684\uff0c\u2f00\u5757\u4ee3\u7801\u4e0d\u80fd\u540c\u65f6\u88ab\u4e24\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u80fd\u4fdd\u8bc1\u53ef\u89c1\u6027\u3001\u6709\u5e8f\u6027\u3001\u539f\u5b50\u6027</p>"},{"location":"android/java/java_safe/#semaphore","title":"Semaphore\u7c7b","text":"<p>\u8fdb\u2f8f\u5e76\u53d1\u63a7\u5236\uff0c\u9650\u5236\u8bbf\u95ee\u2f00\u4e2a\u8d44\u6e90\uff08\u6216\u4ee3\u7801\u5757\uff09\u7684\u7ebf\u7a0b\u6570\u2f6c\u3002\u5f53\u8bbe\u5b9a\u7684\u7ebf\u7a0b\u6570\u2f6c\u662f1\u65f6\uff0c\u5e76\u53d1\u5176\u5b9e\u5c31\u9000\u5316\u5230\u4e86\u4e92\u65a5</p>"},{"location":"android/java/java_safe/#lock","title":"Lock\u7c7b","text":"<p>\u53ef\u4ee5\u53d6\u4ee3Object\u7684notify\u548cwait</p>"},{"location":"android/java/java_safe/#_5","title":"\u5bf9\u8c61\u9501","text":"<p>Synchronized+Object\u7684Notify\u548cwait\u2f00\u8d77\u6784\u6210\u4e86\u540c\u6b65</p>"},{"location":"android/java/java_safe/#volatile","title":"volatile","text":"<p>\u8f7b\u91cf\u7ea7\u7684synchronized\uff0c\u662f\u2f00\u4e2a\u53d8\u91cf\u4fee\u9970\u7b26\uff0c\u53ea\u80fd\u2f64\u6765\u4fee\u9970\u53d8\u91cf\uff0c\u80fd\u4fdd\u8bc1\u7f13\u5b58\u4e00\u81f4\u6027</p> <p>\u7f13\u5b58\u2f00\u81f4\u6027\u534f\u8bae\uff1a\u6bcf\u4e2a\u5904\u7406\u5668\u901a\u8fc7\u55c5\u63a2\u5728\u603b\u7ebf\u4e0a\u4f20\u64ad\u7684\u6570\u636e\u6765\u68c0\u67e5\u2f83\u2f30\u7f13\u5b58\u7684\u503c\u662f\u5426\u8fc7\u671f\uff0c\u5f53\u5904\u7406\u5668\u53d1\u73b0\u7f13\u5b58\u2f8f\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\u88ab\u4fee\u6539\uff0c\u5c31\u4f1a\u5c06\u5f53\u524d\u5904\u7406\u5668\u7684\u7f13\u5b58\u2f8f\u8bbe\u7f6e\u6210\u2f46\u6548\u72b6\u6001\uff0c\u5f53\u5904\u7406\u5668\u8981\u5bf9\u8fd9\u4e2a\u6570\u636e\u8fdb\u2f8f\u4fee\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4f1a\u5f3a\u5236\u91cd\u65b0\u4ece\u7cfb\u7edf\u5185\u5b58\u2fa5\u628a\u6570\u636e\u8bfb\u5230\u5904\u7406\u5668\u7f13\u5b58\u2fa5</p>"},{"location":"android/java/java_safe/#_6","title":"\u53ef\u2ec5\u6027","text":"<p>\u6307\u5f53\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u2f00\u4e2a\u53d8\u91cf\u65f6\uff0c\u2f00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u2f74\u5373\u770b\u5f97\u5230\u4fee\u6539\u7684\u503c</p> <p>volatile\u4fdd\u8bc1\u53ef\u89c1\u6027\uff1a\u88ab\u5176\u4fee\u9970\u7684\u53d8\u91cf\u5728\u88ab\u4fee\u6539\u540e\u53ef\u4ee5\u2f74\u5373\u540c\u6b65\u5230\u4e3b\u5185\u5b58\uff0c\u88ab\u5176\u4fee\u9970\u7684\u53d8\u91cf\u5728\u6bcf\u6b21\u4f7f\u2f64\u4e4b\u524d\u90fd\u4ece\u4e3b\u5185\u5b58\u5237\u65b0</p>"},{"location":"android/java/java_safe/#_7","title":"\u6709\u5e8f\u6027","text":"<p>\u6307\u7a0b\u5e8f\u6267\u2f8f\u7684\u987a\u5e8f\u6309\u7167\u4ee3\u7801\u7684\u5148\u540e\u987a\u5e8f\u6267\u2f8f\uff08happens-before\u539f\u5219\uff09</p> <p>volatile\u4fdd\u8bc1\u6709\u5e8f\u6027\uff1a\u7981\u2f4c\u6307\u4ee4\u91cd\u6392\u4f18\u5316\u7b49\uff0c\u4fdd\u8bc1\u4ee3\u7801\u7684\u7a0b\u5e8f\u4f1a\u4e25\u683c\u6309\u7167\u4ee3\u7801\u7684\u5148\u540e\u987a\u5e8f\u6267\u2f8f</p>"},{"location":"android/java/java_safe/#_8","title":"\u539f\u2f26\u6027","text":"<p>\u6307\u2f00\u4e2a\u64cd\u4f5c\u662f\u4e0d\u53ef\u4e2d\u65ad\u7684\uff0c\u8981\u5168\u90e8\u6267\u2f8f\u5b8c\u6210\uff0c\u8981\u4e0d\u5c31\u90fd\u4e0d\u6267\u2f8f\uff0c\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5bf9\u5b83\u8fdb\u884c\u64cd\u4f5c</p> <p>volatile\u65e0\u6cd5\u4fdd\u8bc1\u539f\u2f26\u6027\uff1a\u4fdd\u8bc1\u539f\u2f26\u6027\u9700\u8981\u901a\u8fc7\u5b57\u8282\u7801\u6307\u4ee4monitorenter\u548cmonitorexit\uff0cvolatile\u548c\u8fd9\u4e24\u4e2a\u6307\u4ee4\u4e4b\u95f4\u662f\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u7684</p> <pre><code>private volatile int i = 0;\n//\u5982\u679c\u662fkotlin\u91c7\u7528\u6ce8\u89e3\u5f62\u5f0f\n@Volatile\nprivate i: Int = 0\n\ni++;\n</code></pre> <p>\u7ebf\u7a0bA\u548c\u7ebf\u7a0bB\u540c\u65f6\u4fee\u6539i++\u65f6\u4e3a\u5565\u4f1a\u6709\u95ee\u9898\uff1f</p> <p>\u7ebf\u7a0bA\u5728i++\u65f6i\u53d8\u62101\uff0c\u4f1a\u7acb\u5373\u5237\u65b0\u4e3b\u5185\u5b58\u4f7f\u5f97\u7ebf\u7a0bB\u7684i\u503c\u65e0\u6548\u91cd\u5199\u4ece\u4e3b\u5185\u5b58\u8bfb\u53d6\uff0c\u6309\u7406\u4e0d\u4f1a\u51fa\u73b0\u5f02\u5e38</p> <p>\u7406\u89e3</p> <p>1\u3001\u7ebf\u7a0b\u8bfb\u53d6i</p> <p>2\u3001temp = i + 1</p> <p>3\u3001i = temp</p> <p>\u5f53 i=0 \u7684\u65f6\u5019A,B\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5165\u4e86 i \u7684\u503c\uff0c \u7136\u540eA\u7ebf\u7a0b\u6267\u884c\u4e86temp = i + 1\u7684\u64cd\u4f5c\uff0c\u7136\u540eB\u7ebf\u7a0b\u4e5f\u6267\u884c\u4e86temp = i + 1\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6A\uff0cB\u4e24\u4e2a\u7ebf\u7a0b\u4fdd\u5b58\u7684 i \u7684\u503c\u90fd\u662f0\uff0ctemp\u7684\u503c\u90fd\u662f1\uff0c\u7136\u540eA\u7ebf\u7a0b\u6267\u884c\u4e86 i = temp\u7684\u64cd\u4f5c\uff0c\u6b64\u65f6i\u7684\u503c\u4f1a\u7acb\u5373\u5237\u65b0\u5230\u4e3b\u5b58\u5e76\u901a\u77e5\u5176\u4ed6\u7ebf\u7a0b\u4fdd\u5b58\u7684 i \u503c\u5931\u6548\uff0c\u6b64\u65f6B\u7ebf\u7a0b\u9700\u8981\u91cd\u65b0\u8bfb\u53d6 i \u7684\u503c\u90a3\u4e48\u6b64\u65f6B\u7ebf\u7a0b\u4fdd\u5b58\u7684 i \u5c31\u662f1\uff0c\u540c\u65f6B\u7ebf\u7a0b\u4fdd\u5b58\u7684temp\u8fd8\u4ecd\u7136\u662f1\uff0c\u7136\u540eB\u7ebf\u7a0b\u6267\u884c i=temp\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e86\u8ba1\u7b97\u7ed3\u679c\u6bd4\u9884\u671f\u5c11\u4e861</p> <p>\u4f7f\u7528\u573a\u666f\uff1a\u4e00\u5199\u591a\u8bfb\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u5199\u591a\u4e2a\u7ebf\u7a0b\u8bfb</p>"},{"location":"android/java/java_safe/#volatile_1","title":"\u61d2\u6c49\u53cc\u91cd\u6821\u9a8c\u548cvolatile","text":"<p>\u61d2\u6c49\u5f0f \u65e2\u7136synchronized\u4fdd\u8bc1\u4e86\u6709\u5e8f\u6027\u90a3\u4e3a\u5565\u8fd8\u9700\u8981volatile?</p> <p>synchronized\u53ea\u80fd\u4fdd\u8bc1\u8ba9\u95ed\u5305\u91cc\u4ee3\u7801\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\uff0c\u5f53\u7ebf\u7a0bA\u6267\u884cINSTANCE = new Singleton()\u65f6\uff0c\u5206\u4e3a\u5f00\u8f9f\u7a7a\u95f4\u521b\u5efa\u5bf9\u8c61\u3001\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u3001\u8d4b\u503c\u7ed9INSTANCE\u4e09\u6b65\uff0c\u7531\u4e8e\u865a\u62df\u673a\u6307\u4ee4\u91cd\u6392\u673a\u5236\u5bfc\u81f4\u540e\u9762\u4e24\u6b65\u53ef\u80fd\u987a\u5e8f\u98a0\u5012\uff0c\u6240\u4ee5\u5f53\u7ebf\u7a0bB\u8d70\u5230if (INSTANCE == null) {\u65f6\u4e0d\u4e3anull</p>"},{"location":"android/java/java_safe/#synchronized-vs-volatile","title":"synchronized vs volatile","text":"synchronized volatile \u4f7f\u7528 \u53d8\u91cf\u3001\u65b9\u6cd5\u3001\u7c7b\u3001\u540c\u6b65\u4ee3\u7801\u5757\u7b49 \u53d8\u91cf \u7ebf\u7a0b\u963b\u585e \u53ef\u80fd\u4f1a \u4e0d\u4f1a \u6027\u80fd \u6709\u9501\uff0c\u7565\u4f4e \u4f18\u4e8e\u524d\u8005 \u4fdd\u8bc1 \u6709\u5e8f\u3001\u53ef\u89c1\u3001\u539f\u5b50 \u6709\u5e8f\u3001\u53ef\u89c1 \u539f\u7406 \u52a0\u9501(monitorenter\u6307\u4ee4)\u91ca\u653e\u9501(monitorexit\u6307\u4ee4)\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5185\u5b58\u5c4f\u969c\u4fdd\u8bc1\u6709\u5e8f\u3001\u53ef\u89c1\u6027 \u5185\u5b58\u5c4f\u969c\u4fdd\u8bc1\u6709\u5e8f\u3001\u53ef\u89c1\u6027"},{"location":"android/java/java_safe/#synchronized-vs-lock","title":"synchronized vs lock","text":"synchronized Lock\u63a5\u53e3 \u4f7f\u7528 \u5173\u952e\u5b57 \u7c7b \u9501\u72b6\u6001 \u4e0d\u53ef\u5224\u65ad \u53ef\u5224\u65ad \u9501\u7c7b\u578b \u53ef\u91cd\u5165\uff0c\u4e0d\u53ef\u4e2d\u65ad\uff0c\u975e\u516c\u5e73\u9501 \u53ef\u91cd\u5165\uff0c\u53ef\u4e2d\u65ad\uff0c\u516c/\u975e\u516c\u5e73\u9501 \u5b58\u5728\u5c42\u6b21 volatile\u5173\u952e\u5b57 synchronized\u5173\u952e\u5b57 Lock\u63a5\u2f1d Atomic\u53d8\u91cf \u539f\u2f26\u6027 \u2f46\u6cd5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u2ec5\u6027 \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u6709\u5e8f\u6027 \u2f00\u5b9a\u7a0b\u5ea6\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u53ef\u4ee5\u4fdd\u969c \u2f46\u6cd5\u4fdd\u969c <p>4.\u5de5\u5177\u7c7b</p> <p>\u540c\u6b65\u5bb9\u5668\uff08\u5df2\u8fc7\u65f6\uff09 \u540c\u6b65\u5bb9\u5668\u7684\u2f2f\u5177\u6709Vector\u3001HashTable\u3001Collections.synchroniedXXX()</p> <p>\u5e76\u53d1\u5bb9\u5668\uff08JUC\uff09 ConcurrentHashMap\u3001CopyOnWriteArrayList</p> <p>JUC\u540c\u6b65\u5668 AQS</p>"},{"location":"android/java/java_safe/#_9","title":"\u5e76\u53d1\u5de5\u5177\u7c7b","text":""},{"location":"android/java/java_safe/#countdownlatch","title":"CountDownLatch","text":"<p>\u76f8\u5bf9\u4e8ejoin\uff0c\u66f4\u7075\u6d3b\u7684\u63a7\u5236\u7ebf\u7a0b\u6267\u884c\u987a\u5e8f\uff0c\u5982\u7ebf\u7a0b123\uff0c\u6309\u7167321\u6267\u884c\u540e\u6700\u7ec8main\u6267\u884c</p> <p>\u539f\u7406\u662f\u901a\u8fc7\u5185\u90e8\u7684\u8ba1\u6570\u6263\u9664\u6765\u63a7\u5236\uff0c\u6bcf\u6b21countDown()\u4f1a\u51cf1 <pre><code>fun main() {\nval mainLatch = CountDownLatch(1)\nval latch1 = CountDownLatch(2)\nval th1 = Thread {\nlatch1.await()\nprintln(\"${Thread.currentThread().name} run finish\")\nmainLatch.countDown()\n}.apply { name = \"thread1\" }\nval th2 = Thread {\nprintln(\"${Thread.currentThread().name} run finish\")\nlatch1.countDown()\n}.apply { name = \"thread2\" }\nval th3 = Thread {\nprintln(\"${Thread.currentThread().name} run finish\")\nlatch1.countDown()\n}.apply { name = \"thread3\" }\nth1.start()\nth2.start()\nth3.start()\nmainLatch.await()\nprintln(\"main\")\n}\n</code></pre></p>"},{"location":"android/java/java_safe/#cyclicbarrier","title":"CyclicBarrier","text":"<p>\u7528\u6765\u591a\u4e2a\u7ebf\u7a0b\u6c47\u603b\u4f7f\u7528\uff0c\u53ef\u4ee5\u591a\u6b21\u8c03\u7528await <pre><code>fun main() {\nval cyclic = CyclicBarrier(4){\nprintln(\"result--------\")\n}\nfor (i in 0..3) {\nThread(MyRun(cyclic)).start()\n}\n}\n\nclass MyRun(private val cyclic: CyclicBarrier) : Runnable {\noverride fun run() {\nprintln(\"${Thread.currentThread().name} is run\")\ncyclic.await()\nprintln(\"${Thread.currentThread().name} is finish\")\ncyclic.await()\n}\nThread-1 is run\nThread-0 is run\nThread-2 is run\nThread-3 is run\nresult--------\nThread-3 is finish\nThread-1 is finish\nThread-0 is finish\nThread-2 is finish\nresult--------\n</code></pre></p>"},{"location":"android/java/java_safe/#semaphore_1","title":"Semaphore","text":"<p>\u4fe1\u53f7\u91cf\uff0c\u4e3b\u8981\u7528\u4e8e\u6d41\u63a7\u4f7f\u7528</p>"},{"location":"android/java/java_safe/#countdownlatch-vs-cyclicbarrier","title":"CountDownLatch vs CyclicBarrier","text":"<p>\u573a\u666f\u4e3e\u4f8b\uff0cAndroid\u9879\u76ee\uff1aA\u6a21\u5757\uff0cB\u6a21\u5757\uff0cC\u6a21\u5757</p> <p>CyclicBarrier\uff1a\u5f53ABC\u6a21\u5757\u5b8c\u6210\u540e\u624d\u80fd\u6253\u5305apk</p> <p>CountDownLatch\uff1a\u5f53A\u6a21\u5757\u5b8c\u6210\u624d\u80fd\u7ee7\u7eedBC\u6a21\u5757</p> CountDownLatch CyclicBarrier \u8ba1\u6570\u5668\u548c\u7ebf\u7a0b\u6570 \u4e0d\u76f8\u7b49\uff0c\u53d6\u51b3\u4e8ecountDown\u8c03\u7528\u6b21\u6570 \u76f8\u7b49 \u7ebf\u7a0b\u63a7\u5236 \u7531\u5176\u4ed6\u7ebf\u7a0b\u901a\u8fc7countDown\u63a7\u5236 \u7531\u672c\u8eab\u63a7\u5236\uff0c\u53ea\u6709await \u4e3b\u7ebf\u7a0b \u4e0d\u963b\u585e \u963b\u585e \u91cd\u590d\u4f7f\u7528 \u4e0d\u53ef\u4ee5 \u53ef\u4ee5 \u8ba1\u6570\u65b9\u5f0f \u5012\u6570\u8ba1\u6570 \u6b63\u6570\u8ba1\u6570 \u5b9e\u73b0 \u5185\u90e8\u7c7bSync\u7ee7\u627fAQS\u5b9e\u73b0 \u901a\u8fc7\u91cd\u5165\u9501ReentrantLock\u5b9e\u73b0"},{"location":"android/java/java_safe/#transient","title":"transient\u5173\u952e\u5b57","text":"<p>\u4f7f\u6210\u5458\u53d8\u91cf\u4e0d\u88ab\u5e8f\u5217\u5316\uff0c\u88abstatic\u4fee\u9970\u7684\u6210\u5458\u53d8\u91cf\u65e0\u6548\uff0c\u9700\u8981\u5b9e\u73b0Serializable\u63a5\u2f1d\uff0c\u5982\u679c\u5b9e\u73b0Externalizable\u63a5\u2f1d\u5219\u4e5f\u65e0\u6548\uff0c\u9700\u8981\u81ea\u884c\u5728readExternal\u65b9\u6cd5\u91cc\u5904\u7406(\u624b\u52a8\u8bbe\u7f6enull)</p>"},{"location":"android/java/java_safe/#_10","title":"\u7ebf\u7a0b\u6c60","text":"<p>ThreadPoolExecutor</p> <p>\u62d2\u7edd\u7b56\u7565</p> <p>ThreadPoolExecutor.DiscardPolicy\uff1a\u4e0d\u4f1a\u629b\u5f02\u5e38\u4e5f\u4e0d\u4f1a\u6267\u2f8f</p> <p>ThreadPoolExecutor.AbortPolicy\uff1a\u9ed8\u8ba4\u7b56\u7565\uff0c\u62d2\u7edd\u540e\u629b\u5f02\u5e38</p> <p>ThreadPoolExecutor.CallerRunsPolicy\uff1a\u62d2\u7edd\u540e\u76f4\u63a5\u6267\u884crun\uff0c\u53ef\u80fd\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b</p> <p>ThreadPoolExecutor.DiscardOldestPolicy\uff1a\u62d2\u7edd\u540e\u4f1a\u629b\u5f03\u4efb\u52a1\u961f\u5217 \u4e2d\u6700\u65e7\u7684\u4efb\u52a1</p> <p>\u81ea\u5b9a\u4e49\u7b56\u7565</p> <p>\u5b9e\u73b0RejectedExecutionHandler\u63a5\u53e3</p> <p>\u5b9e\u73b0\u65b9\u5f0f</p> <ol> <li>newSingleThreadExecutor\uff1a\u4e00\u4e2a\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u6c60\uff0c\u5b58\u6d3b\u65f6\u95f4\u65e0\u9650\uff0c\u7f13\u5b58\u5230LinkedBlockingQueue\uff0c\u9002\u5408\u4e00\u4e2a\u4efb\u52a1\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u7684\u573a\u666f</li> <li>newCachedThreadPool\uff1a\u7f13\u5b58\u5230SynchronousQueue\u662f\u540c\u6b65\u961f\u5217\uff0c\u9002\u5408\u6267\u884c\u5f88\u591a\u77ed\u671f\u5f02\u6b65\u7684\u573a\u666f</li> <li>newFixedThreadPool: \u521b\u5efa\u53ef\u5bb9\u7eb3\u56fa\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60\uff0c\u5b58\u6d3b\u65f6\u95f4\u662f\u65e0\u9650\uff0c\u9002\u5408\u957f\u671f\u6267\u884c\u7684\u573a\u666f</li> <li>newScheduledThreadPool\uff1a\u521b\u5efa\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\uff0c\u7f13\u5b58\u5230DelayedWorkQueue\uff0c\u9002\u5408\u5468\u671f\u6027\u6267\u884c\u7684\u573a\u666f</li> </ol> <p>ThreadPoolExecutor\u7684\u53c2\u6570</p> <ol> <li>corePoolSize\uff1a\u7ebf\u7a0b\u6c60\u4e2d\u7684\u5e38\u9a7b\u6838\u5fc3\u7ebf\u7a0b\u6570</li> <li>maximumPoolSize\uff1a\u7ebf\u7a0b\u6c60\u80fd\u591f\u5bb9\u7eb3\u540c\u65f6\u6267\u884c\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e1</li> <li>keepAliveTime\uff1a\u7a7a\u95f2\u7ebf\u7a0b\u7684\u5b58\u6d3b\u65f6\u95f4</li> <li>unit\uff1akeepAliveTime\u7684\u5355\u4f4d</li> <li>workQueue\uff1a\u963b\u585e\u961f\u5217\uff0c\u88ab\u63d0\u4ea4\u4f46\u5c1a\u672a\u88ab\u6267\u884c\u7684\u4efb\u52a1</li> <li>threadFactory\uff1a\u751f\u6210\u7ebf\u7a0b\u6c60\u4e2d\u5de5\u4f5c\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u5de5\u5382\uff0c\u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b\u4e00\u822c\u9ed8\u8ba4\u5373\u53ef</li> <li>handler\uff1a\u62d2\u7edd\u7b56\u7565\uff0c\u5f53\u961f\u5217\u6ee1\u4e86\u5e76\u4e14\u5de5\u4f5c\u7ebf\u7a0b\u5927\u4e8e\u7b49\u4e8e\u7ebf\u7a0b\u6c60\u6700\u5927\u7ebf\u7a0b\u6570maximumPoolSize\u65f6\u5904\u7406\u65b9\u5f0f</li> </ol> <p>corePollSize\u6ee1\u4e86\u6dfb\u52a0\u5230workQueue\u4e2d\uff0c\u6ee1\u4e86\u518dmaximumPoolSize\u4e4b\u5185\u542f\u52a8\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u518d\u6ee1\u62d2\u7edd\u7b56\u7565handler</p>"},{"location":"android/java/java_safe/#_11","title":"\u5408\u7406\u914d\u7f6e","text":"<p>\u4efb\u52a1\u7279\u6027\uff1a</p> <ol> <li>CPU\u5bc6\u96c6\u578b\uff0cmaximumPoolSize\u4e0d\u8981\u8d85\u8fc7\u673a\u5668\u7684cpu\u6838\u5fc3\u6570+1 <pre><code>//\u673a\u5668\u7684cpu\u6838\u5fc3\u6570\u83b7\u53d6\nRuntime.getRuntime().availableProcessors()\n</code></pre></li> <li>IO\u5bc6\u96c6\u578b(\u78c1\u76d8\u3001\u7f51\u7edc)\uff0cmaximumPoolSize\u4e00\u822c\u662f\u673a\u5668\u7684cpu\u6838\u5fc3\u6570*2</li> <li>\u6df7\u5408\u578b</li> </ol>"},{"location":"android/java/java_thread/","title":"\u7ebf\u7a0b","text":""},{"location":"android/java/java_thread/#_1","title":"\u751f\u547d\u5468\u671f","text":"<p>\u65b0\u5efa\uff0c\u8fd0\u2f8f\uff0c\u963b\u585e\uff0c\u7b49\u5f85\uff0c\u8ba1\u65f6\u7b49\u5f85\u3001\u7ec8\u2f4c</p> <pre><code>class ThreadState implements Runnable {\n\npublic synchronized void waitForASecond() throws InterruptedException {\nwait(500);\n}\npublic synchronized void waitForLong() throws InterruptedException {\nwait();\n}\npublic synchronized void notifyNow() throws InterruptedException {\nnotify();\n}\n@Override\npublic void run() {\ntry {\nwaitForASecond();\nwaitForLong();\n} catch (InterruptedException e) {\ne.printStackTrace();\n}\n}\n}\n\npublic static void main(String[] args) throws InterruptedException {\nThreadState state = new ThreadState();\nThread thread = new Thread(state);\nSystem.out.println(\"\u65b0\u5efa\u7ebf\u7a0b:\"+thread.getState());\nthread.start();\nSystem.out.println(\"\u542f\u52a8\u7ebf\u7a0b:\"+thread.getState());\nThread.sleep(100);//\u8fd0\u2f8fwaitForASecond()\u2f45\u6cd5\nSystem.out.println(\"\u8ba1\u65f6\u7b49\u5f85:\"+thread.getState());\nThread.sleep(1000);//\u8fd0\u2f8fwaitForLong()\u2f45\u6cd5\nSystem.out.println(\"\u7b49\u5f85\u7ebf\u7a0b:\"+thread.getState());\nstate.notifyNow();\nSystem.out.println(\"\u5524\u9192\u7ebf\u7a0b:\"+thread.getState());\nThread.sleep(1000);//\u5f53\u524d\u7ebf\u7a0b\u4f11\u7720,\u65f6\u65b0\u7ebf\u7a0b\u7ed3\u675f\nSystem.out.println(\"\u7ec8\u2f4c\u7ebf\u7a0b:\"+thread.getState());\n}\n\n\u65b0\u5efa\u7ebf\u7a0b:NEW\n\u542f\u52a8\u7ebf\u7a0b:RUNNABLE\n\u8ba1\u65f6\u7b49\u5f85:TIMED_WAITING\n\u7b49\u5f85\u7ebf\u7a0b:WAITING\n\u5524\u9192\u7ebf\u7a0b:BLOCKED\n\u7ec8\u2f4c\u7ebf\u7a0b:TERMINATED\n</code></pre>"},{"location":"android/java/java_thread/#_2","title":"\u542f\u52a8\u7ebf\u7a0b\u7684\u65b9\u5f0f","text":"<p>\u4e24\u79cd\u65b9\u5f0f\uff0cThread\u6e90\u7801\u4e2d\u660e\u786e\u6307\u51fa</p> <p>\u65b9\u5f0f\u4e00\uff1a <pre><code>class PrimeThread(private val minPrime: Long) : Thread() {\noverride fun run() {\nprintln(minPrime)\n}\n}\nPrimeThread(1000L).start()\n</code></pre></p> <p>\u65b9\u5f0f\u4e8c\uff1a <pre><code>class PrimeRun(private val minPrime: Long) : Runnable {\noverride fun run() {\nprintln(minPrime)\n}\n}\nThread(PrimeRun(1000L)).start()\n</code></pre></p> <p>Thread\u548cRunnable\u7684\u533a\u522b\uff1aThread\u662f\u7ebf\u7a0b\u7684\u552f\u4e00\u62bd\u8c61\uff0cRunnable\u53ea\u662f\u4e1a\u52a1\u903b\u8f91\u7684\u62bd\u8c61</p>"},{"location":"android/java/java_thread/#_3","title":"\u505c\u6b62\u7ebf\u7a0b","text":"<p>API\u4e2d\u7684suspend\u3001resume\u3001stop\u4e0d\u5efa\u8bae\u4f7f\u7528(\u5df2\u88ab\u6807\u8bb0\u8fc7\u65f6)\uff0c\u5bb9\u6613\u5f15\u53d1\u6b7b\u9501\uff0c\u539f\u56e0\u662f\u7ebf\u7a0b\u4e0d\u4f1a\u91ca\u653e\u4e2d\u6709\u7684\u8d44\u6e90\u5982\u9501\uff0c\u5e76\u4e14\u4e0d\u4f1a\u7ed9\u4e88\u91ca\u653e\u8d44\u6e90\u7684\u673a\u4f1a</p> <p>\u7ebf\u7a0b\u5de5\u4f5c\u662f\u534f\u4f5c\u5f0f\uff0c\u5373\u53ea\u662f\u901a\u77e5</p> <p>isInterrupted\uff1a\u5224\u65ad\u7ebf\u7a0b\u662f\u5426\u88ab\u4e2d\u65ad</p> <p>interrupt()\uff1a\u5b9e\u4f8b\u65b9\u6cd5\u7528\u6765\u6253\u65ad\u7ebf\u7a0b\uff0c\u53ea\u662f\u53d1\u51fa\u4e2d\u65ad\u8bf7\u6c42\uff0c\u5e76\u4e0d\u4f1a\u7acb\u5373\u505c\u6b62\u7ebf\u7a0b</p> <p>interrupted()\uff1astatic\u65b9\u6cd5\uff0c\u5224\u65ad\u7ebf\u7a0b\u662f\u5426\u88ab\u4e2d\u65ad</p> <p><pre><code>fun main() {\nval thread = PrimeThread()\nthread.start()\nThread.sleep(20)\nthread.interrupt()\n}\n\nclass PrimeThread : Thread() {\noverride fun run() {\nval threadName = currentThread().name\nprintln(\"$threadName, status: $isInterrupted\")\nwhile (!isInterrupted) {\n//while (!interrupted()) {\nprintln(\"isInterrupted: $isInterrupted\")//false\n}\nprintln(\"end isInterrupted: $isInterrupted\")//true\n}\n}\n</code></pre> \u8c03\u7528interrupted()\u533a\u522b\u662f\u4f1a\u5c06isInterrupted\u8bbe\u7f6e\u6210false</p>"},{"location":"android/java/java_thread/#interruptedisinterrupted","title":"interrupted\u548cisInterrupted\u2f45\u6cd5\u7684\u533a\u522b","text":"<p><pre><code>public static boolean interrupted() {\nThread t = currentThread();\nboolean interrupted = t.interrupted;\nif (interrupted) {\nt.interrupted = false;\nclearInterruptEvent();\n}\n\nreturn interrupted;\n}\npublic boolean isInterrupted() {\nreturn this.interrupted;\n}\n</code></pre> sleep\u3001join\u65b9\u6cd5\u4f1a\u629b\u51faInterruptedException\uff0c\u629b\u51fa\u540e\u4f1a\u5c06isInterrupted\u8bbe\u7f6e\u6210true\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u6355\u83b7\u5f02\u5e38\u6765\u91cd\u65b0\u4e2d\u65ad</p>"},{"location":"android/java/java_thread/#startrun","title":"start\u548crun\u65b9\u6cd5","text":"<p>run\uff1a\u666e\u901a\u65b9\u6cd5</p> <p>start\uff1a\u6b63\u771f\u610f\u4e49\u7684\u542f\u52a8\u7ebf\u7a0b\u7684\u65b9\u6cd5</p> <pre><code>fun main() {\nval thread = PrimeThread()\nthread.name = \"PrimeThread\"\nthread.run()//thread: main\nthread.start()//thread: PrimeThread\n}\n\nclass PrimeThread : Thread() {\noverride fun run() {\nprintln(\"thread: ${currentThread().name}\")\n}\n}\n</code></pre>"},{"location":"android/java/java_thread/#join","title":"join\u65b9\u6cd5","text":"<p>\u4fdd\u8bc1\u4e24\u4e2a\u7ebf\u7a0b\u987a\u5e8f\u6267\u884c <pre><code>fun main() {\nval run1 = PrimeRun1()\nval th1 = Thread(run1)\nval run = PrimeRun(th1)\nval th = Thread(run)\nth.start()\nth1.start()\n}\n\nclass PrimeRun(private var thread: Thread?) : Runnable  {\noverride fun run() {\nthread?.join()\nThread.sleep(2)\nprintln(\"run\")\n}\n}\nclass PrimeRun1: Runnable  {\noverride fun run() {\nThread.sleep(2)\nprintln(\"run1\")\n}\n}\n\n\u8f93\u51fa\u7ed3\u679c\uff1a\nrun1\nrun\n</code></pre> \u5982\u679c\u6ca1\u6709\u6267\u884cjoin\u65b9\u6cd5\uff0c\u6309\u7167\u4ee3\u7801\u987a\u5e8f\u662fth\u5148\u6267\u884c\uff0cth1\u540e\u6267\u884c</p>"},{"location":"android/java/java_thread/#_4","title":"\u7ebf\u7a0b\u4f18\u5148\u7ea7","text":"<p>priority\uff1a\u4e0d\u80fd\u4fdd\u8bc1\u7ebf\u7a0b\u4f18\u5148\u6267\u884c\uff0c\u4e86\u89e3\u5373\u53ef</p>"},{"location":"android/java/java_thread/#_5","title":"\u5b88\u62a4\u7ebf\u7a0b","text":"<p>java\u5929\u7136\u662f\u591a\u7ebf\u7a0b\uff0c\u9664\u4e86main\u90fd\u662f\u5b88\u62a4\u7ebf\u7a0b <pre><code>val threadMXBean = ManagementFactory.getThreadMXBean()\nthreadMXBean.dumpAllThreads(false, false).forEach {\nprintln(\"[${it.threadId}] ${it.threadName} ${it.threadState}\")\n}\n\n[1] main RUNNABLE\n[2] Reference Handler RUNNABLE\n[3] Finalizer WAITING\n[4] Signal Dispatcher RUNNABLE\n[5] Attach Listener RUNNABLE\n[21] Common-Cleaner TIMED_WAITING\n[22] Monitor Ctrl-Break RUNNABLE\n[23] Notification Thread RUNNABLE\n</code></pre> \u9ed8\u8ba4\u7528\u6237\u7ebf\u7a0b\u90fd\u662f\u975e\u5b88\u62a4\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u8fd0\u884c\u5b8c\u6210\u540e\uff0c\u7528\u6237\u7ebf\u7a0b\u4f9d\u7136\u4f1a\u6267\u884c <pre><code>fun main() {\nval th = Thread(PrimeRun())\nth.start()\nThread.sleep(2)\nprintln(\"main end\")\n}\n\nclass PrimeRun : Runnable {\noverride fun run() {\nvar i = 5\nwhile (i &gt; 0) {\nprintln(\"run\")\nThread.sleep(2)\ni--\n}\n}\n}\n\u8f93\u51fa\u7ed3\u679c\uff1a\nrun\nmain end\nrun\nrun\nrun\nrun\n</code></pre> \u7528\u6237\u7ebf\u7a0b\u8f6c\u6210\u5b88\u62a4\u8fdb\u7a0b <pre><code>th.isDaemon = true\n\u8f93\u51fa\u7ed3\u679c\uff1a\nrun\nrun\nmain end\n</code></pre> \u6ce8\uff1afinally\u5728\u5b88\u62a4\u8fdb\u7a0b\u4e2d\u4e0d\u4e00\u5b9a\u4f1a\u6267\u884c</p>"},{"location":"android/java/java_thread/#futuretask","title":"FutureTask","text":"<p>\u652f\u6301Callable\u3001Runnable\uff0c\u7531\u4e8eThread\u53ea\u652f\u6301Runnable\u4e0d\u80fd\u76f4\u63a5\u4f20Callable\uff0cFutureTask\u5b9e\u73b0\u4e86Runnable\u63a5\u53e3 <pre><code>fun main() {\nval futureTask = FutureTask(UseCallable())\nThread(futureTask).start()\nprintln(futureTask.get())\n}\n\nclass UseCallable : Callable&lt;String&gt; {\noverride fun call(): String {\nreturn \"hello\"\n}\n}\n</code></pre></p>"},{"location":"android/java/java_thread/#callable-vs-runnable","title":"Callable vs Runnable","text":"<p>\u524d\u8005\u6709\u8fd4\u56de\u503c\uff0c\u540e\u8005\u65e0\u8fd4\u56de\u503c</p>"},{"location":"android/kotlin/kotlin_basic/","title":"\u5165\u95e8","text":""},{"location":"android/kotlin/kotlin_basic/#_1","title":"\u7b80\u4ecb","text":"<p>\u5b98\u7f51</p> <p>\u5224\u65ad\u9759\u6001\u8bed\u8a00\u3001\u52a8\u6001\u8bed\u8a00\uff1f</p> <p>\u9759\u6001\u8bed\u8a00\u662f\u7f16\u8bd1\u671f\u80fd\u6821\u9a8c\u6570\u636e\u7c7b\u578b\uff0c\u5982java <pre><code>String a = \"xx\";\na = 1;//\u62a5\u9519\n</code></pre></p> <p>\u5982kotlin <pre><code>var a = \"xxx\"\na = 1//\u62a5\u9519\n</code></pre></p> <p>\u57fa\u672c\u6570\u636e\u7c7b\u578b</p> <p>Byte,Short,Int,Long,Float,Double,Char,String,Boolean</p> <p>kotlin\u53ea\u6709\u5f15\u7528\u7c7b\u578b\uff0c\u5728\u7f16\u8bd1\u540e\u4f1a\u8f6c\u5316\u6210java\u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b</p> <p>val\u8868\u793a\u53ea\u8bfb\u53d8\u91cf</p> <p>\u5e38\u91cfconst\u4fee\u9970\uff0c\u4e0d\u80fd\u5199\u5728\u51fd\u6570\u91cc\u9762\uff0c\u56e0\u4e3a\u5e38\u91cf\u662f\u7f16\u8bd1\u65f6\u5c31\u9700\u8981\u786e\u5b9a\uff0c\u800c\u51fd\u6570\u662f\u8fd0\u884c\u65f6\u624d\u88ab\u8c03\u7528 <pre><code>const val msg = \"msg\"\nfun main() {\nval info = \"info\"\n}\n</code></pre> \u8868\u8fbe\u5f0f\u662f\u6709\u8fd4\u56de\u503c\u7684</p> <p>java\u4e2d\u7684if\u662f\u8bed\u53e5\u800ckotlin\u4e2d\u7684\u662f\u8868\u8fbe\u5f0f</p> <p>range\u8868\u8fbe\u5f0f</p> <p>in 12..89</p> <p>when\u8868\u8fbe\u5f0f\u76f8\u5f53\u4e8ejava\u4e2d\u7684switch</p> <p>String\u6a21\u7248\u4f7f\u7528${}\u65b9\u5f0f\uff0c\u5176\u4e2d{}\u90e8\u5206\u573a\u666f\u53ef\u7701\u7565</p>"},{"location":"android/kotlin/kotlin_basic/#fieldproperty","title":"field\u548cproperty","text":"<p>Java\u4e2d\u53ef\u4ee5\u5355\u72ec\u7533\u660e\u5b57\u6bb5\uff0c\u4f46kotlin\u4e2d\u4e0d\u884c\uff0c\u53ea\u80fd\u662f\u5c5e\u6027</p> <p>\u539f\u56e0\u662fkotlin\u5fc5\u987b\u4f7f\u7528var\u6216val\u7533\u660e\uff0c\u4e14\u4f1a\u81ea\u52a8\u751f\u6210get/set\u65b9\u6cd5\uff0c\u800c\u5c5e\u6027=\u5b57\u6bb5+get/set</p> <p>get\u65b9\u6cd5\u4e0d\u80fd\u88abprivate\u4fee\u9970</p>"},{"location":"android/kotlin/kotlin_class/","title":"\u7c7b","text":""},{"location":"android/kotlin/kotlin_class/#_1","title":"\u521d\u8bc6\u7c7b","text":"<p>\u58f0\u660e\u5c5e\u6027\u9ed8\u8ba4\u4f1a\u6709get\uff0cset\u65b9\u6cd5\uff0c\u53ef\u8fdb\u884c\u4fee\u6539\u5982\u4e0b <pre><code>class MyClass {\nvar name = \"AFREE\"\nget() = field.lowercase()\nset(value) {\nfield = \"[$value]\"\n}\n}\nMyClass().name//\u83b7\u53d6\nMyClass().name = \"xxx\"//\u8d4b\u503c\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#_2","title":"\u4e3b\u6784\u9020\u51fd\u6570","text":"<p><pre><code>class MyClass(_pwd: String) {//\u53c2\u6570\u662f\u4e34\u65f6\u7c7b\u578b\nvar pwd: String? = _pwd\nfun getAge(): String {\nreturn pwd?.run {\nifBlank {\n\"is blank\"\n}\n} ?: \"is null\"\n}\n}\n</code></pre> \u4ee5\u4e0apwd\u53c2\u6570\u662f\u7c7bjava\u5199\u6cd5\uff0ckt\u4e00\u822c\u4ee5\u4e0b\u5199\u6cd5 <pre><code>class MyClass(var pwd: String?) {\n}\n</code></pre> \u5982\u679c\u662fvar\u5219\u81ea\u52a8\u751f\u6210get\u3001set\u65b9\u6cd5\uff0c\u5982\u679c\u662fval\u5219\u53ea\u6709get\u65b9\u6cd5</p>"},{"location":"android/kotlin/kotlin_class/#init","title":"init\u4ee3\u7801\u5757","text":"<p>init\u662f\u4e3b\u6784\u9020\u8c03\u7528\u65f6\u89e6\u53d1\uff0c\u800c\u6b21\u6784\u9020\u5fc5\u987b\u8c03\u7528\u4e3b\u6784\u9020\u51fd\u6570</p>"},{"location":"android/kotlin/kotlin_class/#_3","title":"\u6b21\u6784\u9020\u51fd\u6570","text":"<p><pre><code>class MyClass(pwd: String) {\ninit {\nprintln(\"\u4e3b\u6784\u9020\u88ab\u8c03\u7528\uff0c\u5bc6\u7801\uff1a$pwd\")\n}\nconstructor() : this(\"mini\", \"123\"){\nprintln(\"\u6211\u662f\u6b21\u6784\u90201\")\n}\nconstructor(userName: String, pwd: String) : this(userName){\nprintln(\"\u6211\u662f\u6b21\u6784\u90202\")\n}\n}\nfun main() {\nMyClass()\n}\n</code></pre> constructor\u90fd\u662f\u6b21\u6784\u9020</p> <p>\u6ce8\uff1ainit\u4e2d\u80fd\u62ff\u5230\u4e3b\u6784\u9020\u4e2d\u7684\u53c2\u6570\uff0c\u65e0\u8bba\u662f\u5426\u662f\u4e34\u65f6\u5c5e\u6027</p> <p>\u6267\u884c\u987a\u5e8f</p> <p>\u7c7b\u6210\u5458\u548cinit\u5757\u540c\u65f6\u751f\u6210\uff0c\u53d6\u51b3\u4e8e\u7f16\u5199\u987a\u5e8f</p>"},{"location":"android/kotlin/kotlin_class/#_4","title":"\u7ee7\u627f","text":"<p>\u7c7b\u548c\u51fd\u6570\u7f16\u8bd1\u540e\u9ed8\u8ba4\u662ffinal\u4fee\u9970\u65e0\u6cd5\u7ee7\u627f\uff0c\u4f7f\u7528open\u5173\u952e\u5b57\u5373\u53ef\u79fb\u9664final <pre><code>open class Person{\nopen fun showName() {\nprintln(\"\u6211\u662fPerson\")\n}\n}\n\nclass Student : Person() {\noverride fun showName() {\nprintln(\"\u6211\u662fStudent\")\n}\nfun study() {\nprintln(\"\u6211\u7231\u5b66\u4e60\")\n}\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#is","title":"is","text":"<p>\u5224\u65ad\u7c7b\u578b\u76f8\u5f53\u4e8ejava\u7684instanceOf</p>"},{"location":"android/kotlin/kotlin_class/#as","title":"as","text":"<p>\u8f6c\u5316\u7c7b\u578b\uff0c\u5f3a\u8f6c <pre><code>    val p: Person = Student()\n//    (p as Student).study()\np.study()\n</code></pre> \u5982\u679c\u6ca1\u6709\u7b2c\u4e8c\u884c\u4ee3\u7801\uff0c\u7b2c\u4e09\u884c\u4ee3\u7801\u4f1a\u62a5\u9519\uff0c\u6216\u8005\u53ef\u4ee5 <pre><code>if (p is Student) {\np.study()\n}\n</code></pre> kt\u7684\u6839\u7236\u7c7bAny\u76f8\u5f53\u4e8ejava\u7684Object</p> <p>Any\u7c7b\u53ea\u63d0\u4f9b\u6807\u51c6\uff0c\u770b\u4e0d\u5230\u6e90\u7801\u5177\u4f53\u5b9e\u73b0\uff0c\u7531\u5404\u4e2a\u5e73\u53f0\u5904\u7406</p> <p>\u9664\u4e86\u53ef\u4ee5\u8f6c\u5316\u7c7b\u578b\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u5bfc\u5165\u51fd\u6570\u8fdb\u884c\u91cd\u547d\u540d\uff0c\u5982 <pre><code>import com.hfc.lib.util.abcdfjdksalfjdlsajflglsdjfsak as method\n\nfun main() {\n//    abcdfjdksalfjdlsajflglsdjfsak()\nmethod()\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#object","title":"object\u5173\u952e\u5b57","text":""},{"location":"android/kotlin/kotlin_class/#_5","title":"\u5355\u4f8b","text":"<p>\u8868\u793a\u7684\u7c7b\u5c06\u53d8\u6210\u5355\u4f8b\u5bf9\u8c61 <pre><code>object Student : Person() {\n}\nStudent.study()\n</code></pre> \u6ce8\uff1a\u6784\u9020\u51fd\u6570\u5c06\u4f1a\u88ab\u79c1\u6709\u5316</p>"},{"location":"android/kotlin/kotlin_class/#object-x","title":"\u533f\u540d\u5bf9\u8c61(object : X())","text":"<p><pre><code>val p = object : Person() {\noverride fun showName() = println()\n}\np.showName()\n</code></pre> \u6ce8\uff1akt\u91cc\u9762\u53ea\u80fd\u8fd9\u6837\u5199\uff0c\u5982\u679c\u662fjava\u63a5\u53e3\u53ef\u4ee5\u7701\u7565object\uff0c\u5982java\u4e2d\u7684Runnable\u63a5\u53e3 <pre><code>Runnable { }\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#companion-object","title":"\u4f34\u751f\u5bf9\u8c61(companion object)","text":"<p>\u53ea\u4f1a\u521d\u59cb\u5316\u4e00\u6b21\uff0c\u53ef\u4ee5\u5229\u7528\u4ee3\u66ffjava\u4e2d\u7684\u9759\u6001\u5e38\u91cf\u3001\u9759\u6001\u65b9\u6cd5 <pre><code>companion object my {\nconst val NAME = \"\" // \u5e38\u91cf\nvar AGE = 2 // \u9759\u6001\u53d8\u91cf\nfun hello(){} // \u9759\u6001\u65b9\u6cd5\n}\n</code></pre> \u7f16\u8bd1\u540e\u4f1a\u751f\u6210\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b\uff0cmy\u8868\u793a\u81ea\u5b9a\u4e49\u540d\u5b57(\u4e00\u822c\u4e0d\u5199)</p>"},{"location":"android/kotlin/kotlin_class/#_6","title":"\u5d4c\u5957\u7c7b(\u9759\u6001\u5185\u90e8\u7c7b)","text":"<p><pre><code>fun main() {\nA.B().b()\n}\n\nclass A {\nclass B {\nfun b() = println(\"b\")\n}\n}\n</code></pre> \u6ce8\uff1aB\u65e0\u6cd5\u8bbf\u95eeA\u4e2d\u7684\u5185\u5bb9</p> <p>\u539f\u56e0\uff1a\u7f16\u8bd1\u540e\u4f1a\u751f\u6210\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u6240\u4ee5\u65e0\u6cd5\u8bbf\u95ee\u975e\u9759\u6001\u5185\u5bb9</p>"},{"location":"android/kotlin/kotlin_class/#inner-class","title":"\u5185\u90e8\u7c7b(inner class)","text":"<p><pre><code>fun main() {\nA().B().b()\n}\n\nclass A {\nval a = \"\"\ninner class B {\nfun b() = println(\"$a\")\n}\n}\n</code></pre> \u7f16\u8bd1\u540e\u5c31\u662fjava\u7684\u5185\u90e8\u7c7b</p>"},{"location":"android/kotlin/kotlin_class/#data-class","title":"\u6570\u636e\u7c7b(data class)","text":"<p>\u548c\u666e\u901a\u7c7b\u533a\u522b\uff1a</p> <p>\u666e\u901a\u7c7b\u7f16\u8bd1\u540e\u53ea\u4f1a\u751f\u6210get set\u65b9\u6cd5\u548c\u6784\u9020\u65b9\u6cd5</p> <p>\u6570\u636e\u7c7b\u989d\u5916\u4f1a\u751f\u6210equals\uff0chasCode\uff0ccopy\uff0ccomponent1(\u89e3\u6784)\uff0ctoString</p> <p>\u6ce8\uff1a\u6570\u636e\u7c7b\u751f\u6210\u65f6\u53ea\u751f\u6210\u4e3b\u6784\u9020\u7684\u5c5e\u6027\uff0c\u5ffd\u7565\u5176\u4ed6\u5c5e\u6027</p> <p>\u4f7f\u7528\u573a\u666f\uff1a 1.\u670d\u52a1\u5668\u8fd4\u56de\u54cd\u5e94\u7684bean\uff0c\u5fc5\u987b\u8981\u6709\u4e3b\u6784\u9020\u4e14\u53c2\u6570\u81f3\u5c11\u4e00\u4e2a\uff0c\u5fc5\u987b\u4f7f\u7528var\u6216val\u4fee\u9970\u53c2\u6570\uff0c\u4e0d\u80fd\u4f7f\u7528\u5176\u4ed6\u4fee\u9970\u7b26\u4fee\u9970\u7c7b\uff0c\u5982open\uff0cinner\u7b49</p> <p>2.\u9700\u8981\u7528\u5230toString\uff0ccopy\u7b49\u573a\u666f</p> <p>\u6ce8\uff1a\u9ed8\u8ba4\u751f\u6210\u7684hashcode\u548ctoStirng\u90fd\u662f\u6309\u7167\u6784\u9020\u51fd\u6570\u91cc\u7684\u53c2\u6570 <pre><code>data class MyClass(var id: String?) {\nvar name: String?= null\n}\n</code></pre> \u4ee5\u4e0a\u53ea\u4f1a\u6839\u636eid\u751f\u6210hashCode\u548ctoString</p>"},{"location":"android/kotlin/kotlin_class/#enum-class","title":"\u679a\u4e3e(enum class)","text":"<p>\u4e5f\u662fclass <pre><code>fun main() {\nprintln(Week.Monday) // Monday\nprintln(Week.Friday is Week) //true\n}\n\nenum class Week{\nMonday,\nTuesday,\nWednesday,\nThursday,\nFriday,\nSaturday,\nSunday\n}\n</code></pre> kt\u4e2d\u679a\u4e3e\u4e00\u822c\u7528\u6cd5 <pre><code>fun main() {\nClock.DATA_OLD.showClock()\nClock.DATA_NOW.showClock()\nClock.DATA_OLD.updateClock(SimpleClock(\"2000\", \"16:25\"))\nClock.DATA_NOW.updateClock(SimpleClock(\"2050\", \"17:58\"))\n}\n\nenum class Clock(var clock: SimpleClock) {\nDATA_OLD(SimpleClock(\"1990\", \"22:15\")),\nDATA_NOW(SimpleClock(\"2022\", \"12:28\"));\n\nfun updateClock(updateClock: SimpleClock) {\nthis.clock = updateClock\nshowClock()\n}\n\nfun showClock() {\nprintln(this.clock)\n}\n}\n\ndata class SimpleClock(var data: String, var time: String)\n</code></pre> \u5176\u4e2d\u5982DATA_OLD\u5c31\u662f\u679a\u4e3e\u672c\u8eab\uff0c\u8c03\u7528\u4e3b\u6784\u9020\u8d4b\u503c</p> <p>\u679a\u4e3e\u548cwhen\u7ed3\u5408\u662f\u53ef\u4ee5\u4e0d\u5199else\uff0c\u4f46\u9700\u8981\u7a77\u4e3e\u6240\u6709\u679a\u4e3e\u503c(kt1.6\u4ee5\u540e\u4f1a\u7f16\u8bd1\u4e0d\u901a\u8fc7) <pre><code>class WeekTest {\nfun switch(week: Week) =\nwhen (week) {\nWeek.Monday -&gt; \"Monday\"\nWeek.Tuesday -&gt; \"Tuesday\"\nWeek.Wednesday -&gt; \"Wednesday\"\nWeek.Thursday -&gt; \"Thursday\"\nWeek.Friday -&gt; \"Friday\"\nWeek.Saturday -&gt; \"Saturday\"\nWeek.Sunday -&gt; \"Sunday\"\n}\n}\nprintln(WeekTest().switch(Week.Monday))\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#sealed-class","title":"\u5bc6\u5c01\u7c7b(sealed class)","text":"<p>\u5bc6\u5c01\u7c7b\u4f7f\u7528sealed\u4fee\u9970\uff0c\u4e3b\u8981\u7528\u6765\u89e3\u51b3\u4f7f\u7528when\u65f6\u4e0d\u5199else\uff0c\u5728when\u65f6\u53ef\u4f7f\u7528is\u5224\u65ad\uff0c\u5b9e\u73b0\u4e0a\u8ff0\u903b\u8f91 <pre><code>fun main() {\nprintln(WeekTest().switch(Week.Monday))\nprintln(WeekTest().switch(Week.Sunday(\"10:55\")))\n}\n\nclass WeekTest {\nfun switch(week: Week) =\nwhen (week) {\nis Week.Monday -&gt; \"Monday\"\nis Week.Tuesday -&gt; \"Tuesday\"\nis Week.Wednesday -&gt; \"Wednesday\"\nis Week.Thursday -&gt; \"Thursday\"\nis Week.Friday -&gt; \"Friday\"\nis Week.Saturday -&gt; \"Saturday\"\nis Week.Sunday -&gt; \"Sunday: ${week.time}\"\n}\n}\n\nsealed class Week {\nobject Monday: Week()//\u5355\u4f8b\uff0c\u5fc5\u987b\u7ee7\u627f\u672c\u7c7b\nobject Tuesday: Week()\nobject Wednesday: Week()\nobject Thursday: Week()\nobject Friday: Week()\nobject Saturday: Week()\nclass Sunday(val time: String): Week()//\u53ef\u4ee5\u975e\u5355\u4f8b\uff0c\u56e0\u4e3a\u6709\u53c2\u6570\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_class/#_7","title":"\u62f7\u8d1d","text":""},{"location":"android/kotlin/kotlin_class/#_8","title":"\u6d45\u62f7\u8d1d","text":"<p>\u5373\u4e24\u4e2a\u5bf9\u8c61\u6307\u5411\u540c\u4e00\u5730\u5740\uff0c\u5f53\u5176\u4e2d\u67d0\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027\u5185\u5bb9\u4fee\u6539\u540e\uff0c\u53e6\u4e00\u4e2a\u5bf9\u8c61\u4e5f\u540c\u6b65\u53d8\u5316\uff0c\u4e3e\u4f8b\uff1a</p> <p>1.java\u4e2dclone\u65b9\u6cd5\u548ckotlin\u4e2ddata\u6570\u636e\u7c7b\u7684copy\u90fd\u662f\u6d45\u62f7\u8d1d</p> <p>2.list\u6216\u5176\u4ed6\u96c6\u5408add\uff0caddAll\u6216\u6784\u9020\u65b9\u6cd5\u521d\u59cb\u5316\u90fd\u662f\u6d45\u62f7\u8d1d</p> <p>3.System.arraycopy()\u4e5f\u662f\u6d45\u62f7\u8d1d</p>"},{"location":"android/kotlin/kotlin_class/#_9","title":"\u6df1\u62f7\u8d1d","text":"<p>\u4e24\u4e2a\u5bf9\u8c61\u5730\u5740\u4e0d\u540c\u4e14\u6570\u636e\u53d8\u5316\u4e92\u4e0d\u5f71\u54cd\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548cString\u4e0d\u5728\u6df1\u62f7\u8d1d\u8003\u8651</p> <p>\u5b9e\u73b0\u601d\u8def\u5927\u81f4\u6709\u51e0\u79cd</p> <p>1.\u5982\u679c\u662f\u666e\u901aclass\uff0c\u5982\u679c\u662fjava\u91cd\u5199clone\uff0c\u5982\u679c\u662fkotlin\u9700\u8981\u7ee7\u627fCloneable\u518d\u91cd\u5199clone\uff0c\u5bf9\u5f15\u7528\u5c5e\u6027\u8fdb\u884c\u521b\u5efa\u5bf9\u8c61\u8d4b\u503c\uff0ckt\u4e3a\u4f8b <pre><code>class C(var d: D): Cloneable {\noverride fun clone(): Any {\nreturn C(D(d.age))\n}\n}\n\nclass D(var age: Int)\n</code></pre></p> <p>2.kt\u76f4\u63a5\u4f7f\u7528data class <pre><code>data class A(var name: String, var b: B)\ndata class B(var age: Int\uff09\n\nval a = A(\"3\", B(4))\na.copy(name = \"4\", b = B(5))\n</code></pre></p> <p>3.\u4f7f\u7528\u81ea\u5b9a\u4e49interface <pre><code>interface DeepCopyable&lt;out R&gt; {\nfun deepCopyFun(): R\n}\ndata class A(var name: String, var b: B) : DeepCopyable&lt;B&gt; {\noverride fun deepCopyFun(): B = B(b.age)\n}\ndata class B(var age: Int)\n</code></pre></p> <p>4.\u5982\u679c\u662f\u5e8f\u5217\u5316\u7c7b\uff0c\u53ef\u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u8fdb\u884c\u62f7\u8d1d <pre><code>fun &lt;T : Any&gt; T.deepCopy(): T {\nval cls = this::class\nif (cls is Serializable || cls is Parcelable) {\nval byteArrayOutputStream = ByteArrayOutputStream()\nval outputStream = ObjectOutputStream(byteArrayOutputStream)\noutputStream.writeObject(this)\n\noutputStream.close()\nbyteArrayOutputStream.close()\n\nval byteArrayInputStream = ByteArrayInputStream(byteArrayOutputStream.toByteArray())\nval inputStream = ObjectInputStream(byteArrayInputStream)\nval copiedList = inputStream.readObject()\n\ninputStream.close()\nbyteArrayInputStream.close()\nreturn copiedList as T\n}\nreturn this\n}\n</code></pre></p> <p>5.kt\u5bf9\u4e8edata\u6216\u8005\u81ea\u5b9a\u4e49\u63a5\u53e3\u7684class\uff0c\u53ef\u4ee5\u4f7f\u7528\u53cd\u5c04+\u62d3\u5c55\u51fd\u6570</p> <p>\u4f9d\u8d56kotlin\u53cd\u5c04api <pre><code>implementation \"org.jetbrains.kotlin:kotlin-reflect:$kotlin_version\"\n</code></pre> <pre><code>fun &lt;T : Any&gt; T.deepCopy(): T {\nval cls = this::class\nif (cls.isData) {\nval dataClassCopyMethod = cls.java.declaredMethods.first { copyMethod -&gt;\ncopyMethod.name == \"copy\"\n}\nval params = cls.primaryConstructor?.parameters?.map { parameter -&gt;\nval value = (this::class as KClass&lt;T&gt;).memberProperties.first {\nit.name == parameter.name\n}.get(this)\n\nif (value is DeepCopyable&lt;*&gt;) {\nvalue.deepCopyFun()\n} else if (value != null &amp;&amp; value::class.isData) {\nvalue.deepCopy()\n} else {\nvalue\n}\n}?.toTypedArray()\nreturn if (params == null) {\ndataClassCopyMethod.invoke(this)\n} else {\ndataClassCopyMethod.invoke(this, *params)\n} as T\n}\nreturn this\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_code/","title":"\u5b9e\u6218\u5e94\u7528","text":""},{"location":"android/kotlin/kotlin_code/#android","title":"Android\u5e94\u7528\u6848\u4f8b","text":""},{"location":"android/kotlin/kotlin_code/#lateinit","title":"lateinit\u5e94\u7528","text":"<pre><code>class MainActivity2 : AppCompatActivity() {\nprivate lateinit var fragment: Fragment\noverride fun onCreate(savedInstanceState: Bundle?) {\nsuper.onCreate(savedInstanceState)\nif (savedInstanceState == null) {\nsupportFragmentManager.findFragmentById(R.id.xxx)?.let { fragment = it\n}\n}\nif (!::fragment.isInitialized) {\nfragment = MyFragment()\n}\nsetContentView(R.layout.xxx)\nshowFragment(supportFragmentManager, fragment)\n}\n}\n</code></pre>"},{"location":"android/kotlin/kotlin_collection/","title":"\u96c6\u5408","text":""},{"location":"android/kotlin/kotlin_collection/#list","title":"list\u96c6\u5408","text":"<p>listOf\uff1a\u751f\u6210\u4e0d\u53ef\u53d8\u96c6\u5408 <pre><code>val list = listOf(\"a\", \"b\", \"c\")\n//println(list.get(3))//\u62a5\u4e0b\u6807\u8d8a\u754c\n//println(list[3]))//\u62a5\u4e0b\u6807\u8d8a\u754c\nprintln(list.getOrElse(3) { \"Nav\" })\nprintln(list.getOrNull(3) ?: \"Nav\")\n</code></pre> \u6ce8\uff1a[]\u662f\u8fd0\u7b97\u7b26\u91cd\u8f7d</p> <p>getOrElse\uff1a\u5982\u679c\u4e0b\u6807\u8d8a\u754c\u8fd4\u56delambda\u91cc\u81ea\u5b9a\u4e49\u5185\u5bb9\u80fd\u591f</p> <p>getOrNull\uff1a\u5982\u679c\u4e0b\u6807\u8d8a\u754c\u8fd4\u56denull\uff0c\u53ef\u7ed3\u5408\u7a7a\u5408\u5e76\u4f7f\u7528</p> <p>mutableListOf\uff1a\u751f\u6210\u53ef\u53d8\u96c6\u5408 <pre><code>val mutableList = mutableListOf(\"a\", \"b\", \"c\")\nmutableList.add(\"d\")\nmutableList.remove(\"b\")\nprintln(mutableList)\n</code></pre> \u76f8\u4e92\u8f6c\u5316 <pre><code>val mutableChangeToList: List&lt;String&gt; = mutableList.toList()\nval listChangeMutable: List&lt;String&gt; = list.toMutableList()\n</code></pre> \u6b64\u5904toList()\u548ctoMutableList()\u53ef\u7701\u7565</p> <p>\u64cd\u4f5c\u7b26\u91cd\u8f7d\u8fd0\u7528 <pre><code>val list = MutableList(5) { \"$it A\" }\nlist.add(1, \"a\")\nlist += \"c\"\nlist -= \"d\"\nlist.removeIf { it.contains(\"A\") }\nprintln(list)\n</code></pre> MutableList(5)\u63a7\u5236\u521d\u59cb\u5316\u4e2a\u6570\uff0c\u4e14\u8d4b\u9ed8\u8ba4\u503c</p> <p>+=\u5176\u5b9e\u5c31\u662fadd(\"c\")</p> <p>removeIf\uff1a\u79fb\u9664\u6ee1\u8db3\u6761\u4ef6\u7684\u9879</p>"},{"location":"android/kotlin/kotlin_collection/#_1","title":"\u904d\u5386","text":"<pre><code>for (s in list) {\nprint(s)\n}\nlist.forEach {\nprint(it)\n}\nlist.forEachIndexed { index, item -&gt;\nprint(\"$index,$item \")\n}\n</code></pre>"},{"location":"android/kotlin/kotlin_collection/#_2","title":"\u89e3\u6784\u4f53","text":"<p><pre><code>val list = listOf(\"a\", \"b\", \"c\")\nval (_, v2, v3) = list\nprintln(\"v2: $v2, v3: #v3\")\n</code></pre> \u5176\u4e2d_\u8868\u793a\u4e0d\u9700\u8981\u7b2c\u4e00\u4e2a\u5143\u7d20</p>"},{"location":"android/kotlin/kotlin_collection/#set","title":"set\u96c6\u5408","text":"<p><pre><code>val set = setOf(\"a\", \"b\", \"3\")\nset.elementAt(2)\nset.elementAtOrElse(2) { \"\" }\nset.elementAtOrNull(2)\n</code></pre> \u548clist\u4f7f\u7528\u7c7b\u4f3c\uff0c\u4f46\u6ca1\u6709[]\u8fd0\u7b97\u7b26\u91cd\u8f7d <pre><code>val set = mutableSetOf(\"a\", \"a\", \"b\", \"c\")\nset += \"d\"\nset -= \"f\"\n</code></pre> list\u96c6\u5408\u53bb\u91cd <pre><code>var list = listOf(\"a\", \"a\", \"b\", \"c\")\nlist = list.toSet().toList()\nlist = list.distinct()\n</code></pre> distinct\u6e90\u7801\u5c31\u662f\uff1atoMutableSet().toList()</p>"},{"location":"android/kotlin/kotlin_collection/#map","title":"map\u96c6\u5408","text":"<pre><code>var map = mapOf(1 to \"a\", 2 to \"b\", 3 to(\"c\"), Pair(4, \"d\"))\n\u83b7\u53d6\u503c\nprintln(map[3])\nprintln(map.get(3))\n//println(map.getValue(3))\u4f1a\u5d29\u6e83\nprintln(map.getOrDefault(5, \"e\"))\nprintln(map.getOrElse(4) { \"d\" })\n</code></pre>"},{"location":"android/kotlin/kotlin_collection/#_3","title":"\u904d\u5386","text":"<pre><code>val map = mapOf(1 to \"a\", 2 to \"b\", 3 to(\"c\"))\nfor (entry in map) {\nprintln(\"${entry.key} , ${entry.value}\")\n}\nmap.forEach { (key, value) -&gt;\nprintln(\"$key , $value\")\n}\nmap.forEach {\nprintln(\"${it.key} , ${it.value}\")\n}\n</code></pre>"},{"location":"android/kotlin/kotlin_collection/#_4","title":"\u8d4b\u503c","text":"<pre><code>val map = mutableMapOf(1 to \"a\", 2 to \"b\", 3 to (\"c\"))\nmap += 4 to \"d\"\nmap[5] = \"e\"\nmap.put(5, \"e\")//\u548c\u4e0a\u9762\u4e00\u79cd\u4e00\u6837\uff0c\u63a8\u8350\u4e0a\u9762\nmap.getOrPut(5) { \"w\" }//\u5982\u679c\u5b58\u5728\u5219\u83b7\u53d6\u539f\u6765\u7684\u503ce\nmap.getOrPut(6) { \"f\" }//\u5982\u679c\u4e0d\u5b58\u5728\u5219\u6dfb\u52a0\u5e76\u8fd4\u56de\u7ed3\u679cf\n</code></pre>"},{"location":"android/kotlin/kotlin_function/","title":"\u51fd\u6570","text":""},{"location":"android/kotlin/kotlin_function/#_1","title":"\u51fd\u6570\u7b80\u4ecb","text":"<p>\u9ed8\u8ba4\u662fpublic\uff0c\u53ef\u4ee5\u5199\u5728\u7c7b\u5916</p> <p>\u51fd\u6570\u53c2\u6570\u5141\u8bb8\u6709\u9ed8\u8ba4\u503c <pre><code>fun main() {\nmethod01(50)\n}\nfun method01(age: Int, name: String = \"xxx\") {\n}\n</code></pre> \u5177\u540d\u51fd\u6570\uff1a\u5141\u8bb8\u53c2\u6570\u987a\u5e8f\u4fee\u6539 <pre><code>fun main() {\nmethod02(name = \"xxx\", age = 25)\n}\nfun method02(age: Int, name: String) {\n\n}\n</code></pre> Unit\u662f\u65e0\u53c2\u8fd4\u56de\uff0c\u662f\u4e2a\u7c7b\uff0c\u53ef\u4ee5\u5ffd\u7565 <pre><code>fun method() {\nreturn println()\n}\nfun method1() : Unit {\nreturn println()\n}\n</code></pre> Nothing\u7c7b\u578b\uff1aTODO(\"xx\")</p> <p>\u548cjava\u4e0d\u540c\uff0c\u4f1a\u62a5\u5f02\u5e38\u53ef\u4ee5\u4f5c\u4e3a\u629b\u51fa\u5f02\u5e38\u6765\u5904\u7406 <pre><code>fun method(bool: Boolean) {\nif (bool) TODO(\"\u6709\u95ee\u9898\")\n}\n</code></pre> \u53cd\u5f15\u53f7 <pre><code>fun method() {\n//    Utils.in() \u62a5\u9519 in\u5728kotlin\u4e2d\u662f\u5173\u952e\u5b57\nUtils.`in`() //\u4f7f\u7528\u53cd\u5f15\u53f7\u89e3\u51b3\n}\n\njava\u7c7b\npublic class Utils {\npublic static final void in() {}\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#_2","title":"\u533f\u540d\u51fd\u6570","text":"<p><pre><code>val len = \"String\".count {\nit == 'r'\n}\n</code></pre> cout\u662f\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u4e2a\u6570{}\u90e8\u5206\u5c31\u662f\u533f\u540d\u51fd\u6570</p> <p>\u6ce8\uff1a\u53ea\u8981\u662f\u533f\u540d\u51fd\u6570\uff0c\u51fd\u6570\u7684\u6700\u540e\u4e00\u884c\u4e00\u822c\u5c31\u662f\u8fd4\u56de\u503c\uff0capply\u9664\u5916</p>"},{"location":"android/kotlin/kotlin_function/#_3","title":"\u51fd\u6570\u62c6\u89e3","text":"<p>1.\u58f0\u660e <pre><code>val method : () -&gt; String\n</code></pre> 2.\u5b9e\u73b0 <pre><code>method = {\n\"XXX\"//\u6700\u540e\u4e00\u884c\u662f\u8fd4\u56de\u503c \u4e0d\u80fd\u6709return\n}\n}\n</code></pre> 3.\u8c03\u7528 <pre><code>println(method())\nprintln(method.invoke())\n</code></pre> \u53ea\u6709\u5355\u4e2a\u8f93\u5165\u9ed8\u8ba4\u6709\u4e2ait(\u5173\u952e\u5b57)\u53c2\u6570\uff0c\u5982\u679c\u662f\u591a\u4e2a\u53c2\u6570 <pre><code>val method : (Int, Boolean) -&gt; String //\u5177\u4f53\u540d\u53ef\u7701\u7565\nmethod = {age, sex-&gt; //\u5177\u4f53\u7c7b\u578b\u53ef\u7701\u7565\n\"age: $age , sex: $sex\"\n}\nprintln(method.invoke(20, true))\n</code></pre> \u7b80\u5316\u51fd\u6570\u4e00\u6b65\u5230\u4f4d <pre><code>val method : (Int, Boolean) -&gt; String= {age, sex-&gt;\n\"age: $age , sex: $sex\"\n}\n</code></pre> \u4ee5\u4e0a\u51fd\u6570\u5f62\u5f0f\uff1a \u65b9\u6cd5\u540d\uff1a\u5165\u53c2\u7c7b\u578b -&gt; \u8fd4\u56de\u7c7b\u578b = \uff5b\uff5d</p> <p>\u53e6\u4e00\u79cd\u5f62\u5f0f\uff1a \u65b9\u6cd5\u540d = \uff5b\u5165\u53c2\u7c7b\u578b -&gt; \u6700\u540e\u4e00\u884c\u81ea\u52a8\u63a8\u65ad\u8fd4\u56de\u7c7b\u578b\uff5d</p> <p>\u5176\u4e2d\u8fd4\u56de\u7c7b\u578b\u4e3a\u81ea\u52a8\u63a8\u65ad\uff0c\u5982 <pre><code>val method = {age Int, sex Boolean -&gt;\n\"age: $age , sex: $sex\" //\u6b64\u65f6\u8fd4\u56de\u7c7b\u578b\u4e3aString\n}\n</code></pre> \u533f\u540d\u51fd\u6570 ==(\u7b49\u4ef7\uff0c\u5c5e\u4e8e) lambda\u8868\u8fbe\u5f0f</p> <p>\u51fd\u6570\u53c2\u6570\u4e5f\u662f\u51fd\u6570 <pre><code>fun main() {\n//\u8c03\u7528\u65b9\u5f0f\u4e00(\u4e0d\u63a8\u8350)\nmethod(4, \"me\", {\nprintln(it)//\u76f8\u5f53\u4e8e\u5b9e\u73b0\n}) //\u8c03\u7528\u65b9\u5f0f\u4e8c\nmethod(4, \"me\", method2 = {\nprintln(it)//\u76f8\u5f53\u4e8e\u5b9e\u73b0\n}) //\u6700\u7ec8\u65b9\u5f0f\nmethod(4, \"me\") {\nprintln(it)//\u76f8\u5f53\u4e8e\u5b9e\u73b0\n}\n}\n\nfun method(age: Int, name: String, method2: (Int) -&gt; Unit){//\u76f8\u5f53\u4e8e\u58f0\u660e\nif (age &gt; 2 &amp;&amp; name == \"me\") {\nmethod2(100)//\u76f8\u5f53\u4e8e\u8c03\u7528\n} else {\nmethod2(40)\n}\n}\n</code></pre> \u529f\u80fd\u548cjava\u63a5\u53e3\u56de\u8c03\u76f8\u540c</p>"},{"location":"android/kotlin/kotlin_function/#inline","title":"\u5185\u8054\u51fd\u6570inline","text":"<p>\u7531\u4e8e\u4e0a\u9762\u5b9e\u73b0\u5728\u7f16\u8bd1\u751f\u6210\u65f6\u4f1a\u51fa\u73b0Functionx\u5bf9\u8c61\u6765\u5b8c\u6210lambda\u7684\u8c03\u7528\uff0c\u5b58\u5728\u6027\u80fd\u635f\u8017</p> <p></p> <p>\u4f7f\u7528inline\u540e\u76f8\u5f53\u4e8ec++\u4e2d\u7684#define \u5b8f\u66ff\u6362\u5c06\u4ee3\u7801\u76f4\u63a5\u66ff\u6362\u5230\u8c03\u7528\u5904\uff0c\u539f\u51fd\u6570\u4f9d\u7136\u5b58\u5728\u6ca1\u88ab\u8c03\u7528</p> <p>\u6240\u4ee5\u4f7f\u7528\u573a\u666f\uff1a\u51fd\u6570\u5b58\u5728\u53c2\u6570\u662flambda(\u533f\u540d\u51fd\u6570)\u65f6</p> <p>\u603b\u7ed3\uff1a\u51fd\u6570\u5185\u5bb9\u76f4\u63d2\u5230\u8c03\u7528\u5904</p>"},{"location":"android/kotlin/kotlin_function/#noinline","title":"noinline","text":"<p>\u4f5c\u7528\u4e8e\u51fd\u6570\u53c2\u6570\uff0c\u4e0d\u8fdb\u884c\u4f18\u5316</p> <p>AS\u4f1a\u63d0\u793a\uff0c\u5982lambda\u4f5c\u4e3a\u5bf9\u8c61\u8fd4\u56de\u65f6</p> <p>\u603b\u7ed3\uff1a\u5c40\u90e8\u5173\u95ed\u4f18\u5316\uff0c\u89e3\u51b3\u4e0d\u80fd\u628a\u51fd\u6570\u7c7b\u578b\u7684\u53c2\u6570\u5f53\u5bf9\u8c61\u4f7f\u7528\u95ee\u9898</p>"},{"location":"android/kotlin/kotlin_function/#crossinline","title":"crossinline","text":"<p>\u8c03\u7528inline\u51fd\u6570\uff0c\u4e14\u5728lambda\u4f7f\u7528return\u65f6\uff0c\u4e5f\u7528\u5728\u53c2\u6570\u4e0a</p> <p>\u603b\u7ed3\uff1a\u5c40\u90e8\u52a0\u5f3a\uff0c\u8ba9\u5185\u8054\u51fd\u6570\u7684\u51fd\u6570\u7c7b\u578b\u53c2\u6570\u53ef\u4ee5\u88ab\u95f4\u63a5\u8c03\u7528\uff0c\u4e0d\u80fd\u5728lambda\u4f7f\u7528return</p>"},{"location":"android/kotlin/kotlin_function/#_4","title":"\u51fd\u6570\u5f15\u7528","text":"<p>method2\u662f\u51fd\u6570\u800clambda\u662f\u51fd\u6570\u7684\u7c7b\u578b\uff0c\u53ef\u4ee5\u5c06lambda\u6539\u6210\u65b9\u6cd5\u518d\u4f7f\u7528::\u5f15\u7528 <pre><code>fun main() {\nmethod(4, \"xx\", ::method2)\n}\n\nprivate fun method2(code: Int){\nprintln(code)\n}\n</code></pre> \u6ce8\uff1a\u6b64\u5904::method\u662f\u5177\u540d\u51fd\u6570</p>"},{"location":"android/kotlin/kotlin_function/#_5","title":"\u51fd\u6570\u8fd4\u56de\u51fd\u6570","text":"<p><pre><code>fun main() {\nprintln(method(\"\u6709\u6d88\u606f\")(\"\u5f20\u4e09\"))\n}\n\nprivate fun method(info: String): (name: String) -&gt; String {\nreturn {\n\"it: $it, info: $info\"\n}\n}\n</code></pre> \u8fd4\u56de\u7c7b\u578b\u662f(name: String) -&gt; String\u51fd\u6570\u7c7b\u578b\uff0c\u5373\u58f0\u660e</p> <p>\u5177\u4f53\u5b9e\u73b0\u662f {         \"it: $it, info: $info\"     }</p> <p>\u8c03\u7528\u662fmethod(\"\u6709\u6d88\u606f\")(\"\u5f20\u4e09\")\uff0c\u6b64\u5904\u5df2\u7f29\u5199 <pre><code>val m = method(\"\u6709\u6d88\u606f\")\nprintln(m(\"\u5f20\u4e09\"))\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#_6","title":"\u5e38\u7528\u5185\u7f6e\u51fd\u6570","text":""},{"location":"android/kotlin/kotlin_function/#letapplyrun","title":"let\uff0capply\uff0crun\u533a\u522b","text":"<p>let\uff0crun\u8fd4\u56de\u503c\u53ef\u4ee5Any\uff0capply\u6c38\u8fdc\u8c03\u7528\u8005\u672c\u8eab</p> <p>let\u5185\u90e8\u6301\u6709it\uff0crun\u548capply\u5185\u90e8\u6301\u6709this</p> <p>run\u662flet\u548capply\u7ed3\u5408\u4f53\uff0c\u63a5\u8fd1let <pre><code>const val NAME: String = \"\u5f20\u4e09,\u674e\u56db,\u738b\u4e94\"\nfun main() {\nNAME.run(::isLong)\n.run(::showText)\n.run(::mapText)\n.run(::println)\nNAME.let(::isLong)\n.let(::showText)\n.let(::mapText)\n.let(::print)\n}\nfun isLong(str: String) = str.length &gt; 5\nfun showText(isLong: Boolean) = if (isLong) \"good\u5b57\u7b26\u4e32\" else \"bad\u5b57\u7b26\u4e32\"\nfun mapText(text: String) = \"\u3010$text\u3011\"\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#with","title":"with","text":"<p>\u548crun\u529f\u80fd\u4e00\u6837\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e0d\u540c</p> <p>with(with(with(with(NAME, ::isLong), ::showText), :: mapText), ::println)</p>"},{"location":"android/kotlin/kotlin_function/#also","title":"also","text":"<p>\u548capply\u7c7b\u4f3c\uff0c\u5185\u90e8\u6301\u6709it\uff0c\u8fd4\u56de\u6c38\u8fdc\u662f\u8c03\u7528\u8005\u672c\u8eab</p> <p>also\u4e5f\u662flet\u548capply\u7ed3\u5408\u4f53\uff0c\u63a5\u8fd1apply</p> <p>run\u548clet\uff1a\u533a\u522bthis\u548cit apply\u548calso\uff1a\u533a\u522bthis\u548cit with\u548crun\uff1a\u533a\u522b\u7ed3\u6784\uff0cwith\u5728\u975enull\u5bf9\u8c61\u65f6\u4f7f\u7528</p>"},{"location":"android/kotlin/kotlin_function/#takeif","title":"takeIf","text":"<p>\u5982\u679c\u662ftrue\u8fd4\u56de\u8c03\u7528\u8005\u672c\u8eab\uff0c\u5426\u5219\u8fd4\u56denull\uff0c\u53ef\u4ee5\u7ed3\u5408\u7a7a\u5408\u5e76\u5904\u7406\uff0c\u5982\u4e0b <pre><code>println(NAME.takeIf {\nisLong(it)\n} ?: \"\u540d\u5b57\u592a\u77ed\u4e86\")\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#takeunless","title":"takeUnless","text":"<p>\u548ctakeIf\u76f8\u53cd</p>"},{"location":"android/kotlin/kotlin_function/#_7","title":"\u6269\u5c55\u51fd\u6570","text":"<ol> <li>\u81ea\u5b9a\u4e49\u6269\u5c55\u4e0d\u80fd\u91cd\u590d</li> <li>jdk\u4e2d\u6269\u5c55\u51fd\u6570\u53ef\u4ee5\u8986\u76d6 <pre><code>fun &lt;T&gt; T?.showContent() = println(\"showContent: $this\")\nfun Any?.other() = println(\"other: $this\")\nnull.other()\n\"D\".showContent()\n</code></pre></li> </ol>"},{"location":"android/kotlin/kotlin_function/#map","title":"map\u51fd\u6570","text":"<p>\u8f6c\u5316\u8fd4\u56de\u7c7b\u578b <pre><code>val list = listOf(1, 2, 3)\nprintln(list.map {\n\"new$it\"\n}.map {\nit.replace(\"new\", \"old\")\n}.map {\nit.replace(\"old\", \"\")\n}.map {\nit.toInt() + 5\n})\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#flatmap","title":"flatMap\u51fd\u6570","text":"<pre><code>val list = listOf(1, 2, 3)\nprintln(list.map {\n\"new$it\"\n}.flatMap {\nlistOf(it.replace(\"new\", \"4\"))\n})\n</code></pre>"},{"location":"android/kotlin/kotlin_function/#filter","title":"filter\u51fd\u6570","text":"<p>\u8fc7\u6ee4\u529f\u80fd\uff0c\u914d\u5408map\u548cflatMap\u6548\u679c\u4e0d\u540c <pre><code>listOf(\nlistOf(\"flat\", \"run\"),\nlistOf(\"ab\", \"len\")\n).flatMap {\nit.filter { content -&gt;\ncontent.contains(\"f\")\n}\n}.map {\nprintln(it)//flat\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_function/#zip","title":"zip\u51fd\u6570","text":"<p>\u5408\u5e76\u96c6\u5408 <pre><code>val list1 = listOf(\"a\",\"b\",\"c\")\nval list2 = listOf(1,2,3)\nprintln(list1.zip(list2))//[(a, 1), (b, 2), (c, 3)]\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/","title":"\u64cd\u4f5c\u7b26\u4e0e\u5173\u952e\u5b57","text":"<p>\u5b98\u65b9\u6587\u6863</p>"},{"location":"android/kotlin/kotlin_op/#_1","title":"\u5e38\u7528\u64cd\u4f5c\u7b26","text":""},{"location":"android/kotlin/kotlin_op/#_2","title":"\uff1f","text":"<p>\u5982\u679c\u5bf9\u8c61\u662fnull\u5219\u4e0d\u6267\u884c\u540e\u7eed\u4ee3\u7801\uff0c\u5e38\u7ed3\u5408let\u4f7f\u7528\uff0c\u5982 <pre><code>var name: String? = null\nname?.length\nname?.let {\nit.length\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#_3","title":"!!","text":"<p>\u8868\u793a\u5f3a\u5236\u6267\u884c\uff0c\u5982\u679c\u662fnull\u5c31\u548cjava\u4e00\u6837\u62a5\u5f02\u5e38 <pre><code>var name: String? = null\nname!!.length\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#_4","title":"?:","text":"<p>\u8868\u793a\u5982\u679cnull\u4e4b\u6267\u884c\u4ee3\u7801\uff0c\u7ed3\u679c\u8f93\u51faxxx\uff0c\u4e00\u822c\u53ef\u7528\u4e8e\u81ea\u5b9a\u4e49\u5f02\u5e38 <pre><code>var name: String? = null\nprintln(name?.length ?: \"xxx\")\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#_5","title":"==\u548c===","text":"<p>==\u76f8\u5f53\u4e8ejava\u7684equals\uff0c\u6bd4\u8f83\u5185\u5bb9</p> <p>===\u76f8\u5f53\u4e8ejava\u7684==\uff0c\u6bd4\u8f83\u5f15\u7528\u503c</p>"},{"location":"android/kotlin/kotlin_op/#string","title":"String\u76f8\u5173","text":""},{"location":"android/kotlin/kotlin_op/#until","title":"until","text":"<p>\u7528\u6cd5\uff1a\u76f4\u5230\u54ea\u91cc\uff0c\u8f93\u51faHell <pre><code>const val NAME: String = \"Hello world!\"\nfun main() {\nprint(NAME.substring(0 until NAME.indexOf('o')))\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#splitc","title":"split\u548c\u89e3\u6784(c++\u4e2d\u7684\u7279\u70b9)","text":"<pre><code>const val NAME: String = \"\u5f20\u4e09,\u674e\u56db,\u738b\u4e94\"\nfun main() {\nval list = NAME.split(\",\")\nval (v1, v2, v3) = list\nprintln(\"v1: $v1, v2: $v2, v3: $v3\")\n}\n</code></pre>"},{"location":"android/kotlin/kotlin_op/#replace","title":"replace","text":"<p><pre><code>const val NAME: String = \"\u5f20\u4e09l,\u674e\u56dbl,\u738b\u4e94l\"\nprintln(NAME.replace(Regex(\"[l]\")) {\nwhen (it.value) {\n\"l\" -&gt; \"\"\nelse -&gt; \"x\"\n}\n})\n</code></pre> \u53bb\u9664l\u6548\u679c\uff0cRegex\u6b63\u5219\u7684\u4f7f\u7528</p>"},{"location":"android/kotlin/kotlin_op/#_6","title":"\u5e38\u7528\u5173\u952e\u5b57","text":""},{"location":"android/kotlin/kotlin_op/#lateinit","title":"lateinit","text":"<p>\u5ef6\u8fdf\u52a0\u8f7d\u5c5e\u6027\uff0c\u9700\u8981\u624b\u52a8\u52a0\u8f7d <pre><code>class MyClass {\nlateinit var name: String\n\nfun loadName() {\nname = \"wiki\"\n}\n\nfun showName() {\nif (::name.isInitialized) {\nprintln(\"name: $name\")\n} else {\nprintln(\"\u4f60\u8fd8\u6ca1\u53d6\u540d\u5462\")\n}\n}\n}\n</code></pre> \u4ee5\u4e0aname\u672a\u521d\u59cb\u5316\u524d\u662f\u4e0d\u80fd\u4f7f\u7528\uff0c\u5373\u4f7f\u5224\u7a7a\u4e5f\u4e0d\u884c\uff0c\u53ea\u80fd\u901a\u8fc7::name.isInitialized\u5224\u65ad</p> <p>\u5b9e\u6218\u6848\u4f8b</p>"},{"location":"android/kotlin/kotlin_op/#by","title":"by","text":"<p>\u59d4\u6258\u5173\u952e\u5b57 <pre><code>class MyClass {\nvar name: String by Delegate()\n}\nclass Delegate {\noperator fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;): String {\nreturn \"\"\n}\n\noperator fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;, value: String) {\n\n}\n}\n</code></pre> \u5b9e\u73b0\u5fc5\u8981\u56e0\u7d20\uff1aget/setValue\u65b9\u6cd5\u548coperator\u5173\u952e\u5b57</p> <p>\u6280\u5de7\uff1a\u76f4\u63a5\u5728Delegate\u4f7f\u7528Alt+Enter\u5feb\u901f\u91cd\u5199</p>"},{"location":"android/kotlin/kotlin_op/#by-lazy","title":"by lazy","text":"<p>\u60f0\u6027\u52a0\u8f7d\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7d <pre><code>fun main() {\nval p = MyClass()\nprintln(\"\u5148\u7761\u4f1a\u518d\u52a0\u8f7d\")\nThread.sleep(2000)\np.showName()\n}\nclass MyClass {\nprivate val name = loadName()\nprivate fun loadName(): String {\nprintln(\"loadName\")\nreturn \"wiki\"\n}\nfun showName() {\nprintln(\"name: $name\")\n}\n}\n</code></pre> \u6267\u884c\u7ed3\u679c\uff1a</p> <p>loadName</p> <p>\u5148\u7761\u4f1a\u518d\u52a0\u8f7d</p> <p>name: wiki</p> <p>\u671f\u671b\u7ed3\u679c\uff1a</p> <p>\u5148\u7761\u4f1a\u518d\u52a0\u8f7d</p> <p>loadName</p> <p>name: wiki</p> <p>\u4f7f\u7528by lazy\u6539\u9020\u540e\u5373\u53ef <pre><code>private val name by lazy {\nloadName()\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#by-delegatesobservable","title":"by Delegates.observable","text":"<p>\u53ef\u7528\u6765\u76d1\u542c\u5c5e\u6027\u53d8\u5316 <pre><code>fun main() {\nMyClass().name = \"new\"\n}\nclass MyClass {\nvar name: String by Delegates.observable(\"old\"){property, oldValue, newValue -&gt;\nprintln(\"property: ${property.name} from $oldValue to $newValue\")\n}\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#by-map","title":"by map","text":"<pre><code>fun main() {\nval delegate = MyClass(hashMapOf(\"age\" to 5, \"name\" to \"fff\"))\nprintln(delegate.age)\nprintln(delegate.name)\n}\nclass MyClass(map: HashMap&lt;String, Any&gt;) {\nval name: String by map\nval age: Int by map\n}\n</code></pre>"},{"location":"android/kotlin/kotlin_op/#by_1","title":"by\u7c7b(\u59d4\u6258\u7c7b)","text":"<p><pre><code>fun main() {\nDelegateB(B()).jump()\n}\n\ninterface A {\nfun jump()\n}\n\nclass B : A {\noverride fun jump() {\nprintln(\"jump\")\n}\n}\n\nclass DelegateB(private val b: B): A {\noverride fun jump() {\nb.jump()\n}\n}\n</code></pre> \u7b80\u5316 <pre><code>class DelegateB(private val b: B): A by b\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#vararg","title":"vararg\u5173\u952e\u5b57","text":"<p>\u8868\u793a\u591a\u4e2a\u53c2\u6570 <pre><code>class MyClass&lt;T&gt;(vararg objects: T) {\n//out\u8868\u793aT\u662f\u53ea\u8bfb\nprivate val list: Array&lt;out T&gt; = objects\n\nfun showObj(index: Int): T? = list[index].takeIf { true }\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#inout","title":"in\u548cout","text":"<p>in\u8868\u793a\u9006\u53d8\uff0c\u6cdb\u578b\u80fd\u88ab\u4fee\u6539\uff0c\u4e0d\u80fd\u8bfb\u53d6\uff0c\u529f\u80fd\u5305\u542bjava\u4e2d\u7684? super T <pre><code>interface B&lt;in T&gt; {\nfun getT(): T //\u62a5\u9519\nfun setT(item: T)\n}\nvar string: ArrayList&lt;in String&gt; = ArrayList&lt;CharSequence&gt;()\n</code></pre> out\u8868\u793a\u534f\u53d8\uff0c\u6cdb\u578b\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u80fd\u8bfb\u53d6\uff0c\u529f\u80fd\u5305\u542bjava\u4e2d\u7684? extends T <pre><code>interface A&lt;out T&gt; {\nfun getT(): T\nfun setT(item: T) //\u62a5\u9519\n}\nvar charSequence: ArrayList&lt;out CharSequence&gt; = ArrayList&lt;String&gt;()\n</code></pre> \u9ed8\u8ba4\u80fd\u8bfb\u53d6\u548c\u4fee\u6539 <pre><code>interface C&lt;T&gt; {\nfun getT(): T\nfun setT(item: T)\n}\n</code></pre></p>"},{"location":"android/kotlin/kotlin_op/#reified","title":"reified","text":"<p>\u5728\u4f7f\u7528\u6cdb\u578b\u7c7b\u578b\u5224\u65ad\u65f6\u4f7f\u7528\uff0c\u5982it is T\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u7ed3\u5408inline <pre><code>fun main() {\nprintln(MyClass().randomObj { A(\"A\") })\n}\n\ndata class A(val name: String)\ndata class B(val name: String)\nclass MyClass {\ninline fun &lt;reified T&gt; randomObj(defaultObj: () -&gt; T): T? {\nval list = listOf(A(\"a\"), B(\"b\"))\nval random = list.shuffled().first()\nprintln(\"\u968f\u673a\u5bf9\u8c61\uff1a$random\")\nreturn random.takeIf { it is T } as T? ?: defaultObj()\n}\n}\n</code></pre> \u6848\u4f8b\u8bbe\u5b9aT\u5c31\u662fA\u7c7b\u578b\uff0c\u8fd4\u56deT?\u539f\u56e0\u662f\u5f53\u968f\u673a\u5bf9\u8c61\u662fB\u7c7b\u578b\u65f6\uff0ctakeIf\u8fd4\u56denull\u65e0\u6cd5\u8f6c\u6210T</p>"},{"location":"android/kotlin/kotlin_op/#_7","title":"\u8fd0\u7b97\u7b26\u91cd\u8f7d","text":"<p><pre><code>fun main() {\nprintln(A(\"name:\") + A(\"Andy\"))\n}\n\nclass A(var name: String) {\noperator fun plus(a1: A): String {\nreturn \"$name ${a1.name}\"\n}\n}\n</code></pre> \u4f7f\u7528operator\u5173\u952e\u5b57\uff0cplus\u662f\u53ef\u4ee5\u901a\u8fc7\u5feb\u6377\u952e(Ctrl+\u7a7a\u683c)\u63d0\u793a\u51fa\u5bf9\u5e94\u5173\u7cfb</p> <p></p>"},{"location":"android/kotlin/kotlin_op/#infix","title":"infix","text":"<p>\u6a21\u4eff\u7cfb\u7edf\u7684x to x <pre><code>infix fun &lt;T, R&gt; T.go(r: R) {\nprintln(\"$this - $r\")\n}\n\"who\" go \"you\"\n\"who\".go(\"you\")\n</code></pre></p>"},{"location":"android/kotlin/kotlin_principle/","title":"\u539f\u7406","text":""},{"location":"android/kotlin/kotlin_principle/#by-lazy","title":"by lazy","text":"<p>\u59d4\u6258\u7684\u5fc5\u8981\u6761\u4ef6\u662f\u6709get/setValue\u51fd\u6570\u4ee5\u53caoperator <pre><code>public interface Lazy&lt;out T&gt; {\npublic val value: T\n\npublic fun isInitialized(): Boolean\n}\n\npublic actual fun &lt;T&gt; lazy(initializer: () -&gt; T): Lazy&lt;T&gt; = SynchronizedLazyImpl(initializer)\n</code></pre></p> <p>\u65e0\u8bba\u662fLazy\u8fd8\u662fSynchronizedLazyImpl\u90fd\u6ca1\u6709\u770b\u5230get/setValue\u51fd\u6570\u4ee5\u53caoperator</p> <p>\u771f\u6b63\u5b9e\u73b0\u5728\u62d3\u5c55\u51fd\u6570\u4e2d <pre><code>public inline operator fun &lt;T&gt; Lazy&lt;T&gt;.getValue(thisRef: Any?, property: KProperty&lt;*&gt;): T = value\n</code></pre> lazy\u8fd8\u6709\u4e00\u4e2a\u91cd\u8f7d\u51fd\u6570 <pre><code>public actual fun &lt;T&gt; lazy(mode: LazyThreadSafetyMode, initializer: () -&gt; T): Lazy&lt;T&gt; =\nwhen (mode) {\nLazyThreadSafetyMode.SYNCHRONIZED -&gt; SynchronizedLazyImpl(initializer)\nLazyThreadSafetyMode.PUBLICATION -&gt; SafePublicationLazyImpl(initializer)\nLazyThreadSafetyMode.NONE -&gt; UnsafeLazyImpl(initializer)\n}\n</code></pre> \u5176\u4e2dSynchronizedLazyImpl\u4f7f\u7528synchronized+\u53cc\u91cd\u6821\u9a8c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u4ee3\u7801\u5757\u53ea\u4f1a\u8c03\u75281\u6b21</p> <p>SafePublicationLazyImpl\u662f\u4f7f\u7528CS\u64cd\u4f5c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u53ef\u80fd\u4f1a\u8c03\u7528\u591a\u6b21\u4ee3\u7801\u5757\uff0c\u4f46\u6570\u503c\u53ea\u53d6\u7b2c\u4e00\u6b21</p> <p>LazyThreadSafetyMode\u4e0d\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</p>"},{"location":"android/kotlin/kotlin_principle/#_1","title":"\u679a\u4e3e","text":"<p>\u679a\u4e3e\u53ea\u80fd\u7ee7\u627f\u63a5\u53e3\u4e0d\u80fd\u7ee7\u627f\u7c7b\u7684\u539f\u56e0</p> <p>\u901a\u8fc7\u53cd\u7f16\u8bd1\u53ef\u4ee5\u770b\u5230\u679a\u4e3e\u5176\u5b9e\u662f\u4e2aClass\u7ee7\u627f\u4e8ejava/lang/Enum\uff0c\u800c\u5bf9\u4e8ejava\u6765\u8bf4\u662f\u5355\u7ee7\u627f\u89c4\u5219</p> <p>\u4f18\u5316\u70b9\uff1a</p> <p>1.\u679a\u4e3e\u6709\u4e24\u4e2a\u5c5e\u6027name\u548cordinal\uff0c\u5176\u4e2dordinal\u4e00\u822c\u5f00\u53d1\u8005\u4f7f\u7528\u4e0d\u5230\uff0c\u5f53\u9700\u8981\u4f7f\u7528\u5230\u679a\u4e3e\u7684\u6570\u503c\u65f6\uff0c\u5efa\u8bae\u624b\u52a8\u6dfb\u52a0\u5b57\u6bb5\u53bb\u8bb0\u5f55</p> <p>2.\u5f53\u679a\u4e3e\u9700\u8981\u4f7f\u7528\u6570\u503c\u5173\u8054\u65f6\uff0c\u4f7f\u7528EnumMap\u548cEnumSet</p>"},{"location":"android/network/net_base/","title":"\u7f51\u7edc\u57fa\u7840","text":"<p>TCP/IP\u6a21\u578b</p> <p>\u5e94\u7528\u5c42\uff1aHTTP\u3001FTP\u3001DNS\u3001Telnet\u3001SNMP\u3001TFTP(\u672f\u8bed\uff1a\u6d88\u606f)</p> <p>\u4f20\u8f93\u5c42\uff1aTCP\u3001UDP(\u672f\u8bed\uff1a\u6bb5)\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0</p> <p>\u7f51\u7edc\u5c42\uff1aIP\u3001ICMP\u3001RIP\u3001OSPF\u3001BGP(\u672f\u8bed\uff1a\u7247)</p> <p>\u7f51\u7edc\u63a5\u53e3\u5c42\uff1a3G\u30014G\u30015G\u6240\u5728(\u672f\u8bed\uff1a\u5e27)\uff0c\u786c\u4ef6\u63a5\u53e3</p> <p>\u5168\u80fd\u672f\u8bed\uff1a\u5305(\u4e00\u822c\u90fd\u4f7f\u7528\u6570\u636e\u5305\u4e0d\u53bb\u7ec6\u5206\u4e0a\u8ff0\u672f\u8bed)</p> <p>\u5206\u522b\u5bf9\u5e94OSI\u6a21\u578b</p> <p>\u5e94\u7528\u5c42(\u4e3a\u5e94\u7528\u63d0\u4f9b\u670d\u52a1)\u3001\u8868\u793a\u5c42(\u6570\u636e\u683c\u5f0f\u8f6c\u5316\u52a0\u5bc6)\u3001\u4f1a\u8bdd\u5c42(\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u7ef4\u62a4\u4f1a\u8bdd)</p> <p>\u4f20\u8f93\u5c42(\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u7ef4\u62a4\u5bf9\u7aef\u7684\u8fde\u63a5)</p> <p>\u7f51\u7edc\u5c42(IP\u9009\u5740\u3001\u8def\u7531\u9009\u62e9)</p> <p>\u94fe\u8def\u5c42(\u63d0\u4f9b\u4ecb\u8d28\u8bbf\u95ee\u548c\u94fe\u8def\u7ba1\u7406)\u3001\u7269\u7406\u5c42(\u7269\u7406\u4f20\u8f93)</p>"},{"location":"android/network/net_base/#_1","title":"\u7f51\u7edc\u6570\u636e\u4f20\u8f93\u539f\u7406","text":"<p>\u5c01\u5305\uff1a</p> <p>\u5e94\u7528\u5c42(\u5fae\u4fe1A\u7528\u6237)-&gt;\u901a\u8fc7Http\u8bf7\u6c42\u53d1\u9001\u4fe1\u606f(hello)-&gt;\u4f20\u8f93\u5c42(\u5c01\u88c5\u5305\uff1aTCP\u9996\u90e8+\u6d88\u606f\u6570\u636e)-&gt;\u7f51\u7edc\u5c42(\u5c01\u88c5\u5305\uff1aTCP\u9996\u90e8+\u6d88\u606f\u6570\u636e+IP\u5305\u9996\u90e8)-&gt;\u94fe\u8def\u5c42(\u5c01\u88c5\u5305\uff1aTCP\u9996\u90e8+\u6d88\u606f\u6570\u636e+IP\u5305\u9996\u90e8+\u4ee5\u592a\u7f51\u5305\u9996\u90e8)-&gt;\u7269\u7406\u5c42(\u4ee5\u592a\u7f51\u7535\u7f06)</p> <p>\u62c6\u5305\uff1a</p> <p>\u94fe\u8def\u5c42(\u89e3\u6790\u9996\u90e8\u62c6\u5305\uff1aTCP\u9996\u90e8+\u6d88\u606f\u6570\u636e+IP\u5305\u9996\u90e8)-&gt;\u7f51\u7edc\u5c42(\u89e3\u6790\u9996\u90e8\u62c6\u5305\uff1aTCP\u9996\u90e8+\u6d88\u606f\u6570\u636e)-&gt;\u4f20\u8f93\u5c42(\u89e3\u6790\u9996\u90e8\u62c6\u5305\uff1a\u6d88\u606f\u6570\u636e)-&gt;\u5e94\u7528\u5c42(\u5fae\u4fe1B\u7528\u6237)</p>"},{"location":"android/network/net_base/#tcp-vs-udp","title":"TCP vs UDP","text":"TCP UDP \u8fde\u63a5 \u9762\u5411\u8fde\u63a5 \u9762\u5411\u65e0\u8fde\u63a5 \u53ef\u9760 \u53ef\u9760\u4f20\u8f93\uff0c\u4f7f\u7528\u6d41\u91cf\u3001\u62e5\u585e\u63a7\u5236 \u4e0d\u53ef\u9760\uff0c\u4e0d\u4f7f\u7528\u6d41\u91cf\u3001\u62e5\u585e\u63a7\u5236 \u8fde\u63a5\u5bf9\u8c61\u4e2a\u6570 \u4e00\u5bf9\u4e00 \u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u4e00\u3001\u591a\u5bf9\u591a \u4f20\u8f93\u65b9\u5f0f \u9762\u5411\u5b57\u8282\u6d41 \u9762\u5411\u62a5\u6587 \u9996\u90e8\u5f00\u9500 \u6700\u5c0f20\u5b57\u8282\uff0c\u6700\u592760\u5b57\u8282 8\u4e2a\u5b57\u8282 \u9002\u7528\u573a\u666f \u53ef\u9760\u4f20\u8f93\u5e94\u7528(\u6587\u4ef6\u4f20\u8f93) \u5b9e\u65f6\u5e94\u7528(IP\u7535\u8bdd\u3001\u89c6\u9891\u4f1a\u8bae\u3001\u76f4\u64ad\u3001\u5728\u7ebf\u89c6\u9891) <p>UDP\u65e2\u7136\u4e0d\u53ef\u9760\u5982\u4f55\u5b9e\u73b0\u53ef\u9760\uff0c\u7528UDT\u89e3\u51b3</p> <p>UDT\uff1a\u57fa\u4e8eUDP\uff0c\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u8fde\u63a5\u3001\u91cd\u4f20\uff0c\u80fd\u4f18\u5316\u5e26\u5bbd\u4e0d\u7a33\u5b9a\u65f6\u4f20\u8f93\u7b97\u6cd5\uff0c\u5149\u7ea4\u3001\u6d77\u91cf\u6570\u636e\u573a\u666f\u4f7f\u7528</p>"},{"location":"android/network/net_base/#mac-vs-ip","title":"MAC vs IP","text":"<p>MAC\u5730\u5740\uff1a\u548c\u786c\u4ef6\u7ed1\u5b9a\uff0c\u552f\u4e00\uff0c48\u4f4d\u53736\u4e2a\u5b57\u8282\uff0c\u5904\u4e8e\u94fe\u8def\u5c42\uff0c\u67e5\u770bpc mac\u547d\u4ee4\uff1aipconfig /all</p> <p>IP\u5730\u5740\uff1a32\u4f4d\u53734\u4e2a\u5b57\u8282\uff0c\u53ef\u4fee\u6539</p>"},{"location":"android/network/net_base/#tcp","title":"TCP","text":""},{"location":"android/network/net_base/#_2","title":"\u57fa\u672c\u7279\u6027","text":"<p>\u9762\u5411\u8fde\u63a5\u3001\u53ef\u9760\u6027\u3001RTT(\u5f80\u8fd4\u65f6\u5ef6)\u548cRTO(\u91cd\u4f20\u8d85\u65f6)\u3001\u6570\u636e\u6392\u5e8f\u3001\u6d41\u91cf\u63a7\u5236\u3001\u5168\u53cc\u5de5</p> \u6d41\u91cf\u63a7\u5236 \u62e5\u585e\u63a7\u5236 \u5173\u8054 \u63a5\u6536\u65b9\u7f13\u5b58 \u7f51\u7edc\u62e5\u5835\u60c5\u51b5 \u63a7\u5236\u539f\u7406 \u6ed1\u52a8\u7a97\u53e3\u63a7\u5236\u6d41\u91cf\uff0c\u7a97\u53e3\u5927\u5c0f\u5728TCP\u5934\u90e8\u7684Window\u5b57\u6bb5\uff0c\u5927\u5c0f\u4e3a0\u65f6\u53d1\u9001\u65b9\u505c\u6b62\u53d1\u9001\u6570\u636e\u5e76\u542f\u52a8\u6301\u7eed\u8ba1\u65f6\u5668(\u95f4\u9694\u8be2\u95ee\u662f\u5426\u53ef\u7ee7\u7eed\u53d1\u9001\u6570\u636e)\uff0c\u5f53\u63a5\u6536\u65b9\u5904\u7406\u5b8c\u6570\u636e\u540e\u4f1a\u53d1\u9001\u901a\u77e5\u62a5\u6587 \u901a\u8fc7\u6162\u542f\u52a8\u3001\u62e5\u585e\u907f\u514d\u3001\u5feb\u91cd\u4f20\u548c\u5feb\u6062\u590d"},{"location":"android/network/net_base/#_3","title":"\u4e09\u6b21\u63e1\u624b","text":"<p>SYN\uff1a\u5efa\u7acb\u8fde\u63a5\u7684\u6807\u5fd7\u4f4d</p> <p>seq\uff1a\u5e8f\u5217\u53f7\uff0c\u7528\u4e8e\u6807\u8bc6TCP\u62a5\u6587\u6bb5\u7684\u987a\u5e8f</p> <p>ACK\uff1a\u786e\u8ba4\u6d88\u606f\u7684\u6807\u5fd7\u4f4d</p> <p>ack\uff1a\u786e\u8ba4\u6d88\u606f\u7684\u901a\u7528\u672f\u8bed\uff0c\u7528\u4e8e\u786e\u8ba4\u5df2\u63a5\u6536\u5230\u7684\u6570\u636e\u5b57\u8282\u7684\u5e8f\u5217\u53f7</p> <p>\u5176\u4ed64\u4e2a\u6807\u8bc6\u4f4d\uff1aPSH(\u4f20\u9001)\u3001FIN(\u7ed3\u675f)\u3001RST(\u91cd\u7f6e)\u3001URG(\u7d27\u6025)</p> <p>\u5ba2\u6237\u7aef------------\u670d\u52a1\u7aef</p> <p>-&gt;SYN=1,seq=X,\u5ba2\u6237\u7aef\u5904\u4e8eSYN_SENT</p> <p>ACK=1,ack=X+1,SYN=1,seq=J&lt;-\uff0c\u670d\u52a1\u7aef\u5904\u4e8eSYN_RECV</p> <p>-&gt;ACK=1,ack=J+1\uff0c\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u5668\u5904\u4e8eESTABLISHED</p> <p>\u7b2c\u4e00\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5</p> <p>\u7b2c\u4e8c\u6b21\u63e1\u624b\uff1a\u670d\u52a1\u5668\u5e94\u7b54\u5ba2\u6237\u7aef\uff0c\u5e76\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5</p> <p>\u7b2c\u4e09\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u9488\u5bf9\u670d\u52a1\u5668\u8bf7\u6c42\u786e\u8ba4\u5e94\u7b54</p>"},{"location":"android/network/net_base/#_4","title":"\u4e3a\u4f55\u9700\u8981\u4e09\u6b21\u63e1\u624b","text":"<p>TCP\u662f\u5168\u53cc\u5de5\u7684\uff0c\u53cc\u65b9\u90fd\u80fd\u53d1\u9001\u548c\u63a5\u6536\u80fd\u529b\uff0c\u4e09\u6b21\u63e1\u624b\u80fd\u786e\u8ba4\u53cc\u65b9\u7684\u53d1\u9001/\u63a5\u6536\u80fd\u529b\uff0c\u4e24\u6b21\u53ea\u80fd\u8bc1\u660e\u5ba2\u6237\u7aef\u7684\u53d1\u9001\u548c\u670d\u52a1\u7aef\u7684\u63a5\u6536\u80fd\u529b\uff0c\u56db\u6b21\u5c5e\u4e8e\u6d6a\u8d39</p>"},{"location":"android/network/net_base/#tcp_1","title":"TCP\u63e1\u624b\u6f0f\u6d1e","text":"<p>\u5ba2\u6237\u7aef\u4f2a\u9020IP\u53d1\u9001\u8bf7\u6c42(\u7b2c\u4e00\u6b21\u63e1\u624b)\uff0c\u670d\u52a1\u7aef\u54cd\u5e94(\u7b2c\u4e8c\u6b21\u63e1\u624b)\u540e\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u7b2c\u4e09\u6b21\u63e1\u624b(\u6c38\u8fdc\u4e0d\u4f1a\u6709\uff0c\u5bfc\u81f4\u4e00\u81f4\u7b49\u5f85\u6d6a\u8d39\u8d44\u6e90)</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u65e0\u6548\u8fde\u63a5\u76d1\u63a7\u91ca\u653e\u3001\u5ef6\u7f13TCB\u5206\u914d\u65b9\u6cd5\u3001\u9632\u706b\u5899</p>"},{"location":"android/network/net_base/#_5","title":"\u56db\u6b21\u6325\u624b","text":"<p>\u5ba2\u6237\u7aef------------\u670d\u52a1\u7aef</p> <p>-&gt;FIN=1,seq=X,\u5ba2\u6237\u7aef\u5904\u4e8eFIN_WAIT_1</p> <p>ACK=1,ack=X+1&lt;-\uff0c\u670d\u52a1\u5668\u5904\u4e8eCLOSE_WAIT\uff0c\u5ba2\u6237\u7aef\u4f9d\u7136\u80fd\u63a5\u6536\u6570\u636e\uff0c\u6536\u5230\u540e\u5904\u4e8eFIN_WAIT_2</p> <p>FIN=1,seq=j&lt;-\uff0c\u670d\u52a1\u5668\u5904\u4e8eCLOSE\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u5904\u4e8eTIME_WAIT</p> <p>-&gt;ACK=1,ack=J+1\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u5904\u4e8eCLOSED\uff0c2*MSL\u540e\u5ba2\u6237\u7aef\u5904\u4e8eCLOSED</p> <p>MSL\uff1a\u6700\u957f\u62a5\u6587\u6bb5\u5bff\u547d(\u5b58\u6d3b\u7684\u6700\u957f\u65f6\u95f4 RFC\u4e2d\u5b9a\u4e49\u4e3a2\u5206\u949f\uff0c\u4e00\u822c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u4e3a30s)</p> <p>TIME_WAIT\uff1a\u6301\u7eed1-4\u5206\u949f</p> <p>\u7b2c\u4e00\u6b21\u6325\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u5173\u95ed\u8bf7\u6c42</p> <p>\u7b2c\u4e8c\u6b21\u6325\u624b\uff1a\u670d\u52a1\u5668\u54cd\u5e94\u5ba2\u6237\u7aef\u5173\u95ed\u8bf7\u6c42</p> <p>\u7b2c\u4e09\u6b21\u6325\u624b\uff1a\u670d\u52a1\u7aef\u53d1\u9001\u5173\u95ed\u8bf7\u6c42</p> <p>\u7b2c\u56db\u6b21\u6325\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u5173\u95ed\u8bf7\u6c42\u786e\u8ba4</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u53ef\u4ee5\u53d1\u8d77\u5173\u95ed\u8bf7\u6c42</p>"},{"location":"android/network/net_base/#_6","title":"\u4e3a\u4f55\u9700\u8981\u56db\u6b21\u6325\u624b","text":"<p>\u548c\u4e09\u6b21\u63e1\u624b\u76f8\u540c\uff0c\u5982\u679c\u670d\u52a1\u5668\u6ca1\u6709\u6570\u636e\u53d1\u9001\u65f6\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u4f1a\u5408\u5e76</p>"},{"location":"android/network/net_base/#time_wait","title":"TIME_WAIT\u4f5c\u7528","text":"<ol> <li>\u9632\u6b62\u8fde\u63a5\u5173\u95ed\u65f6\u7b2c\u56db\u6b21\u6325\u624b\u4e2d\u7684ack\u4e22\u5931\uff0c\u5982\u679c\u6ca1\u6709\u6b64\u72b6\u6001\uff0c\u5ba2\u6237\u7aef\u76f4\u63a5\u8fdb\u5165CLOSED\uff0c\u4e00\u65e6\u5ba2\u6237\u7aef\u6700\u540e\u4e00\u6b21ACK\u4e22\u5931\uff0c\u670d\u52a1\u5668\u4f1a\u91cd\u4f20\u6b64\u65f6\u65e0\u4eba\u5904\u7406\u5c06\u957f\u65f6\u95f4\u7b49\u5f85\u76f4\u5230\u91cd\u4f20\u6b21\u6570\u8fbe\u4e0a\u9650</li> <li>\u9632\u6b62\u65b0\u8fde\u63a5\u6536\u5230\u65e7\u94fe\u63a5\u7684TCP\u62a5\u6587</li> </ol>"},{"location":"android/network/net_base/#socket","title":"Socket","text":"<p>Socket\u662f\u5e94\u7528\u5c42\u4e0eTCP/IP\u534f\u8bae\u901a\u4fe1\u7684\u4e2d\u95f4\u8f6f\u4ef6\u62bd\u8c61\u5c42\uff0c\u662f\u4e00\u7ec4\u63a5\u53e3</p> <p>\u5bf9\u4e8e\u5e94\u7528\u6765\u8bf4\u7f51\u7edc\u5e95\u5c42\u90fd\u662fsocket\uff0c\u5c06\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u94fe\u8def\u5c42\u5305\u88f9</p> <p>\u7f51\u7edc\u901a\u8baf\uff1a\u5efa\u7acb\u8fde\u63a5(\u5ba2\u6237\u7aef\u3001\u670d\u52a1\u7aef)\u3001\u8bfb\u7f51\u7edc\u6570\u636e\u3001\u5199\u7f51\u7edc\u6570\u636e</p> <p>BIO\uff1aB-Blocking\uff0c\u963b\u585e\u5f0f\u7f51\u7edc\u901a\u8baf\u4e5f\u662f\u4f20\u7edf\u7684\u7f51\u7edc\u901a\u8baf\uff0c\u9762\u5411\u6d41\uff0c\u5982Socket\u901a\u8baf</p> <ul> <li>\u4e00\u4e2a\u5ba2\u6237\u7aef\u9700\u8981\u670d\u52a1\u7aef\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u670d\u52a1\uff0c\u5927\u91cf\u5ba2\u6237\u7aef\u5c31\u9700\u8981\u5927\u91cf\u7ebf\u7a0b</li> <li>\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u5e76\u4e00\u76f4\u963b\u585e\u7b49\u5f85\uff0c\u670d\u52a1\u5668\u5904\u7406\u5e76\u54cd\u5e94\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u54cd\u5e94\u5904\u7406\u4fe1\u606f</li> </ul> <p>\u670d\u52a1\u5668ServerSocket\uff1abind\u3001accept\u3001\u7ebf\u7a0b(socket) <pre><code>fun main() {\nval executor = Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors() * 2)\nval serverSocket = ServerSocket()//\u670d\u52a1\u7aef\u5fc5\u5907\nserverSocket.bind(InetSocketAddress(10001))//\u76d1\u542c\u7aef\u53e3\nprintln(\"start server........\")\nwhile (true) {\nexecutor.execute {\nserverSocket.accept().let { s -&gt;\nval bis = ObjectInputStream(s.getInputStream())\nval userName = bis.readUTF()\nprintln(\"accept client msg: $userName\")\nval bos = ObjectOutputStream(s.getOutputStream())\nbos.writeUTF(\"Hello, $userName\")\nbos.flush()\n}\n}\n}\n}\n</code></pre> \u5ba2\u6237\u7aefsocket <pre><code>fun main() {\nval serverAddress = InetSocketAddress(\"127.0.0.1\", 10001)\nval socket = Socket()\nsocket.connect(serverAddress)\nval bos = ObjectOutputStream(socket.getOutputStream())\nbos.writeUTF(\"yuli\")\nbos.flush()\nval bis = ObjectInputStream(socket.getInputStream())\nprintln(bis.readUTF())\n}\n</code></pre> NIO\uff1aIO\u591a\u8def\u590d\u7528\uff0c\u540c\u6b65\u975e\u963b\u585e\uff0c\u4f18\u5316BIO\uff0c\u9762\u5411\u7f13\u51b2\u533a</p> <p>\u6548\u7387\uff1aBIO\u6bd4NIO\u9ad8</p> <p>Selector\u3001Channel\u3001Buffer</p> <p>Buffer\uff1a\u4e00\u822c\u4f7f\u7528ByteBuffer,capacity\u3001position\u3001limit</p> <p>AIO\uff1a\u5f02\u6b65IO\uff0c\u771f\u6b63\u5b9e\u73b0\u7684\u53ea\u6709Windows</p> <p>\u76f4\u63a5\u5185\u5b58\u6bd4\u5806\u5185\u5b58\u5feb</p> <p>\u5806\u5185\u5b58\uff1a\u7531\u4e8ejvm\u5b58\u5728\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u9700\u8981\u5148\u62f7\u8d1d\u5230\u5e94\u7528\u8fdb\u7a0b\u7f13\u51b2\u533a\u518d\u62f7\u8d1d\u5230\u5957\u63a5\u5b57\u53d1\u9001\u7f13\u51b2\u533a</p>"},{"location":"android/network/net_base/#_7","title":"\u96f6\u62f7\u8d1d","text":"<p>\u6307\u8ba1\u7b97\u673a\u6267\u884c\u64cd\u4f5c\u65f6\uff0cCPU\u4e0d\u9700\u8981\u5148\u5c06\u6570\u636e\u4ece\u67d0\u5904\u5185\u5b58\u590d\u5236\u5230\u53e6\u4e00\u4e2a\u7279\u5b9a\u533a\u57df</p> <p>\u5c3d\u53ef\u80fd\u51cf\u5c11CPU\u62f7\u8d1d\u6b21\u6570\u6216\u6ca1\u6709CPU\u62f7\u8d1d\u5373\u4e3a\u96f6\u62f7\u8d1d</p> <p>\u4f7f\u7528mmap\u3001sendfile\u3001slice\u51fd\u6570\u53ef\u4ee5\u51cf\u5c11cpu\u62f7\u8d1d</p>"},{"location":"android/network/net_base/#dma","title":"DMA","text":"<p>\u76f4\u63a5\u5185\u5b58\u8bbf\u95ee\u6280\u672f\uff0c\u7528\u6765\u4ee3\u66ffCPU\u8fdb\u884c\u6570\u636e\u642c\u8fd0\u5de5\u4f5c</p>"},{"location":"android/network/net_base/#_8","title":"\u4f20\u7edf\u6570\u636e\u4f20\u9001","text":"<p>4\u6b21\u62f7\u8d1d\uff1a</p> <p>\u7528\u6237\u8fdb\u7a0b-----------------------------------\u5185\u6838</p> <p>[\u78c1\u76d8-&gt;DMA\u62f7\u8d1d-&gt;\u6587\u4ef6\u8bfb\u53d6\u7f13\u51b2\u533a]-&gt;CPU\u62f7\u8d1d-&gt;\u5e94\u7528\u8fdb\u7a0b\u7f13\u51b2\u533a-&gt;CPU\u62f7\u8d1d</p> <p>-&gt;[\u5957\u63a5\u5b57\u53d1\u9001\u7f13\u51b2\u533a-&gt;DMA\u62f7\u8d1d-&gt;\u7f51\u7edc\u8bbe\u5907\u7f13\u51b2\u533a]</p> <p>4\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff1a</p> <p>\u7528\u6237\u6001-&gt;\u5f00\u59cbread-&gt;\u5185\u6838\u6001-&gt;read\u5b8c\u6210-&gt;\u7528\u6237\u6001-&gt;\u5f00\u59cbsend-&gt;\u5185\u6838\u6001-&gt;send\u5b8c\u6210-&gt;\u7528\u6237\u6001</p>"},{"location":"android/network/net_base/#mmap","title":"MMAP\u5185\u5b58\u6620\u5c04","text":"<p>3\u6b21\u62f7\u8d1d\uff1a</p> <p>[\u78c1\u76d8-&gt;DMA\u62f7\u8d1d]-&gt;\u5e94\u7528\u8fdb\u7a0b\u7f13\u51b2\u533a-&gt;CPU\u62f7\u8d1d</p> <p>-&gt;[\u5957\u63a5\u5b57\u53d1\u9001\u7f13\u51b2\u533a-&gt;DMA\u62f7\u8d1d-&gt;\u7f51\u7edc\u8bbe\u5907\u7f13\u51b2\u533a]</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u8fd8\u662f4\u6b21</p>"},{"location":"android/network/net_base/#sendfile","title":"sendfile","text":"<p>[\u78c1\u76d8-&gt;DMA\u62f7\u8d1d-&gt;\u6587\u4ef6\u8bfb\u53d6\u7f13\u51b2\u533a]-&gt;CPU\u62f7\u8d1d-&gt;[\u5957\u63a5\u5b57\u53d1\u9001\u7f13\u51b2\u533a-&gt;DMA\u62f7\u8d1d-&gt;\u7f51\u7edc\u8bbe\u5907\u7f13\u51b2\u533a]</p> <p>\u786c\u4ef6\u652f\u6301\u60c5\u51b5\u4e0b\uff0cCPU\u62f7\u8d1d\u53ef\u7701\u7565\uff0c2\u6b21\u62f7\u8d1d\uff0c2\u6b21\u4e0a\u4e0b\u6587\u5207\u6362</p>"},{"location":"android/network/net_base/#slice","title":"slice","text":"<p>2\u6b21\u62f7\u8d1d\uff0c2\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff1a</p> <p>[\u78c1\u76d8-&gt;DMA\u62f7\u8d1d-&gt;\u6587\u4ef6\u8bfb\u53d6\u7f13\u51b2\u533a]-&gt;PIPE(\u7ba1\u9053)-&gt;[\u5957\u63a5\u5b57\u53d1\u9001\u7f13\u51b2\u533a-&gt;DMA\u62f7\u8d1d-&gt;\u7f51\u7edc\u8bbe\u5907\u7f13\u51b2\u533a]</p> <p>select\u3001poll\u3001epoll</p>"},{"location":"android/network/net_charles/","title":"\u6293\u5305\u5de5\u5177","text":""},{"location":"android/network/net_charles/#charles","title":"\u6293\u5305\u5de5\u5177charles","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.charlesproxy.com/download/</p> <p>\u6ce8\u518c\uff1ahttps://www.zzzmode.com/mytools/charles/</p>"},{"location":"android/network/net_charles/#_1","title":"\u4ee3\u7406\u914d\u7f6e","text":""},{"location":"android/network/net_charles/#window","title":"window","text":"<p>Help-&gt;SSL Proxying-&gt;Install Charles Root Certificate</p> <p></p> <p>\u9009\u62e9\u5b89\u88c5\u8bc1\u4e66(I)...</p> <p></p> <p>\u9009\u62e9\u672c\u5730\u8ba1\u7b97\u673a</p> <p></p> <p>\u9009\u62e9\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u9881\u53d1\u673a\u6784</p> <p></p>"},{"location":"android/network/net_charles/#_2","title":"\u57fa\u672c\u4f7f\u7528","text":""},{"location":"android/network/net_charles/#wireshark","title":"Wireshark","text":"<p>\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.wireshark.org/</p> <p>BPF\u8bed\u6cd5\uff1ahttps://www.wireshark.org/docs/dfref/</p>"},{"location":"android/network/net_charles/#_3","title":"\u6293\u5305\u767e\u5ea6\u6848\u4f8b","text":"<p>TCP\u4e09\u6b21\u63e1\u624b\u5206\u6790</p> <p>\u4f7f\u7528\u8fc7\u6ee4\u5668\u8fc7\u6ee4ip\u548ctcp</p> <p></p> <p></p> <p>Frame\uff1a\u7269\u7406\u5c42</p> <p>Ethernet\uff1a\u94fe\u8def\u5c42</p> <p>Internet\uff1a\u7f51\u7edc\u5c42</p> <p>Transmission\uff1a\u4f20\u8f93\u5c42\uff0cTCP\u6240\u5728</p> <p>\u7b2c\u4e00\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0cSYN=1\uff0cSeq=1319028629  \u7b2c\u4e8c\u6b21\u63e1\u624b\uff1a\u670d\u52a1\u7aef\u5e94\u7b54\uff0c\u5e76\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff0cACK=1,ack=1319028629+1,SYN=1,seq=4292058564  \u7b2c\u4e09\u6b21\u63e1\u624b\uff1a\u5ba2\u6237\u7aef\u5e94\u7b54\uff0cACK=1,ack=4292058564+1 </p>"},{"location":"android/network/net_http/","title":"HTTP\u534f\u8bae","text":""},{"location":"android/network/net_http/#http","title":"HTTP","text":"<p>HTTP\u534f\u8bae\uff1a\u7528\u4e8e\u4ece\u4e07\u7ef4\u7f51\u670d\u52a1\u5668\u4f20\u8f93\u8d85\u6587\u672c\u5230\u672c\u5730\u6d4f\u89c8\u5668\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u57fa\u4e8eTCP/IP\u534f\u8bae\u6765\u4f20\u9012\u6570\u636e\uff0c\u5c5e\u4e8e\u5e94\u7528\u5c42\u9762\u5411\u5bf9\u8c61\u7684\u534f\u8bae</p>"},{"location":"android/network/net_http/#http10","title":"http1.0","text":"<p>\u65e0\u8fde\u63a5\uff0c\u9650\u5236\u6bcf\u6b21\u53ea\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5904\u7406\u5b8c\u8bf7\u6c42\u5e76\u6536\u5230\u5ba2\u6237\u7aef\u5e94\u7b54\u540e\u65ad\u5f00\u8fde\u63a5</p> <p>\u65e0\u72b6\u6001\uff0c\u4e0d\u5bf9\u8bf7\u6c42\u548c\u54cd\u5e94\u4e4b\u95f4\u7684\u72b6\u6001\u8fdb\u884c\u4fdd\u5b58</p> <p>http\u62a5\u6587</p> <p></p>"},{"location":"android/network/net_http/#http11","title":"http1.1","text":"<p>\u9ed8\u8ba4\u4f7f\u7528Connection:keep-alive\uff0c\u901a\u8fc7Content-Length\u5b57\u6bb5\u6765\u5224\u65ad\u5f53\u524d\u8bf7\u6c42\u6570\u636e\u662f\u5426\u5df2\u7ecf\u5168\u90e8\u63a5\u53d7</p>"},{"location":"android/network/net_http/#httphttps","title":"HTTP\u548cHTTPS","text":"<p>HTTPS=HTTP+SSL/TLS</p> HTTP HTTPS \u7aef\u53e3 80 443 \u5185\u5bb9 \u660e\u6587\uff0c\u4e0d\u5b89\u5168 \u52a0\u5bc6\uff0c\u5b89\u5168 \u8bc1\u4e66 \u65e0 \u9700\u8981CA\u9881\u53d1\u7684\u8bc1\u4e66 \u54cd\u5e94\u901f\u5ea6 \u76f8\u5bf9\u5feb\uff0c\u53ea\u9700\u8981\u63e1\u624b\u76843\u4e2a\u5305 \u76f8\u5bf9\u6162\uff0c\u989d\u5916\u9700\u8981SSL\u63e1\u624b\u76849\u4e2a\u5305\u517112\u4e2a\u5305 <p>\u660e\u6587\u4f20\u8f93\u7f3a\u9677</p> <ol> <li>\u7a83\u542c\u98ce\u9669\uff1a\u7b2c\u4e09\u65b9\u53ef\u4ee5\u83b7\u5f97\u901a\u4fe1\u5185\u5bb9</li> <li>\u7be1\u6539\u98ce\u9669\uff1a\u7b2c\u4e09\u65b9\u53ef\u4ee5\u4fee\u6539\u901a\u4fe1\u5185\u5bb9</li> <li>\u5192\u5145\u98ce\u9669\uff1a\u7b2c\u4e09\u65b9\u53ef\u4ee5\u5192\u5145\u8eab\u4efd\u53c2\u4e0e\u901a\u4fe1</li> </ol>"},{"location":"android/network/net_http/#ssltls","title":"SSL\u548cTLS\u534f\u8bae","text":"<p>\u89e3\u51b3\u660e\u6587\u4f20\u8f93\u7f3a\u9677</p> <ol> <li>\u52a0\u5bc6\u4f20\u64ad\uff0c\u9632\u6b62\u7a83\u542c</li> <li>\u6821\u9a8c\u673a\u5236\uff0c\u4e00\u65e6\u88ab\u7be1\u6539\uff0c\u901a\u4fe1\u53cc\u65b9\u7acb\u523b\u53d1\u73b0</li> <li>\u8eab\u4efd\u8bc1\u4e66\uff0c\u9632\u6b62\u88ab\u5192\u5145</li> </ol> <p>\u57fa\u672c\u601d\u8def\uff1a\u516c\u94a5\u52a0\u5bc6\u6cd5\uff0c\u5ba2\u6237\u7aef\u62ff\u5230\u670d\u52a1\u5668\u7684\u516c\u94a5\u5bf9\u4fe1\u606f\u52a0\u5bc6\uff0c\u670d\u52a1\u5668\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6</p> <p>TLS\u662fSSL3.0\u7684\u540e\u7eed\u7248\u672c</p> <p>SSL\u63e1\u624b</p> <ol> <li>ClientHello\uff1a\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u51fa\u52a0\u5bc6\u901a\u4fe1\u8bf7\u6c42(\u63d0\u4f9b\u652f\u6301\u7684\u534f\u8bae\u7248\u672c\u3001\u968f\u673a\u6570\u7528\u4e8e\u751f\u6210\u5bf9\u8bdd\u5bc6\u94a5\u3001\u652f\u6301\u7684\u52a0\u5bc6\u7b97\u6cd5\u5982RSA\u3001\u652f\u6301\u7684\u538b\u7f29\u65b9\u6cd5)</li> <li>ServerHello\uff1a\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\u54cd\u5e94(\u56de\u5e94\u786e\u8ba4\u4f7f\u7528\u7684\u52a0\u5bc6\u901a\u4fe1\u534f\u8bae\u7248\u672c\u3001\u968f\u673a\u6570\u7528\u4e8e\u751f\u6210\u5bf9\u8bdd\u5bc6\u94a5\u3001\u786e\u8ba4\u52a0\u5bc6\u7b97\u6cd5\u3001\u670d\u52a1\u5668\u8bc1\u4e66)</li> <li>\u5ba2\u6237\u7aef\u56de\u5e94\uff1a\u6821\u9a8c\u8bc1\u4e66\u53d6\u51fa\u516c\u94a5(\u56de\u5e94\u7528\u516c\u94a5\u52a0\u5bc6\u7684\u968f\u673a\u6570\u3001\u7f16\u7801\u66f4\u6539\u901a\u77e5\u3001\u63e1\u624b\u7ed3\u675f\u901a\u77e5)</li> <li>\u670d\u52a1\u7aef\u56de\u5e94\uff1a\u8ba1\u7b97\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5(\u53d1\u9001\u7f16\u7801\u6539\u53d8\u901a\u77e5\u3001\u670d\u52a1\u5668\u63e1\u624b\u7ed3\u675f\u901a\u77e5)</li> </ol>"},{"location":"android/network/net_http/#getpost","title":"get\u548cpost","text":"GET POST \u5728\u6d4f\u89c8\u5668\u56de\u9000 \u65e0\u5bb3 \u518d\u6b21\u63d0\u4ea4\u8bf7\u6c42 URL\u5730\u5740 \u53ef\u4ee5\u4e66\u7b7e\u6536\u85cf \u4e0d\u884c cache \u4e3b\u52a8\u7f13\u5b58 \u9ed8\u8ba4\u4e0d\u7f13\u5b58\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e \u7f16\u7801 url\u7f16\u7801 \u591a\u79cd\u7f16\u7801\u65b9\u5f0f \u5386\u53f2\u8bb0\u5f55 \u4fdd\u7559 \u4e0d\u4fdd\u7559 \u53c2\u6570\u957f\u5ea6 \u9650\u5236 \u4e0d\u9650\u5236 \u53c2\u6570\u6570\u636e\u7c7b\u578b ASCII\u5b57\u7b26 \u65e0\u9650\u5236 \u5b89\u5168 \u53c2\u6570\u66b4\u9732\u5728URL\u4e0a \u88ab\u52a0\u5bc6 \u4f20\u9012\u5f62\u5f0f \u76f4\u63a5\u5728URL\u540e\u9762 \u8bf7\u6c42\u4f53\u4e2d <p>\u672c\u8d28\u6ca1\u6709\u533a\u522b\uff0c\u90fd\u662f\u57fa\u4e8eTCP/IP\uff0c\u7531HTTP\u7684\u89c4\u5b9a\u548c\u670d\u52a1\u5668\u7684\u9650\u5236\u9020\u6210\u4e0d\u540c\u4f53\u73b0</p>"},{"location":"android/network/net_http/#url","title":"URL\u52a0\u8f7d\u539f\u7406","text":"<p>\u4e00\u6b21\u5b8c\u6574HTTP\u8bf7\u6c42 1. DNS\u57df\u540d\u89e3\u6790 2. TCP\u8fde\u63a5\uff0cSSL\u63e1\u624b 3. \u53d1\u9001HTTP/HTTPS\u8bf7\u6c42 4. \u670d\u52a1\u7aef\u5904\u7406\u8bf7\u6c42\u5e76\u8fd4\u56de\u62a5\u6587 5. \u6d4f\u89c8\u5668\u89e3\u6790\u5e76\u6e32\u67d3\u9875\u9762 6. HTTP\u8fde\u63a5\u65ad\u5f00</p> <p>http2.0\u51fa\u73b0keep-alive\u53ef\u4ee5\u4f7f\u7b2c6\u6b65\u4e0d\u5173\u95ed</p>"},{"location":"android/network/net_http/#_1","title":"\u65ad\u70b9\u7eed\u4f20\u539f\u7406","text":"<p>\u5229\u7528HTTP\u8bf7\u6c42\u4e2d\u7684Range\u5b57\u6bb5</p> <p>retrofit\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528@Header(\"Range\")\uff0c\u5bf9\u5e94\u6570\u636e\"bytes=xxx-xxx\"\uff0c\u4ece\u7b2cxxx\u5b57\u8282\u5f00\u59cb\u5230xxx\u5b57\u8282\u7ed3\u675f\uff0c\u7ed3\u675f\u53ef\u7701\u7565\u5373\"bytes=xxx\"</p> <p>\u4e5f\u53ef\u4ee5\u5229\u7528okhttp\u62e6\u622a\u5668\uff0caddHeader(\"RANGE\",\"bytes=${start}\")</p> <p>\u5199\u5165\u6587\u4ef6\u65f6\u5229\u7528FileOutputStream(file, true)\u7684append\u6a21\u5f0f\u5373\u53ef</p>"},{"location":"android/network/net_http/#_2","title":"\u8bf7\u6c42\u65b9\u5f0f","text":"<p>\u5e42\u7b49\uff1a\u591a\u6b21\u8bf7\u6c42\u76f8\u540c\u7684URL\u4f1a\u5f97\u5230\u76f8\u540c\u7684\u7ed3\u679c</p> <p>GET\u8bf7\u6c42\uff1a \u83b7\u53d6\u6570\u636e\uff0c\u53c2\u6570\u9644\u52a0\u5728URL\u4e2d\uff0c\u662f\u5e42\u7b49\u7684</p> <p>\u9002\u7528\u4e8e\u8bfb\u53d6\u8d44\u6e90\u548c\u67e5\u8be2\u6570\u636e\uff0c\u4f46\u4e0d\u5e94\u7528\u4e8e\u63d0\u4ea4\u654f\u611f\u4fe1\u606f\u6216\u4ea7\u751f\u526f\u4f5c\u7528\u7684\u64cd\u4f5c\u3002</p> <p>POST\u8bf7\u6c42\uff1a\u63d0\u4ea4\u6570\u636e\u3002\u53c2\u6570\u5305\u542b\u5728\u8bf7\u6c42\u4e3b\u4f53\u4e2d\uff0c\u4e0d\u662f\u5e42\u7b49\u7684</p> <p>\u9002\u5408\u7528\u4e8e\u521b\u5efa\u65b0\u8d44\u6e90\u3001\u63d0\u4ea4\u8868\u5355\u6570\u636e\u6216\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c</p> <p>\u9002\u7528\u4e8e\u5904\u7406\u654f\u611f\u4fe1\u606f\uff0c\u5982\u7528\u6237\u767b\u5f55\u3001\u6ce8\u518c\u7b49\u3002</p> <p>PUT\u8bf7\u6c42\uff1a\u66f4\u65b0\u8d44\u6e90\uff0c\u662f\u5e42\u7b49\u7684</p> <p>\u9002\u7528\u4e8e\u5bf9\u8d44\u6e90\u8fdb\u884c\u5168\u9762\u66ff\u6362\u7684\u60c5\u51b5\uff0c\u4f8b\u5982\u66f4\u65b0\u7528\u6237\u4fe1\u606f\u3001\u4fee\u6539\u6587\u7ae0\u5185\u5bb9\u7b49\u3002</p> <p>DELETE\u8bf7\u6c42\uff1a\u5220\u9664\u8d44\u6e90\uff0c\u662f\u5e42\u7b49\u7684</p> <p>\u9002\u7528\u4e8e\u5220\u9664\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u5220\u9664\u7528\u6237\u3001\u5220\u9664\u6587\u7ae0\u7b49\u3002</p> <p>PATCH\u8bf7\u6c42\uff1a\u5bf9\u8d44\u6e90\u8fdb\u884c\u5c40\u90e8\u66f4\u65b0\u3002\u4e0ePUT\u8bf7\u6c42\u7c7b\u4f3c\uff0c\u53ea\u66f4\u65b0\u8d44\u6e90\u7684\u4e00\u90e8\u5206\u5185\u5bb9</p> <p>\u9002\u7528\u4e8e\u53ea\u9700\u8981\u66f4\u65b0\u8d44\u6e90\u7684\u67d0\u4e9b\u5c5e\u6027\u6216\u5b57\u6bb5\u7684\u60c5\u51b5\uff0c\u800c\u4e0d\u9700\u8981\u66ff\u6362\u6574\u4e2a\u8d44\u6e90\u3002</p> <p>OPTIONS\u8bf7\u6c42\uff1a\u83b7\u53d6\u670d\u52a1\u5668\u652f\u6301\u7684HTTP\u65b9\u6cd5\u548c\u8d44\u6e90\u7684\u76f8\u5173\u4fe1\u606f</p> <p>\u901a\u5e38\u7528\u4e8e\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u4ee5\u4fbf\u786e\u5b9a\u53ef\u7528\u7684\u4ea4\u4e92\u9009\u9879\u3002</p> <p>HEAD\u8bf7\u6c42\uff1a\u7c7b\u4f3c\u4e8eGET\u8bf7\u6c42\uff0c\u4f46\u53ea\u8fd4\u56de\u54cd\u5e94\u5934\uff0c\u4e0d\u8fd4\u56de\u5b9e\u4f53\u5185\u5bb9\u3002\u901a\u8fc7\u53d1\u9001HEAD\u8bf7\u6c42\uff0c\u53ef\u4ee5\u83b7\u53d6\u8d44\u6e90\u7684\u5143\u4fe1\u606f\uff0c\u5982\u6587\u4ef6\u5927\u5c0f\u3001\u4fee\u6539\u65e5\u671f\u7b49\u3002</p> <p>\u901a\u5e38\u7528\u4e8e\u68c0\u67e5\u8d44\u6e90\u662f\u5426\u5b58\u5728\u3001\u83b7\u53d6\u8d44\u6e90\u7684\u57fa\u672c\u4fe1\u606f\u7b49\u573a\u666f\u3002</p> <p>TRACE\u8bf7\u6c42\uff1a\u7528\u4e8e\u56de\u663e\u670d\u52a1\u5668\u6536\u5230\u7684\u8bf7\u6c42\u3002\u901a\u8fc7\u53d1\u9001TRACE\u8bf7\u6c42\uff0c\u53ef\u4ee5\u5728\u8bf7\u6c42-\u54cd\u5e94\u94fe\u8def\u4e0a\u8ddf\u8e2a\u8bf7\u6c42\u7684\u5904\u7406\u8fc7\u7a0b\uff0c\u5e76\u68c0\u67e5\u4ee3\u7406\u6216\u670d\u52a1\u5668\u5bf9\u8bf7\u6c42\u7684\u4fee\u6539\u60c5\u51b5\u3002</p> <p>\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u548c\u8bca\u65ad\uff0c\u4ee5\u4fbf\u4e86\u89e3\u8bf7\u6c42\u5728\u670d\u52a1\u5668\u7aef\u7684\u5904\u7406\u60c5\u51b5\u3002</p> <p>CONNECT\u8bf7\u6c42\uff1a\u7528\u4e8e\u5efa\u7acb\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u96a7\u9053\u8fde\u63a5\uff0c\u901a\u5e38\u7528\u4e8e\u8fdb\u884c\u5b89\u5168\u7684SSL/TLS\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p>\u4e3b\u8981\u7528\u4e8e\u4ee3\u7406\u670d\u52a1\u5668\u4e0e\u76ee\u6807\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u4ee5\u786e\u4fdd\u5b89\u5168\u8fde\u63a5\u7684\u5efa\u7acb\u3002</p>"},{"location":"android/network/net_okhttp/","title":"Net okhttp","text":"<p>Okhttp\u9ed8\u8ba4\u63d0\u4f9bget head post put delete patch</p> <p>\u652f\u6301\u534f\u8bae</p> <p>\u7c7b\uff1aProtocol</p> <ul> <li>HTTP_1_0(\"http/1.0\")</li> <li>HTTP_1_1(\"http/1.1\")</li> <li>SPDY_3(\"spdy/3.1\")\u5e9f\u5f03\u6539\u7528HTTP_2(\"h2\") </li> <li>H2_PRIOR_KNOWLEDGE(\"h2_prior_knowledge\")\u5c31\u662fHTTP_2\u4e0d\u52a0\u5bc6\u7248\u672c</li> <li>QUIC(\"quic\")\u5c31\u662fHTTP3\uff0c\u57fa\u4e8eUDP\u5b9e\u73b0</li> </ul> <pre><code>,\n\n[rfc_7230]: https://tools.ietf.org/html/rfc7230\n,\n\n@Deprecated(\"OkHttp has dropped support for SPDY. Prefer {@link #HTTP_2}.\")\n,\n\nHTTP_2(\"h2\"),\n[rfc_7540_34]: https://tools.ietf.org/html/rfc7540.section-3.4\n\nH2_PRIOR_KNOWLEDGE(\"h2_prior_knowledge\"),\n\nQUIC(\"quic\");\n</code></pre>"},{"location":"android/network/net_socket/","title":"Socket","text":""},{"location":"android/network/net_socket/#cppsocket","title":"cpp\u5c42Socket","text":"<p>\u670d\u52a1\u7aef</p> <p>ServerSocket</p> <p>\u5ba2\u6237\u7aef</p> <p>\u7ebf\u7a0b\u6c60</p> <p>ThreadPool</p>"},{"location":"android/network/net_socket/#javasocket","title":"java\u5c42Socket","text":""},{"location":"android/performance/android_anr/","title":"ANR\u76d1\u63a7","text":""},{"location":"android/performance/android_anr/#anr","title":"ANR\u7c7b\u578b","text":"\u7c7b\u578b \u4ea7\u751f\u6761\u4ef6 logcat\u5173\u952e\u5b57 KeyDispatch Timeout input\u4e8b\u4ef65s\u5185\u672a\u5904\u7406\u5b8c Input event dispatching timed out Broadcast Timeout onReceive(\u524d\u53f0\u5e7f\u64ad10s\u3001\u540e\u53f060s)\u672a\u5904\u7406\u5b8c Timeout of broadcast BroaddcastRecord Service Timeout onCreate\u3001onBind\u7b49\u751f\u547d\u5468\u671f(\u524d\u53f0\u670d\u52a120s\u3001\u540e\u53f0200s)\u672a\u5904\u7406\u5b8c Timeout exxecuting service ContentProvider Timeout 10s\u672a\u5904\u7406\u5b8c timeout publishing content providers"},{"location":"android/performance/android_anr/#anr_1","title":"ANR\u5e38\u89c1\u539f\u56e0","text":"<ol> <li>\u4e3b\u7ebf\u7a0b\u9891\u7e41\u8fdb\u884c\u8017\u65f6IO\u64cd\u4f5c</li> <li>\u591a\u7ebf\u7a0b\u64cd\u4f5c\u7684\u6b7b\u9501\uff0c\u4e3b\u7ebf\u7a0b\u88abblock</li> <li>\u4e3b\u7ebf\u7a0b\u88abBinder\u5bf9\u7aefblock</li> <li>System Server\u4e2dWatchDog</li> <li>service binder\u7684\u8fde\u63a5\u8fbe\u5230\u4e0a\u9650\u65e0\u6cd5\u548cSystem Server\u901a\u4fe1</li> <li>\u7cfb\u7edf\u8d44\u6e90\u8017\u5c3d</li> </ol>"},{"location":"android/performance/android_anr/#_1","title":"\u5904\u7406\u624b\u6bb5","text":""},{"location":"android/performance/android_anr/#_2","title":"\u7ebf\u4e0b","text":"<ol> <li>\u901a\u8fc7logcat\u548c/data/anr/trace_*.txt\u6587\u4ef6\u5b9a\u4f4d\u786e\u5b9aanr\u65f6\u95f4\u70b9</li> <li>CPU\u4f7f\u7528\u7387</li> <li>\u4e3b\u7ebf\u7a0b\u72b6\u6001\u3001\u5176\u4ed6\u7ebf\u7a0b\u72b6\u6001</li> </ol> <p>\u5173\u952e\u4fe1\u606f\uff1aANR\u65f6\u95f4\u3001\u8fdb\u7a0bpid\u3001\u8fdb\u7a0b\u540d\u3001ANR\u7c7b\u578b</p>"},{"location":"android/performance/android_anr/#_3","title":"\u7ebf\u7a0b\u72b6\u6001","text":"<p>UNDEFINED=-1</p> <p>ZOMBIDE=0//terminated</p> <p>RUNNING=1</p> <p>TIMED_WAIT=2</p> <p>MONITOR=3//blocked</p> <p>WAIT=4</p> <p>INITIALIZING=5</p> <p>STARTING=6</p> <p>NATIVE=7</p> <p>VMWAIT=8</p> <p>SUSPENDED=9</p> <p>java\u4e2dThread\u5c01\u88c5\u7684\u751f\u547d\u5468\u671f</p>"},{"location":"android/performance/android_anr/#_4","title":"\u7ebf\u4e0a","text":"<p>\u901a\u8fc7\u53cb\u76df\u3001bugly\u7b49\u76d1\u63a7\uff0c\u63d0\u53d6\u65e5\u5fd7\u624b\u673a\u914d\u7f6e\u4fe1\u606f\u5927\u81f4\u5b9a\u4f4d\uff0c\u6709\u6761\u4ef6\u53ef\u672c\u5730\u590d\u73b0</p>"},{"location":"android/performance/android_anr/#anr_2","title":"\u81ea\u884c\u5b9e\u73b0ANR\u76d1\u542c","text":"<p>1.\u5229\u7528FileObserver\uff0c\u4f46\u53d7selinux\u9650\u5236\uff0c\u7cfb\u7edf\u5f00\u53d1\u4e0d\u5f71\u54cd\uff0c\u4e09\u65b9app\u4e0d\u884c <pre><code>class AnrObserver : FileObserver {\nconstructor(path: String) : super(path)\n\n@RequiresApi(Build.VERSION_CODES.Q)\nconstructor(file: File) : super(file)\n\noverride fun onEvent(event: Int, path: String?) {\nwhen (event) {\nACCESS -&gt; {}//\u6587\u4ef6\u88ab\u8bbf\u95ee\nATTRIB -&gt; {}//\u6587\u4ef6\u5c5e\u6027\u88ab\u4fee\u6539\uff0c\u5982chmod\u3001chown\u3001touch\u7b49\nCLOSE_NOWRITE -&gt; {}//\u4e0d\u53ef\u5199\u6587\u4ef6\u88abclose\nCLOSE_WRITE -&gt; {}//\u53ef\u5199\u6587\u4ef6\u88abclose\nCREATE -&gt; {}//\u521b\u5efa\u65b0\u6587\u4ef6\nDELETE -&gt; {}//\u6587\u4ef6\u88ab\u5220\u9664\nDELETE_SELF -&gt; {}//\u81ea\u5220\u9664\uff0c\u5373\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u5728\u6267\u884c\u65f6\u5220\u9664\u81ea\u5df1\nMODIFY -&gt; {}//\u6587\u4ef6\u88ab\u4fee\u6539\nMOVE_SELF -&gt; {}//\u81ea\u79fb\u52a8\uff0c\u5373\u4e00\u4e2a\u53ef\u6307\u5411\u6027\u6587\u4ef6\u5728\u6267\u884c\u65f6\u79fb\u52a8\u81ea\u5df1\nMOVED_FROM -&gt; {}//\u6587\u4ef6\u88ab\u79fb\u8d70\uff0c\u5982mv\nMOVED_TO -&gt; {}//\u6587\u4ef6\u88ab\u79fb\u6765\uff0c\u5982mv\u3001cp\nOPEN -&gt; {}//\u6587\u4ef6\u88ab\u6253\u5f00\nelse -&gt; {}//ALL_EVENTS\u5305\u62ec\u4ee5\u4e0a\u6240\u6709\u4e8b\u4ef6\n}\n}\n}\n</code></pre> \u8c03\u7528startWatching\u548cstopWatching\u6765\u542f\u52a8\u76d1\u542c</p> <p>2.\u53c2\u8003\u7cfb\u7edf\u7684WatchDog\u5b9e\u73b0</p> <p>\u539f\u7406\u662f\u4f7f\u7528Handler\u6bcf\u4e2a5s\u6267\u884c\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\uff0c\u5982\u679c\u80fd\u6267\u884c\u6210\u529f\u5219\u6ca1\u6709\u51fa\u73b0ANR</p> <p><pre><code>class ANRWatchDog private constructor() : Thread(\"ANR-WatchDog-Thread\") {\ncompanion object {\nval TAG: String = \"ANR\"\nval TIMEOUT: Long = 5000L\nval instance: ANRWatchDog = Holder.instance\n}\n\nprivate var ignoreDebugger: Boolean = true\n\nprivate val mainHandler by lazy { Handler(Looper.getMainLooper()) }\n\nprivate val anrChecker: ANRChecker by lazy { ANRChecker() }\n\nprivate val lock = Object()\n\nvar onAnrHappened: ((stackTraceInfo: String) -&gt; Unit)? = null\n\noverride fun run() {\nProcess.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND) //\u540e\u53f0\u7ebf\u7a0b\nwhile (true) {\nwhile (!isInterrupted) {\nsynchronized(lock) {\nanrChecker.schedule()\nvar waitTime = TIMEOUT\nval start = SystemClock.uptimeMillis()\nwhile (waitTime &gt; 0) {\ntry {\nlock.wait(waitTime)\n} catch (e: InterruptedException) {\nLog.w(TAG, e.toString())\n}\nwaitTime = TIMEOUT - (SystemClock.uptimeMillis() - start)\n}\n}\nif (!anrChecker.isBlocked()) {\ncontinue\n}\nif (!ignoreDebugger &amp;&amp; Debug.isDebuggerConnected()) {\ncontinue\n}\nonAnrHappened?.invoke(getStackTraceInfo())\n}\nonAnrHappened = null\n}\n}\n\nprivate fun getStackTraceInfo(): String {\nval sb = StringBuilder()\nfor (stElement in Looper.getMainLooper().thread.stackTrace) {\nsb.append(stElement.toString()).append(\"\\r\\n\")\n}\nreturn sb.toString()\n}\n\nprivate object Holder {\nval instance: ANRWatchDog = ANRWatchDog()\n}\n\nprivate inner class ANRChecker : Runnable {\nprivate var completed: Boolean = false\nprivate var startTime: Long = 0\nprivate var executeTime: Long = SystemClock.uptimeMillis()\n\noverride fun run() {\nsynchronized(lock) {\ncompleted = true\nexecuteTime = SystemClock.uptimeMillis()\n}\n}\n\nfun schedule() {\ncompleted = false\nstartTime = SystemClock.uptimeMillis()\nmainHandler.postAtFrontOfQueue(this@ANRChecker)\n}\n\nfun isBlocked(): Boolean = !completed || executeTime - startTime &gt;= 5000L\n}\n}\n</code></pre> \u6d4b\u8bd5\u4ee3\u7801 <pre><code>ANRWatchDog.instance.apply {\nonAnrHappened = { info: String -&gt;\nLog.e(\"tag\", \"info: $info\")\n}\nstart()\n}\nval handler = Handler()\nhandler.postDelayed({\nThread.sleep(1000 * 10)\n}, 3000)\n</code></pre> ANRWatchDog-java\u7248\u672c</p>"},{"location":"android/performance/android_apk_cut/","title":"\u7626\u8eab\u4f18\u5316","text":""},{"location":"android/performance/android_apk_cut/#_1","title":"\u5f00\u542f\u8d44\u6e90\u4f18\u5316","text":"<pre><code>buildTypes {\n    signingConfigs {\n        release {\n            storeFile file('E:\\\\Software\\\\AndroidStudio\\\\default.jks')\n            storePassword '112233'\n            keyAlias 'key0'\n            keyPassword '123456'\n        }\n    }\n    release {\n        minifyEnabled true\n        shrinkResources true\n        signingConfig signingConfigs.release\n        proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n    }\n}\n</code></pre>"},{"location":"android/performance/android_apk_cut/#_2","title":"\u81ea\u5b9a\u4e49\u4fdd\u7559\u8d44\u6e90","text":"<p>\u8def\u5f84\uff1ares/raw/keep.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;resources xmlns:tools=\"http://schemas.android.com/tools\" tools:discard=\"@layout/unused\" tools:keep=\"@layout/used*_a,@layout/used_b\" /&gt;\n</code></pre> keep\uff1a\u6307\u5b9a\u4fdd\u7559\u7684\u8d44\u6e90</p> <p>discard\uff1a\u6307\u5b9a\u8981\u820d\u5f03\u7684\u8d44\u6e90</p> <p>\u90fd\u662f\u7528\uff0c\u5206\u5272\uff0c\u53ef\u7528\u901a\u914d\u7b26*</p>"},{"location":"android/performance/android_apk_cut/#_3","title":"\u56fd\u9645\u5316\u7cbe\u7b80","text":"<pre><code>defaultConfig {\n    //...\n    resConfigs(\"zh-rCN\")\n}\n</code></pre>"},{"location":"android/performance/android_apk_cut/#_4","title":"\u52a8\u6001\u5e93\u914d\u7f6e","text":"<p><pre><code>defaultConfig {\n    //...\n    ndk {\n        abiFilters 'armeabi-v7a'\n    }\n}\n</code></pre> \u603b\u5171\u652f\u63014\u79cd\uff1aarmeabi-v7a\uff0carm64-v8a\uff0cx86\uff0cx86_64\uff0c\u4e00\u822c\u624b\u673a\u90fd\u662farm\u67b6\u6784</p>"},{"location":"android/performance/android_apk_cut/#_5","title":"\u5206\u5305\u6253\u5305","text":"<p>\u65b9\u5f0f\u4e00(\u8fc7\u65f6) <pre><code>flavorDimensions \"default\"\nproductFlavors {\n    arm32 {\n        dimension \"default\"\n        ndk {\n            abiFilters 'armeabi-v7a'\n        }\n    }\n    x86 {\n        dimension \"default\"\n        ndk {\n            abiFilters 'x86_64'\n        }\n    }\n}\n</code></pre> \u6253\u5305\u5b8c\u5728output\u76ee\u5f55</p> <p></p> <p>\u65b9\u5f0f\u4e8c(\u63a8\u8350) <pre><code>splits {\n    abi{\n        enable true\n        reset()\n        include 'armeabi-v7a', 'x86_64'\n        universalApk true // \u5305\u542b\u5168\u90e8\u67b6\u6784\n    }\n}\n</code></pre> \u6253\u5305\u5b8c\u5728output\u76ee\u5f55</p> <p></p>"},{"location":"android/performance/android_apk_cut/#_6","title":"\u56fe\u7247\u8d44\u6e90\u5904\u7406","text":"<ol> <li>png\u3001jpeg\u8f6cwebp\uff0c\u6700\u597d\u4f7f\u7528\u7f51\u7edc\u56fe\u7247</li> <li>\u77e2\u91cf\u56fe(\u5c0f\u56fe\u6807\u4f7f\u7528)\uff0cImageView\u7ed3\u5408\u4f7f\u7528tint\u5c5e\u6027\u4fee\u6539\u56fe\u6807\u989c\u8272</li> <li>mipmap-x\uff0cdrawable-x\u76ee\u5f55\u914d\u5408\u5c4f\u5e55\u9002\u914d\u53ef\u7cbe\u7b80</li> </ol>"},{"location":"android/performance/android_apk_cut/#_7","title":"\u4ee3\u7801\u6df7\u6dc6","text":"<p>res\u6df7\u6dc6\uff1ahttps://github.com/shwenzhang/AndResGuard</p> <p>java\u6df7\u6dc6\uff1aminifyEnabled \u7f6e\u4e3a true</p> <p>-keep class androidx.lifecycle.** { *; }</p>"},{"location":"android/performance/android_bitmap/","title":"Bitmap\u4f18\u5316","text":""},{"location":"android/performance/android_bitmap/#bitmap","title":"Bitmap","text":"<p>\u56fe\u7247\u5360\u7528\u5185\u5b58\u5927\u5c0f\u8ba1\u7b97\uff1a\u5206\u8fa8\u7387x\u50cf\u7d20\u70b9\u5927\u5c0f</p> <p>\u7f16\u7801\u6a21\u5f0f\uff1a</p> <p>RGB_565\uff1a16\u4f4d\uff0c2\u4e2a\u5b57\u8282(byte)</p> <p>ARGB_8888\uff1a32\u4f4d\uff0c4\u4e2a\u5b57\u8282(byte)</p> <p>100*100\u7684\u56fe\u7247\u5360\u7528\u5185\u5b58\uff1a100x100x2(4) = 20000(40000)byte</p> <p>\u6ce8\u610f\uff1a\u5360\u7528\u5927\u5c0f\u548c\u6587\u4ef6\u5927\u5c0f\u4e0d\u76f8\u7b49</p> <p>Android\u4e2d\u52a0\u8f7dBitmap\u4f7f\u7528BitmapFactory.decodeResource\u4ece\u8d44\u6e90\u6587\u4ef6\u4e2d\u52a0\u8f7d\u65f6\u4f1a\u8fdb\u884c\u4e00\u6b21\u8f6c\u5316</p> \u5bc6\u5ea6 ldpi mdpi hdpi xhdpi xxhdpi xxxhdpi \u5bc6\u5ea6\u503c 120 160(\u57fa\u7ebf) 240 320 480 640 \u5206\u8fa8\u7387 240x320 320x480 480x800/480x854 1280x720 1920x1080 3840x2160 \u56fe\u7247\u5927\u5c0f 36x36 48x48 72x72 96x96 144x144 192x192 <p>\u8f6c\u5316\u516c\u5f0f\uff1a\u5206\u8fa8\u7387x(\u8bbe\u5907dpi/\u76ee\u5f55dpi)</p> <p>\u5982\u8bbe\u5907dpi\u4e3a480\uff0cxhdpi\u76ee\u5f55120x160\u7684\u56fe\u7247\u5185\u5b58\u5927\u5c0f\u4e3a</p> <p>120x(480/320)x160(480/320) = 43200byte=42kb</p> <p>https://developer.android.com/topic/performance/graphics/cache-bitmap?hl=zh-cn</p> <p>https://developer.android.com/topic/performance/graphics?hl=zh-cn</p>"},{"location":"android/performance/android_bitmap/#_1","title":"\u9ad8\u6548\u52a0\u8f7d\u5927\u578b\u4f4d\u56fe","text":""},{"location":"android/performance/android_bitmap/#_2","title":"\u8bfb\u53d6\u4f4d\u56fe\u5c3a\u5bf8\u548c\u7c7b\u578b","text":"<p><pre><code>val options = BitmapFactory.Options().apply {\ninJustDecodeBounds = true//\u53ef\u907f\u514d\u5185\u5b58\u5206\u914d\uff0c\u4e3a\u4f4d\u56fe\u5bf9\u8c61\u8fd4\u56de null\n}\nBitmapFactory.decodeResource(resources, R.id.myimage, options)\nval imageHeight: Int = options.outHeight\nval imageWidth: Int = options.outWidth\nval imageType: String = options.outMimeType\n</code></pre> \u8fdb\u884c\u89e3\u7801\u524d\u5148\u8bfb\u53d6\u5c3a\u5bf8\u9632\u6b62OOM</p>"},{"location":"android/performance/android_bitmap/#_3","title":"\u6309\u6bd4\u4f8b\u538b\u7f29","text":"<pre><code>fun calculateInSampleSize(options: BitmapFactory.Options, reqWidth: Int, reqHeight: Int): Int {\nval (height: Int, width: Int) = options.run { outHeight to outWidth }\nvar inSampleSize = 1\nif (height &gt; reqHeight || width &gt; reqWidth) {\nval halfHeight: Int = height / 2\nval halfWidth: Int = width / 2\nwhile (halfHeight / inSampleSize &gt;= reqHeight &amp;&amp; halfWidth / inSampleSize &gt;= reqWidth) {\ninSampleSize *= 2\n}\n}\n\nreturn inSampleSize\n}\n</code></pre>"},{"location":"android/performance/android_bitmap/#_4","title":"\u6574\u4f53\u6d41\u7a0b","text":"<p>\u5c06\u4efb\u610f\u5927\u5c3a\u5bf8\u7684\u4f4d\u56fe\u52a0\u8f7d\u5230\u663e\u793a 100x100 \u50cf\u7d20\u7f29\u7565\u56fe\u7684 ImageView \u4e2d <pre><code>fun decodeSampledBitmapFromResource(\nres: Resources,\nresId: Int,\nreqWidth: Int,\nreqHeight: Int\n): Bitmap {\nreturn BitmapFactory.Options().run {\ninJustDecodeBounds = true\nBitmapFactory.decodeResource(res, resId, this)\n\ninSampleSize = calculateInSampleSize(this, reqWidth, reqHeight)\n\ninJustDecodeBounds = false\n\nBitmapFactory.decodeResource(res, resId, this)\n}\n}\n\nimageView.setImageBitmap(\ndecodeSampledBitmapFromResource(resources, R.id.xxx, 100, 100)\n)\n</code></pre></p>"},{"location":"android/performance/android_bitmap/#_5","title":"\u7f13\u5b58\u4f4d\u56fe","text":""},{"location":"android/performance/android_bitmap/#_6","title":"\u5185\u5b58\u7f13\u5b58","text":"<p>LruCache \u7c7b\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\u8f6f\u5f15\u7528\u6216\u5f31\u5f15\u7528\u5bb9\u6613\u88ab\u56de\u6536</p> <p>\u9009\u62e9\u7b56\u7565</p> <ol> <li>\u5f53\u524dapp\u5185\u5b58\u5360\u7528\u60c5\u51b5(\u53ef\u80fd\u5373\u5c06\u8fbe\u5230\u8fdb\u7a0b\u6240\u80fd\u7533\u8bf7\u7684\u6700\u5927\u5185\u5b58)</li> <li>\u5c4f\u5e55\u663e\u793a\u56fe\u7247\u6570\u91cf(\u5217\u8868\u4e2d\u663e\u793a\u573a\u666f)</li> <li>\u5c4f\u5e55\u5c3a\u5bf8\u548c\u5bc6\u5ea6(\u5206\u8fa8\u7387\u548cdpi\u5f71\u54cd\u8ba1\u7b97\u5185\u5b58\u5927\u5c0f)</li> <li>\u4f4d\u56fe\u5c3a\u5bf8\u548c\u914d\u7f6e(\u539f\u56fe\u5927\u5c0f\uff0c\u7f16\u7801\u6a21\u5f0f\uff0c\u538b\u7f29)</li> <li>\u56fe\u7247\u8bbf\u95ee\u9891\u7387</li> <li>\u8d28\u91cf\u548c\u6570\u91cf\u4e4b\u95f4\u7684\u5e73\u8861</li> </ol> <p>\u4f7f\u7528\u4f8b\u5b50\uff0c\u5206\u914d\u6700\u5927\u5185\u5b58\u7684\u215b <pre><code>private lateinit var memoryCache: LruCache&lt;String, Bitmap&gt;\n\noverride fun onCreate(savedInstanceState: Bundle?) {\nval maxMemory = (Runtime.getRuntime().maxMemory() / 1024).toInt()\n\nval cacheSize = maxMemory / 8\nmemoryCache = object : LruCache&lt;String, Bitmap&gt;(cacheSize) {\noverride fun sizeOf(key: String, bitmap: Bitmap): Int {\nreturn bitmap.byteCount / 1024\n}\n}\n}\n</code></pre></p>"},{"location":"android/performance/android_bitmap/#_7","title":"\u78c1\u76d8\u7f13\u5b58","text":"<p>DiskLruCache</p>"},{"location":"android/performance/android_bitmap/#_8","title":"\u56fe\u7247\u52a0\u8f7d\u6846\u67b6\u8bbe\u8ba1\u601d\u8def","text":"<ul> <li>\u91c7\u6837\u7387\u538b\u7f29(inSampleSize)\uff0c\u5c3a\u5bf8\u538b\u7f29</li> <li>bitmap\u7f16\u7801\u683c\u5f0fARGB_8888\u7b49</li> <li>\u52a0\u8f7d\u65b9\u5f0f\uff1a\u534f\u7a0b\u7528\u6765\u5f02\u6b65\u52a0\u8f7d\u548c\u7ebf\u7a0b\u5207\u6362</li> <li>\u591a\u7ea7\u7f13\u5b58\uff1aLruCache\u3001\u5bf9\u8c61\u590d\u7528\u6c60\u3001DiskLruCache</li> <li>\u5185\u5b58\u6cc4\u6f0fOOM\uff1a\u751f\u547d\u5468\u671f\u76d1\u542c\uff0c\u4f4e\u5185\u5b58\u65f6\u91ca\u653e</li> <li>\u5217\u8868\u52a0\u8f7d\uff1a\u9519\u4e71\u95ee\u9898</li> </ul> <p>Glide\u5df2\u7ecf\u5b8c\u6210\u4f18\u5316</p>"},{"location":"android/performance/android_blockcanary/","title":"Android blockcanary","text":"<p>\u5b98\u7f51\uff1ahttps://github.com/markzhai/AndroidPerformanceMonitor</p> <p>\u63a5\u5165\u65b9\u5f0f\uff1a <pre><code>implementation 'com.github.markzhai:blockcanary-android:1.5.0'\n</code></pre></p>"},{"location":"android/performance/android_blockcanary/#_1","title":"\u5b9e\u73b0\u539f\u7406","text":"<p>Android\u6d88\u606f\u673a\u5236\u91c7\u7528\u7684\u662fHandler\uff0c\u5229\u7528Handler\u5904\u7406Message\u65f6\u7684\u6253\u5370\u63a5\u53e3</p> <p>\u5728Looper\u7684loop\u65b9\u6cd5\u4e2d\u7684loopOnce\u65b9\u6cd5\u5206\u53d1msg\u65f6\u6709\u4e00\u4e2aPrinter\u5bf9\u8c61(\u63a5\u53e3) <pre><code>if (logging != null) {\nlogging.println(\"&gt;&gt;&gt;&gt;&gt; Dispatching to \" + msg.target + \" \"\n+ msg.callback + \": \" + msg.what);\n}\n//...\nmsg.target.dispatchMessage(msg);//\u56de\u8c03Handler\u5904\u7406\u6d88\u606f\n//...\nif (logging != null) {\nlogging.println(\"&lt;&lt;&lt;&lt;&lt; Finished to \" + msg.target + \" \" + msg.callback);\n}\n</code></pre> \u5ba2\u6237\u7aef\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e\u4e00\u4e2aPrinter\u5bf9\u8c61\uff0c\u5229\u7528\u5148\u540e\u4e24\u6b21println\u65b9\u6cd5\u56de\u8c03\uff0c\u53ef\u4ee5\u8bb0\u5f55\u65f6\u95f4\u6233 <pre><code>public void setMessageLogging(@Nullable Printer printer) {\nmLogging = printer;\n}\n</code></pre></p>"},{"location":"android/performance/android_blockcanary/#_2","title":"\u7f3a\u9677","text":"<p>\u7c92\u5ea6\u592a\u5927\uff0c\u4e0d\u7cbe\u51c6\uff0c\u5047\u8bbe\u8c03\u7528\u94fe\u4e3a\u65b9\u6cd5a\u3001b\u3001c\uff0c\u5206\u522b\u8017\u65f6400\u300125\u300175\uff0c\u65e0\u6cd5\u786e\u5b9a\u662f\u54ea\u4e2a\u65b9\u6cd5\u8017\u65f6\u957f</p> <p>\u89e3\u51b3\u65b9\u6848</p>"},{"location":"android/performance/android_crash/","title":"Crash\u76d1\u63a7","text":""},{"location":"android/performance/android_crash/#java-crash","title":"java crash\u76d1\u63a7","text":""},{"location":"android/performance/android_crash/#_1","title":"\u7ebf\u4e0b","text":"<p>\u76f4\u63a5\u901a\u8fc7logcat\u5b9a\u4f4d</p>"},{"location":"android/performance/android_crash/#_2","title":"\u7ebf\u4e0a","text":"<p>\u5b9e\u73b0\u539f\u7406\uff1a\u6ce8\u518c\u81ea\u5df1\u7684\u76d1\u542c\uff0c\u7cfb\u7edf\u63d0\u4f9b\u6355\u83b7\u5f02\u5e38\u76d1\u542c\u63a5\u53e3</p> <p>\u9ed8\u8ba4\u5728RuntimeInit\u4e2d\u8bbe\u7f6e(KillApplicationHandler) <pre><code>Thread.setDefaultUncaughtExceptionHandler(new KillApplicationHandler(loggingHandler))\n</code></pre></p> <p>\u81ea\u5b9a\u4e49\u5904\u7406 <pre><code>class CrashHandler : UncaughtExceptionHandler {\nprivate var defaultUncaughtExceptionHandler: UncaughtExceptionHandler? = null\n\ninit {\ndefaultUncaughtExceptionHandler = Thread.getDefaultUncaughtExceptionHandler()\nThread.setDefaultUncaughtExceptionHandler(this)//\u66ff\u6362\u6389\u9ed8\u8ba4KillApplicationHandler\n}\n\noverride fun uncaughtException(t: Thread, e: Throwable) {\nval dir = File(BaseApplication.instance.externalCacheDir, \"crash_info\")\nif (!dir.exists()) {\ndir.mkdirs()\n}\ntry {\n//\u5b58\u5230\u672c\u5730\u4e5f\u53ef\u4ee5\u4e0a\u4f20\u5230\u670d\u52a1\u5668\nval logFile = File(dir,  \"${System.currentTimeMillis()}.txt\")\nval pw = PrintWriter(FileWriter(logFile))\npw.println(\"thread: ${t.name}\")\ne.printStackTrace(pw)\npw.flush()\npw.close()\n} catch (e: Exception) {\ne.printStackTrace()\n} finally {\ndefaultUncaughtExceptionHandler?.uncaughtException(t, e)\n}\n}\n}\n</code></pre> crash\u6587\u4ef6\u4f1a\u5728/sdcard/Android/cache/crash_info/\u4e0b\u751f\u6210</p>"},{"location":"android/performance/android_crash/#native-crash","title":"native crash\u76d1\u63a7","text":""},{"location":"android/performance/android_crash/#_3","title":"\u7ebf\u4e0b","text":"<p>\u901a\u8fc7\u5893\u7891\u6587\u4ef6\u5b9a\u4f4d</p> <p>native crash\u65e5\u5fd7\u5b58\u653e\u70b9\uff0c\u8def\u5f84\u4e3a/data/tombstones/\uff0c\u4e00\u822c\u4e0d\u5141\u8bb8\u76f4\u63a5\u8bfb\u53d6\uff0c\u53ef\u901a\u8fc7adb bugreport\u5bfc\u51fa</p>"},{"location":"android/performance/android_crash/#_4","title":"\u7ebf\u4e0a","text":"<p>\u5b9e\u73b0\u539f\u7406\uff1a\u548cjava\u5c42\u7c7b\u4f3c\uff0c\u901a\u8fc7\u6ce8\u518c\u76d1\u542clinux\u4fe1\u53f7\uff0c\u9700\u8981\u5728c++\u5c42\u5b9e\u73b0</p> <p>\u5e38\u89c1\u5d29\u6e83\u4fe1\u53f7 |\u4fe1\u53f7|\u63cf\u8ff0| |--|--| |SIGSEGV|\u5185\u5b58\u5f15\u7528\u65e0\u6548\uff0c\u5982\u7a7a\u6307\u9488| |SIGBUS|\u8bbf\u95ee\u5185\u5b58\u5bf9\u8c61\u7684\u672a\u5b9a\u4e49\u90e8\u5206| |SIGFPE|\u7b97\u672f\u8fd0\u7b97\u9519\u8bef\uff0c\u5982\u9664\u4ee50| |SIGILL|\u975e\u6cd5\u6307\u4ee4\uff0c\u5982\u6267\u884c\u5783\u573e\u6216\u7279\u6743\u6307\u4ee4| |SIGSYS|\u7cdf\u7cd5\u7684\u7cfb\u7edf\u8c03\u7528| |SIGXCPU|\u8d85\u8fc7CPU\u65f6\u95f4\u9650\u5236| |SIGXFSZ|\u6587\u4ef6\u5927\u5c0f\u9650\u5236|</p> <p>ndk\u5de5\u7a0b\u914d\u7f6e</p> <p>\u501f\u52a9google\u7684breakpad\u6dfb\u52a0\u81ea\u5b9a\u4e49\u76d1\u542c</p> <p>\u5927\u81f4\u914d\u7f6e\u6d41\u7a0b</p> <p>\u590d\u5236\u6e90\u7801\u5230cpp\u76ee\u5f55</p> <p></p> <p>\u6dfb\u52a0cmake\u914d\u7f6e\u6587\u4ef6\uff0c\u5176\u5b9e\u662f\u5c06breakpad\u6e90\u7801\u4e2d\u7684/android/google_breakpad/Android.mk\u8fdb\u884c\u8f6c\u5316\uff0c\u6700\u7ec8\u4ee3\u7801 <pre><code>cmake_minimum_required(VERSION 3.22.1)\n#\u5bf9\u4e8emk\u6587\u4ef6\u4e2d\u7684LOCAL_C_INCLUDES\ninclude_directories(src src/common/android/include)\n#\u5f00\u542farm\u6c47\u7f16\u652f\u6301\uff0c.s\u5c5e\u4e8e\u6c47\u7f16\u6e90\u7801\nenable_language(ASM)\n\n#\u751f\u6210libbreakpad.a \u6307\u5b9a\u6e90\u7801\uff0c\u5bf9\u4e8emk\u4e2d\u7684LOCAL_SRC_FILES\u548cLOCAL_MODULE\nadd_library(breakpad STATIC\nsrc/client/linux/crash_generation/crash_generation_client.cc\nsrc/client/linux/dump_writer_common/thread_info.cc\nsrc/client/linux/dump_writer_common/ucontext_reader.cc\nsrc/client/linux/handler/exception_handler.cc\nsrc/client/linux/handler/minidump_descriptor.cc\nsrc/client/linux/log/log.cc\nsrc/client/linux/microdump_writer/microdump_writer.cc\nsrc/client/linux/minidump_writer/linux_dumper.cc\nsrc/client/linux/minidump_writer/linux_ptrace_dumper.cc\nsrc/client/linux/minidump_writer/minidump_writer.cc\nsrc/client/minidump_file_writer.cc\nsrc/common/convert_UTF.cc\nsrc/common/md5.cc\nsrc/common/string_conversion.cc\nsrc/common/linux/breakpad_getcontext.S\nsrc/common/linux/elfutils.cc\nsrc/common/linux/file_id.cc\nsrc/common/linux/guid_creator.cc\nsrc/common/linux/linux_libc_support.cc\nsrc/common/linux/memory_mapped_file.cc\nsrc/common/linux/safe_readlink.cc)\n\n#\u94fe\u63a5log\u5e93\u5bf9\u5e94mk\u4e2d\u7684LOCAL_EXPORT_LDLIBS\ntarget_link_libraries(breakpad log)\n</code></pre> \u5728\u81ea\u5df1\u7684cmake\u6587\u4ef6\u4e2d\u5f15\u5165breakpad <pre><code>cmake_minimum_required(VERSION 3.22.1)\n\nproject(\"jetpack\")\n\n#\u5f15\u5165breakpad\u5934\u6587\u4ef6\ninclude_directories(breakpad/src breakpad/src/common/android/include)\n\nadd_library(${CMAKE_PROJECT_NAME} SHARED jetpack.cpp)\n\n#\u5f15\u5165breakpad\u7684cmake\u6587\u4ef6\uff0c\u6267\u884c\u5e76\u751f\u6210libbreakpad.a\nadd_subdirectory(breakpad)\n\ntarget_link_libraries(${CMAKE_PROJECT_NAME} android breakpad log)\n</code></pre> cpp\u5b9e\u73b0 <pre><code>#include \"jni.h\"\n#include \"android/log.h\"\n#include \"client/linux/handler/minidump_descriptor.h\"\n#include \"client/linux/handler/exception_handler.h\"\n\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_hfc_jetpack_NativeCrash_testNativeCrash(JNIEnv *env, jobject thiz) {\nint *p = NULL;\n*p = 10;//\u62a5\u7a7a\u6307\u9488\n}\n\n//\u56de\u8c03\u63a5\u53e3\u51fd\u6570\nbool DumpCallback(const google_breakpad::MinidumpDescriptor &amp;descriptor,\nvoid *context,\nbool succeeded) {\n__android_log_print(ANDROID_LOG_ERROR, \"native\", \"native crash:%s\", descriptor.path());\nreturn false;\n}\n\n//\u6ce8\u518ccrash\u76d1\u542c\u51fd\u6570\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_hfc_jetpack_NativeCrash_initNativeCrash(JNIEnv *env, jobject thiz, jstring path_) {\nconst char *path = env-&gt;GetStringUTFChars(path_, 0);\n\n__android_log_print(ANDROID_LOG_INFO, \"native\", \"===&gt; %s\", path);\ngoogle_breakpad::MinidumpDescriptor descriptor(path);\nstatic google_breakpad::ExceptionHandler eh(descriptor, NULL, DumpCallback,\nNULL, true, -1);\n\nenv-&gt;ReleaseStringUTFChars(path_, path);\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>object NativeCrash {\ninit {\nSystem.loadLibrary(\"jetpack\")\n}\nexternal fun testNativeCrash()\n\nexternal fun initNativeCrash(path: String)\n}\n\nval dir = File(BaseApplication.instance.externalCacheDir, \"native_crash\")\nif (!dir.exists()) {\ndir.mkdirs()\n}\nNativeCrash.initNativeCrash(dir.absolutePath)\nNativeCrash.testNativeCrash()\n</code></pre> \u5893\u7891\u6587\u4ef6\u4f1a\u5728/sdcard/Android/cache/native_crash/\u4e0b\u751f\u6210xxx.dmp</p>"},{"location":"android/performance/android_crash/#_5","title":"\u914d\u7f6e\u5206\u6790\u5de5\u5177","text":"<p>\u73af\u5883\u53d8\u91cf\u6dfb\u52a0\uff1a</p> <p>AndroidStudio\\plugins\\android-ndk\\resources\\lldb\\bin</p> <p>AndroidSDK\\ndk\\25.1.8937393\\toolchains\\llvm\\prebuilt\\windows-x86_64\\bin</p> <p>minidump_stackwalk.exe\u5206\u6790BreakPad\u4e2ddump\u51fa\u6765\u7684dmp\u6587\u4ef6 <pre><code>minidump_stackwalk xxx.dump &gt;crash.txt\n</code></pre> llvm-addr2line.exe\u5b9a\u4f4dso\u62a5\u9519\u4f4d\u7f6e <pre><code>llvm-addr2line -f -C -e xxx.so 0xaaaa(crash.txt\u6709\u8bb0\u5f55)\n</code></pre> \u4e5f\u53ef\u4ee5\u4f7f\u7528IDA\u5de5\u5177\u5206\u6790(arm\u8c8c\u4f3c\u65e0\u6cd5\u53cd\u6c47\u7f16\uff0c\u5373\u770b\u4e0d\u5230\u4f2a\u4ee3\u7801)</p>"},{"location":"android/performance/android_crash/#xcrash","title":"XCrash","text":"<p>\u7231\u5947\u827a https://github.com/iqiyi/xCrash</p>"},{"location":"android/performance/android_datastructure/","title":"\u6570\u636e\u7ed3\u6784\u4f18\u5316","text":"<p>\u7ebf\u4e0aAPM(Android performance monitor)\u76f8\u5173\u77e5\u8bc6\u70b9</p> <p>\u6280\u672f\u70b9</p> <p>Bytecode\u3001Hook\u3001JS\u6ce8\u5165\u3001Gradle\u3001ASM\u3001kotlinpoet</p> <p>Java\u5c42\u5b9e\u73b0\u529f\u80fd - CPU\u6307\u6807 - \u5185\u5b58\u6307\u6807 - FPS\u6307\u6807 - ANR - \u5361\u987f - GC/OOM - \u7f51\u7edc - \u529f\u8017 - \u8fdc\u7a0b\u4e0b\u53d1 \u65e5\u5fd7\u56de\u635e \u652f\u6301\u8fdc\u7a0bshell\u52a8\u6001\u4ee3\u7801\u4e0b\u53d1</p> <p>APM\u5b9e\u73b0\u601d\u8def</p> <ol> <li>\u914d\u7f6e(\u6ce8\u89e3+json)</li> <li>\u6570\u636e\u94fe\u7684\u4fdd\u5b58 App\u542f\u52a8\u3001\u7ed3\u675f\u3001\u754c\u9762\u8df3\u8f6cLifecycleCallbacks</li> <li>Crash Thread</li> <li>CPU GC \u7535\u91cf linux\u77e5\u8bc6\u70b9 /proc/stat /proc/pid/stat BatteryMonitor</li> <li>ANR FPS \u6587\u4ef6\u68c0\u6d4b/data/anr/trace.txt Choreographer.FrameCallback</li> </ol> <p>adb shell dumpsys battery \u83b7\u53d6\u624b\u673a\u7535\u6c60\u76f8\u5173\u4fe1\u606f</p> <p>adb shell getprop ro.product.model \u901a\u8fc7\u624b\u673a\u673a\u578b\u5224\u65ad\u4e2d\u9ad8\u7aef\u624b\u673a</p> <p>adb shell dumpsys window displays</p> <p>mDisplayId: \u663e\u793a\u5c4f\u7f16\u53f7</p> <p>init\uff1a\u662f\u521d\u59cb\u5206\u8fa8\u7387\u548c\u5c4f\u5e55\u5bc6\u5ea6</p> <p>app\u7684\u9ad8\u5ea6\u6bd4init\u5c0f\u8868\u793a\u5e95\u90e8\u6709\u865a\u62df\u6309\u952e</p> <p>adb shell settings get secure android_id</p> <p>adb shell service call iphonesubinfo 1 \u83b7\u53d6IEMI</p> <p>adb shell cat /proc/cpuinfo adb shell cat /proc/meminfo</p> <p>MemAvailable=MemFree+Buffers+Cached+Slab</p> <p>kernel\u52a8\u6001\u5185\u5b58\u5206\u914d\uff1a\u547d\u4ee4\u4e2d\u65e0\u6cd5\u67e5\u770b</p> <p>xlog</p> <p>syscall \u7528\u6237\u6001 \u5185\u6838\u6001</p> <p>dumpsys meminfo</p> <p>dumpsys meminfo \u5305\u540d</p> <p>RSS \u5171\u4eab\u5e93so \u52a8\u6001\u94fe\u63a5\u5e93</p> <p>Tinker\u7684so\u7684\u52a0\u8f7d\u6d41\u7a0b https://github.com/KeepSafe/Relinker</p> <p>YSS&gt;=RSS&gt;=PSS&gt;=USS</p> <p>vmstart</p> <p>cpu\u65f6\u95f4\u7247 \u7528\u6237cpu\u65f6\u95f4 \u7cfb\u7edfcpu\u65f6\u95f4 linux TMS</p> <p>activity\u9500\u6bc1\u5982\u4f55\u5f97\u77e5\uff1f</p> <p>ReferenceQueue</p> <p>WeakHashMap\uff1aKey\u662f\u5f31\u5f15\u7528\u53ef\u4ee5\u88ab\u56de\u6536\uff0c\u628aActivity\u4f5c\u4e3akey\uff0c\u5f53key\u88ab\u56de\u6536\u8bf4\u660eactivity\u5df2\u7ecf\u9500\u6bc1\u4e86\uff0c\u7ed3\u5408registerActivityLifecycleCallbacks\uff0cstop\u4e2dgc</p> <p>\u9608\u503c\u5904\u7406\uff1aKOOM &gt; Matrix</p> <p>SystemClock.sleep System.runFinalization</p> <p>Debug.M</p>"},{"location":"android/performance/android_datastructure/#koom","title":"KOOM","text":"<p>Native Heap\u6cc4\u6f0f\u76d1\u63a7</p> <p>bionic</p> <p>xhook</p> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> <p>1.\u542f\u52a8\u4f18\u5316</p> <p>\u542f\u52a8\u80cc\u666f\u4f18\u5316SplashScreen</p> <p>\u6709\u5411\u65e0\u73af\u56feDAG\u3001\u62d3\u6251\u6392\u5e8f\u3001CountDownLatch\u63a7\u5236\u7ebf\u7a0b\u987a\u5e8f(app_startup\u3001Android_startup)</p> <p>\u67b6\u6784\u4e0aApplication\u521d\u59cb\u5316\u5206\u79bb\u5230\u4e2a\u6a21\u5757</p> <p>SplashActivity\u4f18\u5316\uff0c\u8d23\u4efb\u94fe\u6a21\u5f0f\uff0conStop\u4e2dfinish\u9632\u6b62Main\u5931\u8d25\u65f6\u51fa\u73b0\u95ee\u9898</p> <p>\u61d2\u52a0\u8f7d\u3001\u5ef6\u8fdf\u52a0\u8f7d</p> <p>2.\u5185\u5b58\u4f18\u5316</p> <p>\u5185\u5b58\u6cc4\u6f0f\u3001ANR\u3001\u5185\u5b58\u6296\u52a8\u3001OOM\u3001\u5f31\u5f15\u7528\u3001JVM\u7684gc\u56de\u6536\u7b97\u6cd5(\u6839\u53ef\u8fbe)</p> <p>bitmap\u3001\u6570\u636e\u7ed3\u6784HashMap\u548cSparseArray(ArrayMap)</p> <p>\u7ebf\u4e0a\u76d1\u63a7KOOM\u3001\u7ebf\u4e0b\u76d1\u63a7LeakCanary</p> <p>3.UI\u4f18\u5316</p> <p>\u5e03\u5c40\u4f18\u5316\u3001webview\u4f18\u5316\u3001recycleview\u4f18\u5316\u3001\u81ea\u5b9a\u4e49view(onDraw)</p> <p>4.\u5b89\u88c5\u5305\u7626\u8eab</p> <p>\u56fe\u7247webp(svg\u3001json)\u3001so\u5e93\u3001\u6df7\u6dc6\u3001\u52a0\u56fa</p>"},{"location":"android/performance/android_koom/","title":"KOOM","text":"<p>\u7531\u5feb\u624b\u56e2\u961f\u5f00\u53d1</p> <p>https://github.com/KwaiAppTeam/KOOM/blob/master/README.zh-CN.md</p>"},{"location":"android/performance/android_koom/#_1","title":"\u57fa\u672c\u4f7f\u7528","text":"<pre><code>implementation \"com.kuaishou.koom:koom-java-leak:2.2.1\"\n</code></pre> <p>application\u4e2d\u521d\u59cb\u5316 <pre><code>OOMMonitor.init(CommonConfig.Builder().build(),\nOOMMonitorConfig.Builder().setHprofUploader(object : OOMHprofUploader {\noverride fun upload(file: File, type: OOMHprofUploader.HprofType) {\n//\u4e0a\u4f20hprof\u5feb\u7167\n}\n}).setReportUploader(object : OOMReportUploader {\noverride fun upload(file: File, content: String) {\n//\u4e0a\u4f20json\u6cc4\u6f0f\u62a5\u544a\n}\n})\n.build()\n)\nOOMMonitor.startLoop()\n</code></pre></p>"},{"location":"android/performance/android_koom/#_2","title":"\u6e90\u7801\u5206\u6790","text":"<p>startLoop\u6267\u884csuper.startLoop\uff0c\u63a5\u7740\u6267\u884cLoopMonitor\u91cc\u9762\u7684mLoopRunnable\uff0c\u91cc\u9762\u9996\u5148\u6267\u884ccall\u51fd\u6570\uff0c\u5b9e\u73b0\u5728OOMMonitor\u4e2d\u6267\u884ctrackOOM</p> <p>trackOOM\u4f1a\u5148\u4ecemOOMTrackers\u4e2a\u7ef4\u5ea6\u8fdb\u884c\u68c0\u6d4b <pre><code>private val mOOMTrackers = mutableListOf(\nHeapOOMTracker(), ThreadOOMTracker(), FdOOMTracker(),\nPhysicalMemoryOOMTracker(), FastHugeMemoryOOMTracker()\n)\n</code></pre> \u5176\u4e2dPhysicalMemoryOOMTracker\u53ea\u662f\u6253\u5370\u4e00\u4e9b\u65e5\u5fd7</p> <p>\u68c0\u6d4b\u51fd\u6570track\u8fd4\u56de\u4e3atrue\u5219\u6dfb\u52a0\u5230mTrackReasons\u4e2d</p> <p>KOOM\u901a\u8fc7\u5468\u671f\u8f6e\u8be2\u68c0\u6d4b\uff0c\u901a\u8fc7HandlerThread\u68c0\u6d4b\u4ee5\u4e0b\u7ef4\u5ea6</p> <ol> <li>\u5185\u5b58\u5360\u7528\u7387\u68c0\u6d4bHeapOOMTracker\uff0c\u68c0\u6d4b\u5185\u5b58\u5360\u7528\u6bd4\u4f8b\u8d85\u8fc7\u9608\u503c(\u6839\u636e\u6700\u5927\u5185\u5b58\u7b97\u51fa(0.8,0.85,0.9)\u6216\u624b\u52a8\u8bbe\u7f6e\u8fdb\u6765)\u65f6\u4e14\u8d85\u8fc7\u4e0a\u6b21\u6bd4\u4f8b-0.05\uff0c\u8bb0\u5f55\u6b21\u6570+1\uff0c\u5f53\u8d85\u8fc73\u6b21\u89e6\u53d1</li> <li>\u7ebf\u7a0b\u6570\u68c0\u6d4bThreadOOMTracker\uff0c\u68c0\u6d4b\u7ebf\u7a0b\u6570\u91cf\u8d85\u8fc7\u9608\u503c(EMUI\u4e14\u7248\u672c\u5c0f\u4e8eO\u662f450\uff0c\u5176\u4ed6750\u6216\u624b\u52a8\u8bbe\u7f6e\u8fdb\u6765)\u65f6\u4e14\u8d85\u8fc7\u4e0a\u6b21\u6570\u91cf-50\uff0c\u8bb0\u5f55\u6b21\u6570+1\uff0c\u5f53\u8d85\u8fc73\u6b21\u89e6\u53d1</li> <li>\u6587\u4ef6\u63cf\u8ff0\u7b26\u68c0\u6d4bFdOOMTracker\uff0c\u68c0\u6d4b\u6253\u5f00\u6587\u4ef6\u6570\u91cf\u8d85\u8fc7\u9608\u503c(\u9ed8\u8ba41000\u6216\u624b\u52a8\u8bbe\u7f6e\u8fdb\u6765)\u65f6\u4e14\u8d85\u8fc7\u4e0a\u6b21\u6570\u91cf-50\uff0c\u8bb0\u5f55\u6b21\u6570+1\uff0c\u5f53\u8d85\u8fc73\u6b21\u89e6\u53d1</li> <li>\u5185\u5b58\u589e\u957f\u68c0\u6d4bFastHugeMemoryOOMTracker\uff0c\u68c0\u6d4b\u5185\u5b58\u5360\u7528\u6bd4\u4f8b\u8d85\u8fc70.9\u89e6\u53d1\uff0c\u68c0\u6d4b\u5230\u5f53\u524d\u5185\u5b58-\u4e0a\u6b21\u5185\u5b58\u5927\u4e8e350m(\u589e\u957f\u8fc7\u5feb)\u89e6\u53d1</li> </ol> <p>\u5728dumpAndAnalysis\u4e4b\u524d\u4f1a\u8fdb\u884c\u89e6\u53d1\u5224\u65ad</p> <p>isExceedAnalysisPeriod() || isExceedAnalysisTimes()</p> <p>\u8d85\u8fc715\u5929\u89e6\u53d1\u6216\u8005\u8d85\u8fc75\u6b21\u5c31\u4e0d\u89e6\u53d1</p> <p>\u63a5\u4e0b\u6765\u8fdb\u884cdumpAndAnalysis\u4e3b\u8981\u662fdump\u51fahprof\u4ee5\u53ca\u5206\u6790</p> <p>dump\u51fd\u6570\uff1asuspendAndFork\u89e3\u51b3\u591a\u7ebf\u7a0bfork\u95ee\u9898\u3001Debug.dumpHprofData\u3001resumeAndWait</p>"},{"location":"android/performance/android_koom/#koom","title":"KOOM\u76d1\u63a7","text":"<p>KOOM\u76d1\u63a7\u6574\u4f53\u5185\u5b58\uff0c\u800c\u4e0d\u662f\u76d1\u63a7\u5bf9\u8c61\uff0c\u51cf\u5c11dump\u9891\u7387</p>"},{"location":"android/performance/android_koom/#dump","title":"\u89e3\u51b3dump\u6162","text":"<p>\u662f\u5426\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u5904\u7406\uff0c\u53ef\u4ee5\uff0c\u4f46\u662fdump\u4f1a\u89e6\u53d1stw\uff0cstw\u662f\u505c\u6b62\u4e00\u5207\u7ebf\u7a0b(\u5177\u4f53\u4ee3\u7801\u5728art/runtime/thread_list.cc\u7684ScopeSuspendAll\u4e2d)\uff0c\u56e0\u6b64\u6ca1\u5565\u6548\u679c</p> <p>\u89e3\u51b3\u65b9\u6848\uff1afork\u4e00\u4efd\u8fdb\u7a0b\u8fdb\u884cdump</p>"},{"location":"android/performance/android_koom/#fork","title":"fork","text":"<p>fork\u7cfb\u7edf\u8c03\u7528\u7528\u4e8e\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u4f1a\u8fd4\u56de\u591a\u6b21\uff0c\u8fd4\u56de\u503c\u4f4d\u6574\u578b\uff0c\u8d1f\u503c\u8868\u793a\u521b\u5efa\u5b50\u8fdb\u7a0b\u5931\u8d25\uff0c0\u8fd4\u56de\u65b0\u5efa\u7684\u5b50\u8fdb\u7a0b(\u5373\u5f53\u524d\u5904\u4e8e\u5b50\u8fdb\u7a0b)\uff0c\u6b63\u6570\u8fd4\u56de\u65b0\u8fdb\u7a0bid(\u5373\u5f53\u524d\u5904\u4e8e\u7236\u8fdb\u7a0b)</p> <p>\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u662f\u5171\u4eab\u540c\u4e00\u4efd\u5185\u5b58(read-only)\uff0c\u901a\u8fc7copy-on-write\u8fdb\u884c\u5199\u6570\u636e(\u5199\u65f6\u590d\u5236\u5185\u5b58\u76f8\u540c\u7a7a\u95f4)</p>"},{"location":"android/performance/android_koom/#fork_1","title":"fork\u5b58\u5728\u95ee\u9898","text":"<p>\u7531\u4e8ejava\u5929\u751f\u662f\u591a\u7ebf\u7a0b\uff0c\u4e3b\u8fdb\u7a0ba\u7ebf\u7a0b\u8c03\u7528fork\uff0c\u5219\u5b50\u8fdb\u7a0b\u53ea\u590d\u5236a\u7ebf\u7a0b\uff0c\u5bf9\u4e8e\u5176\u4ed6\u7ebf\u7a0bb,c,d\u53ea\u590d\u5236\u7ebf\u7a0b\u4e2d\u5bf9\u8c61(\u5373Thread\u5bf9\u8c61)\uff0c\u6b64\u65f6stw\u65e0\u6cd5\u505c\u6b62\u8fd9\u4e9b\u7ebf\u7a0b\u5bfc\u81f4\u5361\u6b7b(\u6b7b\u9501)</p> <p>\u89e3\u51b3\u65b9\u6848\uff1afork\u4e4b\u524d\u5148\u89e6\u53d1SuspendAll\uff0c\u7b49fork\u5b8c\u540e\u6062\u590dResumeAll</p> <p>koom\u52a0\u8f7dkoom-fast-dump.so\u53bb\u5904\u7406\uff0c\u4ee5AndroidR\u7248\u672cSuspendAndFork\u4e3a\u4f8b <pre><code>//\u53cd\u5c04\u8c03\u7528libart.so(suspend\u76f8\u5173\u64cd\u4f5c\u7f16\u8bd1\u4ea7\u7269)\u4e2d\u7684\u51fd\u6570\nvoid *handle = kwai::linker::DlFcn::dlopen(\"libart.so\", RTLD_NOW);\n//art::Dbg::SuspendVM\u548cart::Dbg::ResumeVM\nsuspend_vm_fnc_ =\n(void (*)())DlFcn::dlsym(handle, \"_ZN3art3Dbg9SuspendVMEv\");\nKFINISHV_FNC(suspend_vm_fnc_, DlFcn::dlclose, handle)\n\npid_t HprofDump::SuspendAndFork() {\nKCHECKI(init_done_)\nif (android_api_ &lt; __ANDROID_API_R__) {\nsuspend_vm_fnc_();\n} else if (android_api_ &lt;= __ANDROID_API_S__) {\n//...\n}\n//\u518d\u8fdb\u884cfork\npid_t pid = fork();\nif (pid == 0) {\nalarm(60);\nprctl(PR_SET_NAME, \"forked-dump-process\");\n}\nreturn pid;\n}\n</code></pre> \u5176\u4e2d_ZN3art3Dbg9SuspendVMEv\u662fc++\u7b26\u53f7\u5316\u8868\u73b0\uff0c\u901a\u8fc7\u547d\u4ee4\u67e5\u770b\u7b26\u53f7\u540d(\u6b63\u771f\u51fd\u6570\u540d) <pre><code>run -D libart.so &gt;xx.txt\n</code></pre></p> <p>\u9664\u4e86JVMIT\u4ee5\u5916\uff0c\u901a\u8fc7\u53cd\u5c04hide\u6ce8\u89e3\u9650\u5236\u4e5f\u4f7f\u7528\u5230\u53cd\u5c04so\u4e2d\u7684\u51fd\u6570\uff0c\u9700\u8981\u638c\u63e1so\u7684\u683c\u5f0f\u548c\u6570\u636e\u683c\u5f0f\u5206\u6790</p> <p>JVMTI\uff1a\u63a7\u5236JVM\u884c\u4e3a\uff0c\u53ef\u53cd\u5c04\u8c03\u7528so\u4e2d\u7684\u51fd\u6570</p>"},{"location":"android/performance/android_koom/#hprof","title":"hprof","text":"<p>hprof\u662f\u57fa\u4e8eJVMTI\u5b9e\u73b0\u7684\u5185\u5b58\u5206\u6790\u5668\u4ee3\u7406\uff0c\u8bb0\u5f55java\u7684\u5185\u5b58\u955c\u50cf\u5305\u62ec\u5806\u8be6\u7ec6\u4f7f\u7528\u4fe1\u606f\uff0c\u5305\u542b\u8bb8\u591a\u65e0\u7528\u4fe1\u606f(\u65f6\u95f4\u3001\u7248\u672c\u3001\u6807\u7b7e\u7b49)</p>"},{"location":"android/performance/android_koom/#hprof_1","title":"hprof\u538b\u7f29","text":"<p>android.os.Debug.dumpHprofData\u80af\u5b9a\u662f\u901a\u8fc7IO\u5199\u5230\u6587\u4ef6\u4e2d\uff0c\u5219\u53ef\u4ee5\u8fdb\u884chprof\u88c1\u526a\uff0c\u901a\u8fc7hook IO\u7684write\u51fd\u6570\u6765\u63d0\u53d6\u9700\u8981(\u65e0\u7528\u4fe1\u606f\u629b\u5f03\u6389)\u7684buffer\u5199\u5230hprof\u6587\u4ef6\u5373\u53ef\u51cf\u5c11hprof\u5927\u5c0f</p>"},{"location":"android/performance/android_leakcanary/","title":"LeakCanary","text":"<p>\u7531Square\u516c\u53f8\u5f00\u53d1</p> <p>https://github.com/square/leakcanary</p> <p>\u63a5\u5165\u65b9\u5f0f\uff1a <pre><code>debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'\n</code></pre> \u4f9d\u8d56\u7248\u672c\u83b7\u53d6</p> <p>\u65b0\u7248\u672c\u65e0\u9700\u5728application\u4e2d\u521d\u59cb\u5316\uff0c\u91c7\u7528ContentProvider\u5f62\u5f0f\u81ea\u52a8\u521d\u59cb\u5316</p> <p>\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u540e\u901a\u77e5\u680f\u663e\u793a\uff0clog\u901a\u8fc7tag(LeakCanary)\u67e5\u770b\u4fe1\u606f\u5305\u62ecdump\u6587\u4ef6\u5730\u5740</p> <p>\u76d1\u542cActivity\uff1a\u4eceActivity\u6e90\u7801\u5165\u624bdispatchActivityCreated\u4f1a\u8c03\u7528\u5230Application\u4e2d\u7684callback</p> <p>\u76d1\u542cFragment\uff1a\u4eceFragmentManager\u6e90\u7801\u5165\u624bdispatchOnFragmentCreated</p> <p>Fragment\u7684\u672c\u8d28\u662fView</p> <p>LeakCanary\u5b9e\u73b0\u539f\u7406\u5c31\u662f\u5229\u7528registerActivityLifecycleCallbacks\u76d1\u542cActivity\uff0c\u7136\u540e\u5229\u7528registerFragmentLifecycleCallbacks\u76d1\u542cFragment</p> <p>\u68c0\u6d4bActivity\u662f\u5426\u88ab\u56de\u6536\uff0c\u53ef\u4ee5\u628aActivity\u5bf9\u8c61\u653e\u5230\u5f31\u5f15\u7528\u4e2d\uff0c\u624b\u52a8\u89e6\u53d1gc\u540e\u5224\u65adActivity\u5bf9\u8c61\u662f\u5426\u4e3anull</p> <p>ReferenceQueue\u7528\u6765\u4fdd\u5b58\u6240\u6709\u5f31\u5f15\u7528\u5bf9\u8c61</p> <p>\u5206\u6790dump\u4f7f\u7528haha\u5e93\u6216\u8005shark\u5e93</p> <p>\u4e0d\u80fd\u4f7f\u7528\u7ebf\u4e0a\u539f\u56e0</p> <ol> <li>\u9891\u7e41gc\u5bb9\u6613\u5bfc\u81f4\u5361\u987f</li> <li>\u6bcf\u6b21\u68c0\u6d4b\u5230\u6cc4\u6f0f\u5c31\u4f1adump\u5feb\u7167\u6587\u4ef6\uff0c\u540c\u4e00\u4e2a\u4e5f\u4f1a\u89e6\u53d1</li> <li>dump\u51fa\u7684hprof(\u5185\u5b58\u955c\u50cf)\u6587\u4ef6\u8017\u65f6\uff0c\u5bb9\u6613\u9020\u6210\u7a0b\u5e8f\u672a\u54cd\u5e94</li> <li>hprof\u6587\u4ef6\u592a\u5927\uff0c\u89e3\u6790\u8017\u65f6</li> </ol> <p>\u7ebf\u4e0a\u4f7f\u7528KOOM</p>"},{"location":"android/performance/android_mat/","title":"Mat\u5de5\u5177","text":""},{"location":"android/performance/android_mat/#memory-analyzer","title":"Memory Analyzer\u4e0b\u8f7d\u5730\u5740","text":"<p>https://eclipse.dev/mat/downloads.php</p>"},{"location":"android/performance/android_mat/#hprofdump","title":"hprof\u6587\u4ef6dump","text":"<p>\u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7android studio profiler-memory</p> <p>\u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7\u4ee3\u7801 <pre><code>private fun dumpHprof() {\nLog.e(tag\", \"start dump \")\n    val cacheDir = applicationContext.externalCacheDir\n    val filePath = \"${cacheDir?.absolutePath}/${System.currentTimeMillis()}_dump.hprof\"\n    val file = File(filePath)\n    try {\n        android.os.Debug.dumpHprofData(file.absolutePath)\n        Log.e(\"tag\", \"end dump \")\n    } catch (e: Exception) {\n        e.printStackTrace()\n    }\n}\n</code></pre></p>"},{"location":"android/performance/android_mat/#_1","title":"\u6807\u51c6\u683c\u5f0f\u8f6c\u5316","text":"<p>\u5de5\u5177\u4f4d\u7f6e\uff1aAndroidSDK\\platform-tools <pre><code>hprof-conv -z fileName.hprof newFileName.hprof\n</code></pre> \u4f7f\u7528\u62d6\u62fd\u811a\u672c <pre><code>@echo off\nSetlocal enabledelayedexpansion\nset \"file=%~1\"\nset inputfilename=%~n1\nmd %inputfilename%\nset hpOutFile=%inputfilename%\\%inputfilename%_new.hprof\nhprof-conv.exe %file% %hpOutFile%\necho success!\nendlocal\n</code></pre> Histogram</p> <p>with incoming references\uff1a\u67e5\u770b\u7c7b\u88ab\u54ea\u4e9b\u5b9e\u4f8b\u5f15\u7528</p> <p>with outgoing references: \u67e5\u770b\u5f15\u7528\u54ea\u4e9b\u5916\u90e8\u5b9e\u4f8b</p> <p>Shallow Heap: \u6d45\u5806</p> <p>Retained Heap: \u6df1\u5806\uff0c\u7740\u91cd\u67e5\u770b</p> <p>\u5de6\u4e0b\u89d2\u6709\u9ec4\u70b9\u8868\u793a\u6709\u6cc4\u6f0f</p>"},{"location":"android/performance/android_memory_base/","title":"\u57fa\u7840\u77e5\u8bc6","text":""},{"location":"android/performance/android_memory_base/#android","title":"Android\u865a\u62df\u673a","text":""},{"location":"android/performance/android_memory_base/#_1","title":"\u57fa\u672c\u6982\u5ff5","text":"<ul> <li>.dex\u6587\u4ef6\uff1aApp\u6240\u6709java\u6e90\u4ee3\u7801\u7f16\u8bd1\u540e\u751f\u6210\u4f17\u591aclass\u6587\u4ef6\uff0c\u7531DX/D8\uff0c\u7f16\u8bd1\u4e3a\u4e00\u4e2a/\u591a\u4e2a\uff08multiDex\uff09dex\u6587\u4ef6\uff0c\u7531Android\u865a\u62df\u673a\u7f16\u8bd1\u6267\u884c</li> <li>odex\u6587\u4ef6\uff1adex\u6587\u4ef6\u7ecf\u8fc7\u9a8c\u8bc1\u548c\u4f18\u5316\u540e\u7684\u4ea7\u7269\uff0cart\u4e0b\u7684odex\u6587\u4ef6\u5305\u542b\u7ecf\u8fc7AOT\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u4ee5\u53cadex\u7684\u5b8c\u6574\u5185\u5bb9\uff0c\u4f46Android8.0\u4e4b\u540eodex\u4e2d\u7684dex\u5185\u5bb9\u79fb\u52a8\u5230\u4e86.vdex\u6587\u4ef6</li> <li>.art\u6587\u4ef6\uff1aart\u4e0b\u6839\u636e\u914d\u7f6e\u6587\u4ef6\u751f\u6210odex\u6587\u4ef6\u65f6\u540c\u65f6\u751f\u6210.art\u6587\u4ef6\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u63d0\u5347\u8fd0\u884c\u65f6\u52a0\u8f7dodex\u4e2d\u70ed\u70b9\u4ee3\u7801\u7684\u901f\u5ea6\uff0c\u5305\u542b\u4e86\u7c7b\u4fe1\u606f\u548codex\u4e2d\u70ed\u70b9\u65b9\u6cd5\u7684\u7d22\u5f15\uff0c\u8fd0\u884cApp\u65f6\u4f1a\u9996\u5148\u6839\u636e\u8fd9\u4e2a\u6587\u4ef6\u6765\u52a0\u8f7dodex\u4e2d\u5df2\u7ecf\u7f16\u8bd1\u8fc7\u7684\u4ee3\u7801</li> <li>\u89e3\u91ca\u5668\uff08Interpreter\uff09\uff1a\u7528\u4e8e\u7a0b\u5e8f\u8fd0\u884c\u65f6\u5bf9\u4ee3\u7801\u8fdb\u884c\u9010\u884c\u89e3\u91ca\uff0c\u7ffb\u8bd1\u6210\u5bf9\u5e94\u5e73\u53f0\u7684\u673a\u5668\u7801\u6267\u884c\uff1b</li> <li>JIT\u7f16\u8bd1\uff08Just In Time\uff09\uff1a\u7531\u4e8e\u89e3\u91ca\u5668\u65b9\u5f0f\u8fd0\u884c\u592a\u6162\u5f15\u5165\uff0c\u5bf9\u4e8e\u9891\u7e41\u8fd0\u884c\u7684\u70ed\u70b9\u4ee3\u7801\uff08\u5224\u5b9a\u6807\u51c6\u4e00\u822c\u662f\u5728\u67d0\u4e2a\u65f6\u95f4\u6bb5\u5185\u6267\u884c\u6b21\u6570\u8fbe\u5230\u67d0\u4e2a\u9608\u503c\uff09\u8fdb\u884c\u5b9e\u65f6\u7f16\u8bd1\uff08\u5728ART\u4e0b\u4ee5\u65b9\u6cd5\u4e3a\u7c92\u5ea6\uff09\u6267\u884c\uff0c\u5e76\u4e14\u7f13\u5b58JIT\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u5728\u5185\u5b58\u4e2d\u7528\u4e8e\u4e0b\u6b21\u6267\u884c\u3002\u7531\u4e8e\u4ee5\u65b9\u6cd5\u4e3a\u7c92\u5ea6\uff08ArtMethod\uff09\u8fdb\u884c\u7f16\u8bd1\uff0cJIT\u7f16\u8f83\u4e8e\u89e3\u91ca\u5668\u53ef\u4ee5\u751f\u6210\u6548\u7387\u66f4\u9ad8\u7684\u4ee3\u7801\uff0c\u8fd0\u884c\u66f4\u5feb\uff1b</li> <li>AOT\u7f16\u8bd1\uff08Ahead-Of-Time\uff09\uff1a\u5e94\u7528\u5b89\u88c5\u65f6\u5168\u91cf\u7f16\u8bd1\u6240\u6709\u4ee3\u7801\u4e3a\u672c\u5730\u673a\u5668\u7801\uff0c\u8fd0\u884c\u65f6\u76f4\u63a5\u6267\u884c\u673a\u5668\u7801\uff1b</li> </ul> <p>Dalvik\u5185\u5b58\u533a\u57df\u5757</p> <p>Linear Alloc\uff1a\u533f\u540d\u5171\u4eab\u5185\u5b58\uff0c\u53ea\u8bfb\u533a\u57df</p> <p>Zygote Space\uff1aZygote\u8fdb\u7a0b\u548c\u5e94\u7528\u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\uff0c\u5bf9\u8c61\u5728\u542f\u52a8\u65f6\u4f1a\u91cd\u65b0\u521b\u5efa</p> <p>Alloc Space\uff1a\u6bcf\u4e2a\u8fdb\u7a0b\u72ec\u5360\uff0c\u5206\u914d\u5bf9\u8c61\u533a\u57df</p> <p>Art\u5185\u5b58\u533a\u57df\u5757</p> <p>Non Moving Space</p> <p>Zygote Space</p> <p>Alloc Space</p> <p>Image Space\uff1a\u9884\u52a0\u8f7d\u7684\u7c7b\u4fe1\u606f\uff0cZygote\u8fdb\u7a0b\u548c\u5e94\u7528\u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab</p> <p>Large Obj Space\uff1a\u5206\u914d\u5927\u5bf9\u8c61\uff0c\u5982bitmap\uff0c\u6b64\u5904\u5bf9\u8c61\u53ea\u521b\u5efa\u4e00\u6b21</p> <p>\u8fd0\u884c\u65f6\u5806\u90fd\u5206\u4e3a\u524d3\u4e2a</p> Dalvik Art \u56de\u6536\u7b97\u6cd5 \u6807\u8bb0-\u6e05\u9664\u7b97\u6cd5 CMS\uff1f GC\u6682\u505c \u4e24\u6b21 \u4e00\u6b21 <ul> <li>4.4\u88ab\u5f15\u5165\uff0c5.0\u5f00\u59cb\u66ff\u6362Dalvik\u865a\u62df\u673a\uff0c7.0\u548c8.0\u5206\u522b\u8fdb\u884c\u4e00\u7cfb\u5217\u6539\u52a8</li> <li>4.4~7.0 ART\u53ea\u91c7\u7528AOT\u7f16\u8bd1\uff0c\u5728App\u5b89\u88c5\u65f6\u5c31\u7f16\u8bd1\u6240\u6709\u4ee3\u7801\u5b58\u50a8\u5728\u672c\u5730\uff0c\u6253\u5f00App\u76f4\u63a5\u8fd0\u884c\uff0c\u8fd9\u6837\u505a\u7684\u4f18\u70b9\u662f\u5e94\u7528\u8fd0\u884c\u901f\u5ea6\u53d8\u5feb\uff0c\u7f3a\u70b9\u4e5f\u5f88\u660e\u663e\uff0cApp\u5b89\u88c5\u65f6\u95f4\u660e\u663e\u53d8\u957f\uff0c\u800c\u4e14\u5360\u7528\u5b58\u50a8\u7a7a\u95f4\u8f83\u5927</li> <li>7.0 \u5f15\u5165\u4e86JIT\u7f16\u8bd1\uff0c\u7ed3\u5408\u4f7f\u7528AOT/JIT\u6df7\u5408\u7f16\u8bd1</li> <li>Android 8.0\u5f15\u5165\u4e86.vdex\u6587\u4ef6\uff0c\u5b83\u91cc\u9762\u5305\u542b APK \u7684\u672a\u538b\u7f29 DEX \u4ee3\u7801\uff0c\u4ee5\u53ca\u4e00\u4e9b\u7528\u4e8e\u52a0\u5feb\u9a8c\u8bc1\u901f\u5ea6\u7684\u5143\u6570\u636e</li> </ul> JVM Android\u865a\u62df\u673a \u865a\u62df\u673a\u6808 \u5c40\u90e8\u53d8\u91cf\u8868\u548c\u64cd\u4f5c\u6570\u6808 \u5bc4\u5b58\u5668 \u5806 Eden\u3001S0\u3001S1\u548c\u8001\u5e74\u4ee3 Alloc Space\u5148\u5f53\u4e8e\u65b0\u751f\u4ee3\uff0cLarge Obj Space\u76f8\u5f53\u4e8e\u8001\u5e74\u4ee3 \u52a0\u8f7d class\u6216jar dex <ul> <li> <p>\u57fa\u4e8e\u5bc4\u5b58\u5668\u6267\u884c\u6548\u7387\u597d\uff0c\u4f46\u662f\u53ef\u79fb\u690d\u6027\u5dee\uff0c\u96be\u8de8\u5e73\u53f0</p> </li> <li> <p>\u52a0\u8f7d\u901f\u5ea6\u5feb\uff0cdex\u76f8\u6bd4\u4e8eJar\u6587\u4ef6\u4f1a\u628a\u6240\u6709\u5305\u542b\u7684\u4fe1\u606f\u6574\u5408\u5728\u4e00\u8d77\uff0c\u51cf\u5c11\u4e86\u5197\u4f59\u4fe1\u606f\u3002\u8fd9\u6837\u5c31\u51cf\u5c11I/O\u64cd\u4f5c\uff0c\u63d0\u9ad8\u7c7b\u7684\u67e5\u627e\u901f\u5ea6</p> </li> </ul>"},{"location":"android/performance/android_memory_base/#_2","title":"\u8fdb\u7a0b\u5185\u5b58\u5206\u914d","text":"<p>\u901a\u8fc7getprop\u83b7\u53d6</p> <p>app\u542f\u52a8\u521d\u59cb\u5806\u5206\u914d\u7684\u5185\u5b58\uff1a</p> <p>[dalvik.vm.heapstartsize]: [8m]</p> <p>app\u6700\u5927\u5185\u5b58\u9650\u5236\uff1a</p> <p>[dalvik.vm.heapgrowthlimit]: [256m]</p> <p>\u5f00\u542flargeHeap=true\u540e\u7684\u6700\u5927\u9650\u5236</p> <p>[dalvik.vm.heapsize]: [512m]</p> <p>largeHeap\u4e3atrue\uff0c\u5219\u5185\u5b58\u5230heapsize\u624d\u4f1aOOM\uff0c\u5426\u5219\u8fbe\u5230 heapgrowthlimit\u5c31\u4f1aOOM</p>"},{"location":"android/performance/android_memory_base/#kill","title":"\u4f4e\u5185\u5b58kill\u8fdb\u7a0b\u673a\u5236","text":"<p>\u8fdb\u7a0b\u5206\u4e3a\uff1a\u7a7a\u8fdb\u7a0b\u3001\u540e\u53f0\u8fdb\u7a0b\u3001\u670d\u52a1\u8fdb\u7a0b\u3001\u53ef\u89c1\u8fdb\u7a0b\u3001\u524d\u53f0\u8fdb\u7a0b</p> <p>AMS\u4f1a\u5bf9\u8fdb\u7a0b\u8fdb\u884c\u8bc4\u5206\uff0c\u8bb0\u5f55\u5230adj\u4e2d</p> <p>oom_adj: ps\u67e5\u770bpid \u7136\u540e\u4f7f\u7528cat/pid/oom_adj\uff0c\u5185\u5b58\u4e0d\u8db3\u65f6\u6839\u636e\u6b64\u503c\u8fdb\u884ckill(\u4ece\u9ad8\u5230\u5e95) </p> <p>\u4fdd\u6d3b\u53ef\u4ee5\u7528workmanager</p>"},{"location":"android/performance/android_memory_commond/","title":"\u7cfb\u7edf\u547d\u4ee4","text":""},{"location":"android/performance/android_memory_commond/#_1","title":"\u5206\u6790\u5185\u5b58\u547d\u4ee4","text":""},{"location":"android/performance/android_memory_commond/#dumpsys-meminfo","title":"dumpsys meminfo","text":"<p>\u53ef\u4ee5\u770b\u5230\u4e0d\u540c\u6807\u51c6\u6392\u5e8f</p> <p>dumpsys meminfo \u5305\u540d</p> <p>\u5185\u5b58\u6307\u6807</p> \u542b\u4e49 \u7b49\u4ef7 USS \u7269\u7406\u5185\u5b58 \u8fdb\u7a0b\u72ec\u5360\u7684\u5185\u5b58 PSS \u7269\u7406\u5185\u5b58 PSS=USS+\u6309\u6bd4\u4f8b\u5305\u542b\u5171\u4eab\u5e93 RSS \u7269\u7406\u5185\u5b58 RSS=USS+\u5305\u542b\u5171\u4eab\u5e93 VSS \u865a\u62df\u5185\u5b58 VSS=RSS+\u672a\u5206\u914d\u5b9e\u9645\u7269\u7406\u5185\u5b58 <p>\u4e00\u822c\u5206\u6790PSS</p> <p>\u53ef\u4ee5\u5728\u754c\u9762\u8df3\u8f6c\u540e\u524d\u540edumpsys\u5bf9\u6bd4\u6570\u636e\uff0c\u53ea\u80fd\u5927\u6982\u5224\u65ad\u662f\u5426\u6709\u6cc4\u6f0f</p>"},{"location":"android/performance/android_memory_commond/#procrank","title":"procrank","text":""},{"location":"android/performance/android_memory_commond/#cat-procmeminfo","title":"cat /proc/meminfo","text":""},{"location":"android/performance/android_memory_commond/#free","title":"free","text":""},{"location":"android/performance/android_memory_commond/#showmap","title":"showmap","text":""},{"location":"android/performance/android_memory_commond/#vmstat","title":"vmstat","text":""},{"location":"android/performance/android_memory_commond/#_2","title":"\u603b\u7ed3","text":"<ol> <li>dumpsys meminfo \u9002\u7528\u573a\u666f\uff1a \u67e5\u770b\u8fdb\u7a0b\u7684oom adj\uff0c\u6216\u8005dalvik/native\u7b49\u533a\u57df\u5185\u5b58\u60c5\u51b5\uff0c\u6216\u8005\u67d0 \u4e2a\u8fdb\u7a0b\u6216apk\u7684\u5185\u5b58\u60c5\u51b5\uff0c\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff1b</li> <li>procrank \u9002\u7528\u573a\u666f\uff1a \u67e5\u770b\u8fdb\u7a0b\u7684VSS/RSS/PSS/USS\u5404\u4e2a\u5185\u5b58\u6307\u6807\uff1b</li> <li>cat /proc/meminfo \u9002\u7528\u573a\u666f\uff1a \u67e5\u770b\u7cfb\u7edf\u7684\u8be6\u5c3d\u5185\u5b58\u4fe1\u606f\uff0c\u5305\u542b\u5185\u6838\u60c5\u51b5\uff1b</li> <li>free \u9002\u7528\u573a\u666f\uff1a \u53ea\u67e5\u770b\u7cfb\u7edf\u7684\u53ef\u7528\u5185\u5b58\uff1b</li> <li>showmap \u9002\u7528\u573a\u666f\uff1a \u67e5\u770b\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5185\u5b58\u5206\u914d\u60c5\u51b5</li> </ol>"},{"location":"android/performance/android_memory_leak/","title":"\u5185\u5b58\u6cc4\u6f0f\u4f18\u5316","text":"<p>\u5f53\u5bf9\u8c61\u4e0d\u80fd\u88ab\u56de\u6536\u5bfc\u81f4\u5185\u5b58\u8d8a\u6765\u8d8a\u5c11\uff0c\u6700\u7ec8\u53ef\u80fd\u4f1aoom</p> <p>java\u5bf9\u8c61\u5b58\u6d3b</p> <p>\u5e38\u89c1\u6cc4\u6f0f\uff1a\u5355\u4f8bcontext(applicationContext\u6216\u8005\u624b\u52a8\u5c06\u5355\u4f8b\u7f6enull)\u3001handler(\u5f31\u5f15\u7528+\u9500\u6bc1removeMessage\u64cd\u4f5c)\u3001\u3001</p>"},{"location":"android/performance/android_memory_leak/#_1","title":"\u5e38\u89c1\u5185\u5b58\u6cc4\u6f0f\u539f\u56e0","text":"<ul> <li>\u9759\u6001\u53d8\u91cf\u6216\u5355\u4f8b(\u4e0d\u8981\u6301\u6709activity\u6216view\u7b49\u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u6539\u6210\u5f31\u5f15\u7528)</li> <li>\u975e\u9759\u6001\u7c7b\u6301\u6709\u9759\u6001\u5b9e\u4f8b\u5f15\u7528(\u6539\u6210\u9759\u6001\u5185\u90e8\u7c7b)</li> <li>\u533f\u540d\u5185\u90e8\u7c7b(Handler\uff0c\u53ef\u6539\u6210\u9759\u6001\u5185\u90e8\u7c7b\u6216\u8005\u5f31\u5f15\u7528\u65b9\u5f0f+\u9500\u6bc1removeMessage\u64cd\u4f5c)</li> <li>webview(\u901a\u8fc7\u52a8\u6001\u521b\u5efa+addView/removeView\u7684\u5f62\u5f0f\u6216\u72ec\u7acb\u8fdb\u7a0b\u9000\u51fa\u8c03\u7528System.exit)</li> <li>\u52a8\u753b\u95ee\u9898(activity\u9500\u6bc1\uff0c\u9700\u8981cancel\u52a8\u753b)</li> <li>\u6d41\u3001Cursor\u3001File\u7b49\u6ca1\u6709close\uff0cBitmap\u7684recycle(\u9ad8\u7248\u672c\u5176\u5b9e)</li> <li>\u7ebf\u7a0b\u6c60\u6ca1\u6709shutdown</li> <li>ThreadLocal\u4f7f\u7528\u4e0d\u5f53\u6cc4\u6f0f</li> <li>Activity\u6cc4\u6f0f(\u4e3b\u7ebf\u7a0b\u4e00\u76f4\u5728\u5237\u65b0UI\u6216\u8005\u52a8\u753b\u6267\u884c\uff0c\u6ce8\u610fView\u5237\u65b0\u5728onStop\u6539\u6210onPause\u5904\u7406)</li> </ul> <p>AMS\u515c\u5e95\u673a\u5236\uff1a\u542f\u52a8Activity\u65f6\uff0c\u4f1a\u542f\u52a8\u5b9a\u65f610s</p> <p>ActivityA(\u4e00\u76f4\u6267\u884c\u52a8\u753b) \u8df3\u8f6c\u5230ActivityB \u900f\u660e\u4e3b\u9898 finish\u540eB\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898</p> <p>onDestory 10s\u540e\u624d\u6267\u884c\u95ee\u9898</p> <p>\u539f\u56e0\uff1a\u524d\u8005\u662f\u56e0\u4e3aactivity\u5b58\u653e\u5728ActivityThread\u7684mNewActivities\uff0c\u800cmNewActivities=null\u6267\u884c\u662f\u5728</p> <p>Looper.myQueue().addIdleHandler(new Idler());</p> <p>IdleHandler\u662f\u7a7a\u95f2\u65f6\u624d\u6267\u884c\uff0c\u7531\u4e8e\u52a8\u753b\u5237\u65b0UI\u5bfc\u81f4Handler\u6ca1\u6709\u5904\u4e8e\u7a7a\u95f2\u5bfc\u81f4mNewActivities=null\u4e0d\u6267\u884c</p> <p>\u540e\u8005\u539f\u56e0\u4e5f\u7c7b\u4f3cac.activityIdle(a.token, a.createdConfig, stopProfiling)\u6ca1\u6267\u884c</p>"},{"location":"android/performance/android_memory_leak/#_2","title":"\u5185\u5b58\u6cc4\u6f0f\u5206\u6790\u5de5\u5177","text":"<p>MAT: \u5206\u6790hprof\u6587\u4ef6</p> <p>LeakCanary\uff1a\u7ebf\u4e0b\u4f7f\u7528\uff0c\u5b9e\u65f6\uff0c\u4ea7\u751fhprof\u6587\u4ef6</p> <p>Matrix</p> <p>Koom\uff1a\u7ebf\u4e0a\u4f7f\u7528\uff0c\u65e0\u6cd5\u5b9e\u65f6\uff0c\u4ea7\u751fhprof\u6587\u4ef6</p> <p>Android Studio Memory-profiler</p> <p>\u4f7f\u7528\u6559\u7a0b\uff1a https://developer.android.com/studio/profile/memory-profiler#performance</p> <p>\u70b9\u51fbCapture heap dump\u5373\u53ef\u5f97\u5230hprof\u6587\u4ef6</p>"},{"location":"android/performance/android_memory_oom/","title":"\u5185\u5b58\u6ea2\u51fa\u4f18\u5316","text":""},{"location":"android/performance/android_memory_oom/#oom","title":"\u5185\u5b58\u6ea2\u51fa(OOM)","text":"<p>\u5206\u7c7b\uff1aJava\u5806\u5185\u5b58\u6ea2\u51fa(\u5e38\u89c1)\u3001\u65e0\u8db3\u591f\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u3001FD\u6570\u91cf\u8d85\u51fa\u9650\u5236\u3001\u7ebf\u7a0b\u6570\u8d85\u51fa\u9650\u5236\u3001\u865a\u62df\u5185\u5b58\u4e0d\u8db3</p>"},{"location":"android/performance/android_memory_oom/#_1","title":"\u5e38\u89c1\u5185\u5b58\u6ea2\u51fa","text":"<ul> <li>\u5185\u5b58\u6296\u52a8</li> <li>\u5185\u5b58\u6cc4\u6f0f</li> <li>\u6587\u4ef6\u6570\u8fbe\u4e0a\u9650</li> <li>\u7ebf\u7a0b\u6570\u8fbe\u4e0a\u9650</li> <li>\u5185\u5b58\u4e0d\u8db3</li> </ul>"},{"location":"android/performance/android_memory_oom/#_2","title":"\u5206\u914d\u5927\u5185\u5b58","text":"<p>AndroidManifest\u4e2dandroid:largeHeap=\"true\"\uff0c\u83b7\u53d6\u5f53\u524d\u914d\u7f6e\u5185\u5b58\u5927\u5c0f\u548c\u6700\u5927\u5185\u5b58\u5927\u5c0f <pre><code>getSystemService(Context.ACTIVITY_SERVICE).let {it as ActivityManager\nval info = ActivityManager.MemoryInfo()// \u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\nit.getMemoryInfo(info)\nLog.e(\"tag\", \"memory: ${it.memoryClass}, large memory\uff1a ${it.largeMemoryClass}, info: ${info.availMem} ${info.totalMem}\")\n}\n</code></pre></p>"},{"location":"android/performance/android_memory_oom/#_3","title":"\u76d1\u542c\u91ca\u653e\u5185\u5b58\u54cd\u5e94","text":"<p>\u6839\u636e\u5185\u5b58level\u5904\u7406 <pre><code>class MainActivity : ComponentActivity(), ComponentCallbacks2 {\noverride fun onTrimMemory(level: Int) {\nsuper.onTrimMemory(level)\n}\n</code></pre></p>"},{"location":"android/performance/android_memory_shake/","title":"\u5185\u5b58\u6296\u52a8\u4f18\u5316","text":"<p>\u77ed\u65f6\u95f4\u5185\u5b58\u53cd\u590d\u53d1\u751f\u589e\u957f\u548c\u56de\u6536\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5361\u987f\u548coom</p> <p>\u5361\u987f\uff1agc\u56de\u6536\u4e2d\u4f1a\u6709stw\u4f7f\u5f97\u5de5\u4f5c\u7ebf\u7a0b(\u5305\u62ec\u4e3b/\u5b50\u7ebf\u7a0b)\u6682\u505c</p> <p>oom\uff1a\u5982\u679c\u5783\u573e\u56de\u6536\u91c7\u7528\u7684\u65f6\u6807\u8bb0-\u6e05\u9664\u6cd5\u4f1a\u51fa\u73b0\u5927\u91cf\u5185\u5b58\u788e\u7247\uff0c\u6b64\u65f6\u521b\u5efa\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u5bf9\u8c61(\u5982\u6570\u7ec4)\u65f6\u7531\u4e8e\u6ca1\u6709\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u5bfc\u81f4oom</p>"},{"location":"android/performance/android_memory_shake/#_1","title":"\u76d1\u63a7\u5de5\u5177","text":"<p>BlockCanary</p> <p>Matrix</p> <p>\u90fd\u662f\u91c7\u7528AOP\u601d\u60f3</p> <p>\u5207\u9762</p> <p>BaseActivity\uff1a\u4fb5\u5165\u6027\u592a\u5f3a</p> <p>Message</p>"},{"location":"android/performance/android_memory_shake/#_2","title":"\u5e38\u89c1\u5185\u5b58\u6296\u52a8","text":"<ul> <li>\u5b57\u7b26\u4e32\u62fc\u63a5(StringBuilder\u4ee3\u66ff+)\uff0cColor.parseColor()</li> <li>\u5728\u5faa\u73af\u91cc\u9762\u521b\u5efa\u5bf9\u8c61</li> <li>\u5728onDraw\u91cc\u9762\u521b\u5efa\u5bf9\u8c61</li> <li>bitmap</li> </ul>"},{"location":"android/performance/android_memory_shake/#_3","title":"\u5185\u5b58\u6296\u52a8\u5206\u6790\u5de5\u5177","text":"<p>Android Studio Memory-profiler\u4e2d</p> <p>Record native allocations</p> <p>Record Java/Kotlin allocations</p> <p>\u6839\u636e\u4e0a\u4e0b\u6587\u73af\u5883\u4f18\u5316\u5bf9\u8c61\u521b\u5efa</p>"},{"location":"android/performance/android_memory_shake/#_4","title":"\u4f18\u5316\u624b\u6bb5","text":"<p>\u4f18\u5316\u672c\u8d28\uff1a\u51cf\u5c11\u5bf9\u8c61\u7684\u521b\u5efa</p> <p>\u5bf9\u8c61\u6c60\uff0c\u53ef\u53c2\u8003Handler\u3001Glide\u3001Okhttp\u7b49</p> <p>Handler\uff1a\u91c7\u7528\u5355\u9879\u94fe\u8868\u5b9e\u73b0</p> <p>Glide\uff1a\u53ccMap\u5b9e\u73b0</p> <p>\u7f3a\u9677\u5c31\u662f\u6570\u7ec4\u5bf9\u8c61\u6c60\u4e2dkey\u4e0d\u662f\u57fa\u672c\u6570\u636e\u7c7b\u578b\u4f1a\u4ea7\u751f\u5927\u91cfInteger\u5bf9\u8c61</p> <p>\u4f18\u5316\u65b9\u5f0f\u662f\u4f7f\u7528\u4eff\u7167SparseArray\u7ed3\u5408TreeMap\u5b9e\u73b0\uff0cTreeMap\u4e3b\u8981\u6709ceilingKey\u65b9\u6cd5\u9700\u8981\u6a21\u4eff\u3002</p> <p>ceilingKey\u65b9\u6cd5\u4f5c\u7528</p> <p>\u6570\u7ec4\u5982byte[]\u9700\u898125\u4e2a\u5927\u5c0f\uff0c\u800c\u5bf9\u8c61\u6c60\u4e2d\u53ea\u670920\u621630\u7684\u5927\u5c0f\uff0c\u6b64\u65f6\u901a\u8fc7ceilingKey\u53ef\u4ee5\u83b7\u53d6\u523030\u5927\u5c0f</p> <p>\u4e3a\u4f55\u4e0d\u76f4\u63a5\u521b\u5efa25\u4e2a\u5927\u5c0f\u7684\u6570\u7ec4\u5462\uff1f \u8fdd\u53cd\u672c\u8d28\u662f\u8f83\u5c11\u5bf9\u8c61\u521b\u5efa</p>"},{"location":"android/performance/android_start/","title":"\u542f\u52a8\u4f18\u5316","text":"<p>\u51c6\u5907\u77e5\u8bc6\uff1aapp\u542f\u52a8\u6d41\u7a0b\u3001DAG\u3001\u62d3\u6b65\u6392\u5e8f\u3001\u7ebf\u7a0b\u76f8\u5173</p> <p>\u9ed1\u767d\u5c4f\uff1a splashscreen PhoneWindow\u4e2d\u89e3\u6790</p> <p>context\uff1a\u88c5\u9970\u8005\u6a21\u5f0f</p> <p>\u4f18\u5316\u90e8\u5206\uff1a</p> <p>Application attachBaseContext \u5b57\u8282\u4f18\u5316</p> <p>attach-onCreate-onStart-onResume</p> <p>attach: \u521b\u5efa\u4e0a\u4e0b\u6587\uff0c\u521b\u5efawindow</p> <p>activity\u7ba1\u7406window\uff0cwindow\u7ba1\u7406view</p> <p>onWindowFocusChanged\u662f\u771f\u6b63\u663e\u793a</p> <p>setContentView\u6bd4\u81ea\u5b9a\u4e49view\u6162\uff1f\u56e0\u4e3a\u901a\u8fc7\u89e3\u6790xml \u53cd\u5c04 \u8f6c\u6210view \u4f18\u5316\u65b9\u5f0f\uff1a\u65e0\uff0c\u53ea\u80fd\u51cf\u5c11xml\u4e2d\u7684\u5e03\u5c40\u5c42\u7ea7\uff0c\u6839\u672c\u89e3\u51b3\u65b9\u6848compose</p> <p>onResume\u53ef\u4f18\u5316</p> <p>Looper.myQueue().addIdleHandler {     false }</p>"},{"location":"android/performance/android_start/#dag","title":"\u6709\u5411\u65e0\u73af\u56feDAG","text":"<p>\u8868\u793a\u4e8b\u4ef6\u4e4b\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u7ba1\u7406\u4efb\u52a1\u4e4b\u95f4\u7684\u8c03\u5ea6</p> <p></p> <p>\u9876\u70b9\uff1a\u56fe\u4e2d\u7684\u4e00\u4e2a\u70b9\uff0c\u6bd4\u5982\u9876\u70b9Java\uff0c\u9876\u70b9Socket</p> <p>\u8fb9\uff1a\u8fde\u63a5\u4e24\u4e2a\u9876\u70b9\u7684\u7ebf\u6bb5\u53eb\u505a\u8fb9</p> <p>\u5165\u5ea6\uff1a\u4ee3\u8868\u5f53\u524d\u6709\u591a\u5c11\u8fb9\u6307\u5411\u5b83\uff0c\u5982Java\u5165\u5ea6\u4e3a0\uff0cSocket\u5165\u5ea6\u4e3a1</p> <p>\u51fa\u5ea6\uff1a\u4ee3\u8868\u5f53\u524d\u6307\u5411\u5176\u4ed6\u7684\u8fb9\u6570\uff0c\u5982Java\u51fa\u5ea6\u4e3a2</p>"},{"location":"android/performance/android_start/#_1","title":"\u62d3\u6251\u6392\u5e8f","text":"<p>\u5bf9\u4e00\u4e2a\u6709\u5411\u56fe\u6784\u9020\u62d3\u6251\u5e8f\u5217\u7684\u8fc7\u7a0b</p> <p>\u4e24\u79cd\u7b97\u6cd5\uff1a\u5165\u5ea6\u8868\u6cd5(BFS\u6cd5\u5373\u5e7f\u5ea6\u4f18\u5148\u641c\u7d22)\u548cDFS\u6cd5(\u6df1\u5ea6\u4f18\u5148\u641c\u7d22)</p>"},{"location":"android/performance/android_start/#_2","title":"\u5165\u5ea6\u8868\u6cd5","text":"<ol> <li>\u627e\u5230\u56fe\u4e2d\u5165\u5ea6\u4e3a0\u7684\u9876\u70b9</li> <li>\u53cd\u590d\u5220\u9664\u9876\u70b9\u518d\u627e\u5165\u5ea6\u4e3a0\u7684\u9876\u70b9\uff0c\u5b8c\u6210\u6392\u5e8f</li> </ol> <p>\u4e0a\u56fe\u4e2d\u7ed3\u679c\uff1a</p> <p>Java-Socket-\u8bbe\u8ba1\u6a21\u5f0f-Http\u534f\u8bae-OkHttp</p> <p>\u62d3\u6251\u6392\u5e8f\u4e0d\u552f\u4e00\uff1aJava\u540e\u53ef\u4ee5\u662fSocket\u4e5f\u53ef\u4ee5\u662f\u8bbe\u8ba1\u6a21\u5f0f</p>"},{"location":"android/performance/android_start/#dfs","title":"DFS","text":"<ol> <li>\u6df1\u5ea6\u641c\u7d22</li> <li>\u627e\u5230\u56fe\u4e2d\u51fa\u5ea6\u4e3a0\u7684\u9876\u70b9</li> </ol> <p>Java-Socket-Http\u534f\u8bae-Okhttp</p> <p>Okhttp-Http\u534f\u8bae-Socket\u540e\u8bbe\u8ba1\u6a21\u5f0f\u7684\u51fa\u5ea6\u4e3a0\uff0c\u6240\u4ee5\u662f\u8bbe\u8ba1\u6a21\u5f0f-Java</p> <p>\u6700\u7ec8\u7ed3\u679c\u662f\u62ff\u9006\u5e8f\uff1a</p> <p>Java-\u8bbe\u8ba1\u6a21\u5f0f-Socket-Http\u534f\u8bae-Okhttp</p> <p>CountDownLatch\u5b8c\u6210\u7ebf\u7a0b\u6267\u884c\u987a\u5e8f \u4e09\u65b9sdk\u901a\u8fc7\u5b57\u8282\u7801\u63d2\u6869 gradle\u4fee\u6539\u5185\u90e8\u5b50\u7ebf\u7a0b\u542f\u52a8\u7b49</p>"},{"location":"android/performance/android_ui/","title":"UI\u4f18\u5316","text":""},{"location":"android/performance/android_ui/#_1","title":"\u5e03\u5c40\u4f18\u5316","text":""},{"location":"android/performance/android_ui/#webview","title":"WebView\u4f18\u5316","text":"<p>webview</p>"},{"location":"android/ui/ui_anim/","title":"\u52a8\u753b","text":""},{"location":"android/ui/ui_anim/#renderthread","title":"RenderThread","text":"<p>\u6e32\u67d3\u7ebf\u7a0b\uff0cAndroid5.0\u4e4b\u540e\u5c06Open GL\u7ebf\u7a0b\u72ec\u7acb\u51fa\u6765\u7684\u7ebf\u7a0b</p> <p>\u786c\u4ef6\u52a0\u901f\uff1a\u901a\u8fc7GPU\u6e32\u67d3\uff0cAndroid4.0\u9ed8\u8ba4\u5f00\u542f\uff0c</p> <p>GPU\uff1a\u786c\u4ef6\uff0c\u7531GPU\u5382\u5546\u6309\u7167Open GL\u89c4\u8303\u5b9e\u73b0\u7684\u9a71\u52a8</p> <p>Open GL\u7ebf\u7a0b\uff1a\u5904\u7406\u786c\u4ef6\u52a0\u901f\u7ed8\u5236\u7684\u7ebf\u7a0b</p>"},{"location":"android/ui/ui_anim/#android","title":"Android\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u8f6f\u4ef6\u7ed8\u5236</p> <p>CPU\u4e3b\u5bfc\uff0c\u6bcf\u4e2a\u7a97\u53e3\u5173\u8054\u4e00\u4e2aSurface\uff0clockCanvas\u65b9\u6cd5\u83b7\u53d6\u4e00\u4e2aCanvas\uff0cSurfaceFlinger\uff0cGraphicBuffer</p> <p>\u786c\u4ef6\u7ed8\u5236</p> <p>GPU\u4e3b\u5bfc</p>"},{"location":"android/ui/ui_anim/#_1","title":"\u8f6c\u573a\u52a8\u753b","text":"<p>https://blog.csdn.net/chennai1101/article/details/81984104</p> <p>z\u8f74\u4fee\u6539\u95ee\u9898\uff1a\u53ea\u80fd\u5faa\u73af\u4fee\u6539ViewGroup\u7684clipChildren\u5c5e\u6027 <pre><code> private fun clipAllViewGroup(v: View, clipChild: Boolean) {\n    if (v.parent == null || v.parent !is ViewGroup) return\n    (v.parent as ViewGroup).clipChildren = clipChild\n    clipAllViewGroup(v.parent as ViewGroup, clipChild)\n}\n</code></pre></p>"},{"location":"android/ui/ui_camera/","title":"Camera","text":""},{"location":"android/ui/ui_camera/#camerax","title":"CameraX","text":""},{"location":"android/ui/ui_camera/#_1","title":"\u57fa\u672c\u914d\u7f6e","text":"<p>\u6dfb\u52a0\u6743\u9650 <pre><code>&lt;uses-feature\nandroid:name=\"android.hardware.camera\"\nandroid:required=\"false\" /&gt;\n\n&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n&lt;uses-permission android:name=\"android.permission.RECORD_AUDIO\" /&gt;\n&lt;uses-permission\nandroid:name=\"android.permission.WRITE_EXTERNAL_STORAGE\"\nandroid:maxSdkVersion=\"28\" /&gt;\n</code></pre> \u6dfb\u52a0\u4f9d\u8d56 <pre><code>def cameraxVersion = \"1.3.0\"\nimplementation(\"androidx.camera:camera-core:${cameraxVersion}\")\nimplementation(\"androidx.camera:camera-camera2:${cameraxVersion}\")\nimplementation(\"androidx.camera:camera-lifecycle:${cameraxVersion}\")\nimplementation(\"androidx.camera:camera-video:${cameraxVersion}\")\nimplementation(\"androidx.camera:camera-view:${cameraxVersion}\")\nimplementation(\"androidx.camera:camera-extensions:${cameraxVersion}\")\n</code></pre> \u6dfb\u52a0\u9884\u89c8view <pre><code>&lt;androidx.camera.view.PreviewView\nandroid:id=\"@+id/cameraPreView\"\nandroid:layout_width=\"match_parent\"\nandroid:layout_height=\"match_parent\" /&gt;\n</code></pre></p>"},{"location":"android/ui/ui_camera/#_2","title":"\u6743\u9650\u7533\u8bf7","text":"<p><pre><code>companion object {\nprivate const val TAG: String = \"CameraXActivity\"\nprivate const val REQUEST_CODE_PERMISSIONS = 10\nprivate val REQUIRED_PERMISSIONS = mutableListOf(\nManifest.permission.CAMERA,\nManifest.permission.RECORD_AUDIO\n).toTypedArray()\n}\n</code></pre> \u70b9\u51fb\u9884\u89c8\u65f6\u7533\u8bf7\u6743\u9650 <pre><code>getBinding().btnCamera.click {\nif (checkPermission())\nstartCamera()\nelse ActivityCompat.requestPermissions(\nthis,\nREQUIRED_PERMISSIONS,\nREQUEST_CODE_PERMISSIONS\n)\n}\n\nprivate fun checkPermission() = REQUIRED_PERMISSIONS.all {\nContextCompat.checkSelfPermission(\nbaseContext,\nit\n) == PackageManager.PERMISSION_GRANTED\n}\n\noverride fun onRequestPermissionsResult(\nrequestCode: Int,\npermissions: Array&lt;out String&gt;,\ngrantResults: IntArray\n) {\nsuper.onRequestPermissionsResult(requestCode, permissions, grantResults)\nif (requestCode == REQUEST_CODE_PERMISSIONS) {\nif (checkPermission())\nstartCamera()\n}\n}\n</code></pre></p>"},{"location":"android/ui/ui_camera/#_3","title":"\u5f00\u542f\u9884\u89c8","text":"<pre><code>private val imageCapture: ImageCapture by lazy {\nImageCapture.Builder()\n.setCaptureMode(ImageCapture.CAPTURE_MODE_MINIMIZE_LATENCY)\n.setTargetResolution(Size(1200, 2652)) // \u65b9\u6cd5\u8fc7\u65f6\u4f46\u4e0d\u8bbe\u7f6e\u6700\u7ec8\u7167\u7247\u548c\u9884\u89c8\u5927\u5c0f\u4e0d\u4e00\u81f4\n.setFlashMode(ImageCapture.FLASH_MODE_AUTO)\n.build()\n}\nprivate var cameraSelector: CameraSelector = CameraSelector.DEFAULT_BACK_CAMERA\nprivate var cameraProvider: ProcessCameraProvider? = null\nprivate fun startCamera() {\n// \u83b7\u53d6\u76f8\u673a\u5355\u4f8b\nProcessCameraProvider.getInstance(this).apply {\n// \u6dfb\u52a0\u76d1\u542c\naddListener(\n{\ncameraProvider = get() // \u83b7\u53d6\u76f8\u673a\n// \u6307\u5b9a\u9884\u89c8\u7684\u76f8\u673a\nbindPreview(cameraProvider!!, imageCapture, cameraSelector)\n}, ContextCompat.getMainExecutor(this@CameraXActivity)\n)\n}\n}\n</code></pre>"},{"location":"android/ui/ui_camera/#_4","title":"\u63a7\u5236\u95ea\u5149\u706f","text":"<pre><code>private var flashCount: Int = 0\nprivate fun changeFlash() {\nval imageCapture = imageCapture ?: return\nif (!turnCamera) return\nflashCount++\nval flashMode = when (flashCount % 3) {\n0 -&gt; {\ngetBinding().btnFlash.text = \"\u95ea\u5149\u706f(\u5173\u95ed)\"\nImageCapture.FLASH_MODE_OFF\n}\n1 -&gt; {\ngetBinding().btnFlash.text = \"\u95ea\u5149\u706f(\u6253\u5f00)\"\nImageCapture.FLASH_MODE_ON\n}\nelse -&gt; {\ngetBinding().btnFlash.text = \"\u95ea\u5149\u706f(\u81ea\u52a8)\"\nImageCapture.FLASH_MODE_AUTO\n}\n}\nimageCapture.flashMode = flashMode\n}\n</code></pre>"},{"location":"android/ui/ui_camera/#_5","title":"\u5207\u6362\u6444\u50cf\u5934","text":"<pre><code>private fun turnCamera() {\nval cameraProvider = cameraProvider ?: return\ncameraSelector = if (turnCamera) {\ngetBinding().btnTurnCamera.text = \"\u6444\u50cf\u5934(\u524d\u7f6e)\"\nturnCamera = false\nCameraSelector.DEFAULT_FRONT_CAMERA\n} else {\ngetBinding().btnTurnCamera.text = \"\u6444\u50cf\u5934(\u540e\u7f6e)\"\nturnCamera = true\nCameraSelector.DEFAULT_BACK_CAMERA\n}\nbindPreview(cameraProvider, imageCapture, cameraSelector)\n}\n\nprivate fun bindPreview(\ncameraProvider: ProcessCameraProvider,\nimageCapture: ImageCapture,\ncameraSelector: CameraSelector\n) {\ntry {\ncameraProvider.unbindAll() // \u7ed1\u5b9a\u4e4b\u524d\u5148\u89e3\u7ed1\n// \u521b\u5efa\u5e76\u8bbe\u7f6e\u76f8\u673a\u9884\u89c8\u7a97\u53e3\nval preview = Preview.Builder().build().also {\n// \u7ed1\u5b9a\u5e03\u5c40\u4e2d\u7684Preview\u8fdb\u884c\u9884\u89c8\nit.setSurfaceProvider(getBinding().cameraPreView.surfaceProvider)\n}\n// \u591a\u4e2a\u6444\u50cf\u5934\u540c\u65f6\u4f7f\u7528\n//            val viewPort = ViewPort.Builder(Rational(1080, 1920), display!!.rotation).build()\n//            val useCaseGroup = UseCaseGroup.Builder()\n//                .addUseCase(preview)\n//                .addUseCase(imageCapture)\n//                .setViewPort(viewPort)\n//                .build()\n//            val selectors = cameraSelector.map {\n//                ConcurrentCamera.SingleCameraConfig(it, useCaseGroup, this)\n//            }\nval camera = cameraProvider.bindToLifecycle(this, cameraSelector, preview, imageCapture)\n} catch (e: Exception) {\nLog.e(\"tag\", \"startCamera: ${e.message}\")\n}\n}\n</code></pre>"},{"location":"android/ui/ui_camera/#_6","title":"\u62cd\u7167\u5e76\u4fdd\u5b58\u5230\u76f8\u518c","text":"<p><pre><code>private fun takePhoto() {\nval name = SimpleDateFormat(\"yyyy-MM-dd-HH-mm-ss-SSS\", Locale.US)\n.format(System.currentTimeMillis())\nval contentValues = ContentValues().apply {\nput(MediaStore.MediaColumns.DISPLAY_NAME, name)\nput(MediaStore.MediaColumns.MIME_TYPE, \"image/jpeg\")\nif (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.P) {\nput(MediaStore.Images.Media.RELATIVE_PATH, \"Pictures/CameraX-Image\")\n}\n}\nval outputOptions = ImageCapture.OutputFileOptions\n.Builder(\ncontentResolver,\nMediaStore.Images.Media.EXTERNAL_CONTENT_URI,\ncontentValues\n)\n.setMetadata(ImageCapture.Metadata().also {\nit.isReversedHorizontal = !turnCamera\n})\n.build()\n\nimageCapture.takePicture(\noutputOptions,\nContextCompat.getMainExecutor(this),\nobject : ImageCapture.OnImageSavedCallback {\noverride fun onError(exc: ImageCaptureException) {\nLog.e(TAG, \"Photo capture failed: ${exc.message}\", exc)\n}\n\noverride fun\nonImageSaved(output: ImageCapture.OutputFileResults) {\nlifecycleScope.launch {\nit.transformRotation(contentResolver, !turnCamera)\n}\n}\n}\n)\n}\n</code></pre> \u7531\u4e8e\u524d\u7f6e\u6444\u50cf\u5934\u62cd\u6444\u7684\u7167\u7247\u4f1a\u5de6\u53f3\u76f8\u53cd\uff0c\u9700\u8981\u624b\u52a8\u8f6c\u6362\u540e\u518d\u91cd\u65b0\u4fdd\u5b58 <pre><code>suspend fun Uri.transformRotation(\ncontentResolver: ContentResolver,\nisReversedHorizontal: Boolean\n) {\nif (!isReversedHorizontal) return\nwithContext(Dispatchers.IO) {\ncontentResolver.openInputStream(this@transformRotation)?.use { input -&gt;\nval originalBitmap = BitmapFactory.decodeStream(input)\nval preMatrix = Matrix().apply { preScale(-1f, 1f) }\nval flippedBitmap = Bitmap.createBitmap(\noriginalBitmap, 0, 0, originalBitmap.width,\noriginalBitmap.height, preMatrix, true\n)\ncontentResolver.openOutputStream(this@transformRotation)?.let { output -&gt;\noutput.use { useOutput -&gt;\nflippedBitmap.compress(Bitmap.CompressFormat.JPEG, 100, useOutput)\n}\n}\n}\n}\n}\n</code></pre></p>"},{"location":"android/ui/ui_camera/#_7","title":"\u83b7\u53d6\u7167\u7247\u771f\u5b9e\u8def\u5f84","text":"<p><pre><code>suspend fun Uri.getFilePath(context: Context): String? {\nreturn withContext(Dispatchers.IO) {\nvar filePath: String? = null\nval cursor = context.contentResolver.query(this@getFilePath, null, null, null, null)\ncursor?.use {\nif (it.moveToFirst()) {\nval index = it.getColumnIndex(MediaStore.Images.Media.DATA)\nfilePath = it.getString(index)\n}\n}\nif (filePath.isNullOrEmpty()) {\nfilePath = if (DocumentsContract.isDocumentUri(context, this@getFilePath)) {\n// \u5904\u7406 Document \u7c7b\u578b\u7684 URI\nval docId = DocumentsContract.getDocumentId(this@getFilePath)\nval split = docId.split(\":\").toTypedArray()\nif (split.size &gt; 1 &amp;&amp; \"primary\".equals(split[0], ignoreCase = true)) {\n\"${context.getExternalFilesDir(null)}/${split[1]}\"\n} else {\nnull\n}\n} else if (\"content\".equals(this@getFilePath.scheme, ignoreCase = true)) {\n// \u5904\u7406 Content \u7c7b\u578b\u7684 URI\nval projection = arrayOf(MediaStore.Images.Media.DATA)\ncontext.contentResolver.query(this@getFilePath, projection, null, null, null)?.use { cursor -&gt;\nif (cursor.moveToFirst()) {\nval columnIndex = cursor.getColumnIndexOrThrow(MediaStore.Images.Media.DATA)\ncursor.getString(columnIndex)\n} else {\nnull\n}\n}\n} else if (\"file\".equals(this@getFilePath.scheme, ignoreCase = true)) {\n// \u5904\u7406 File \u7c7b\u578b\u7684 URI\nthis@getFilePath.path\n} else {\nnull\n}\n}\nfilePath\n}\n}\n</code></pre> \u8c03\u7528 <pre><code>lifecycleScope.launch {\nit.transformRotation(contentResolver, !turnCamera)\nval path = it.getFilePath(this@CameraXActivity)\nToast.makeText(\nthis@CameraXActivity,\n\"\u4fdd\u5b58\u5b8c\u6bd5:$path\",\nToast.LENGTH_LONG\n).show()\n}\n</code></pre></p>"},{"location":"android/ui/ui_camera/#_8","title":"\u56fe\u7247\u76f8\u5173\u51fd\u6570","text":"<p>\u83b7\u53d6\u56fe\u7247\u65cb\u8f6c\u5ea6\u6570 <pre><code>fun Uri.getPictureRotation(contentResolver: ContentResolver): Int {\nreturn contentResolver.openInputStream(this)?.use { input -&gt;\nval exifInterface = if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {\nExifInterface(input)\n} else {\nExifInterface(this.path!!)\n}\nval rotationFlag = exifInterface.getAttributeInt(\nExifInterface.TAG_ORIENTATION,\nExifInterface.ORIENTATION_NORMAL\n)\nwhen (rotationFlag) {\nExifInterface.ORIENTATION_ROTATE_90 -&gt; 90\nExifInterface.ORIENTATION_ROTATE_180 -&gt; 180\nExifInterface.ORIENTATION_ROTATE_270 -&gt; 270\nelse -&gt; 0\n}\n} ?: 0\n}\n</code></pre></p>"},{"location":"android/ui/ui_constraintLayout/","title":"ConstraintLayout","text":""},{"location":"android/ui/ui_constraintLayout/#_1","title":"\u4f7f\u7528\u767e\u5206\u6bd4","text":"<p><pre><code>&lt;style name=\"ParentDefaultStyle\"&gt;\n&lt;item name=\"android:layout_width\"&gt;0dp&lt;/item&gt;\n&lt;item name=\"android:layout_height\"&gt;0dp&lt;/item&gt;\n&lt;item name=\"layout_constraintWidth_default\"&gt;percent&lt;/item&gt;\n&lt;item name=\"layout_constraintHeight_default\"&gt;percent&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> \u8bbe\u7f6e\u7ec4\u4ef6\u5bbd\u9ad81\uff1a1 <pre><code>&lt;androidx.constraintlayout.widget.Guideline\nandroid:id=\"@+id/albumGuidelineL\"\nandroid:layout_width=\"wrap_content\"\nandroid:layout_height=\"wrap_content\"\nandroid:orientation=\"vertical\"\napp:layout_constraintGuide_percent=\"0.097\" /&gt;\n\n&lt;androidx.constraintlayout.widget.Guideline\nandroid:id=\"@+id/albumGuidelineR\"\nandroid:layout_width=\"wrap_content\"\nandroid:layout_height=\"wrap_content\"\nandroid:orientation=\"vertical\"\napp:layout_constraintGuide_percent=\"0.321\" /&gt;\n\n&lt;androidx.appcompat.widget.AppCompatImageView\nandroid:id=\"@+id/album\"\nstyle=\"@style/ParentDefaultStyle\"\nandroid:src=\"@mipmap/default_album\"\napp:layout_constraintBottom_toBottomOf=\"parent\"\napp:layout_constraintDimensionRatio=\"1:1\"\napp:layout_constraintEnd_toStartOf=\"@id/albumGuidelineR\"\napp:layout_constraintStart_toEndOf=\"@+id/albumGuidelineL\"\napp:layout_constraintTop_toTopOf=\"parent\" /&gt; </code></pre></p>"},{"location":"android/ui/ui_view/","title":"View&lifecycle","text":""},{"location":"android/ui/ui_view/#viewlifecycle","title":"\u81ea\u5b9a\u4e49view\u4e4blifecycle","text":"<pre><code>abstract class BaseView @JvmOverloads constructor(\ncontext: Context, attrs: AttributeSet? = null,\ndefStyleAttr: Int = 0\n) : FrameLayout(context, attrs, defStyleAttr), LifecycleOwner {\n\nprivate val lifecycleRegistry by lazy { LifecycleRegistry(this) }\n\ninit {\nlifecycleRegistry.currentState = Lifecycle.State.CREATED\n}\n\noverride fun onAttachedToWindow() {\nsuper.onAttachedToWindow()\nlifecycleRegistry.currentState = Lifecycle.State.STARTED\n}\n\noverride fun onDetachedFromWindow() {\nsuper.onDetachedFromWindow()\nlifecycleRegistry.currentState = Lifecycle.State.DESTROYED\n}\n\noverride val lifecycle: Lifecycle\nget() = lifecycleRegistry\n}\n</code></pre>"},{"location":"android/ui/ui_webview/","title":"WebView","text":""},{"location":"android/ui/ui_webview/#_1","title":"\u5e38\u89c1\u914d\u7f6e\u95ee\u9898","text":"<p>\u7f51\u9875\u4e0d\u663e\u793a\uff0c\u8bf4\u660e\u6ca1\u6709\u5f00\u542fJavaScript <pre><code>webview.settings.javaScriptEnabled = true\n</code></pre> \u7f51\u9875\u52a0\u8f7d\u540e\u62a5\u9519\uff0c\u8bf4\u660e\u8bbe\u7f6e\u4e86WebViewClient\uff0c\u9700\u5728AndroidManifest\u4e2d\u6dfb\u52a0usesCleartextTraffic <pre><code>&lt;application android:usesCleartextTraffic=\"true\"&gt;\n</code></pre></p>"},{"location":"android/ui/ui_webview/#androidh5","title":"Android\u8c03\u7528H5","text":""},{"location":"android/ui/ui_webview/#1","title":"\u65b9\u5f0f1","text":"<p><pre><code>webview.loadUrl(\"javascript:funName()\")\n</code></pre> \u4e0d\u80fd\u83b7\u53d6\u8fd4\u56de\u503c</p>"},{"location":"android/ui/ui_webview/#2","title":"\u65b9\u5f0f2","text":"<pre><code>evaluateJavascript(\"funName()\") { returnStr-&gt; }\n</code></pre>"},{"location":"android/ui/ui_webview/#h5android","title":"H5\u8c03\u7528Android","text":""},{"location":"android/ui/ui_webview/#1_1","title":"\u65b9\u5f0f1","text":"<pre><code>addJavascriptInterface(JsInterface(), \"android\")\n\nprivate inner class JsInterface {\n@JavascriptInterface\nfun jsCallback(content: String) {\n\n}\n}\n</code></pre>"},{"location":"android/ui/ui_webview/#2_1","title":"\u65b9\u5f0f2","text":"<p>WebViewClient\u4e2d\u91cd\u5199\u65b9\u6cd5 <pre><code>override fun shouldOverrideUrlLoading(view: WebView?, request: WebResourceRequest?): Boolean {\nreturn super.shouldOverrideUrlLoading(view, request)\n}\n</code></pre> \u4e00\u822c\u7528\u4e8e\u62e6\u622a\u94fe\u63a5\uff0c\u8fd4\u56detrue\u8868\u793a\u62e6\u622a</p>"},{"location":"android/ui/ui_webview/#3","title":"\u65b9\u5f0f3","text":"<p>WebViewChromeClient\u4ece\u91cd\u5199\u65b9\u6cd5onJsAlert\u3001onJsConfirm\u3001onJsPrompt</p>"},{"location":"android/ui/ui_webview/#_2","title":"\u4f18\u5316\u65b9\u6848","text":"<ol> <li>WebView \u52a8\u6001\u52a0\u8f7d\u548c\u9500\u6bc1</li> <li>\u72ec\u7acb\u7684web\u8fdb\u7a0b\uff0c\u4e0e\u4e3b\u8fdb\u7a0b\u9694\u5f00\uff0c\u89e3\u51b3\u4efb\u4f55webview\u5185\u5b58\u6cc4\u6f0f\u4e4b\u7c7b\u7684\u95ee\u9898</li> <li>\u5b9e\u73b0WebView\u590d\u7528</li> <li>DNS\u89e3\u6790\u4f18\u5316\uff08\u63a5\u53e3\u4e0e\u7f51\u9875\u4e3b\u57df\u540d\u4e00\u81f4\uff09</li> <li>\u79bb\u7ebf\u9884\u63a8\uff0c\u4e0b\u53d1\u79bb\u7ebf\u5305\uff0c\u5e76\u589e\u91cf\u66f4\u65b0</li> <li>\u7f51\u9875\u6309\u8282\u70b9\u5c40\u90e8\u5237\u65b0</li> <li>\u81ea\u5b9a\u4e49\u5b9e\u73b0\u56fe\u7247\u8d44\u6e90\u7f13\u5b58</li> <li>\u52a0\u8f7d\u672c\u5730\u7f51\u9875</li> </ol>"},{"location":"android/ui/ui_webview/#_3","title":"\u72ec\u7acb\u8fdb\u7a0b\u601d\u8def","text":"<p>Manifest\u4e2d\u7533\u660eWebViewActivity\u5728\u5176\u4ed6\u8fdb\u7a0b\uff0c\u518d\u58f0\u660e\u4e00\u4e2aService <pre><code>&lt;activity\nandroid:name=\".YWebViewActivity\"\nandroid:exported=\"false\"\nandroid:process=\":ywebview\" /&gt;\n&lt;service\nandroid:name=\".mainprocess.MainProcessCommandService\"\nandroid:exported=\"false\"\nandroid:process=\":ywebview\" /&gt;\n</code></pre> Application\u4e2d\u7ed1\u5b9aService\uff0c\u76f8\u5f53\u4e8e\u542f\u52a8\u4e86ywebview\u8fdb\u7a0b <pre><code>Looper.myQueue().addIdleHandler {\nWebViewCommandsDispatcher.prepareWebViewConfig()\nfalse\n}\n// \u7ed1\u5b9aService\nval intent = Intent(BaseApplication.instance, MainProcessCommandService::class.java)\nBaseApplication.instance.bindService(intent, this, Context.BIND_AUTO_CREATE)\n\nclass MainProcessCommandService: Service() {\noverride fun onBind(intent: Intent): IBinder? {\nreturn MainProcessCommandsManager.asBinder()\n}\n}\n</code></pre> WebView\u8fdb\u7a0b\u9884\u52a0\u8f7d\u80fd\u4f18\u5316\u542f\u52a8\u65f6\u95f4100ms+\uff0c\u4f46\u5728\u51b7\u542f\u52a8\u65f6\u76f4\u63a5\u542f\u52a8WebViewActivity\u4f1a\u5f88\u6162(webview\u8fdb\u7a0b\u8fd8\u6ca1\u6709\u52a0\u8f7d\u5b8c\u6210\uff0c\u8fd8\u4e0d\u5982\u76f4\u63a5\u542f\u52a8\u5feb)</p>"},{"location":"android/ui/ui_webview/#webview","title":"WebView\u590d\u7528","text":"<p>\u5b9e\u73b0\u601d\u8def\u662f\u4f7f\u7528\u96c6\u5408\u6765\u4fdd\u5b58WebView\uff0c\u53ef\u4ee5\u6700\u5927\u4fdd\u5b58\u51e0\u4e2a\uff0c\u5982\u4f7f\u7528Stack\u3001List\u7b49\uff0c\u53ef\u968f\u8fdb\u7a0b\u542f\u52a8\u65f6\u521b\u5efaWebView <pre><code>private val cache: Stack&lt;YWebView&gt; = Stack()\nfun prepareWebView() {\nif (cache.size &lt; MAX_CACHE) {\ncache.push(createWebView())\n}\n}\nprivate fun createWebView(): YWebView =\nYWebView(MutableContextWrapper(BaseApplication.instance))\n</code></pre> \u83b7\u53d6WebView\u65f6\u9700\u8981\u66ff\u6362context\uff0c\u7531\u4e8e\u521b\u5efa\u7684\u65f6\u5019\u91c7\u7528applicationContext <pre><code>cache.pop().also { yWebView -&gt;\n(yWebView.context as MutableContextWrapper).baseContext = context\n}\n</code></pre> \u5728Activity\u9500\u6bc1\u65f6\u56de\u6536WebView(\u53ef\u80fd\u5b58\u5728\u95ee\u9898) <pre><code>fun destroy(webView: YWebView, isCache: Boolean = true) {\nwebView.stopLoading()\nwebView.clearCache(true)\nwebView.clearHistory()\nwebView.clearFormData()\nwebView.clearSslPreferences()\nif (webView.parent != null)\n(webView.parent as ViewGroup).removeView(webView)\n(webView.context as MutableContextWrapper).baseContext = webView.context.applicationContext\nif (isCache &amp;&amp; cache.size &lt; MAX_CACHE) {\ncache.push(webView)\n}\n}\n</code></pre> \u5f85\u89e3\u51b3\u95ee\u9898\uff1a</p> <p>WebView\u590d\u7528\uff1a\u5b58\u5728\u95ee\u9898\u754c\u9762goBack\u65f6\u6df7\u4e71</p> <p>goBack\u65f6\u4f1a\u81ea\u52a8\u5237\u65b0\u754c\u9762</p> <p>\u7f51\u9875\u4e2d\u6253\u5f00\u5e94\u7528\u672a\u5b9e\u73b0</p>"},{"location":"android/ui/ui_webview/#x5","title":"X5\u5185\u6838","text":"<p>https://x5.tencent.com/docs/index.html</p>"},{"location":"android/ui/ui_webview/#agentweb","title":"AgentWeb","text":"<p>https://github.com/Justson/AgentWeb</p> <p>\u57fa\u4e8eX5\u5185\u6838\u7684WebView\u5c01\u88c5</p>"},{"location":"android/ui/recyclerview/ui_recyclerview/","title":"\u57fa\u672c\u4f7f\u7528","text":""},{"location":"android/ui/recyclerview/ui_recyclerview/#recyclerview","title":"RecyclerView\u57fa\u672c\u4f7f\u7528","text":""},{"location":"android/ui/recyclerview/ui_recyclerview/#adapter","title":"\u5b9a\u4e49adapter","text":"<p>1)\u5148\u5b9a\u4e49ViewHolder</p> <p>xml\u5e03\u5c40\uff1aitem.rv.xml <pre><code>class MyViewHolder(val binding: ItemRvBinding) : RecyclerView.ViewHolder(binding.root)\n</code></pre> 2)\u518d\u5b9e\u73b0adapter <pre><code>class MyAdapter(val list: MutableList&lt;String&gt;): RecyclerView.Adapter&lt;MyViewHolder&gt;() {\noverride fun onCreateViewHolder(parent: ViewGroup, viewType: Int): MyViewHolder = MyViewHolder(\nItemRvBinding.inflate(LayoutInflater.from(parent.context), parent, false)\n\noverride fun getItemCount(): Int = list.size\n\noverride fun onBindViewHolder(holder: MyViewHolder, position: Int) {\nholder.binding.itemTv.text = list[position]\n}\n}\n</code></pre> 3)\u6dfb\u52a0\u76d1\u542c <pre><code>var onItemClickListener: ((pos: Int) -&gt; Unit)? = null\nvar onItemLongClickListener: ((pos: Int) -&gt; Unit)? = null\nholder.itemView.setOnClickListener {\nonItemClickListener?.invoke(position)\n}\nholder.itemView.setOnLongClickListener {\nonItemLongClickListener?.invoke(position)\ntrue\n}\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_1","title":"\u57fa\u672c\u4f7f\u7528","text":"<pre><code>getBinding().rv.apply {\nlayoutManager =\nLinearLayoutManager(this@RVActivity, LinearLayoutManager.VERTICAL, false)//\u4f7f\u7528ListView\u5f62\u5f0f\nlayoutManager =\nGridLayoutManager(this@RVActivity, 2,\nGridLayoutManager.VERTICAL, false)////\u4f7f\u7528GridView\u5f62\u5f0f\nlayoutManager =\nStaggeredGridLayoutManager(3,\nStaggeredGridLayoutManager.VERTICAL)//\u7011\u5e03\u6d41\nval myAdapter = MyAdapter(mutableListOf(\"1\", \"2\", \"3\"))\nadapter = myAdapter\nmyAdapter.onItemClickListener = {\n\n}\nmyAdapter.onItemLongClickListener = {\n\n}\nitemAnimator = DefaultItemAnimator() //\u5176\u4ed6\u52a8\u753b\u9700\u81ea\u5b9a\u4e49\n\n(itemAnimator as SimpleItemAnimator).supportsChangeAnimations = false //\u5173\u95ed\u52a8\u753b\n\n//\u7ed9Item\u6dfb\u52a0\u5206\u5272\u7ebf\naddItemDecoration(DividerItemDecoration(this@RVActivity, DividerItemDecoration.VERTICAL))))//\u5782\u76f4\u65b9\u5411\naddItemDecoration(DividerItemDecoration(this@RVActivity, DividerItemDecoration.HORIZONTAL))//\u6c34\u5e73\u65b9\u5411\nscrollToPosition(0)//\u6eda\u52a8\u5230\u7b2c0\u4e2a\n}\n</code></pre>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_2","title":"\u4fee\u6539\u5206\u5272\u7ebf\u6837\u5f0f","text":"<pre><code>&lt;item name=\"android:listDivider\"&gt;@drawable/bg_recyclerview_divider&lt;/item&gt;\n\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\nandroid:shape=\"rectangle\"&gt;\n\n&lt;gradient\nandroid:centerColor=\"#ff00ff00\"\nandroid:endColor=\"#ff0000ff\"\nandroid:startColor=\"#ffff0000\"\nandroid:type=\"linear\"/&gt;\n\n&lt;size\nandroid:width=\"10dp\"\nandroid:height=\"10dp\"/&gt;\n\n&lt;/shape&gt;\n</code></pre>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_3","title":"\u81ea\u5b9a\u4e49\u5206\u5272\u7ebf","text":"<p><pre><code>class MyDecoration: RecyclerView.ItemDecoration() {\noverride fun getItemOffsets(\noutRect: Rect,\nview: View,\nparent: RecyclerView,\nstate: RecyclerView.State\n) {\nsuper.getItemOffsets(outRect, view, parent, state)\n}\n\noverride fun onDraw(c: Canvas, parent: RecyclerView, state: RecyclerView.State) {\nsuper.onDraw(c, parent, state)\n}\n\noverride fun onDrawOver(c: Canvas, parent: RecyclerView, state: RecyclerView.State) {\nsuper.onDrawOver(c, parent, state)\n}\n}\n</code></pre> GridLayoutManager\u8bbe\u7f6e\u5206\u5272\u7ebf <pre><code>class GridSpacingItemDecoration(//\u5217\u6570\nprivate val column: Int, private val leftSpace: Int, //\u5de6\u95f4\u8ddd\nprivate val topSpace: Int, //\u9876\u90e8\u95f4\u8ddd\nprivate val rightSpace: Int, //\u53f3\u95f4\u8ddd\nprivate val bottomSpace: Int, //\u5e95\u90e8\u95f4\u8ddd\nprivate val centerLeftSpace: Int, //item\u4e4b\u95f4\u5de6\u95f4\u8ddd\nprivate val centerTopSpace: Int //item\u4e4b\u95f4\u9876\u90e8\u95f4\u8ddd\n) : RecyclerView.ItemDecoration() {\n\nfun getItemOffsets(\noutRect: Rect, view: View?,\nparent: RecyclerView, state: RecyclerView.State?\n) {\nval pos = parent.getChildAdapterPosition(view!!)\nif (pos % column == 0) {\noutRect.left = leftSpace\n} else {\noutRect.left = centerLeftSpace\n}\nif (pos &lt; column) {\noutRect.top = topSpace\n} else {\noutRect.top = centerTopSpace\n}\nif (pos % column == column - 1) {\noutRect.right = rightSpace\n} else {\noutRect.right = 0\n}\noutRect.bottom = bottomSpace\n}\n}\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_4","title":"\u5206\u5272\u7ebf\u7ed8\u5236\u6e90\u7801\u5206\u6790","text":"<p><pre><code>@Override\npublic void draw(Canvas c) {\nsuper.draw(c);\n\nfinal int count = mItemDecorations.size();\nfor (int i = 0; i &lt; count; i++) {\nmItemDecorations.get(i).onDrawOver(c, this, mState);\n}\n//...\n}\n\n@Override\npublic void onDraw(Canvas c) {\nsuper.onDraw(c);\n\nfinal int count = mItemDecorations.size();\nfor (int i = 0; i &lt; count; i++) {\nmItemDecorations.get(i).onDraw(c, this, mState);\n}\n}\n</code></pre> draw\u4f1a\u8c03\u7528\u7236\u7c7bView\u7684draw\uff0c\u63a5\u7740\u8c03\u7528onDraw\u65b9\u6cd5\uff0c\u5373\u8c03\u7528\u5230\u5206\u5272\u7ebf\u7684onDraw\uff0c\u6700\u540e\u8c03\u7528onDrawOver\u65b9\u6cd5\uff0c\u6240\u4ee5onDrawOver\u53ef\u4ee5\u7528\u6765\u7ed8\u5236\u8986\u76d6\u573a\u666f\u4f7f\u7528\uff0c\u5217\u5982\u5438\u9876</p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_5","title":"\u5206\u5272\u7ebf\u4e8b\u4ef6\u95ee\u9898","text":"<p>\u5206\u5272\u7ebf\u662f\u65e0\u6cd5\u89e6\u53d1\u4efb\u4f55\u4e8b\u4ef6\uff0c\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u624b\u52bf\u89e3\u51b3 <pre><code>val gestureDetector =\nGestureDetector(parent.context, object : GestureDetector.SimpleOnGestureListener() {\noverride fun onSingleTapUp(e: MotionEvent): Boolean {\nval pointX = e.x\nval pointY = e.y\n//\u5224\u65ad\u8fb9\u8ddd\u518d\u5904\u7406\u4e8b\u4ef6\nreturn super.onSingleTapUp(e)\n}\n})\nparent.addOnItemTouchListener(object : RecyclerView.OnItemTouchListener {\noverride fun onInterceptTouchEvent(rv: RecyclerView, e: MotionEvent): Boolean =\ngestureDetector.onTouchEvent(e)\n\noverride fun onTouchEvent(rv: RecyclerView, e: MotionEvent) {\ngestureDetector.onTouchEvent(e)\n}\n\noverride fun onRequestDisallowInterceptTouchEvent(disallowIntercept: Boolean) {\n\n}\n})\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_6","title":"\u5b9e\u7528\u65b9\u6cd5","text":""},{"location":"android/ui/recyclerview/ui_recyclerview/#getchildcount","title":"getChildCount()","text":"<p>\u5b9e\u9645\u8fd4\u56de\u7684\u662f\u6574\u6570\u7684\u53ef\u89c1\u7684item\u6570\u91cf</p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#getchildatint-index","title":"getChildAt(int index)","text":"<p>\u83b7\u53d6\u662f\u53ef\u89c1\u7684\u7b2cindex\u4e2a\u4f4d\u7f6e\u7684item</p> <p>\u6240\u4ee5\u5f53item\u53ea\u663e\u793a\u4e00\u9879\u65f6\u4ee5\u4e0b\u83b7\u53d6\u7684\u6548\u679c\u4e00\u81f4(\u6848\u4f8b\u6296\u97f3) <pre><code>val itemView: View? = layoutmanager.findViewByPosition(0)\nval itemView: View? = getChildAt(0)\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_7","title":"\u5173\u95ed\u52a8\u753b","text":"<p>\u4e3b\u8981\u662f\u7528\u6765\u89e3\u51b3\u5237\u65b0\u51fa\u73b0\u95ea\u70c1\u95ee\u9898 <pre><code>(getBinding().rv.itemAnimator as SimpleItemAnimator).supportsChangeAnimations = false\n//\u6216\u8005\ngetBinding().rv.itemAnimator = null\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#sethastfixedsize","title":"setHastFixedSize","text":"<p><pre><code>rv.setHastFixedSize(true)\n</code></pre> item\u6539\u53d8\u65f6\u4e0d\u4f1a\u5f71\u54cdrv\u7684\u9ad8\u5ea6\u65f6\u4f7f\u7528</p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#sethasstableids","title":"setHasStableIds","text":"<p><pre><code>adapter.setHasStableIds(true)\n</code></pre> \u5e76\u9700\u8981\u91cd\u5199getItemId(int position)\u65b9\u6cd5\uff0c\u56fa\u5b9aid\u53ef\u4ee5\u51cf\u5c11\u5237\u65b0\uff0c\u53ef\u4ee5\u89e3\u51b3\u6570\u636e\u9519\u4e71\u89c1\u6e90\u7801\u5206\u6790\u4e00\u7ea7\u7f13\u5b58\u590d\u7528\u673a\u5236</p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_8","title":"\u4fee\u6539\u7f13\u5b58\u6c60\u5927\u5c0f","text":"<p>\u9ed8\u8ba4\u662f5\u4e2a\uff0c\u89c1\u6e90\u7801\u5206\u6790RecyclerViewPool\u7f13\u5b58\u7684DEFAULT_MAX_SCRAP\u503c <pre><code>rv.recycledViewPool.setMaxRecycledViews(0, 5)\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_recyclerview/#_9","title":"\u590d\u7528(\u5171\u4eab)\u7f13\u5b58\u6c60","text":"<pre><code>rv.setRecycledViewPool(recycledViewPool)\n</code></pre>"},{"location":"android/ui/recyclerview/ui_recyclerview/#cache","title":"\u4fee\u6539cache\u7f13\u5b58\u5927\u5c0f","text":"<p>\u9ed8\u8ba4\u662f2\u4e2a\uff0c\u89c1\u6e90\u7801\u5206\u6790Cache\u7f13\u5b58\u7684DEFAULT_CACHE_SIZE\u503c <pre><code>rv.setItemViewCacheSize(3)\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_source_code/","title":"\u6e90\u7801\u89e3\u6790","text":""},{"location":"android/ui/recyclerview/ui_source_code/#_1","title":"\u56db\u7ea7\u7f13\u5b58\u6e90\u7801\u5206\u6790","text":"<p>onTouchEvent\u4f1a\u89e6\u53d1\u7f13\u5b58\u548c\u590d\u7528\u6d41\u7a0b <pre><code>@Override\npublic boolean onTouchEvent(MotionEvent e) {\n//...\nif (scrollByInternal(\ncanScrollHorizontally ? dx : 0,\ncanScrollVertically ? dy : 0,\nvtev)) {\ngetParent().requestDisallowInterceptTouchEvent(true);\n}\n//...\n}\n\nboolean scrollByInternal(int x, int y, MotionEvent ev) {\n//...\nif (x != 0) {\nconsumedX = mLayout.scrollHorizontallyBy(x, mRecycler, mState);\n}\nif (y != 0) {\nconsumedY = mLayout.scrollVerticallyBy(y, mRecycler, mState);\n}\n//...\n}\n</code></pre> \u4ee5LinearLayoutManager\u4e3a\u4f8b <pre><code>@Override\npublic int scrollVerticallyBy(int dy, RecyclerView.Recycler recycler,\nRecyclerView.State state) {\nif (mOrientation == HORIZONTAL) {\nreturn 0;\n}\nreturn scrollBy(dy, recycler, state);\n}\n</code></pre> scrollBy\u4e3b\u8981\u770bfill\u65b9\u6cd5 <pre><code>recycleByLayoutState(recycler, layoutState);\nlayoutChunk(recycler, state, layoutState, layoutChunkResult);\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_source_code/#_2","title":"\u7f13\u5b58","text":"<p>recycleByLayoutState\u4e3b\u8981\u662f\u7f13\u5b58\u76f8\u5173</p> <p>\u7f13\u5b58\u6700\u7ec8\u8c03\u7528recycleChildren\u65b9\u6cd5\uff0c\u63a5\u7740\u8c03\u7528recycleView <pre><code>public void removeAndRecycleViewAt(int index, Recycler recycler) {\nfinal View view = getChildAt(index);\nremoveViewAt(index);\nrecycler.recycleView(view);\n}\n</code></pre> recycleView\u4e3b\u8981\u770brecycleViewHolderInternal\u65b9\u6cd5</p>"},{"location":"android/ui/recyclerview/ui_source_code/#mcachedviewsrecycledviewpool","title":"mCachedViews\u548cRecycledViewPool\u76f8\u5173","text":"<p><pre><code>final ArrayList&lt;ViewHolder&gt; mCachedViews = new ArrayList&lt;ViewHolder&gt;();\nint mViewCacheMax = DEFAULT_CACHE_SIZE;\nstatic final int DEFAULT_CACHE_SIZE = 2;\nvoid recycleViewHolderInternal(ViewHolder holder) {\n//...\nif (xxx)) {\nint cachedViewSize = mCachedViews.size();\nif (cachedViewSize &gt;= mViewCacheMax &amp;&amp; cachedViewSize &gt; 0) {\nrecycleCachedViewAt(0); // \u8d85\u8fc72\u4e2a\u540e\u4f1a\u79fb\u9664\u7b2c0\u4e2a\ncachedViewSize--;\n}\nint targetCacheIndex = cachedViewSize;\n//...\nmCachedViews.add(targetCacheIndex, holder);//\u6dfb\u52a0\u5230\u7f13\u5b58\u4e2d\ncached = true;\n}\n//...\nif (!cached) {\naddViewHolderToRecycledViewPool(holder, true);\nrecycled = true;\n}\n//...\n}\nmCachedViews\u9ed8\u8ba4\u6700\u5927\u53ea\u67092\u4e2a\u7f13\u5b58\u5927\u5c0f\uff0c\u8d85\u8fc7\u540e\u4f1a\u5c06\u7b2c0\u4e2a\u79fb\u9664\n```java\nvoid recycleCachedViewAt(int cachedViewIndex) {\nViewHolder viewHolder = mCachedViews.get(cachedViewIndex);\naddViewHolderToRecycledViewPool(viewHolder, true);\nmCachedViews.remove(cachedViewIndex);\n}\n</code></pre> \u7f13\u5b58\u5230\u7f13\u5b58\u6c60\u4e2d <pre><code>void addViewHolderToRecycledViewPool(ViewHolder holder, boolean dispatchRecycled) {\n//...\ngetRecycledViewPool().putRecycledView(holder);\n}\nprivate static final int DEFAULT_MAX_SCRAP = 5;\nint mMaxScrap = DEFAULT_MAX_SCRAP;\nSparseArray&lt;ScrapData&gt; mScrap = new SparseArray&lt;&gt;();//key\u662fitemViewType\npublic void putRecycledView(ViewHolder scrap) {\nfinal int viewType = scrap.getItemViewType();//\u6839\u636e\u4e0d\u540ctpye\u7c7b\u578b\u7f13\u5b58ViewHolder\nfinal ArrayList scrapHeap = getScrapDataForType(viewType).mScrapHeap;\nif (mScrap.get(viewType).mMaxScrap &lt;= scrapHeap.size()) {\nreturn;\n}\n//...\nscrap.resetInternal();//\u6e05\u7a7aViewHolder\u6570\u636e\nscrapHeap.add(scrap);\n}\nprivate ScrapData getScrapDataForType(int viewType) {\nScrapData scrapData = mScrap.get(viewType);\nif (scrapData == null) {\nscrapData = new ScrapData();\nmScrap.put(viewType, scrapData);\n}\nreturn scrapData;\n}\n</code></pre> \u7f13\u5b58\u6c60\u4e2d\u6bcf\u4e2aitemViewType\u6700\u591a\u7f13\u5b585\u4e2a\uff0c\u4e14\u6570\u636e\u4f1a\u6e05\u7a7a</p>"},{"location":"android/ui/recyclerview/ui_source_code/#mattachedscrapmchangedscrap","title":"mAttachedScrap\u548cmChangedScrap\u76f8\u5173","text":"<p><pre><code>onMeasure\ndispatchLayoutStep1();//PreLayout \u52a8\u753b\u524d\u5e03\u5c40 \u52a8\u753b\u7684\u51c6\u5907\u5de5\u4f5c\uff0c\u5b58\u50a8\u4e00\u4e0b\u73b0\u6709item\u7684\u4fe1\u606f\ndispatchLayoutStep2();//\u771f\u6b63\u6d4b\u91cf\u548c\u5e03\u5c40\n\nonLayout\ndispatchLayoutStep1();\ndispatchLayoutStep2();\ndispatchLayoutStep3();//PostLayout \u52a8\u753b\u540e\u5e03\u5c40 \u6267\u884c\u52a8\u753b\uff0c\u6e05\u9664\u4e00\u4e9b\u6570\u636e\n</code></pre> \u53ea\u4f1a\u6267\u884c\u4e00\u6b21</p> <p>dispatchLayoutStep2-&gt;onLayoutChildren-&gt;detachAndScrapAttachedViews <pre><code>public void detachAndScrapAttachedViews(Recycler recycler) {\nfinal int childCount = getChildCount();\nfor (int i = childCount - 1; i &gt;= 0; i--) {\nfinal View v = getChildAt(i);\nscrapOrRecycleView(recycler, i, v);\n}\n}\nprivate void scrapOrRecycleView(Recycler recycler, int index, View view) {\nfinal ViewHolder viewHolder = getChildViewHolderInt(view);\n//...\nif (viewHolder.isInvalid() &amp;&amp; !viewHolder.isRemoved()\n&amp;&amp; !mRecyclerView.mAdapter.hasStableIds()) {\nremoveViewAt(index);\nrecycler.recycleViewHolderInternal(viewHolder);\n} else {\ndetachViewAt(index);\nrecycler.scrapView(view);\nmRecyclerView.mViewInfoStore.onViewDetached(viewHolder);\n}\n}\n</code></pre> recycleViewHolderInternal\u5c31\u662f\u4e0a\u9762\u7684mCachedViews\u548cRecycledViewPool\u7f13\u5b58\u903b\u8f91</p> <p>scrapView\u5c31\u662fmAttachedScrap\u548cmChangedScrap\u7f13\u5b58\u903b\u8f91\uff0c\u4e0d\u9650\u5236\u5bb9\u91cf\u6ee1\u8db3\u6761\u4ef6\u76f4\u63a5\u7f13\u5b58 <pre><code>void scrapView(View view) {\nfinal ViewHolder holder = getChildViewHolderInt(view);\nif (holder.hasAnyOfTheFlags(ViewHolder.FLAG_REMOVED | ViewHolder.FLAG_INVALID)\n|| !holder.isUpdated() || canReuseUpdatedViewHolder(holder)) {\n//...\nholder.setScrapContainer(this, false);\nmAttachedScrap.add(holder);\n} else {\nif (mChangedScrap == null) {\nmChangedScrap = new ArrayList&lt;ViewHolder&gt;();\n}\nholder.setScrapContainer(this, true);\nmChangedScrap.add(holder);\n}\n}\n</code></pre> onLayoutChildren-&gt;fill\u8d70onTouchEvent\u5206\u6790\u7684\u6d41\u7a0b</p>"},{"location":"android/ui/recyclerview/ui_source_code/#_3","title":"\u603b\u7ed3","text":"\u7f13\u5b58\u7ed3\u6784 \u5bb9\u5668\u7c7b\u578b \u5bb9\u91cf\u9650\u5236 \u7f13\u5b58\u7528\u9014 \u662f\u5426\u56de\u8c03createView \u662f\u5426\u56de\u8c03bindView mChangedScrap/mAttachedScrap ArrayList \u65e0\uff0c\u4e00\u822c\u4e3a\u5c4f\u5e55\u5185\u603b\u7684\u53ef\u89c1\u5217\u8868\u9879\u6570 \u4e34\u65f6\u5b58\u653e\u4ecd\u5728\u5f53\u524d\u5c4f\u5e55\u53ef\u89c1\u3001\u4f46\u88ab\u6807\u8bb0\u4e3a\u300c\u79fb\u9664\u300d\u6216\u300c\u91cd\u7528\u300d\u7684\u5217\u8868\u9879 \u5426 \u5426 mCachedViews ArrayList \u9ed8\u8ba4\u4e3a2 \u5b58\u653e\u5df2\u88ab\u79fb\u51fa\u5c4f\u5e55\u3001\u4f46\u6709\u53ef\u80fd\u5f88\u5feb\u91cd\u65b0\u8fdb\u5165\u5c4f\u5e55\u7684\u5217\u8868\u9879 \u5426 \u5426 mViewCacheExtension \u5f00\u53d1\u8005\u81ea\u5df1\u5b9a\u4e49 \u65e0 \u63d0\u4f9b\u989d\u5916\u7684\u53ef\u7531\u5f00\u53d1\u4eba\u5458\u81ea\u7531\u63a7\u5236\u7684\u7f13\u5b58\u5c42\u7ea7 \u5426 \u5426 RecycledViewPool(mScrap) SparseArray \u6bcf\u79cditemType\u9ed8\u8ba4\u4e3a5 \u6309\u4e0d\u540c\u7684itemType\u5206\u522b\u5b58\u653e\u8d85\u51famCachedViews\u9650\u5236\u7684\u3001\u88ab\u79fb\u51fa\u5c4f\u5e55\u7684\u5217\u8868\u9879 \u5426 \u662f <ol> <li>mChangedScrap \u8868\u793a\u6570\u636e\u5df2\u7ecf\u6539\u53d8\u7684ViewHolder\u5217\u8868\uff0c\u9700\u8981\u91cd\u65b0\u7ed1\u5b9a\u6570\u636e\uff08\u8c03\u7528onBindViewHolder\uff09<ul> <li>\u5f00\u542f\u4e86\u5217\u8868\u9879\u52a8\u753b(itemAnimator)\uff0c\u5e76\u4e14\u5217\u8868\u9879\u52a8\u753b\u7684canReuseUpdatedViewHolder(ViewHolder viewHolder)\u65b9\u6cd5\u8fd4\u56defalse\u7684\u524d\u63d0\u4e0b\uff1b</li> <li>\u8c03\u7528\u4e86notifyItemChanged\u3001notifyItemRangeChanged\u8fd9\u4e00\u7c7b\u65b9\u6cd5\uff0c\u901a\u77e5\u5217\u8868\u9879\u6570\u636e\u53d1\u751f\u53d8\u5316\uff1b</li> </ul> </li> <li>mAttachedScrap \u5e94\u5bf9\u7684\u5219\u662f\u5269\u4e0b\u7684\u7edd\u5927\u90e8\u5206\u573a\u666f<ul> <li>\u50cfnotifyItemMoved\u3001notifyItemRemoved\u8fd9\u79cd\u5217\u8868\u9879\u53d1\u751f\u79fb\u52a8\uff0c\u4f46\u5217\u8868\u9879\u6570\u636e\u672c\u8eab\u6ca1\u6709\u53d1\u751f\u53d8\u5316\u7684\u573a\u666f\u3002</li> <li>\u5173\u95ed\u4e86\u5217\u8868\u9879\u52a8\u753b\uff0c\u6216\u8005\u5217\u8868\u9879\u52a8\u753b\u7684canReuseUpdatedViewHolder\u65b9\u6cd5\u8fd4\u56detrue\uff0c\u5373\u5141\u8bb8\u91cd\u7528\u539f\u5148\u7684ViewHolder\u5bf9\u8c61\u7684\u573a\u666f</li> </ul> </li> <li>\u56de\u8c03bindView\u901a\u8fc7mFlags\u51b3\u5b9a\uff0c\u4eceRecycledViewPool\u53d6\u51fa\u7684\u7f13\u5b58\u4f1a\u8c03\u7528resetInternal\u65b9\u6cd5\u4f7f\u5f97mFlags\u53d8\u62100</li> </ol>"},{"location":"android/ui/recyclerview/ui_source_code/#_4","title":"\u590d\u7528","text":"<p>\u56de\u5230fill\u65b9\u6cd5\u4e2dlayoutChunk\u65b9\u6cd5\u4e3b\u8981\u662f\u590d\u7528\u76f8\u5173 <pre><code>void layoutChunk(RecyclerView.Recycler recycler, RecyclerView.State state,LayoutState layoutState, LayoutChunkResult result) {\nView view = layoutState.next(recycler);\n//...\n}\nView next(RecyclerView.Recycler recycler) {\n//...\nfinal View view = recycler.getViewForPosition(mCurrentPosition);\n//...\nreturn view;\n}\n</code></pre> \u6700\u7ec8\u8c03\u5230tryGetViewHolderForPositionByDeadline\u65b9\u6cd5 <pre><code>ViewHolder tryGetViewHolderForPositionByDeadline(int position,\nboolean dryRun, long deadlineNs) {\nViewHolder holder = null;\n// 0) If there is a changed scrap, try to find from there\nif (mState.isPreLayout()) {\nholder = getChangedScrapViewForPosition(position);\nfromScrapOrHiddenOrCache = holder != null;\n}\n// 1) Find by position from scrap/hidden list/cache\nif (holder == null) {\nholder = getScrapOrHiddenOrCachedHolderForPosition(position, dryRun);\nif (holder != null) {\nif (!validateViewHolderForOffsetPosition(holder)) {\nif (!dryRun) {\n//...\nrecycleViewHolderInternal(holder);\n}\nholder = null;\n} else {\nfromScrapOrHiddenOrCache = true;\n}\n}\n}\nif (holder == null) {\nfinal int offsetPosition = mAdapterHelper.findPositionOffset(position);\n//...\n\nfinal int type = mAdapter.getItemViewType(offsetPosition);\n// 2) Find from scrap/cache via stable ids, if exists\nif (mAdapter.hasStableIds()) {\nholder = getScrapOrCachedViewForId(mAdapter.getItemId(offsetPosition),type, dryRun);\n//...\n}\nif (holder == null &amp;&amp; mViewCacheExtension != null) {\nfinal View view = mViewCacheExtension\n.getViewForPositionAndType(this, position, type);\nif (view != null) {\nholder = getChildViewHolder(view);\n//...\n}\n}\nif (holder == null) { // fallback to pool\n//...\nholder = getRecycledViewPool().getRecycledView(type);\n//...\n}\nif (holder == null) {\n//...\nholder = mAdapter.createViewHolder(RecyclerView.this, type);\n//...\n}\n}\nboolean bound = false;\nif (xxx) {\n} else if (xxx)) {\n//...\nbound = tryBindViewHolderByDeadline(holder, offsetPosition, position, deadlineNs);\n}\n//...\n}\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_source_code/#mchangedscrap","title":"\u7b2c\u4e00\u7ea7\u7f13\u5b58mChangedScrap","text":"<p>getChangedScrapViewForPosition(position) <pre><code>ArrayList&lt;ViewHolder&gt; mChangedScrap = null;\nViewHolder getChangedScrapViewForPosition(int position) {\n//...\n// find by position\nfor (int i = 0; i &lt; changedScrapSize; i++) {\nfinal ViewHolder holder = mChangedScrap.get(i);\nif (!holder.wasReturnedFromScrap() &amp;&amp; holder.getLayoutPosition() == position) {\n//...\nreturn holder;\n}\n}\n// find by id\nif (mAdapter.hasStableIds()) {\n//...\nif (xxx) {\nfinal long id = mAdapter.getItemId(offsetPosition);\nfor (int i = 0; i &lt; changedScrapSize; i++) {\nfinal ViewHolder holder = mChangedScrap.get(i);\nif (xxx &amp;&amp; holder.getItemId() == id) {\n//...\nreturn holder;\n}\n}\n}\n}\nreturn null;\n}\n</code></pre> \u901a\u8fc7position\u6765\u83b7\u53d6\u7f13\u5b58\uff0c\u6ee1\u8db3\u6761\u4ef6\u8fd8\u4f1a\u901a\u8fc7id\u6765\u83b7\u53d6(\u89e3\u51b3\u6570\u636e\u9519\u4e71\uff0c\u539f\u56e0\uff1a\u91cd\u65b0\u4ece\u7f51\u7edc\u83b7\u53d6\u6570\u636e\u65f6\u540c\u4e00\u4e2aposition\u6570\u636e\u53d8\u4e86\uff0c\u6b64\u7f13\u5b58\u4e0d\u4f1a\u91cd\u65b0\u89e6\u53d1onBindViewHolder)</p>"},{"location":"android/ui/recyclerview/ui_source_code/#id","title":"\u5f00\u542f\u901a\u8fc7id\u83b7\u53d6\u7f13\u5b58","text":"<pre><code>myAdapter.setHasStableIds(true)\n//\u91cd\u5199Adapter\u4e2d\u7684getItemId\u65b9\u6cd5\uff0c\u6307\u5b9a\u4e0d\u540c\u7684id\noverride fun getItemId(position: Int): Long {\nreturn super.getItemId(position)\n}\n</code></pre>"},{"location":"android/ui/recyclerview/ui_source_code/#mattachedscrapmcachedviews","title":"\u7b2c\u4e8c\u7ea7\u7f13\u5b58mAttachedScrap\u548cmCachedViews","text":"<p>getScrapOrHiddenOrCachedHolderForPosition <pre><code>final ArrayList&lt;ViewHolder&gt; mAttachedScrap = new ArrayList&lt;&gt;();\nfinal ArrayList&lt;ViewHolder&gt; mCachedViews = new ArrayList&lt;ViewHolder&gt;();\nViewHolder getScrapOrHiddenOrCachedHolderForPosition(int position, boolean dryRun) {\nfinal int scrapCount = mAttachedScrap.size();\n\n// Try first for an exact, non-invalid match from scrap.\nfor (int i = 0; i &lt; scrapCount; i++) {\nfinal ViewHolder holder = mAttachedScrap.get(i);\nif (xxx) {\n//...\nreturn holder;\n}\n}\n\n//....\n\n// Search in our first-level recycled view cache.\nfinal int cacheSize = mCachedViews.size();\nfor (int i = 0; i &lt; cacheSize; i++) {\nfinal ViewHolder holder = mCachedViews.get(i);\n//...\nif (xxx) {\nif (!dryRun) {\nmCachedViews.remove(i);\n}\n//...\nreturn holder;\n}\n}\nreturn null;\n}\n</code></pre> getScrapOrCachedViewForId\u4e5f\u662f\u4ecemAttachedScrap\u83b7\u53d6\u7f13\u5b58</p>"},{"location":"android/ui/recyclerview/ui_source_code/#mviewcacheextension","title":"\u7b2c\u4e09\u7ea7\u7f13\u5b58mViewCacheExtension","text":"<p>\u81ea\u5b9a\u4e49\u7f13\u5b58 <pre><code>setViewCacheExtension(object : RecyclerView.ViewCacheExtension(){\noverride fun getViewForPositionAndType(\nrecycler: RecyclerView.Recycler,\nposition: Int,\ntype: Int\n): View? {\nreturn null\n}\n})\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_source_code/#recycledviewpool","title":"\u7b2c\u56db\u7ea7\u7f13\u5b58RecycledViewPool","text":"<p>getRecycledViewPool().getRecycledView(type)\u901a\u8fc7\u7f13\u5b58\u6c60\u83b7\u53d6 <pre><code>SparseArray&lt;ScrapData&gt; mScrap = new SparseArray&lt;&gt;()\npublic ViewHolder getRecycledView(int viewType) {\nfinal ScrapData scrapData = mScrap.get(viewType);\nif (scrapData != null &amp;&amp; !scrapData.mScrapHeap.isEmpty()) {\nfinal ArrayList&lt;ViewHolder&gt; scrapHeap = scrapData.mScrapHeap;\nreturn scrapHeap.remove(scrapHeap.size() - 1);\n}\nreturn null;\n}\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_stagger/","title":"\u591a\u9009\u6848\u4f8b","text":""},{"location":"android/ui/recyclerview/ui_stagger/#_1","title":"\u591a\u9009\u6848\u4f8b","text":""},{"location":"android/ui/recyclerview/ui_stagger/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u4e00\u822c\u4f7f\u7528\u7ebf\u6027\u5e03\u5c40(\u8d2d\u7269\u8f66)\u6216\u8005\u683c\u5b50\u5e03\u5c40(\u76f8\u518c)</p>"},{"location":"android/ui/recyclerview/ui_stagger/#_3","title":"\u5b9e\u73b0\u6b65\u9aa4","text":""},{"location":"android/ui/recyclerview/ui_stagger/#_4","title":"\u5e03\u5c40\u9009\u62e9","text":"<pre><code>private val linear by lazy { LinearLayoutManager(this) }\nprivate val grid by lazy { GridLayoutManager(this, 3) }\nprivate fun changeManager(flag: Int) {\nwhen (flag) {\n0 -&gt; {\ngetBinding().adRv.layoutManager = linear\n}\n\n1 -&gt; {\ngetBinding().adRv.layoutManager = grid\n}\n}\n</code></pre>"},{"location":"android/ui/recyclerview/ui_stagger/#adapter","title":"\u7ed1\u5b9aadapter","text":"<pre><code>getBinding().adRv.apply {\nitemAnimator = null\nadapter = helper.adapter\n}\n</code></pre>"},{"location":"android/ui/recyclerview/ui_stagger/#_5","title":"\u4e0a\u62c9\u52a0\u8f7d\u66f4\u591a","text":"<p>(\u4f7f\u7528BaseRecyclerViewAdapterHelper) <pre><code>val helperBuilder = QuickAdapterHelper.Builder(rvAdapter)\n.setTrailingLoadStateAdapter(object : TrailingLoadStateAdapter.OnTrailingListener {\noverride fun onLoad() {\nrvAdapter.addAll(mutableListOf&lt;Media&gt;().also { it.addAll(loadMoreUrls) })\n_helper?.trailingLoadState = LoadState.NotLoading(true)\n}\n\noverride fun onFailRetry() {\n}\n\noverride fun isAllowLoading(): Boolean {\nreturn !getBinding().smartRefresh.isRefreshing\n}\n})\n_helper = helperBuilder.build()\nval helper = _helper!!\nhelper.trailingLoadState = LoadState.NotLoading(false)\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_stagger/#_6","title":"\u4e0b\u62c9\u5237\u65b0","text":"<p>(\u4f7f\u7528SmartRefreshLayout) <pre><code>getBinding().smartRefresh.setOnRefreshListener {\nrvAdapter.submitList(mutableListOf&lt;Media&gt;().also { it.addAll(imgUrls) })\ngetBinding().smartRefresh.finishRefresh()\nhelper.trailingLoadState = LoadState.NotLoading(false)\n}\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_stagger/#_7","title":"\u9002\u914d\u5668\u5b9e\u73b0","text":"<p><pre><code>var isSelectMode: Boolean = false//\u662f\u5426\u8fdb\u5165\u591a\u9009\u6a21\u5f0f\nprivate val cacheSelect = LinkedHashMap&lt;String, Media&gt;()// \u7f13\u5b58\u9009\u4e2d\u7684\u6570\u636e\n</code></pre> onBindViewHolder <pre><code>if (isSelectMode) { // \u590d\u9009\u6846\u72b6\u6001\u8bbe\u7f6e\nholder.binding.btnCheck.visibility = View.VISIBLE\nholder.binding.btnCheck.isSelected = cacheSelect.containsKey(media.url)\n} else {\nholder.binding.btnCheck.visibility = View.GONE\n}\n</code></pre> item\u70b9\u51fb\u5904\u7406\u590d\u9009\u6846\u72b6\u6001 <pre><code>holder.itemView.clickNormal {\nif (isSelectMode) {\nif (cacheSelect.containsKey(media.url)) {\ncacheSelect.remove(media.url)\nnotifyItemChanged(position)\n} else {\ncacheSelect[media.url] = media\nnotifyItemChanged(position)\n}\n} else {\n// \u8df3\u8f6c\u7b49\u5176\u4ed6\u5904\u7406\n}\n}\n</code></pre> \u8fdb\u5165/\u9000\u51fa\u591a\u9009\u6a21\u5f0f <pre><code>fun enterSelectMode() {\nisSelectMode = !isSelectMode\ncacheSelect.clear()\nnotifyItemRangeChanged(0, itemCount)\n}\n</code></pre> \u83b7\u53d6\u9009\u4e2d\u9879 <pre><code>fun getSelectItem() = cacheSelect.values\n</code></pre></p>"},{"location":"android/ui/recyclerview/ui_stagger/#_8","title":"\u7011\u5e03\u6d41\u76f8\u5173","text":""},{"location":"android/ui/recyclerview/ui_stagger/#_9","title":"\u5e38\u89c1\u95ee\u9898","text":"<p>\u754c\u9762\u5237\u65b0\u6216\u8005\u6dfb\u52a0\u89c6\u56fe\u65f6\u51fa\u73b0\u4f4d\u7f6e\u4ea4\u6362\u3001\u9876\u90e8\u7a7a\u767d\u7b49\u95ee\u9898</p>"},{"location":"android/ui/recyclerview/ui_stagger/#_10","title":"\u89e3\u51b3\u65b9\u6848","text":"<p>\u5bf9\u5e03\u5c40\u5c5e\u6027\u8fdb\u884c\u8c03\u6574 <pre><code>private val stagger by lazy {\nStaggeredGridLayoutManager(\n3,\nStaggeredGridLayoutManager.VERTICAL\n).apply {\ngapStrategy = StaggeredGridLayoutManager.GAP_HANDLING_NONE//\u9632\u6b62\u4e00\u4e9b\u573a\u666f\u7684\u4f4d\u7f6e\u4ea4\u6362\nisItemPrefetchEnabled = false//\u9884\u52a0\u8f7d\u7684\u89c6\u56fe\u662f\u4e0d\u53ef\u89c1\u7684\u4e0d\u5229\u4e8e\u5904\u7406\u590d\u9009\u6846\u903b\u8f91\n}\n}\n</code></pre> \u5173\u95edRecyclerView\u5c4f\u5e55\u5916\u7f13\u5b58\uff0c\u5f71\u54cd\u590d\u9009\u6846\u663e\u793a\u9690\u85cf\u5904\u7406 <pre><code>getBinding().adRv.setItemViewCacheSize(0)\n</code></pre> \u8fdb\u5165/\u9000\u51fa\u591a\u9009\u6a21\u5f0f\u65f6\u4e0d\u8981\u8c03\u7528notifyItemRangeChanged\u5237\u65b0\uff0c\u624b\u52a8\u5904\u7406\u590d\u9009\u6846\u903b\u8f91 <pre><code>val manager = getBinding().adRv.layoutManager as StaggeredGridLayoutManager\nval startPos = manager.findFirstVisibleItemPositions(null).apply {\nArrays.sort(this)//\u4f1a\u51fa\u73b0\u7c7b\u4f3c[3,1,2]\u8868\u793a\u6700\u4e0a\u9762\u53ef\u89c1\u7684\u89c6\u56fe\u4e0b\u6807\u4e3a1\uff0c2\uff0c3\uff0c\u9700\u8981\u6392\u4e00\u4e0b\u987a\u5e8f\n}\nval endPos = manager.findLastVisibleItemPositions(null).apply {\nArrays.sort(this)//\u6700\u4e0b\u9762\u53ef\u89c1\u89c6\u56fe\u4e0b\u6807\n}\nfor (i in startPos[0]..endPos[endPos.size - 1]) {//\u904d\u5386\u53ef\u89c1\u89c6\u56fe\u5c06\u590d\u9009\u6846\u663e\u793a/\u9690\u85cf\u5904\u7406\nmanager.findViewByPosition(i)?.let { itemView -&gt;\nitemView.findViewById&lt;AppCompatImageView&gt;(R.id.btnCheck)?.let {\nit.isVisible = rvAdapter.isSelectMode\nit.isSelected = false\n}\n}\n}\n</code></pre> \u5176\u4ed6\u4e0d\u53ef\u89c1\u7684\u590d\u9009\u6846\u4f1a\u5728onBindViewHolder\u65f6\u5904\u7406\uff0c\u524d\u63d0\u662fonBindViewHolder\u4f1a\u8c03\u7528\uff0c\u56e0\u6b64\u4e0a\u9762\u9700\u8981\u5173\u95ed\u9884\u52a0\u8f7d\u548c\u5c4f\u5e55\u5916\u7f13\u5b58</p> <p>\u70b9\u51fb\u4e8b\u4ef6\u4fee\u6539\uff0c\u4e0d\u80fd\u8c03\u7528notifyItemChanged\u53bb\u5237\u65b0\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f4d\u7f6e\u4ea4\u6362 <pre><code>holder.itemView.clickNormal {\nif (isSelectMode) {\nif (cacheSelect.containsKey(media.url)) {\ncacheSelect.remove(media.url)\nholder.binding.btnCheck.isSelected = false\n} else {\ncacheSelect[media.url] = media\nholder.binding.btnCheck.isSelected = true\n}\n} else {\n// \u8df3\u8f6c\u7b49\u5176\u4ed6\u5904\u7406\n}\n}\n</code></pre></p> <p>itemView\u6216\u8005ImageView\u9700\u8981\u56fa\u5b9a\u5bbd\u9ad8\uff0c\u7f51\u7edc\u56fe\u7247\u53ef\u8ba9\u540e\u53f0\u544a\u8bc9\u56fe\u7247\u5bbd\u9ad8\uff0c\u672c\u5730\u56fe\u7247\u53ef\u4ee5\u901a\u8fc7MediaStore\u7684WIDTH/HEIGHT\u5b57\u6bb5\u83b7\u53d6\uff0c\u6216\u8005\u5176\u4ed6\u573a\u666f(\u5982\u62cd\u7167)\u901a\u8fc7bitmap\u83b7\u53d6 <pre><code>holder.binding.imgContent.apply {//ImageView\n//\u6309\u7167\u56fe\u7247\u5bbd\u9ad8\u6bd4\u4f8b\u6362\u7b97ImageView\u9ad8\u5ea6\nval imageHeight = (media.height * imageWidth).div(media.width)\n\nlayoutParams.apply {\nwidth = imageWidth\nheight = imageHeight\n}\n}.load(media.url)\n</code></pre> \u56fe\u7247\u52a0\u8f7d\u4f7f\u7528coil\u5e93</p> <p>scrollToPosition\u4f1a\u89e6\u53d1\u4f4d\u7f6e\u8ba1\u7b97\uff0c\u5728\u5217\u8868\u4e2d\u95f4\u65f6\u5f80\u9876\u90e8\u6dfb\u52a0\u6570\u636e\u65e0\u5f71\u54cd\uff0c\u5f80\u5e95\u90e8\u6dfb\u52a0\u6570\u636e\u5b58\u5728\u95ee\u9898 <pre><code>rvAdapter.add()\ngetBinding().adRv.layoutManager?.scrollToPosition(0)\ngetBinding().adRv.layoutManager?.scrollToPosition(rvAdapter.itemCount - 1) //\u4f1a\u5bfc\u81f4\u9876\u90e8\u7a7a\u767d\ngetBinding().adRv.scrollBy(0,2300) // \u6b63\u5e38 \u4f46\u9700\u8981\u8ba1\u7b97y\u503c\n</code></pre></p>"},{"location":"img/fws/sensor/","title":"Index","text":""},{"location":"img/fws/sensor/#_1","title":"\u9879\u76ee\u7b80\u4ecb","text":"<p>\u81ea\u5b9a\u4e49\u670d\u52a1\uff0c\u7528\u6765\u4f20\u8f93\u8f66\u673a\u548c\u624b\u673a\u4e4b\u95f4\u6570\u636e</p>"},{"location":"img/fws/sensor/#_2","title":"\u9879\u76ee\u7ed3\u6784","text":""},{"location":"img/fws/sensor/#localsocket","title":"localsocket","text":"<p>\u6a21\u5757(library)\u7c7b\u578b\uff0c\u5c01\u88c5LocalSocket\u7684\u4f7f\u7528\uff0c\u5f53\u524d\u4f7f\u7528\u5728proxy\u9879\u76ee\u4ee5\u53caframework\u4e2d</p> <p>\u6ce8\uff1aframework\u5e76\u4e0d\u76f4\u63a5\u4f9d\u8d56\u6b64\u9879\u76ee\uff0c\u800c\u662f\u590d\u5236\u4e86LocalSocketClientHandle.java\u6587\u4ef6\u5230frameworks/base/core/java/android/hardware/\u76ee\u5f55</p> <p>\u4f7f\u7528\u65b9\u5f0f</p> <p>\u670d\u52a1\u7aef</p> <p>\u521b\u5efa\u670d\u52a1\u7aef\u5bf9\u8c61 <pre><code>private val localSocketServerHandler by lazy { LocalSocketServerHandler() }\n</code></pre> \u542f\u52a8\u670d\u52a1\u7aef <pre><code>localSocketServerHandler.start(\"xxx\")\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>localSocketServerHandler.send(\"xxx\")\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>localSocketServerHandler.setMsgListener(object : MsgListener {\noverride fun onMsgReceive(msg: String, client: LocalSocket) {\n//TODO\uff1a\u5904\u7406\u63a5\u6536\u5230\u6d88\u606f\n}\n\noverride fun onConnect(client: LocalSocket) {\n//TODO\uff1a\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\n}\n\noverride fun onClose(client: LocalSocket) {\n//TODO\uff1a\u6709\u5ba2\u6237\u7aef\u5173\u95ed\n}\n})\n</code></pre> \u5173\u95ed\u670d\u52a1\u7aef <pre><code>localSocketServerHandler.closeServer()\n</code></pre> \u5ba2\u6237\u7aef</p> <p>\u521b\u5efa\u5ba2\u6237\u7aef\u5bf9\u8c61 <pre><code>private val clientHandler by lazy { LocalSocketClientHandler() }\n</code></pre> \u542f\u52a8\u5ba2\u6237\u7aef <pre><code>clientHandler.start(\"xxx\")//\u548c\u670d\u52a1\u7aef\u4fdd\u6301\u76f8\u540c\u540d\u5b57\n</code></pre> \u53d1\u9001\u6d88\u606f <pre><code>clientHandler.send(\"xxx\")\n</code></pre> \u8bbe\u7f6e\u76d1\u542c <pre><code>localSocketServerHandler.setMsgListener(object : MsgListener {\noverride fun onMsgReceive(msg: String, client: LocalSocket) {\n//TODO\uff1a\u5904\u7406\u63a5\u6536\u5230\u6d88\u606f\n}\n\noverride fun onConnect(client: LocalSocket) {\n//TODO\uff1a\u8fde\u63a5\u6210\u529f\n}\n\noverride fun onClose(client: LocalSocket) {\n//TODO\uff1a\u5ba2\u6237\u7aef\u5173\u95ed\n}\n})\n</code></pre> \u5173\u95ed\u5ba2\u6237\u7aef <pre><code>clientHandler.closeClient()\n</code></pre></p>"},{"location":"img/fws/sensor/#netty","title":"netty","text":"<p>\u6a21\u5757(library)\u7c7b\u578b\uff0c\u5c01\u88c5Netty\u7684\u901a\u7528\u7c7b\uff0c\u5177\u4f53\u4f7f\u7528\u89c1proxy\u9879\u76ee</p>"},{"location":"img/fws/sensor/#netty_clientnetty_server","title":"netty_client\u548cnetty_server","text":"<p>\u5e94\u7528(application)\u7c7b\u578b\uff0c\u7528\u6765\u6d4b\u8bd5localsocket\u548cnetty\u7684\u57fa\u672c\u4f7f\u7528</p>"},{"location":"img/fws/sensor/#proxy","title":"proxy","text":"<p>\u6a21\u5757\u3001\u5e94\u7528\u7c7b\u578b\uff0c\u5c06build.gradle_d.kts\u4e3a\u6a21\u5757\uff0cbuild.gradle.kts\u4e3a\u5e94\u7528(\u9ed8\u8ba4)\uff0c\u6682\u5b9a\u65b9\u6848\u662f\u6539\u6587\u4ef6\u540d\u7684\u5f62\u5f0f\u5207\u6362</p> <p>\u6b64\u6a21\u5757\u6b63\u5f0f\u4f7f\u7528\u4f1a\u7f16\u8bd1\u6210\u7cfb\u7edfapp\uff0c\u5177\u4f53\u89c1Android.mk\u6587\u4ef6</p> <p>\u5bf9netty\u7684\u6269\u5c55\u4f7f\u7528SensorClientHandler\u548cSensorServerHandler</p> <p>## \u4f20\u611f\u5668\u5b9e\u73b0\u65b9\u68481(\u666e\u901a\u5e94\u7528\u751f\u6548\uff0c\u6e38\u620f\u65e0\u6548\uff0c\u5e9f\u9664)</p>"},{"location":"img/fws/sensor/#_3","title":"\u6e90\u7801","text":"<p>RK3588\u8f66\u673a\u7aef</p> <p>framework\u5c42\u4fee\u6539\u70b9</p> <p>frameworks/base/core/java/android/hardware/SystemSensorManager.java</p> <p>\u4e3b\u8981\u4fee\u6539\u5bf9\u4f20\u611f\u5668\u76d1\u542c\u6570\u636e\u548c\u53cd\u76d1\u542c\u6570\u636e\u63a5\u53e3\u8fdb\u884c\u62e6\u622a\u5904\u7406\uff0c\u4f5c\u4e3a\u5f00\u542f\u548c\u5173\u95ed\u624b\u673a\u7aef\u4f20\u611f\u5668\u7684\u5165\u53e3</p> <p>frameworks/base/core/java/android/hardware/LocalSocketClientHandle.java</p> <p>\u4e3b\u8981\u662f\u5c01\u88c5LocalSocket\u7684api\u4f5c\u4e3aclient\u7aef\u4f7f\u7528\uff0c\u5177\u4f53\u8c03\u7528\u5728SystemSensorManager\u4e2d</p> <p>\u7cfb\u7edfapp\u5c42\uff1aproxy\u9879\u76ee(CariadProxy)\uff0c\u6b64\u9879\u76ee\u6ca1\u6709\u754c\u9762\uff0c\u662f\u4e00\u4e2a\u670d\u52a1\uff0c\u4f5c\u4e3a\u8fde\u901a\u8f66\u673aframework\u548c\u624b\u673a\u7aef\u6570\u636e\u6865\u6881</p> <p>\u624b\u673a\u7aef</p> <p>app\u5c42: netty_client\u9879\u76ee\uff0c\u4e3b\u8981\u662f\u901a\u8fc7netty\u5c06\u4f20\u611f\u5668\u6570\u636e\u4f20\u9012\u5230proxy\u9879\u76ee\u4e2d</p>"},{"location":"img/fws/sensor/#_4","title":"\u6574\u4f53\u6d41\u7a0b","text":"<ol> <li>RK\u5f00\u673a\u542f\u52a8proxy\u4e2dLocalSocket\u670d\u52a1\u7aef\u4ee5\u53caNetty\u670d\u52a1\u7aef</li> <li>\u624b\u673a\u7aef\u542f\u52a8Netty\u5ba2\u6237\u7aef\u5e76\u8fde\u63a5</li> <li>RK\u4e09\u65b9app\u76d1\u542c\u4f20\u611f\u5668</li> <li>RK fw(SystemSensorManager)\u88ab\u521b\u5efa</li> <li>RK SystemSensorManager\u521b\u5efaLocalSocket\u5ba2\u6237\u7aef\u5e76\u8fde\u63a5</li> <li>RK\u4e09\u65b9app\u8c03\u7528registerListenerImpl</li> <li>RK LocalSocket\u5ba2\u6237\u7aef\u53d1\u9001enable\u6d88\u606f\uff0c\u643a\u5e26\u4f20\u611f\u5668\u7c7b\u578b</li> <li>\u624b\u673a\u7aef\u6536\u5230\u6d88\u606f\u5f00\u542f\u5bf9\u5e94\u4f20\u611f\u5668\u76d1\u542c\u5e76\u5c06\u6570\u636e\u901a\u8fc7Netty\u5ba2\u6237\u7aef\u53d1\u9001\u5230RK</li> <li>RK\u7aefNetty\u670d\u52a1\u7aef\u6536\u5230\u6d88\u606f\uff0c\u901a\u8fc7LocalSocket\u670d\u52a1\u7aef\u5206\u53d1\u6d88\u606f</li> <li>RK\u4e09\u65b9app\u6536\u5230\u6570\u636e</li> </ol> <p>SystemSensorManager\u6bcf\u4e2aapp\u8fdb\u7a0b\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\uff0c\u5373\u6709\u591a\u4e2aLocalSocket\u5ba2\u6237\u7aef</p> <p>\u6d41\u7a0b\u56fe</p> <p></p>"},{"location":"img/fws/sensor/#2","title":"\u4f20\u611f\u5668\u5b9e\u73b0\u65b9\u68482","text":""},{"location":"img/fws/sensor/#_5","title":"\u6e90\u7801","text":""},{"location":"img/fws/sensor/#rk3588","title":"RK3588\u8f66\u673a\u7aef","text":""},{"location":"linux/deepin_install/","title":"deepin","text":""},{"location":"linux/deepin_install/#_1","title":"\u5b98\u7f51","text":"<p>https://www.deepin.org/index/zh</p>"},{"location":"linux/deepin_install/#_2","title":"\u5b89\u88c5\u6559\u7a0b","text":"<p>https://www.deepin.org/zh/installation/</p>"},{"location":"linux/deepin_install/#bcm4352","title":"\u535a\u901a\u65e0\u7ebf\u82af\u7247bcm4352\u89e3\u51b3\u65e0\u7ebf\u65ad\u5f00\u641c\u7d22\u4e0d\u5230\u4fe1\u53f7","text":"<p>1.\u5378\u8f7d <pre><code>sudo apt autopurge bcmwl-kernel-source\nsudo apt autoremove bcmwl-kernel-source\n</code></pre> \u5728https://packages.debian.org/search\u4e2d\u641c\u7d22broadcom-sta</p> <p>buster-backports\u7248\u672c\u4e2d\u4e0b\u8f7d\u5bf9\u5e94\u7684\u4e09\u4e2a\u8f6f\u4ef6\u5305\uff1a</p> <p>broadcom-sta-common\u3001broadcom-sta-dkms\u3001broadcom-sta-source\u8fdb\u884c\u5b89\u88c5</p> <p>\u53ef\u80fd\u9047\u5230\u4f9d\u8d56\u51b2\u7a81 <pre><code>sudo aptitude install -f\n</code></pre> \u9009\u62e9\u67d0\u4e2a\u89e3\u51b3\u65b9\u6848\u540e\u91cd\u65b0\u5b89\u88c5\u4e0a\u9762\u7684\u8f6f\u4ef6</p>"},{"location":"linux/linux_command/","title":"\u5e38\u7528\u547d\u4ee4","text":""},{"location":"linux/linux_command/#ip","title":"\u67e5\u770b\u672c\u5730ip","text":"<pre><code>ifconfig\n</code></pre>"},{"location":"linux/linux_command/#_1","title":"\u6587\u4ef6\u5939\u53bb\u9664\u5c0f\u9501","text":"<pre><code>sudo chmod -R 777 \u8def\u5f84(\u6587\u4ef6\u5939\u6216\u6587\u4ef6)\n</code></pre>"},{"location":"linux/linux_command/#_2","title":"\u663e\u793a\u9690\u85cf\u6587\u4ef6","text":"<pre><code>ctrl+H\n</code></pre>"},{"location":"linux/linux_command/#_3","title":"\u67e5\u770b\u5185\u6838\u7248\u672c","text":"<pre><code>uname -a\n\u53ef\u4ee5\u533a\u5206\u662fx68,x86_64,arm64\u7b49\n</code></pre>"},{"location":"linux/linux_command/#_4","title":"\u5378\u8f7d\u65e7\u7248\u672c\u5185\u6838","text":"<p><pre><code>sudo apt-get remove linux-image- \u63a5\u7740\u6309\u4e24\u4e0btab\u952e\n</code></pre> \u5378\u8f7d\u5b8c\u540e\u6267\u884c <pre><code>sudo update-grub\n</code></pre></p>"},{"location":"linux/linux_command/#_5","title":"\u67e5\u770b\u5206\u533a\u5360\u7528\u60c5\u51b5","text":"<pre><code>df -h\n</code></pre>"},{"location":"linux/linux_command/#_6","title":"\u6740\u6b7b\u8fdb\u7a0b","text":"<p>\u4ee5\u6587\u4ef6\u7ba1\u7406\u5668nautilus\u4e3a\u4f8b \u65b9\u5f0f\u4e00\uff1a <pre><code>killall nautilus\n</code></pre> \u65b9\u5f0f\u4e8c\uff1a <pre><code>ps -A | grep nautilus\u5f97\u5230pid\nsudo kill pid\n</code></pre></p>"},{"location":"linux/linux_command/#as","title":"as\u672a\u54cd\u5e94","text":"<pre><code>pkill java\n</code></pre>"},{"location":"linux/linux_command/#vi","title":"vi\u4f7f\u7528","text":"<pre><code>\u63d2\u5165 \u6309insert\n\u4fdd\u5b58\u5e76\u9000\u51fa \u5148\u6309esc \u518d\u6309 : \u8f93\u5165wq\n\u67e5\u627e\uff1a/\u5185\u5bb9 \u6309n\u641c\u7d22\u4e0b\u4e00\u4e2a N\u4e0a\u4e00\u4e2a\n\u7f16\u8f91\uff1aa\n\u663e\u793a\u884c\u53f7\uff1aset nu \u4e0d\u663e\u793aset nonu\n</code></pre>"},{"location":"linux/linux_command/#filezillaftp","title":"\u5b89\u88c5filezilla\u7528\u4e8e\u7ba1\u7406ftp","text":"<pre><code>sudo apt-get install filezilla\n</code></pre>"},{"location":"linux/linux_command/#_7","title":"\u547d\u4ee4\u5b89\u88c5","text":"<p>1)apt-get</p> <p>sudo apt-get install package \u5b89\u88c5\u5305 sudo apt-get install package - - reinstall \u91cd\u65b0\u5b89\u88c5\u5305 sudo apt-get -f install \u4fee\u590d\u5b89\u88c5\"-f = \u2014\u2014fix-missing\" sudo apt-get remove package \u5220\u9664\u5305 sudo apt-get remove package - - purge \u5220\u9664\u5305\uff0c\u5305\u62ec\u5220\u9664\u914d\u7f6e\u6587\u4ef6\u7b49 sudo apt-get autoremove package  \u5220\u9664\u5305\u53ca\u5176\u4f9d\u8d56\u7684\u8f6f\u4ef6\u5305 sudo apt-get update \u66f4\u65b0\u6e90 sudo apt-get upgrade \u66f4\u65b0\u5df2\u5b89\u88c5\u7684\u5305 sudo apt-get dist-upgrade \u5347\u7ea7\u7cfb\u7edf sudo apt-get dselect-upgrade \u4f7f\u7528 dselect \u5347\u7ea7 sudo apt-get build-dep package \u5b89\u88c5\u76f8\u5173\u7684\u7f16\u8bd1\u73af\u5883 sudo apt-get source package \u4e0b\u8f7d\u8be5\u5305\u7684\u6e90\u4ee3\u7801 sudo apt-get clean &amp;&amp; sudo apt-get autoclean \u6e05\u7406\u65e0\u7528\u7684\u5305 sudo apt-get check \u68c0\u67e5\u662f\u5426\u6709\u635f\u574f\u7684\u4f9d\u8d56</p> <p>2)dpkg</p> <p>dpkg \u2013l | grep package \u67e5\u8be2deb\u5305\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6ca1\u6709\u6307\u5b9a\u5305\u5219\u663e\u793a\u5168\u90e8\u5df2\u5b89\u88c5\u5305,\u5176\u4e2d-l\u7b49\u4ef7\u4e8e--list dpkg -s package \u67e5\u770b\u5df2\u7ecf\u5b89\u88c5\u7684\u6307\u5b9a\u8f6f\u4ef6\u5305\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5176\u4e2d-s\u7b49\u4ef7\u4e8e--status dpkg -L package \u5217\u51fa\u4e00\u4e2a\u5305\u5b89\u88c5\u7684\u6240\u6709\u6587\u4ef6\u6e05\u5355\uff0c\u5176\u4e2d-L\u7b49\u4ef7\u4e8e--listfiles dpkg -S file \u67e5\u770b\u7cfb\u7edf\u4e2d\u7684\u67d0\u4e2a\u6587\u4ef6\u5c5e\u4e8e\u54ea\u4e2a\u8f6f\u4ef6\u5305 dpkg -i \u6240\u6709deb\u6587\u4ef6\u7684\u5b89\u88c5,\u5176\u4e2d-i\u7b49\u4ef7\u4e8e--install dpkg -r \u6240\u6709deb\u6587\u4ef6\u7684\u5378\u8f7d\uff0c\u5176\u4e2d-r\u7b49\u4ef7\u4e8e--remove dpkg -P \u5f7b\u5e95\u7684\u5378\u8f7d\uff0c\u5305\u62ec\u8f6f\u4ef6\u7684\u914d\u7f6e\u6587\u4ef6 dpkg -c \u67e5\u8be2deb\u5305\u6587\u4ef6\u4e2d\u6240\u5305\u542b\u7684\u6587\u4ef6,\u5176\u4e2d-c\u7b49\u4ef7\u4e8e--contents dpkg -L \u67e5\u770b\u7cfb\u7edf\u4e2d\u5b89\u88c5\u5305\u7684\u7684\u8be6\u7ec6\u6e05\u5355\uff0c\u540c\u65f6\u6267\u884c -c  sudo dpkg -I iptux.deb#\u67e5\u770biptux.deb\u8f6f\u4ef6\u5305\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5305\u62ec\u8f6f\u4ef6\u540d\u79f0\u3001\u7248\u672c\u4ee5\u53ca\u5927\u5c0f\u7b49\uff08\u5176\u4e2d-I\u7b49\u4ef7\u4e8e--info\uff09 \u6ce8\uff1adpkg\u547d\u4ee4\u65e0\u6cd5\u81ea\u52a8\u89e3\u51b3\u4f9d\u8d56\u5173\u7cfb\u3002\u5982\u679c\u5b89\u88c5\u7684deb\u5305\u5b58\u5728\u4f9d\u8d56\u5305\uff0c\u5219\u5e94\u907f\u514d\u4f7f\u7528\u6b64\u547d\u4ee4\uff0c\u6216\u8005\u6309\u7167\u4f9d\u8d56\u5173\u7cfb\u987a\u5e8f\u5b89\u88c5\u4f9d\u8d56\u5305\u3002</p>"},{"location":"linux/linux_command/#_8","title":"\u66f4\u65b0\u76f8\u5173","text":"<pre><code>sudo apt-get update\nsudo apt-get autoremove\nsudo apt-get upgrade\n</code></pre>"},{"location":"linux/linux_command/#_9","title":"\u641c\u7d22\u547d\u4ee4","text":"<p>grep\uff1a <pre><code>grep \u5185\u5bb9 ./ -R\n</code></pre> find: <pre><code>find . -name \"xxx\"\u5728\u5f53\u524d\u76ee\u5f55\u53ca\u5b50\u76ee\u5f55\u4e0b\u67e5\u8be2\u53ef\u4ee5\u7528or\u8fde\u63a5\nfind . -name \"xxx\" or -name \"xxx\"\nfind . -regex \"xxx\"\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\nfind . -iregex \"xxx\"\u5ffd\u7565\u5927\u5c0f\u5199\nfind . -name \"*\" -type f | xargs grep \"xxx\"\n</code></pre></p>"},{"location":"linux/linux_command/#_10","title":"\u914d\u7f6e\u542f\u52a8\u6302\u8f7d","text":"<p>\u4f4d\u7f6e\uff1a/etc/fstab</p> <p>\u67e5\u770buuid\uff1a <pre><code>sudo blkid\n</code></pre></p>"},{"location":"linux/linux_command/#_11","title":"\u67e5\u770b\u6587\u4ef6\u5939\u5927\u5c0f","text":"<pre><code>du -h --max-depth=1 \u76ee\u5f55 --max-depth=1\u9650\u5236\u76ee\u5f55\u5c42\u6570\n</code></pre>"},{"location":"linux/linux_command/#_12","title":"\u7ec8\u7aef\u6e05\u5c4f","text":"<pre><code>clear\u6216reset\n</code></pre>"},{"location":"linux/linux_command/#pid","title":"\u67e5\u770bpid","text":"<p>\u9664\u4e86\u4f7f\u7528ps\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528lsof</p> <p>\u5982\u65e0\u6cd5\u5220\u9664.fuse_hiddenxxx <pre><code>lsof .fuse_hiddenxxx\n</code></pre> \u67e5\u770b\u8fdb\u7a0b\u6240\u6709\u8005\u7684PID <pre><code>kill -9 pid\u6216\u8005\u76f4\u63a5\u8fdb\u4efb\u52a1\u7ba1\u7406\u5668\u6740\u6b7b\u8fdb\u7a0b\n</code></pre></p>"},{"location":"linux/linux_command/#_13","title":"\u8ba1\u7b97\u6587\u4ef6\u5939\u5927\u5c0f","text":"<pre><code>du -sh \u6587\u4ef6\u5939\n</code></pre>"},{"location":"linux/linux_command/#ssd","title":"\u6d4b\u8bd5ssd\u901f\u5ea6","text":"<pre><code>sudo apt-get install hdparm\nsudo hdparm -Tt /dev/sda\n</code></pre>"},{"location":"linux/linux_software/","title":"\u5e38\u89c1\u8f6f\u4ef6","text":"<p>\u661f\u706b\u5546\u5e97\uff1ahttps://spark-app.store/</p> <p>QQ\uff1ahttps://im.qq.com/linuxqq/index.shtml</p> <p>\u641c\u72d7\u8f93\u5165\u6cd5\uff1ahttps://shurufa.sogou.com/</p> <p>\u706b\u7130\u622a\u56fe\uff1a\u5b98\u65b9\u5e94\u7528\u5546\u5e97/\u661f\u706b\u5546\u5e97</p> <ul> <li>\u7cfb\u7edf-\u952e\u76d8-\u952e\u76d8\u5feb\u6377\u952e-\u81ea\u5b9a\u4e49\u5feb\u6377\u952e-(\u6dfb\u52a0\u540d\u79f0\u706b\u7130\u622a\u56fe\uff0c\u547d\u4ee4flameshot gui\uff0c\u5feb\u6377\u952e\u5982Alt+A)</li> <li>\u622a\u56fe\u9ed1\u5c4f\u95ee\u9898\uff1a\u8bbe\u7f6e-\u5173\u4e8e-\u7cfb\u7edf\u7a97\u53e3\uff0c\u5982\u679c\u662fWayLand\u9700\u4fee\u6539\u6210x11\uff0csudo vi /etc/gdm3/custom.conf\uff0cWaylandEnable=false\u53bb\u6389#\uff0c\u4fdd\u5b58\u5e76\u91cd\u542f\u7535\u8111</li> </ul>"},{"location":"linux/ubuntu_install/","title":"ubuntu","text":""},{"location":"linux/ubuntu_install/#windows11ubuntu","title":"Windows11\u5b89\u88c5Ubuntu\u53cc\u7cfb\u7edf","text":""},{"location":"linux/ubuntu_install/#ubuntuiso","title":"\u4e0b\u8f7dUbuntu\u955c\u50cfiso\u6587\u4ef6","text":"<ul> <li>\u5b98\u7f51\uff1a https://ubuntu.com/download/desktop</li> <li>\u963f\u91cc\uff1a https://developer.aliyun.com/mirror/?spm=a2c6h.25603864.0.0.94936c65ILrxWy</li> <li>\u6e05\u534e\uff1a https://mirrors.tuna.tsinghua.edu.cn/</li> </ul>"},{"location":"linux/ubuntu_install/#u","title":"U\u76d8\u542f\u52a8\u5236\u4f5c\u5de5\u5177","text":"<p>\u5b98\u7f51\u63a8\u8350https://rufus.ie/</p> <p>\u8fd0\u884c rufus-3.10.exe\uff0c\u6309\u7167\u4e0b\u56fe\u9009\u62e9\uff0c\u70b9\u51fb\u5f00\u59cb\u2013OK\u2013\u786e\u5b9a\uff0c\u7b49\u5f85\u8fdb\u5ea6\u6761\u8d70\u5b8c\u2013\u5173\u95ed</p> <p> </p>"},{"location":"linux/ubuntu_install/#u_1","title":"U\u76d8\u542f\u52a8\u5b89\u88c5\u7cfb\u7edf","text":"<p>\u6309\u7167\u63d0\u793a</p>"},{"location":"linux/ubuntu_install/#_1","title":"\u53cc\u7cfb\u7edf\u5f15\u5bfc\u754c\u9762\u7f8e\u5316+\u4fee\u6539\u9ed8\u8ba4\u542f\u52a8\u9879","text":"<p>\u4e3b\u9898\u4e0b\u8f7d\u5730\u5740\uff1ahttps://www.gnome-look.org/p/1009236/</p> <p>\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5\uff1ahttps://pan.baidu.com/s/1-mOl3_mHZZVh_PVMq9oQ1w \u63d0\u53d6\u7801\uff1a2pbn</p> <p>\u542f\u52a8Ubuntu\u7cfb\u7edf\u8fdb\u884c\u64cd\u4f5c <pre><code>\u89e3\u538b\ntar xvJf Vimix-1080p.tar.xz\n\u8fdb\u5165\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\ncd Vimix-1080p\n\u5b89\u88c5\nsudo ./install.sh\n\u4fee\u6539\u542f\u52a8\u8bbe\u7f6e\nsudo gedit /etc/default/grub\n</code></pre> GRUB_DEFAULT\uff08\u9ed8\u8ba4\u542f\u52a8\u9879\uff1a\u7f16\u53f7\u662f\u4ece0\u5f00\u59cb\u7684\uff09</p> <p>GRUB_TIMEOUT_STYLE\uff08\u662f\u5426\u663e\u793a\u5012\u8ba1\u65f6\uff0chidden\u7684\u5c5e\u6027\u8868\u793a\u4e0d\u4f1a\u663e\u793a\u5012\u8ba1\u65f6\uff0c\u6ce8\u91ca\u6389\u8be5\u884c\u5219\u663e\u793a\u5012\u8ba1\u65f6\uff09</p> <p>GRUB_TIMEOUT\uff08\u7b49\u5f85\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff09 \u6309\u81ea\u8eab\u9700\u6c42\u66f4\u6539\u540e\uff0c\u4fdd\u5b58\u5373\u53ef</p> <p>\u5728\u547d\u4ee4\u884c\u8f93\u5165 <pre><code>sudo update-grub\n</code></pre> \u91cd\u542f\u751f\u6548</p>"},{"location":"linux/ubuntu_install/#_2","title":"\u89e3\u51b3\u53cc\u7cfb\u7edf\u4e0b\u65f6\u95f4\u4e0d\u540c\u6b65\u95ee\u9898","text":"<p>\u8fdb\u5165Ubuntu\u7cfb\u7edf\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4 <pre><code>sudo apt-get install ntpdate //\u5728Ubuntu\u4e0b\u66f4\u65b0\u672c\u5730\u65f6\u95f4\nsudo ntpdate time.windows.com\nsudo hwclock --localtime --systohc //\u5c06\u672c\u5730\u65f6\u95f4\u66f4\u65b0\u5230\u786c\u4ef6\u4e0a\n</code></pre> \u7136\u540e\u91cd\u542f\u8fdb\u5165Windows\uff0c\u521d\u6b21\u91cd\u542f\u53ef\u80fd\u65f6\u95f4\u4f9d\u7136\u4e0d\u540c\uff0c\u4f46\u662f\u5728Windows\u81ea\u52a8\u8c03\u6574\u4e00\u904d\u540e\uff0c\u65f6\u95f4\u5c31\u540c\u6b65\u4e86\u3002</p>"},{"location":"linux/ubuntu_install/#vi","title":"vi\u7f16\u8f91\u5668\u952e\u76d8\u9519\u4e71\u7684\u95ee\u9898","text":"<p>\u5b89\u88c5vim full\u7248\u672c \u9996\u5148\uff0c\u8981\u5148\u5378\u6389\u65e7\u7248\u7684vi\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code>sudo apt-get remove vim-common\nsudo apt-get install vim\n</code></pre></p>"},{"location":"linux/ubuntu_install/#root","title":"\u8bbe\u7f6eroot\u5bc6\u7801","text":"<pre><code>sudo passwd root\n</code></pre>"},{"location":"linux/ubuntu_install/#_3","title":"\u5b89\u88c5\u8f93\u5165\u6cd5","text":"<p>\u5148\u5b89\u88c5\u661f\u706b\u5546\u5e97\uff0c\u5728\u529e\u516c\u4e2d\u9009\u4e2d\u76f8\u5e94\u7684\u8f93\u5165\u6cd5\uff0c\u4f8b\u5982\u767e\u5ea6\u8f93\u5165\u6cd5\uff0c\u5b89\u88c5\u4e2d\u4f1a\u51fa\u73b0\u62a5\u9519\uff0c\u6253\u5f00\u7ec8\u7aef\u6267\u884c <pre><code>sudo apt install -f\n</code></pre> \u6253\u5f00\u8bbe\u7f6e-\u533a\u57df\u4e0e\u8bed\u8a00-\u7ba1\u7406\u5df2\u5b89\u88c5\u7684\u8bed\u8a00\uff0c\u5728\u5f39\u51fa\u7684\u6846\u4e2d\u9009\u62e9\u952e\u76d8\u8f93\u5165\u6cd5\u7cfb\u7edf\u4e3aFcitx 4</p> <p>\u6ce8\u9500\u7535\u8111\uff0c\u91cd\u65b0\u6253\u5f00\u661f\u706b\u5546\u5e97\u91cd\u65b0\u5b89\u88c5\u8f93\u5165\u6cd5\u518d\u6ce8\u9500\u5373\u53ef</p>"},{"location":"linux/ubuntu_install/#_4","title":"\u7f8e\u5316\u4e3b\u9898","text":"<p>\u6253\u5f00ubuntu software\uff0c\u641c\u7d22\u5e76\u5b89\u88c5GNOME Tweaks\u548c\u6269\u5c55</p> <p>\u62d3\u5c55\u7ba1\u7406\u5b89\u88c5\uff1a <pre><code>sudo apt install gnome-shell-extension-manager\n</code></pre> \u6253\u5f00\u62d3\u5c55\u7ba1\u7406\u5668\u9009\u62e9\u5b89\u88c5User Themes</p> <p>mac\u4e3b\u9898 <pre><code>git clone https://github.com/vinceliuice/WhiteSur-gtk-theme.git --depth=1\n</code></pre> \u6267\u884c <pre><code>./install.sh\n</code></pre> mac\u56fe\u6807 <pre><code>git clone https://github.com/vinceliuice/WhiteSur-icon-theme.git --depth=1\n</code></pre> \u6267\u884c <pre><code>./install.sh\n</code></pre></p> <p>\u6253\u5f00\u4f18\u5316(GNOME Tweaks)\uff0c\u4e0b\u5b89\u88c5\u5916\u89c2\uff0c\u5bf9\u5e94\u7528\u7a0b\u5e8f\u3001\u5149\u6807\u3001\u56fe\u6807\u3001Shell\u8fdb\u884c\u4e3b\u9898\u914d\u7f6eWhite\u5f00\u5934</p> <p>\u7a97\u53e3\u6807\u9898\u680f\u4fee\u6539\u653e\u7f6e\u4e3a\u5de6</p>"},{"location":"linux/ubuntu_install/#samba","title":"\u914d\u7f6esamba\u5171\u4eab","text":"<p>\u5b89\u88c5samba <pre><code>sudo apt-get install samba\n</code></pre> \u8bbe\u7f6e\u7528\u6237\u76ee\u5f55\u6743\u9650 <pre><code>sudo chmod 755 /home/username\n</code></pre> \u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 <pre><code>sudo vi /etc/samba/smb.conf\n</code></pre> \u6dfb\u52a0\u5185\u5bb9 <pre><code>[Share]  \n    Comment = Ubuntu File Share  \n    Path = /home/username  \n    Browseable = yes  \n    Writable = yes  \n    Valid Users = username\n</code></pre> \u8bbe\u7f6e\u8bbf\u95ee\u7528\u6237\u5e76\u8bbe\u7f6e\u8bbf\u95ee\u5bc6\u7801 <pre><code>sudo smbpasswd -a username\n</code></pre> \u91cd\u542fsamba\u670d\u52a1 <pre><code>sudo service smbd restart\n</code></pre> window\u7535\u8111\u76f4\u63a5\u5728\u6587\u4ef6\u7ba1\u7406\u5176\u4e2d\u8f93\u5165ubuntu\u7684ip\u5730\u5740\u5373\u53ef\u8bbf\u95ee\uff0c\u521b\u5efa\u78c1\u76d8\u6620\u5c04\u8def\u5f84\u4e3a\uff1a <pre><code>\\\\ip\\Share\n</code></pre></p>"},{"location":"linux/ubuntu_install/#java","title":"\u914d\u7f6ejava\u73af\u5883","text":"<pre><code>PATH=~/bin:$PATH\nexport JAVA_HOME=/media/yuli/E/Software/android-studio-linux/jbr\nexport CLASSPATH=.:${JAVA_HOME}/bin\nexport PATH=${JAVA_HOME}/bin:/media/yuli/E/Software/AndroidSDKlinux/platform-tools:$PATH\n</code></pre>"},{"location":"mac/mac_install/","title":"\u9ed1\u82f9\u679c","text":""},{"location":"mac/mac_install/#_1","title":"\u865a\u62df\u673a\u5f62\u5f0f","text":"<p>\u865a\u62df\u673a\u5b89\u88c5</p>"},{"location":"mac/mac_install/#_2","title":"\u9ed1\u82f9\u679c\u5f62\u5f0f","text":""},{"location":"mac/mac_install/#1","title":"1.\u5b89\u88c5","text":"<p>\u89c1\u9ed1\u82f9\u679c\u5b89\u88c5</p>"},{"location":"mac/mac_install/#2","title":"2.\u9a71\u52a8\u4fee\u590d","text":""},{"location":"mac/mac_install/#1_1","title":"1.\u4fee\u590d\u4eae\u5ea6\u4e4b\u6838\u663e\u6559\u7a0b","text":"<p>1.\u5220\u9664\u4e07\u80fd\u9a71\u52a8 /EFI/CLOVER/kexts/other/IntelGraphicsFixup.kext\uff0c\u5f80\u91cc\u6dfb\u52a0FakePCIID_Intel_HD_Graphics.kext\uff0cAppleBacklightFixup.kext</p> <p>2.\u4f7f\u7528Clover Configurator</p> <p>\u6253\u5f00/EFI/CLOVER/config.plist 1\uff09\u52fe\u9009Acpi\u9879\u4e2d\u7684AddDTGP\u548cAddPNLF\uff0cPatches\u4e2d\u6dfb\u52a0AZAL to HDEF\u6216HDAS to HDEF</p> <p>2\uff09\u52fe\u9009Devices\u9879\u4e2d\u7684SetIntelBacklight\u548cSetIntelMacBacklight\uff1bSystem Paramenters\u53ef\u8bbe\u7f6e\u5f00\u673a\u9ed8\u8ba4\u4eae\u5ea6Backlight Level\u6700\u4eae0xFFFF,Inject Kexts\u9009\u62e9Detect</p> <p>3.\u67e5\u770bCPU\u578b\u53f7\uff0c\u9009\u62e9\u5408\u9002\u7684platform-id Intel HD Graphics 4400\u53ef\u4f7f\u75280x0a160000\uff0c0x0c160000\uff0c0x0a260006</p> <p>Intel\u6838\u663eplatform ID\u6574\u7406\u53casmbios\u901f\u67e5\u8868</p> <p>https://blog.daliansky.net/Intel-core-display-platformID-finishing.html</p> <p>4.\u5728Graphics\u9879\u4e2d\u586b\u5199ig-platform-id</p> <p>5.\u4fdd\u5b58\u540e\u91cd\u542f</p>"},{"location":"mac/mac_install/#2_1","title":"2.\u4fee\u590d\u58f0\u97f3\u4e4b\u4eff\u5192\u58f0\u5361\u6559\u7a0b","text":"<p>1.\u5220\u9664\u4e07\u80fd\u9a71\u52a8</p> <p>/EFI/CLOVER/kexts/other/VoodooHDA.kext\uff0c\u5f80\u91cc\u6dfb\u52a0AppleALC.kext\u548cLilu.kext</p> <p>2.\u4f7f\u7528Clover Configurator</p> <p>\u6253\u5f00/EFI/CLOVER/config.plist,\u52fe\u9009Acpi\u9879\u4e2d\u7684FIXHPET</p> <p>3.\u67e5\u770b\u58f0\u5361\u578b\u53f7</p> <p>win\u4e0b\u53ef\u4f7f\u7528aida\u8f6f\u4ef6\u67e5\u770b\uff0cMac\u76f4\u63a5\u4f7f\u7528Hackintool\u67e5\u770b</p> <p>Realtek AppleALC283\u53ef\u4f7f\u7528layout-id\u5982\u4e0b\uff1a 1, 3, 11, 66(\u672c\u673a11)</p> <p>\u5176\u4ed6AppleALC\u652f\u6301\u7684Codecs\u5217\u8868</p> <p>https://blog.daliansky.net/AppleALC-Supported-codecs.html </p> <p>\u7b14\u8bb0\u672c\uff0c\u4ece\u5927\u6570\u5b57\u6539\u5230\u5c0f\u6570\u5b57\u5c1d\u8bd5</p> <p>4.\u5728Devices\u9879\u4e2dAudio Inject\u586b\u5199layout-id</p> <p>5.\u4fdd\u5b58\u540e\u91cd\u542f</p>"},{"location":"mac/mac_install/#3ddst","title":"3.ddst\u4fee\u6539\u6559\u7a0b","text":"<p>1.Command+shift+G\uff0c\u524d\u5f80/usr/bin\u76ee\u5f55\uff0c\u5e76\u5c06iasl\u7f16\u8bd1\u5668\u62d6\u5165\u5230\u8be5\u76ee\u5f55</p> <p>2.aml\u8f6cdsl\uff1a <pre><code>iasl -da -dl *.aml\n</code></pre> 3.\u4f7f\u7528MaciASL\u6253\u5f00dsl\u8fdb\u884c\u4fee\u6539\u6216\u8005\u6253\u8865\u4e01</p> <p>4.dsl\u8f6caml\uff1a <pre><code>iasl *.dsl\n</code></pre> 5.\u590d\u5236\u5230EFI/Clover/ACPI/patched/</p>"},{"location":"mac/mac_install/#3","title":"3.\u4f18\u5316","text":""},{"location":"mac/mac_install/#1_2","title":"1.\u9690\u85cf\u76f8\u5173\u542f\u52a8\u76d8","text":"<p>Clover Configurator\u4e2d\u9009\u62e9Gui\u9879\u53bb\u9664Scan\u4e2d\u7684Legacy\uff0cHide Volume\u4e2d\u6dfb\u52a0Preboot\uff0cRecovery\uff0cmacOS Install</p>"},{"location":"mac/mac_install/#2_2","title":"2.\u8bbe\u7f6e\u4e3b\u9898","text":"<p>Gui\u4e2dTheme\u4fee\u6539\u540d\u79f0\uff0c\u540d\u79f0\u4e3aEFI/CLOVER/themes\u4e2d\u7684\u6587\u4ef6\u5939\u540d\u79f0</p>"},{"location":"mac/mac_install/#3_1","title":"3.\u8bbe\u7f6e\u9ed8\u8ba4\u542f\u52a8\u76d8","text":"<p>Boot\u4e2dDefault Boot Volume\u586b\u5199\u76d8\u540d\u79f0</p>"},{"location":"mac/mac_swift/","title":"SwiftUI","text":""},{"location":"mac/mac_swift/#_1","title":"\u4ea7\u54c1\u5206\u7c7b\u7f16\u7801","text":"<pre><code>#if os(iOS)\n//code\n#endif\n\n#if os(macOS)\n//code\n#endif\n</code></pre>"},{"location":"mac/mac_swift/#_2","title":"\u6253\u5305","text":"<p>1.\u6253\u5f00\u83dc\u5355Product-Archive</p> <p>2.\u9009\u62e9Distribute App</p> <p>3.Copy App\uff0c\u9009\u4e2d\u684c\u9762\u5373\u53ef</p>"},{"location":"mac/mac_swift/#_3","title":"\u5e38\u89c1\u5751","text":"<p>Mac\u7aef\u4f7f\u7528AsyncImage\u7ec4\u4ef6\u52a0\u8f7d\u7f51\u7edc\u56fe\u7247\u62a5\u9519</p> <p>\u5f02\u5e38\uff1afinished with error [-1003] Error Domain=NSURLErrorDomain Code=-1003 \"\u672a\u80fd\u627e\u5230\u4f7f\u7528\u6307\u5b9a\u4e3b\u673a\u540d\u7684\u670d\u52a1\u5668\u3002\"</p> <p>\u89e3\u51b3\uff1a\u52fe\u9009\u7ea2\u6846\u9009\u9879</p> <p></p>"},{"location":"ohos/arkts_base/","title":"Arkts base","text":"<p>TypeScript\u7684\u5b98\u65b9\u6559\u7a0b\uff08https://www.typescriptlang.org/docs/\uff09</p> <p>\u5728\u7ebfPlayground\u5e73\u53f0\uff08https://www.typescriptlang.org/play\uff09</p>"},{"location":"ohos/arkts_base/#_1","title":"\u8fed\u4ee3\u5668","text":"<p>for of\u548cfor in <pre><code>let list = [4, 5, 6];\n\nfor (let i in list) {\nconsole.log(i); // \"0\", \"1\", \"2\",\n}\n\nfor (let i of list) {\nconsole.log(i); // \"4\", \"5\", \"6\"\n}\n</code></pre></p>"},{"location":"ohos/ohos_build/","title":"\u6e90\u7801\u7f16\u8bd1","text":""},{"location":"ohos/ohos_build/#wsl2","title":"WSL2\u914d\u7f6e","text":"<p>1.\u6253\u5f00Microsoft store\u641c\u7d22ubuntu\uff0c\u63a8\u8350\u4f7f\u7528ubuntu-20.04\uff0c\u4e0b\u8f7d\u540e\u5982\u679c\u51fa\u73b0\u4e71\u7801\u5219\u5b89\u88c5update_x64.msi(wsl2\u4e2d)\uff0c\u5982\u679cwsl2\u8fd8\u672a\u914d\u7f6e\u5219\u5148wsl2\u73af\u5883\u914d\u7f6e</p> <p>2.\u8bbe\u7f6eroot\u5bc6\u7801 <pre><code>sudo passwd root\n</code></pre></p> <p>3.Ubuntu Shell\u73af\u5883\u4fee\u6539\u4e3abash</p> <p>\u6267\u884csudo dpkg-reconfigure dash\uff0c\u9009\u62e9No</p> <p>4.\u5207\u6362python\u7248\u672c <pre><code>sudo update-alternatives --install /usr/bin/python python /usr/bin/python3 150\n</code></pre></p> <p>5.\u5b89\u88c5pip3 <pre><code>sudo apt -y update\nsudo apt upgrade\nsudo apt install python3-pip\n</code></pre></p> <p>6.\u914d\u7f6egit\u76f8\u5173 <pre><code>sudo apt install git-all\nsu\ncurl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | sudo bash\napt install git-lfs\ngit lfs install\nexit\ngit config --global user.name \"yuli\"\ngit config --global user.email \"1875287386@qq.com\"\ngit config --global credential.helper store\n</code></pre></p> <p>7.\u914d\u7f6erepo <pre><code>curl https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 &gt; /usr/local/bin/repo\nchmod a+x /usr/local/bin/repo\npip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple requests\n</code></pre></p> <p>8.\u6309\u7167wsl\u8fc1\u79fb\u5230\u5176\u4ed6\u78c1\u76d8(\u53ef\u8df3\u8fc7)</p>"},{"location":"ohos/ohos_build/#_1","title":"\u5b98\u7f51\u76f8\u5173","text":"<p>\u6e90\u7801\u6587\u6863\uff1a https://gitee.com/openharmony/docs</p> <p>\u5f00\u53d1\u8005\u6587\u6863\uff1a http://docs.openharmony.cn/pages/v4.0/zh-cn/OpenHarmony-Overview_zh.md/</p>"},{"location":"ohos/ohos_build/#_2","title":"\u6e90\u7801\u4e0b\u8f7d","text":"<p>\u6ce8\u518cgitee\u4ee5\u53ca\u751f\u6210ssh <pre><code>ssh-keygen -t ed25519 -C \"ubuntu\"\n</code></pre> \u4e0b\u8f7d <pre><code>repo init -u git@gitee.com:openharmony/manifest.git -b master --no-repo-verify\nrepo sync -c\nrepo forall -c 'git lfs pull'\n</code></pre></p>"},{"location":"ohos/ohos_build/#_3","title":"\u7f16\u8bd1\u914d\u7f6e","text":"<p>\u914d\u7f6e\u73af\u5883\uff1a <pre><code>./build/build_scripts/env_setup.sh\nsudo apt install libxinerama-dev libxcursor-dev libxrandr-dev libxi-dev\n</code></pre> \u5982\u679cenv_setup.sh\u6267\u884c\u6ca1\u6548\u679c\uff0c\u5219\u6253\u5f00\u6b64\u811a\u672c\u6587\u4ef6\u5220\u9664\u6216\u6ce8\u91ca\u6389\u8fd9\u53e5\u4ee3\u7801 result2=$(echo $SHELL | grep \"zsh\")</p> <p>\u9884\u7f16\u8bd1\u5de5\u5177\u4e0b\u8f7d\uff1a <pre><code>./build/prebuilts_download.sh\n</code></pre> 64\u4f4d\uff1a <pre><code>./build.sh --product-name rk3568 --target-cpu arm64 --ccache\n</code></pre> 32\u4f4d\uff1a <pre><code>./build.sh --product-name rk3568  --ccache\n</code></pre></p> <p>\u7f16\u8bd1\u5b8c\u6210\u955c\u50cf\u8def\u5f84\uff1a\\out\\rk3568\\packages\\phone\\images\\</p>"},{"location":"ohos/ohos_build/#_4","title":"\u53c2\u8003\u6559\u7a0b","text":"<p>https://blog.csdn.net/nanzhanfei/article/details/121951919</p>"},{"location":"ohos/ohos_build/#_5","title":"\u5176\u4ed6\u4f7f\u7528\u7f51\u7ad9","text":"<p>daily\u6784\u5efa\u7248\u672c</p> <p>http://ci.openharmony.cn</p>"},{"location":"window/window_inner_android/","title":"Android\u5b50\u7cfb\u7edf","text":""},{"location":"window/window_inner_android/#1windows","title":"1.\u5f00\u542fwindows\u529f\u80fd(\u9700\u8981\u91cd\u542f)","text":"<p>\u6253\u5f00\u63a7\u5236\u9762\u677f-\u7a0b\u5e8f-\u542f\u52a8\u6216\u5173\u95edwindows\u529f\u80fd</p> <p>\u52fe\u9009Hyper-V\u548c\u865a\u62df\u673a\u5e73\u53f0</p> <p>\u5bf9\u4e8eWin11\u5bb6\u5ead\u7248</p> <p>\u65b0\u5efa\u6587\u4ef6\u540d\u4e3a\uff1a\u5f00\u542fHyper-V.cmd\uff0c\u5185\u5bb9\u5982\u4e0b\uff0c\u4fdd\u6301\u53cc\u51fb\u6267\u884c <pre><code>pushd \"%~dp0\"\ndir /b %SystemRoot%\\servicing\\Packages*Hyper-V*.mum &gt;hyper-v.txt\nfor /f %%i in ('findstr /i . hyper-v.txt 2^&gt;nul') do dism /online /norestart /add-package:\"%SystemRoot%\\servicing\\Packages%%i\"\ndel hyper-v.txt\nDism /online /enable-feature /featurename:Microsoft-Hyper-V-All /LimitAccess /ALL\n</code></pre></p>"},{"location":"window/window_inner_android/#2","title":"2.\u4e0b\u8f7d\u5b50\u7cfb\u7edf","text":"<p>\u6253\u5f00\u8bbe\u7f6e-\u65f6\u95f4\u548c\u8bed\u8a00-\u8bed\u8a00\u548c\u533a\u57df</p> <p>\u5c06\u56fd\u5bb6\u548c\u5730\u533a\u4fee\u6539\u6210\u7f8e\u56fd\uff0c\u4e0b\u8f7d\u4ee5\u4e0b\u8f6f\u4ef6</p> <p>Windows Subsystem for Android\u4e0b\u8f7d\u94fe\u63a5\uff1a(\u6d4f\u89c8\u5668\u6253\u5f00\u70b9get in store app) https://www.microsoft.com/store/productId/9P3395VX91NR</p>"},{"location":"window/window_inner_android/#3","title":"3.\u8fde\u63a5\u8bbe\u5907","text":"<p>\u5f00\u59cb\u4e2d\u6253\u5f00\u9002\u7528\u4e8eAndroid\u7684Windows\u5b50\u7cfb\u7edf\u8bbe\u7f6e\u8f6f\u4ef6\uff0c\u9009\u62e9\u5f00\u53d1\u4eba\u5458\uff0c\u5f00\u542f\u5f00\u53d1\u4eba\u5458\u6a21\u5f0f\uff0c\u8bb0\u4f4fadb\u7684ip\u8fde\u63a5\u6bd4\u5982 <pre><code>adb connect 127.0.0.1:58526\n</code></pre> \u8fde\u63a5\u540e\u4f7f\u7528 <pre><code>adb install xxx.apk\n</code></pre></p>"},{"location":"window/window_install/","title":"\u7cfb\u7edf\u5b89\u88c5","text":""},{"location":"window/window_install/#_1","title":"\u955c\u50cf\u4e0b\u8f7d","text":"<p>https://msdn.itellyou.cn/</p>"},{"location":"window/window_software/","title":"\u5e38\u89c1\u8f6f\u4ef6","text":"<p>Xshell</p> <p>Mobaxterm</p> <p>RAMMap\uff1a\u5185\u5b58\u6e05\u7406\u5de5\u5177</p> <p>WizTree: \u78c1\u76d8\u5206\u6790\u5de5\u5177</p> <p>scrcpy\uff1a\u5b89\u5353\u6295\u5c4f\u795e\u5668</p> <p>AI\u5de5\u5177\uff1agpt\u8f6f\u4ef6</p> <p>drawio\uff1a\u7ed8\u5236\u7c7b\u56fe\u3001\u6d41\u7a0b\u56fe\u7b49\u5de5\u5177</p> <p>charles\uff1a\u6293\u5305\u5de5\u5177</p> <p>IDA\uff1aso\u8c03\u8bd5\u5de5\u5177\uff0c\u53cd\u6c47\u7f16\u5de5\u5177</p>"},{"location":"window/window_vmware/","title":"VMWare\u5b89\u88c5","text":""},{"location":"window/window_vmware/#1vmware","title":"1.\u5b89\u88c5VMWare\u865a\u62df\u673a","text":"<p>\u5b98\u65b9\u4e0b\u8f7d\u5730\u5740\uff1a</p> <p>https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</p> <p>VMware\u8bb8\u53ef\u8bc1</p> <p>17.x</p> <p>JU090-6039P-08409-8J0QH-2YR7F</p> <p>ZA5RU-6FYD5-48EPY-3XXEE-PAUGD</p> <p>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</p> <p>FC7D0-D1YDL-M8DXZ-CYPZE-P2AY6</p> <p>ZC3TK-63GE6-481JY-WWW5T-Z7ATA</p> <p>1Z0G9-67285-FZG78-ZL3Q2-234JG</p> <p>4A4RR-813DK-M81A9-4U35H-06KND</p> <p>NZ4RR-FTK5H-H81C1-Q30QH-1V2LA</p> <p>JU090-6039P-08409-8J0QH-2YR7F</p> <p>4Y09U-AJK97-089Z0-A3054-83KLA</p> <p>4C21U-2KK9Q-M8130-4V2QH-CF810</p> <p>MC60H-DWHD5-H80U9-6V85M-8280D</p> <p>16.x</p> <p>ZF3R0-FHED2-M80TY-8QYGC-NPKYF</p> <p>Z1ZPR-EDGQN-M1JE9-HYFGX-YPGEX</p> <p>\u5185\u5b58\uff1a\u4e0d\u80fd\u8d85\u8fc7\u7269\u7406\u5185\u5b58 cpu\u6838\u6570\uff1a\u89c1\u4efb\u52a1\u7ba1\u7406\u5668-\u6027\u80fd\uff0ccpu\u4e2a\u6570\u548c\u5904\u7406\u5668\u76f8\u4e58\u4e0d\u80fd\u8d85\u8fc720</p> <p></p>"},{"location":"window/window_vmware/#2ubuntu","title":"2.\u5b89\u88c5\u7cfb\u7edf(\u4ee5ubuntu\u4e3a\u4f8b)","text":"<p>iso\u955c\u50cf\u4e0b\u8f7d\u5730\u5740\uff1a \u963f\u91cc \u6e05\u534e</p>"},{"location":"window/window_vmware/#3samba","title":"3.\u5b89\u88c5samba\u5171\u4eab","text":"<p>\u5728ubuntu\u7ec8\u7aef\u4e2d\u64cd\u4f5c <pre><code>sudo apt-get install samba\nsudo apt-get install cifs-utils\n</code></pre> \u4fee\u6539\u914d\u7f6e <pre><code>sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak\nsudo vi /etc/samba/smb.conf\n</code></pre> \u6700\u540e\u6dfb\u52a0\u4e00\u4e0b\u5185\u5bb9\uff0c/home/hfc/\u53ef\u4ee5\u66f4\u6539\u6210\u5176\u4ed6\u76ee\u5f55 <pre><code>[share]\n      path = /home/hfc/\n      available = yes\n      browseable = yes\n      public = yes\n      writable = yes\n</code></pre> \u521b\u5efa\u7528\u6237 <pre><code>sudo touch /etc/samba/smbpasswd\nsudo smbpasswd -a hfc(\u5f53\u524d\u7cfb\u7edf\u7528\u6237)\n</code></pre> \u91cd\u542f\u670d\u52a1 <pre><code>sudo /etc/init.d/smbd restart\n</code></pre> win10\u5f00\u542fsmb\u5171\u4eab\u670d\u52a1  Win+R\uff0c\u8f93\u5165gpedit.msc ,\u6253\u5f00\u7ec4\u7b56\u7565\uff0c\u4fee\u6539\u4ee5\u4e0b\u914d\u7f6e\u540e\u91cd\u542f\u7535\u8111  \u82e5\u5f00\u542fhyper-v\u9700\u8981\u5173\u95ed\uff0c\u5426\u5219\u5f71\u54cd\u6a21\u62df\u5668\u4f7f\u7528 \u5173\u95ed\u65b9\u5f0f\uff1a \u7ba1\u7406\u5458\u8fd0\u884c\u7ec8\u7aef\u8f93\u5165bcdedit /set  hypervisorlaunchtype OFF(\u6062\u590dAUTO) Win+R\u8f93\u5165services.msc\uff0c\u5c06HV\u4e3b\u673a\u670d\u52a1\u7981\u7528  \u91cd\u542f\u7535\u8111\u751f\u6548</p>"},{"location":"window/window_win11/","title":"Window11\u76f8\u5173","text":""},{"location":"window/window_win11/#1win10","title":"1.\u53f3\u952e\u83dc\u5355\u6062\u590dwin10","text":"<p>1.win+r\u6253\u5f00\u8fd0\u884c\u7a97\u53e3\uff0c\u8f93\u5165regedit\uff0c\u6309\u4e0b\u56de\u8f66\u952e\u786e\u8ba4\u5373\u53ef\u6253\u5f00\u6ce8\u518c\u8868</p> <p>2.\u5728\u8def\u5f84\u4e2d\u8f93\u5165\uff1aHKEY_CURRENT_USER\\SOFTWARE\\CLASSES\\CLSID</p> <p></p> <p>3.\u53f3\u952e\u70b9\u51fbCLSID\u9879\uff0c\u70b9\u51fb\u65b0\u5efa\u4e00\u4e2a\u9879\uff0c\u547d\u540d\u4e3a{86ca1aa0-34aa-4e8b-a509-50c905bae2a2} </p> <p>4.\u53f3\u952e\u70b9\u51fb\u65b0\u5efa\u7684\u9879\uff0c\u7136\u540e\u518d\u65b0\u5efa\u4e00\u4e2a\u9879\uff0c\u547d\u540d\u4e3aInprocServer32 </p> <p>5.\u91cd\u542f\u8d44\u6e90\u7ba1\u7406\u5668 </p> <p>\u547d\u4ee4\u65b9\u5f0f <pre><code>reg.exe delete \"HKCUSoftwareClassesCLSID{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}InprocServer32\" /va /f\n</code></pre> \u6216\u8005 <pre><code>reg add HKCU\\Software\\Classes\\CLSID\\{86ca1aa0-34aa-4e8b-a509-50c905bae2a2}\\InprocServer32 /ve /d \"\" /f\n</code></pre> \u9700\u8981\u91cd\u542f\u7535\u8111</p>"},{"location":"window/window_win11/#2","title":"2.\u62d6\u62fd\u5220\u9664\u6587\u4ef6","text":"<p>\u65b0\u5efabat\u6587\u4ef6\uff0c\u6dfb\u52a0\u4ee3\u7801 <pre><code>DEL /F /A /Q \\\\?\\%1\nRD /S /Q \\\\?\\%1\n</code></pre></p>"},{"location":"window/window_win11/#37z00x","title":"3.\u5408\u5e767z.00x","text":"<p>\u6253\u5f00cmd <pre><code>copy /b xxx.7z.* xxx.7z\n</code></pre></p>"},{"location":"window/window_wsl2/","title":"WSL2","text":""},{"location":"window/window_wsl2/#1windows","title":"1.Windows\u529f\u80fd\u4e2d\u52fe\u9009","text":"<p>\u63a7\u5236\u9762\u677f-\u7a0b\u5e8f-\u542f\u7528\u6216\u5173\u95ed</p> <p>Windows\u865a\u62df\u673a\u76d1\u63a7\u7a0b\u5e8f\u5e73\u53f0\u3001\u9002\u7528\u4e8eLinux\u7684Windows\u5b50\u7cfb\u7edf\u5e76\u91cd\u542f\u7535\u8111</p>"},{"location":"window/window_wsl2/#2ubuntu","title":"2.\u5b89\u88c5ubuntu","text":"<p>\u6253\u5f00\u5e94\u7528\u5546\u5e97\u641c\u7d22ubuntu\u5e76\u83b7\u53d6\uff0c\u4f8b\u5982\u9009\u62e9ubuntu22.04</p>"},{"location":"window/window_wsl2/#3","title":"3.\u4e0b\u8f7d\u66f4\u65b0\u7a0b\u5e8f\u5e76\u5b89\u88c5","text":"<p>https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi</p>"},{"location":"window/window_wsl2/#4ubuntu","title":"4.\u542f\u52a8ubuntu","text":"<p>window\u83dc\u5355\u4e2d\u6253\u5f00ubuntu\u4f1a\u81ea\u52a8\u8fdb\u884c\u5b89\u88c5\uff0c\u5b8c\u6210\u540e\u8f93\u5165\u7528\u6237\u540d\uff0c\u5bc6\u7801</p> <p>\u62a5\u9519\uff1aWslRegisterDistribution failed with error: 0x80370102</p> <p>\u786e\u4fddBIOS\u4e2dVirtualization(\u6216\u8005VT\u5173\u952e\u5b57\uff0c\u6bcf\u4e2a\u7535\u8111\u53ef\u80fd\u4e0d\u540c)\u529f\u80fd\u5df2\u7ecf\u5f00\u542f</p> <p>\u7ba1\u7406\u5458\u8eab\u4efd\u6253\u5f00\u7ec8\u7aef <pre><code>bcdedit /set hypervisorlaunchtype auto\n</code></pre> \u91cd\u542f\u7535\u8111</p>"},{"location":"window/window_wsl2/#5","title":"5.\u67e5\u770b\u914d\u7f6e","text":"<p>\u6253\u5f00powershell\u8f93\u5165 <pre><code>wsl -l --all -v\n</code></pre> \u5982\u679cversion\u662f2\u8868\u793a\u5df2\u7ecf\u5b89\u88c5wsl2\uff0c\u5982\u679c\u662f1\u9700\u8981\u8fdb\u884c\u5347\u7ea7 <pre><code>wsl --set-version Ubuntu-22.04 2\n</code></pre></p>"},{"location":"window/window_wsl2/#6c","title":"6.\u8fc1\u79fb\u5230\u5176\u4ed6\u76d8\uff0c\u9ed8\u8ba4\u5b89\u88c5\u5728c\u76d8","text":"<p><pre><code>wsl --shutdown\n</code></pre> \u901a\u8fc7wsl -l --all -v\u786e\u8ba4\u662fStopped\u72b6\u6001</p> <p>\u5bfc\u51fa\u538b\u7f29\u5305\uff1a <pre><code>wsl --export Ubuntu-22.04 D:\\ubuntuback\\ubuntu22.04.tar\n</code></pre> \u6ce8\u9500\u7cfb\u7edf\uff1a <pre><code>wsl --unregister Ubuntu-22.04\n</code></pre> \u5bfc\u5165\u7cfb\u7edf\uff1a <pre><code>wsl --import Ubuntu-22.04 D:\\ubuntu2204 D:ubuntuback\\ubuntu22.04.tar\n</code></pre> Ubuntu-22.04 Linux\u7cfb\u7edf\u540d\u79f0\u548c\u7248\u672c</p> <p>D:\\Ubuntu2204 \u5b89\u88c5\u8def\u5f84</p> <p>D:ubuntuback\\ubuntu22.04.tar \u955c\u50cf\u6240\u5728\u4f4d\u7f6e</p> <p>\u91cd\u65b0\u8bbe\u7f6e\u7528\u6237\uff1a <pre><code>ubuntu2204.exe config --default-user yuli\n</code></pre></p> <p>\u914d\u7f6e\u4ea4\u6362swap\u5185\u5b58</p> <p>1.\u771f\u6b63\u7684ubuntu\u4e2d <pre><code>sudo fallocate -l 10G /swapfile\nsudo chmod 600 /swapfile\nsudo mkswap /swapfile\nsudo swapon /swapfile\necho '/swapfile swap swap defaults 0 0' | sudo tee -a /etc/fstab\nfree -h\uff1a\u53ef\u67e5\u770b\n</code></pre> wsl\u5f62\u5f0f\u7684ubuntu\u4e2d</p> <p>\u6587\u4ef6\u7ba1\u7406\u5668\u5730\u5740\u8f93\u5165\uff1a%UserProfile%\uff0c\u56de\u8f66\u6253\u5f00.wslconfig(\u82e5\u65e0\u6b64\u6587\u4ef6\u5219\u65b0\u5efa)\uff0c\u914d\u7f6e\u9700\u8981\u7684\u53c2\u6570 <pre><code>[wsl2]\nmemory=16GB\nswap=10GB\nswapfile=D:\\\\ubuntu2004\\\\wsl-swap.vhdx\nnestedVirtualization=true\n</code></pre> \u66f4\u591a\u914d\u7f6e\u67e5\u770b\uff1a</p> <p>https://learn.microsoft.com/en-us/windows/wsl/wsl-config#wslconfig</p> <p>\u91ca\u653e\u7a7a\u95f4\uff1a <pre><code>wsl --shutdown\ndiskpart\nselect vdisk file=\"D:\\ubuntu2204\\ext4.vhdx\"\nattach vdisk readonly\ncompact vdisk\ndetach vdisk\nexit\n</code></pre> \u6620\u5c04window\u78c1\u76d8\uff0c\u6587\u4ef6\u7ba1\u7406\u5668\u8f93\u5165 <pre><code>\\\\wsl$\n</code></pre> \u540e\u56de\u8f66\uff0c\u53f3\u952e\u6dfb\u52a0\u6620\u5c04\u7f51\u7edc\u9a71\u52a8\u5668 </p>"}]}